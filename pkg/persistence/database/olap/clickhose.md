# ClickHouse OLAP åŒ…åŠŸèƒ½æ¸…å•

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. è¿æ¥ç®¡ç†
- âœ… å•ä¾‹è¿æ¥æ±  (åŸºäºé…ç½® Hash)
- âœ… è¿æ¥å¤ç”¨éªŒè¯ (Ping + æ•°æ®åº“å­˜åœ¨æ€§æ£€æŸ¥)
- âœ… è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“ (AutoCreateDB)
- âœ… è¿æ¥é…ç½®çƒ­æ›´æ–°
- âœ… ä¼˜é›…å…³é—­æ‰€æœ‰è¿æ¥

### 2. è¡¨ç®¡ç†
- âœ… è‡ªåŠ¨å»ºè¡¨ (åŸºäº entity.Model)
- âœ… é€’å½’è§£æåµŒå…¥å­—æ®µ
- âœ… è‡ªå®šä¹‰è¡¨å¼•æ“é…ç½®
- âœ… MergeTree å¼•æ“æ”¯æŒ
- âœ… åˆ†åŒº (PARTITION BY)
- âœ… æ’åºé”® (ORDER BY)
- âœ… TTL æ•°æ®è¿‡æœŸ
- âœ… ç´¢å¼•ç²’åº¦é…ç½®

### 3. ç»Ÿè®¡è§†å›¾
- âœ… åˆ†é’Ÿçº§ç»Ÿè®¡ (7å¤© TTL)
- âœ… å°æ—¶çº§ç»Ÿè®¡
- âœ… æ—¥çº§ç»Ÿè®¡
- âœ… æœˆçº§ç»Ÿè®¡
- âœ… è‡ªåŠ¨èšåˆ (sum/avg/max/min)
- âœ… POPULATE å›å¡«å†å²æ•°æ®

### 4. æ•°æ®æ“ä½œ
- âœ… å•æ¡æ’å…¥ (Insert)
- âœ… æ‰¹é‡æ’å…¥ (BatchInsert, 1000æ¡/æ‰¹)
- âœ… Nil æ•°æ®æ£€æŸ¥
- âœ… ç©ºæŒ‡é’ˆéªŒè¯

### 5. æŸ¥è¯¢åŠŸèƒ½
- âœ… é€šç”¨ç»Ÿè®¡æŸ¥è¯¢ (QueryStats)
- âœ… æ—¶é—´èŒƒå›´æŸ¥è¯¢
- âœ… å¤šç²’åº¦æ”¯æŒ (minute/hour/day/month)
- âœ… ç»“æœé™åºæ’åˆ—

## ğŸ§ª æµ‹è¯•è¦†ç›–

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- âœ… è¿æ¥åˆ›å»ºä¸éªŒè¯
- âœ… æ•°æ®åº“è‡ªåŠ¨åˆ›å»º
- âœ… è¡¨åˆ›å»ºä¸å­—æ®µæ˜ å°„
- âœ… ç»Ÿè®¡è§†å›¾åˆ›å»º

### æ•°æ®æ“ä½œæµ‹è¯•
- âœ… å•æ¡æ’å…¥
- âœ… æ‰¹é‡æ’å…¥ (1000æ¡)
- âœ… Nil æ•°æ®æ‹’ç»
- âœ… æ— æ•ˆæ•°æ®æ‹’ç»
- âœ… UTF-8 å­—ç¬¦ä¸²å¤„ç†
- âœ… æå€¼æ•°æ®å¤„ç†

### æŸ¥è¯¢æµ‹è¯•
- âœ… åŸºç¡€æŸ¥è¯¢
- âœ… æ—¶é—´èŒƒå›´æŸ¥è¯¢
- âœ… LIMIT åˆ†é¡µ
- âœ… ç»Ÿè®¡èšåˆå‡†ç¡®æ€§
- âœ… ä¸å­˜åœ¨è¡¨é”™è¯¯å¤„ç†

### æ€§èƒ½æµ‹è¯•
- âœ… å‹åŠ›æµ‹è¯• (10,000æ¡)
- âœ… å¹¶å‘æ’å…¥ (1000æ¡)
- âœ… ååé‡æµ‹è¯• (>100k æ¡/ç§’)

### é«˜çº§æµ‹è¯•
- âœ… è¿æ¥æ± å¤ç”¨
- âœ… å¤šé…ç½®è¿æ¥éš”ç¦»
- âœ… å¹¶å‘è¿æ¥è·å– (20ä¸ªå¹¶å‘)
- âœ… å¤§æ•°å€¼å¤„ç† (Float64 æå€¼)
- âœ… è‡ªå®šä¹‰è¡¨å¼•æ“
- âœ… èµ„æºæ¸…ç†

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **ååé‡**: ~110,000 æ¡/ç§’
- **æ‰¹é‡æ’å…¥**: 1000 æ¡/æ‰¹
- **å¹¶å‘æ”¯æŒ**: 20+ å¹¶å‘è¿æ¥
- **æ•°æ®ä¿ç•™**: 
  - åˆ†é’Ÿç»Ÿè®¡: 7 å¤©
  - å°æ—¶ç»Ÿè®¡: æ°¸ä¹…
  - æ—¥ç»Ÿè®¡: æ°¸ä¹…
  - æœˆç»Ÿè®¡: æ°¸ä¹…
  - åŸå§‹æ•°æ®: 90 å¤© (å¯é…ç½®)

## ğŸ”’ æ•°æ®å®‰å…¨

- âœ… è¿æ¥å‚æ•°éªŒè¯
- âœ… SQL æ³¨å…¥é˜²æŠ¤ (å‚æ•°åŒ–æŸ¥è¯¢)
- âœ… Nil æŒ‡é’ˆæ£€æŸ¥
- âœ… æ•°æ®åº“å­˜åœ¨æ€§éªŒè¯
- âœ… è¿æ¥æœ‰æ•ˆæ€§éªŒè¯

## ğŸ›  é…ç½®é€‰é¡¹

```go
type Config struct {
    Host         string  // ClickHouse ä¸»æœº
    Port         int     // ç«¯å£ (é»˜è®¤ 9000)
    Database     string  // æ•°æ®åº“å
    Username     string  // ç”¨æˆ·å
    Password     string  // å¯†ç 
    Debug        bool    // è°ƒè¯•æ¨¡å¼
    MaxOpenConns int     // æœ€å¤§è¿æ¥æ•° (é»˜è®¤ 10)
    MaxIdleConns int     // æœ€å¤§ç©ºé—²è¿æ¥ (é»˜è®¤ 5)
    AutoCreateDB bool    // è‡ªåŠ¨åˆ›å»ºæ•°æ®åº“
}
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

```go
// 1. åˆ›å»ºè¿æ¥
ch, err := NewClickHouse(&Config{
    Host:         "localhost",
    Port:         9000,
    Database:     "my_olap",
    Username:     "default",
    Password:     "password",
    AutoCreateDB: true,
})

// 2. åˆ›å»ºè¡¨
type Trade struct {
    entity.Model
    UserID   string  `gorm:"column:user_id"`
    Symbol   string  `gorm:"column:symbol"`
    Price    float64 `gorm:"column:price"`
    Quantity float64 `gorm:"column:quantity"`
}

err = ch.CreateTable(&Trade{})

// 3. æ’å…¥æ•°æ®
trade := &Trade{
    UserID:   "U001",
    Symbol:   "BTCUSDT",
    Price:    50000.00,
    Quantity: 0.1,
}
err = ch.Insert(trade)

// 4. æ‰¹é‡æ’å…¥
trades := []Trade{...}
err = ch.BatchInsert(&trades)

// 5. æŸ¥è¯¢ç»Ÿè®¡
stats, err := ch.QueryStats("trades", "hour", 
    time.Now().Add(-24*time.Hour), 
    time.Now(),
)
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. âœ… ä½¿ç”¨æ‰¹é‡æ’å…¥ä»£æ›¿å•æ¡æ’å…¥
2. âœ… åˆç†è®¾ç½®åˆ†åŒºé”® (å»ºè®®æŒ‰æœˆåˆ†åŒº)
3. âœ… é€‰æ‹©åˆé€‚çš„æ’åºé”® (å»ºè®®æ—¶é—´å­—æ®µ)
4. âœ… é…ç½®é€‚å½“çš„ TTL (é¿å…æ•°æ®è†¨èƒ€)
5. âœ… å¤ç”¨è¿æ¥å®ä¾‹ (è¿æ¥æ± )
6. âœ… ä½¿ç”¨ç‰©åŒ–è§†å›¾é¢„èšåˆ (åŠ é€ŸæŸ¥è¯¢)