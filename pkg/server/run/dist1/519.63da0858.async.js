(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(jt,Sn,i){"use strict";i.d(Sn,{Z:function(){return Zt}});var Et=i(13062),se=i(71230),bt=i(89032),re=i(15746),wt=i(71194),We=i(48889),Ft=i(34792),nn=i(48086),T=i(2824),f=i(67294),xn=i(28216),Dt=i(58024),Re=i(39144),Tt=i(48736),tn=i(27049),Rt=i(49111),Ke=i(19650),Mt=i(30887),an=i(54689),p=i(11849),yn=i(69610),Cn=i(54941),Zn=i(57254),jn=i(7945),En=i(24616),bn=i(63270),wn=i(3050),Fn=i(16165),Dn=i(49101),Tn=i(73171),Rn=i(8212),Mn=i(65233),Bn=i(20924),In=i(25592),Bt=i(59250),On=i(13013),It=i(22385),ln=i(94199),Ot=i(57663),be=i(71577),An=i(57119),n=i(85893),Vn=function(e){var s,g,o,a,Z,R,W,I,c,B,M,y={key:(s=e.key)!==null&&s!==void 0?s:e.name,name:(g=e.name)!==null&&g!==void 0?g:"",title:(o=e.title)!==null&&o!==void 0?o:"",text:e.text,danger:(a=e.danger)!==null&&a!==void 0?a:!1,block:(Z=e.block)!==null&&Z!==void 0?Z:!1,type:(R=e.type)!==null&&R!==void 0?R:"default",target:e.target,size:(W=e.size)!==null&&W!==void 0?W:"default",shape:(I=e.shape)!==null&&I!==void 0?I:"",icon:(c=e.icon)!==null&&c!==void 0?c:"",ghost:(B=e.ghost)!==null&&B!==void 0?B:!1,disabled:(M=e.disabled)!==null&&M!==void 0?M:!1},K=(0,f.useState)(!1),_=(0,T.Z)(K,2),d=_[0],t=_[1];function j(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(z){return z.command==e.name}):null}var V=function(){if(e.onClick!=null)try{t({delay:100});var oe=j();oe!=null&&oe.isalert?We.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(y.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(y)}}):e.onClick(y)}finally{t(!1)}};function r(){return e.ismenu?(0,n.jsx)(On.Z,{overlay:e.menu,children:(0,n.jsx)(ln.Z,{title:y.title,children:(0,n.jsx)(be.Z,(0,p.Z)((0,p.Z)({},y),{},{onClick:V,loading:d,children:y.text}))})}):(0,n.jsx)(ln.Z,{title:y.title,children:(0,n.jsx)(be.Z,(0,p.Z)((0,p.Z)({},y),{},{onClick:V,loading:d,children:y.text}))})}return r()},Me=Vn,At=i(47673),Je=i(4107),Vt=i(36877),Ln=i(96607),Lt=i(77883),kn=i(70507),kt=i(77576),Wn=i(12028),Wt=i(43358),Pn=i(34041),Pt=i(53400),on=i(41505),zn=i(76010),Pe=i(96486),Be=i(86582),zt=i(8963),Nn=i(68297),Nt=i(18106),He=i(58634),Kn=i(30381),un=i.n(Kn),Oe=i(75308);function rn(G,e,s){var g,o,a=(0,Oe.MM)(e,G);if((g=e.comvtp)!==null&&g!==void 0&&g.isvtp){var Z=new Map(e.comvtp.items);a=Z.get(a)}if((o=e.foreign)!==null&&o!==void 0&&o.isfkey){var R=e.foreign.oneobjectfield,W=e.foreign.onedisplayname;s[R]!=null&&(a=s[R][W])}if(e.type=="boolean"&&(a=a?"\u662F":"\u5426"),e.type=="datetime"){var I,c;if(a==""||a==null)return a;var B=(I=e.datatimetype)===null||I===void 0?void 0:I.dateformat;if((c=e.datatimetype)!==null&&c!==void 0&&c.istime){var M,y;B=((M=e.datatimetype)===null||M===void 0?void 0:M.dateformat)+" "+((y=e.datatimetype)===null||y===void 0?void 0:y.timeformat)}a=un()(a).format(B)}return a}var Hn=function(e,s){var g,o,a,Z=e.attr,R=(g=Z==null||(o=Z.fields)===null||o===void 0||(a=o.find(function(W){return W.field==s}))===null||a===void 0?void 0:a.porpfield)!==null&&g!==void 0?g:s;return R},Gn=function(e,s,g,o){var a,Z=e.attr,R=[];function W(c,B,M){var y=rn(c,B,M);return e.onFieldRender!=null?e.onFieldRender(B,y,M):(0,n.jsx)(n.Fragment,{children:y})}var I=function(B,M){return e.onColumnToEdit?e.onColumnToEdit(B,M):(e.onGetFieldToEdit&&(B=e.onGetFieldToEdit(B,M)),o(M),(0,n.jsx)(Ye,{attr:B,value:g[B.field],onChange:function(K){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(M,B.field,K))){console.log(K);var _=Object.assign({},g);M[B.field]=K,_[B.field]=K,o(_)}},onSearchValueChange:function(K){e.onSearchValueChange&&e.onSearchValueChange(B,M,K)},onSearchBefore:function(K,_){e.onSearchData&&e.onSearchData(K,function(d){_(d.model,d)})},onSearchData:e.onSearchData}))};return Z==null||(a=Z.fields)===null||a===void 0||a.filter(function(c){return c.visible}).forEach(function(c){var B;R.push({dataIndex:c.field,title:c.title,sorter:(B=c.sorter)!==null&&B!==void 0?B:!0,ellipsis:!0,render:function(y,K){if(K!=null)return s&&K.editable&&(c.isedit==null||c.isedit==!0)?I(c,K):W(y,c,K)}})}),R},Jn=He.Z.TabPane,Un=function G(e){var s,g,o,a,Z,R=(0,f.useState)((s=e.loading)!==null&&s!==void 0?s:!1),W=(0,T.Z)(R,2),I=W[0],c=W[1],B=(0,f.useState)((g=e.data)!==null&&g!==void 0?g:{rows:[],total:0}),M=(0,T.Z)(B,2),y=M[0],K=M[1],_=(0,f.useState)((o=e.rowedit)!==null&&o!==void 0?o:!1),d=(0,T.Z)(_,2),t=d[0],j=d[1],V=(0,f.useState)((a=e.current)!==null&&a!==void 0?a:1),r=(0,T.Z)(V,2),z=r[0],oe=r[1],J=(0,f.useState)(10),fe=(0,T.Z)(J,2),de=fe[0],ve=fe[1],O=(0,f.useState)([]),m=(0,T.Z)(O,2),E=m[0],w=m[1],ie=(0,f.useState)((Z=e.selectType)!==null&&Z!==void 0?Z:"radio"),X=(0,T.Z)(ie,2),ue=X[0],ge=X[1],je=(0,f.useState)(),Se=(0,T.Z)(je,2),Ce=Se[0],me=Se[1],$=(0,f.useState)({}),S=(0,T.Z)($,2),b=S[0],u=S[1];(0,f.useEffect)(function(){var l;K((l=e.data)!==null&&l!==void 0?l:{rows:[],total:0})},[e.data]),(0,f.useEffect)(function(){var l;j((l=e.rowedit)!==null&&l!==void 0?l:!1)},[e.rowedit]),(0,f.useEffect)(function(){var l;c((l=e.loading)!==null&&l!==void 0?l:!1)},[e.loading]),(0,f.useEffect)(function(){var l;oe((l=e.current)!==null&&l!==void 0?l:1)},[e.current]);var C=function(v,A,D){var ne,ae,he=function(Y){c(!1),K(Y)},F=function(Y){if(Y.column==null)return"";var k={name:Hn(e,Y.field),isdesc:!1};return Y.order=="descend"&&(k.isdesc=!0),k};c(!0),oe((ne=v.current)!==null&&ne!==void 0?ne:1),ve((ae=v.pageSize)!==null&&ae!==void 0?ae:10);try{var h,x,L={page:(h=v.current)!==null&&h!==void 0?h:1,size:(x=v.pageSize)!==null&&x!==void 0?x:10,sortList:[]};if(D!=null)if((0,Pe.isArray)(D))D.forEach(function(P){var Y=F(P);Y!=""&&P.sortList.push(Y)});else{var Q=F(D);Q!=""&&L.sortList.push(Q)}e.onSearchData!=null&&e.onSearchData(L,he)}finally{c(!1)}},N=function(v,A){var D=E.length<=v.length;if(w(v),e.onSelectRows!=null)if(v.length>0){var ne=A[A.length-1];D||(ne=null,v.length==1&&(ne=y.rows.find(function(ae){return ae.id==v[0]}))),e.onSelectRows(ne,v,D)}else e.onSelectRows(null,v,!1)},U=function(){if(!!e.isselect)return{selectedRowKeys:E,fixed:!0,type:ue,columnTitle:Ce,hideSelectAll:!1,columnWidth:"32px",onChange:N}};function le(l){l=="checkbox"&&(ge("radio"),w([]),e.onSelectStateChange&&e.onSelectStateChange(!1),me(te()))}function te(){return(0,n.jsx)(be.Z,{type:"link",onClick:function(){me(null),ge("checkbox"),w([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function Ee(l){if(e.isedit){l.editable=!t;var v=(0,Be.Z)(y.rows);v.forEach(function(A){A.id==l.id?A.editable=!t:A.editable&&(A.editable=!1)}),j(!t)}}function we(){var l;if(e.isexpandable&&(e==null||(l=e.attr)===null||l===void 0?void 0:l.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(A,D){var ne;if(!!A&&(Le(D,"id"),(e==null||(ne=e.attr)===null||ne===void 0?void 0:ne.childmodels)!=null&&e.attr.childmodels.length>0)){var ae,he=e==null||(ae=e.attr)===null||ae===void 0?void 0:ae.childmodels[0];if(D[he.propertyname]||(D[he.propertyname]=[]),D[he.propertyname].total=D[he.propertyname].length,D[he.propertyname].total==0){var F={page:1,size:10};Fe(F,he,D)}}},expandedRowRender:ze}:e.onExpandable(e.attr)}function Fe(l,v,A){l.childmodel=v,l.parent=A,e.onSearchData!=null&&e.onSearchData(l,function(D){var ne=(0,Be.Z)(y.rows),ae=ne.findIndex(function(he){return he.id==A.id});ne[ae][v.propertyname]=D.rows,ne[ae][v.propertyname].total1=D.total,K({rows:ne,total:y.total})})}var Ve=function(v,A){if(e.onExpandedRowTabPane){var D=e.onExpandedRowTabPane(v,A);if(D!=null)return D}return(0,n.jsx)(G,{isselect:!1,isedit:!1,isclosecard:!0,attr:v,data:{rows:A[v.propertyname],total:A[v.propertyname].total1},onSearchData:function(ae){Fe(ae,v,A)}},"id")},ze=function(v){var A;if((e==null||(A=e.attr)===null||A===void 0?void 0:A.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(ne){var ae=e.attr.childmodels[Number(ne)];Fe({},ae,v)},children:e.attr.childmodels.map(function(D,ne){return v[D.propertyname]||(v[D.propertyname]=[]),v[D.propertyname].total=v[D.propertyname].length,(0,n.jsx)(Jn,{tab:D.title,children:Ve(D,v)},ne)})})},Le=function(v,A){try{var D,ne;if(((D=U())===null||D===void 0?void 0:D.type)=="radio"&&N([v[A]],[v]),((ne=U())===null||ne===void 0?void 0:ne.type)=="checkbox"){var ae=v[A],he=[];E.includes(ae)?he=E.filter(function(F){return F!=ae}):(he=(0,Be.Z)(E),he.push(ae)),N(he,[v])}}catch(F){console.log(F)}};function ee(){var l=Gn(e,t,b,u),v="id";return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:v,columns:l,rowSelection:U(),scroll:{x:l.length*150},dataSource:y.rows,pagination:{current:z,pageSize:de,total:y.total,hideOnSinglePage:!0,showTotal:function(D){return"\u603B ".concat(D," \u884C")}},loading:I,expandable:we(),onChange:C,onRow:function(D){return{onClick:function(ae){ae.stopPropagation();try{var he,F;if(((he=U())===null||he===void 0?void 0:he.type)=="radio"&&N([D[v]],[D]),((F=U())===null||F===void 0?void 0:F.type)=="checkbox"){var h=D[v],x=[];E.includes(h)?x=E.filter(function(L){return L!=h}):(x=(0,Be.Z)(E),x.push(h)),N(x,[D])}}finally{e.onRowClick&&e.onRowClick(ae,D)}},onDoubleClick:function(ae){ae.stopPropagation(),Ee(D),e.onRowDoubleClick&&e.onRowDoubleClick(ae,D)},onMouseEnter:function(ae){e.onRowMouseEnter&&e.onRowMouseEnter(ae,D)},onMouseLeave:function(ae){e.onMouseLeave&&e.onMouseLeave(ae,D)}}}})}function H(){return e.isclosecard?ee():(0,n.jsx)(Re.Z,{children:ee()})}return H()},Ue=Un,Qn=i(61193),Xn=i.n(Qn),Yn=function(e){var s=(0,f.useState)({left:0,top:0,bottom:0,right:0}),g=(0,T.Z)(s,2),o=g[0],a=g[1],Z=(0,f.useState)(!0),R=(0,T.Z)(Z,2),W=R[0],I=R[1],c=f.createRef(),B=function(_,d){var t,j,V,r=(t=window)===null||t===void 0||(j=t.document)===null||j===void 0?void 0:j.documentElement,z=r.clientWidth,oe=r.clientHeight,J=c==null||(V=c.current)===null||V===void 0?void 0:V.getBoundingClientRect();a({left:-(J==null?void 0:J.left)+(d==null?void 0:d.x),right:z-((J==null?void 0:J.right)-(d==null?void 0:d.x)),top:-(J==null?void 0:J.top)+(d==null?void 0:d.y),bottom:oe-((J==null?void 0:J.bottom)-(d==null?void 0:d.y))})};function M(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){W&&I(!1)},onMouseOut:function(){I(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function y(){return(0,n.jsx)(We.Z,(0,p.Z)((0,p.Z)({},e),{},{title:M(),modalRender:function(_){return(0,n.jsx)(Xn(),{disabled:W,bounds:o,onStart:function(t,j){return B(t,j)},children:(0,n.jsx)("div",{ref:c,children:_})})}}))}return y()},Qe=Yn,$n=function(e){var s,g,o=(0,f.useState)([]),a=(0,T.Z)(o,2),Z=a[0],R=a[1],W=(0,f.useState)(null),I=(0,T.Z)(W,2),c=I[0],B=I[1],M=(0,f.useState)(!1),y=(0,T.Z)(M,2),K=y[0],_=y[1],d=(0,f.useState)(e.data),t=(0,T.Z)(d,2),j=t[0],V=t[1],r=(0,f.useState)(ue()),z=(0,T.Z)(r,1),oe=z[0],J=(0,f.useState)((s=e.commandShow)!==null&&s!==void 0?s:!0),fe=(0,T.Z)(J,1),de=fe[0],ve=(0,f.useState)((g=e.modelshow)!==null&&g!==void 0?g:!1),O=(0,T.Z)(ve,2),m=O[0],E=O[1];(0,f.useEffect)(function(){V(e.data)},[e.data]),(0,f.useEffect)(function(){var $;E(($=e.modelshow)!==null&&$!==void 0?$:!1)},[e.modelshow]);var w={page:1,size:10,whereList:[],sortList:[]},ie=function(){var S,b,u=un()().valueOf().toString(),C={id:u,isnew:!0,editable:!0};if((S=e.model)===null||S===void 0||(b=S.fields)===null||b===void 0||b.forEach(function(te){te.field!=null&&te.field!="id"&&(C[te.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(C))){var N=[],U=1;j!=null&&j.rows!=null&&(N=(0,Be.Z)(j.rows),N.forEach(function(te){te.editable=!1}),U=j.total+U);var le=[C].concat((0,Be.Z)(N));_(!0),e.onAdded!=null&&e.onAdded(C),e.onDataChange!=null?e.onDataChange({rows:le,total:U},C,"add"):V({rows:le,total:U})}},X=function(){if(Z.length>0){var S=[],b=[],u=(0,Be.Z)(j.rows);Z.forEach(function(N){if(N!=null){var U=u.findIndex(function(te){return te.id==N?e.onRemoveRowing!=null&&!e.onRemoveRowing(te)?!1:(te.isnew||S.push(N),!0):!1}),le=u.splice(U,1);e.onRemoveed!=null&&e.onRemoveed(le[0]),b.push(le[0])}});var C={rows:u,total:j.total-1};e.onDataChange!=null?b.length>0&&e.onDataChange(C,b,"remove"):V(C)}};function ue(){var $=[];return e.model!=null&&(e.model.isadd&&$.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&$.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&($=e.onGetCommands($)),$}function ge($,S){E($),e.onModalChange&&e.onModalChange($,S)}function je(){var $;if(!e.closetoolbar)return(0,n.jsx)(sn,{iscircle:e.iscirclebutton,commandShow:de,selectcount:Z.length,attrs:oe,isclosecard:!1,onClick:function(b,u){e.onCommandClicking&&e.onCommandClicking(u),b=="add"&&ie(),b=="remove"&&X(),e.onCommandClicked&&e.onCommandClicked(u)},searchShow:e.closesearch?!1:{fields:($=e.model)===null||$===void 0?void 0:$.fields,onSearch:function(b){w.whereList=[],b!=null&&((0,Pe.isArray)(b)?w.whereList=b:w.whereList=[b]),w.page=1,w.sortList=[],e.onSearchData!=null&&e.onSearchData(w,function(u){V(u)})},onSearchData:e.onSearchData}})}function Se(){var $,S,b;return(0,n.jsx)(Ue,{attr:e.model,data:j,isedit:!e.closeedit,rowedit:K,selectType:($=e.selectType)!==null&&$!==void 0?$:"checkbox",isselect:(S=e.isselect)!==null&&S!==void 0?S:!0,isclosecard:(b=e.closecard)!==null&&b!==void 0?b:!0,onSelectRows:function(C,N){console.log(C),console.log(N),R(N),B(C)},onSearchData:function(C,N){if(C.foreign&&C.field){e.onSearchData&&e.onSearchData(C,N);return}w.page=C.page,w.size=C.size,w.sortList=C.sortList,e.onSearchData!=null&&e.onSearchData(w,function(U){V(U)})},onRowDataChangeing:function(C,N,U){return e.onEditRowing!=null?e.onEditRowing(C,N,U):(!C.isnew&&e.onDataChange!=null&&e.onDataChange(j,C,"edit"),!0)},onRowDoubleClick:function(C,N){N.editable!=null&&_(N.editable),e.ismodal&&m&&ge(!1,N)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(C,N,U){N.isnew&&(N[U.rowfield]=U.row),e.onSearchValueChange&&e.onSearchValueChange(C,N,U)}})}function Ce(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[je(),Se()]}):(0,n.jsxs)(Re.Z,{children:[je(),Se()]})}function me(){if(e.ismodal){var $;return(0,n.jsx)(Qe,{title:($=e.model)===null||$===void 0?void 0:$.title,width:600,visible:m,onCancel:function(){ge(!1,null)},onOk:function(){ge(!1,c)},children:(0,n.jsx)(n.Fragment,{children:Ce()})})}else return Ce()}return me()},Xe=$n,qn=on.Z.RangePicker,_n=Je.Z.Search,Ze;(function(G){G.Input="Input",G.TextArea="Input.TextArea",G.InputNumber="InputNumber",G.Switch="Switch",G.DatePicker="DatePicker",G.RangePicker="RangePicker",G.Search="Input.Search",G.Avatar="Avatar",G.Select="Select"})(Ze||(Ze={}));var dn=function(e){var s,g={maxLength:500,size:"middle",placeholder:"",disabled:(s=e.disabled)!==null&&s!==void 0?s:!1,style:{width:"100%"},texttype:Ze.Input};for(var o in g)e.options!=null&&e.options[o]!=null&&(g[o]=e.options[o]);return e.width!=null&&(g.style.width=e.width),g.texttype=pn(e,g),g},pn=function(e,s){var g=e.textType,o=e.attr;if(o!=null){if((o.type=="int"||o.type=="int32"||o.type=="int64"||o.type=="decimal")&&(g=Ze.InputNumber,s.min=o.min,o.precision!=null&&o.precision>0&&(s.precision=o.precision),s.picker=void 0),o.type=="datetime"&&(g=Ze.DatePicker),o.type=="boolean"&&(g=Ze.Switch,e.search)){g=Ze.Select;var a=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];s.options=a}if(o.comvtp!=null&&o.comvtp.isvtp){g=Ze.Select;var Z=[];(0,Pe.isMap)(o.comvtp.items)||(o.comvtp.items=new Map(o.comvtp.items)),o.comvtp.items.forEach(function(R,W){Z.push({label:R,value:W})}),s.options=Z}o.foreign!=null&&o.foreign.isfkey&&(g=Ze.Search),o.length!=null&&o.length>0&&(s.maxLength=o.length),e.disabled==null&&o.disabled!=null&&(s.disabled=o.disabled),e.search&&(s.disabled=!1)}return g==null&&(g=Ze.Input),g},et=function(e){var s=(0,f.useState)(function(){return dn(e)}),g=(0,T.Z)(s,2),o=g[0],a=g[1],Z=(0,f.useState)({isshow:!1,model:void 0,data:void 0}),R=(0,T.Z)(Z,2),W=R[0],I=R[1],c=(0,f.useState)({row:void 0,value:"",text:"",rowfield:""}),B=(0,T.Z)(c,2),M=B[0],y=B[1],K=(0,zn.Z)(e.defaultValue,{value:j(e.value),onChange:function(m,E){if(console.log(m),e.onChange!=null){var w=V(m);console.log(w),e.onChange(w)}}}),_=(0,T.Z)(K,2),d=_[0],t=_[1];(0,f.useEffect)(function(){if(e.search){var O;M.field!=((O=e.attr)===null||O===void 0?void 0:O.field)&&r(null),a(dn(e))}},[e.attr]),(0,f.useEffect)(function(){var O;if(((O=e.attr)===null||O===void 0?void 0:O.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&M.row==null&&e.value!=null){var m=e.children[e.attr.foreign.oneobjectfield];r(m)}},[e.value]);function j(O){var m=e.attr;return(0,Oe.MM)(m,O)}function V(O){var m=e.attr;switch(o.texttype){case Ze.Select:return(m==null?void 0:m.type)=="string"?O.label:(0,Oe.Nz)(m,O)}return(0,Oe.Nz)(m,O)}function r(O){var m={value:"",text:"",row:void 0,rowfield:"",field:""};if(O){var E,w,ie,X,ue,ge,je,Se,Ce,me,$=(E=(w=e.attr)===null||w===void 0||(ie=w.foreign)===null||ie===void 0?void 0:ie.oneobjectfieldkey)!==null&&E!==void 0?E:"",S=(X=(ue=e.attr)===null||ue===void 0||(ge=ue.foreign)===null||ge===void 0?void 0:ge.onedisplayname)!==null&&X!==void 0?X:"";console.log($+"---"+S),m.row=O,m.value=O[$],m.text=O[S],m.rowfield=(je=(Se=e.attr)===null||Se===void 0||(Ce=Se.foreign)===null||Ce===void 0?void 0:Ce.oneobjectfield)!==null&&je!==void 0?je:"",m.field=(me=e.attr)===null||me===void 0?void 0:me.field,console.log(m)}y(m),t(m.value),e.onSearchValueChange&&e.onSearchValueChange(m)}function z(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_n,(0,p.Z)((0,p.Z)({},o),{},{size:"middle",value:M.text,onSearch:function(m){if(e.onSearchBefore!=null){var E,w={foreign:(E=e.attr)===null||E===void 0?void 0:E.foreign,value:m,field:e.attr};e.onSearchBefore(w,function(ie,X){var ue;(ie.title==null||ie.title=="")&&(ie.title=(ue=e.attr)===null||ue===void 0?void 0:ue.title),I({isshow:!0,model:ie,data:X})})}}})),(0,n.jsx)(Xe,{ismodal:!0,modelshow:W.isshow,model:W.model,data:W.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(m,E){var w=(0,p.Z)({},W);w.isshow=m,console.log(w),I(w),r(E)},onSearchData:function(m,E){var w;m.field=e.attr,m.foreign=(w=e.attr)===null||w===void 0?void 0:w.foreign,e.onSearchData!=null&&e.onSearchData(m,E)}})]})}function oe(){var O=e.attr;return(O==null?void 0:O.type)=="string"&&(o.labelInValue=!0),(0,n.jsx)(Pn.Z,(0,p.Z)((0,p.Z)({},o),{},{size:"middle",value:d,onChange:t}))}function J(){return(0,n.jsx)(Wn.Z,{size:"default",checked:d,onChange:t})}function fe(){var O=e.attr,m=void 0,E=void 0;if(console.log(O),O&&O.datatimetype&&(O.datatimetype.istime&&(m={format:O.datatimetype.timeformat}),E=O.datatimetype.dateformat,O.datatimetype.istime&&(E=E+" "+O.datatimetype.timeformat)),e.search){var w;return(0,n.jsx)(qn,{size:"middle",showTime:m,format:E,style:o.style,value:d,allowEmpty:[!0,!0],picker:(w=e.options)===null||w===void 0?void 0:w.picker,onChange:t})}else return(0,n.jsx)(on.Z,(0,p.Z)((0,p.Z)({},o),{},{format:E,showTime:m,size:"middle",picker:"date",value:d,onChange:t}))}function de(){return(0,n.jsx)(kn.Z,(0,p.Z)((0,p.Z)({},o),{},{value:d,onChange:t}))}function ve(){switch(o.texttype){case Ze.InputNumber:return de();case Ze.DatePicker:return fe();case Ze.Switch:return J();case Ze.Select:return oe();case Ze.Search:return z()}return(0,n.jsx)(Je.Z,(0,p.Z)((0,p.Z)({},o),{},{size:"middle",value:d,onChange:function(m){t(m.target.value)}}))}return ve()},Ye=et,nt=i(76570),Kt=null,tt=function(e){var s=new Map;s.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),s.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),s.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var g=(0,f.useState)({value:"",attr:{type:"string"}}),o=(0,T.Z)(g,2),a=o[0],Z=o[1],R=(0,f.useState)(""),W=(0,T.Z)(R,2),I=W[0],c=W[1],B=(0,f.useState)({type:"string"}),M=(0,T.Z)(B,2),y=M[0],K=M[1],_=(0,f.useState)({name:"*",type:"string",symbol:""}),d=(0,T.Z)(_,2),t=d[0],j=d[1],V=(0,f.useState)({picker:null}),r=(0,T.Z)(V,2),z=r[0],oe=r[1],J=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(m){if(m.issearch){var E,w=(E=m.searchsymbol)!==null&&E!==void 0?E:s.get(m.type);m.type=="datetime"&&(w=s.get(m.type)),m.type=="decimal"&&(w=s.get("int")),m.foreign&&m.foreign.isfkey&&(w=void 0),J.push({label:m.title,value:m.field,children:w})}});function fe(){return(0,n.jsx)(Ln.Z,{style:{width:"140px"},options:J,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(E){var w;console.log(E);var ie=E[0],X=(w=e.fields)===null||w===void 0?void 0:w.find(function(ge){return ge.field==ie});if(j({name:ie,symbol:E[1],type:X==null?void 0:X.type}),t.name!=ie&&(Z(Object.assign(a,{value:"",attr:X})),c(""),K(X),(X==null?void 0:X.type)=="datetime")){var ue=(0,p.Z)({},z);ue.picker=E[1],oe(ue)}}})}function de(){return(0,n.jsx)(Ye,{width:"240px",options:z,search:!0,name:t.name,attr:y,value:I,onChange:function(E){console.log(E),c(E),Z({value:E,attr:a.attr})},onSearchBefore:function(E,w){e.onSearchData&&e.onSearchData(E,function(ie){w(ie.model,ie)})},onSearchData:e.onSearchData})}function ve(){return(0,n.jsx)(be.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(nt.Z,{}),onClick:function(){console.log(a);var E=(0,Oe.Nz)(y,a.value);console.log(E);var w={name:t.name,symbol:t.symbol,value:E};if(w.name=="*"&&w.value=="")e.onSearch();else{if(y.type=="datetime"&&a.value!=""&&(0,Pe.isArray)(E)){var ie=[];return a.value[0]!=null&&(w.symbol=">=",w.value=a.value[0],ie.push(w)),a.value[1]!=null&&ie.push({name:t.name,symbol:"<=",value:a.value[1]}),e.onSearch(ie)}e.onSearch(w)}}})}function O(){return(0,n.jsxs)(Je.Z.Group,{compact:!0,children:[fe(),de(),ve()]})}return O()},at=tt,it=function(){function G(){(0,yn.Z)(this,G),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Cn.Z)(G,[{key:"onPrint",value:function(s){}},{key:"onSet",value:function(s){}},{key:"onHelp",value:function(s){}},{key:"onAbout",value:function(s){}}]),G}(),lt=function(e){var s=["add","create"],g=["remove","delete"],o=["update","edit"],a=["ImportData","import"],Z=["ExportData","export"];function R(){var t,j=[],V=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(r){if(r.issplit&&r.splitname!=null)if(V.has(r.splitname)){var z=V.get(r.splitname);z==null||z.push(r)}else V.set(r.splitname,[r]);else j.push(r)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:j.map(function(r){if(V.has(r.command)){var z,oe=(0,n.jsx)(an.Z,{children:(z=V.get(r.command))===null||z===void 0?void 0:z.map(function(J,fe){return(0,n.jsx)(an.Z.Item,{children:(0,n.jsx)(Me,(0,p.Z)((0,p.Z)({},y(J)),{},{onClick:function(){return M(J.command,J)},toolbar:e}),fe)},fe)})});return(0,n.jsx)(Me,(0,p.Z)((0,p.Z)({},y(r)),{},{icon:(0,n.jsx)(Zn.Z,{}),ismenu:!0,menu:oe,onClick:function(){return M(r.command,r)},toolbar:e}))}else return(0,n.jsx)(Me,(0,p.Z)((0,p.Z)({},y(r)),{},{onClick:function(){return M(r.command,r)},toolbar:e}))})})}function W(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function I(){if(e.helpShow!=null&&e.helpShow!=!1){var t,j,V,r,z,oe,J,fe,de,ve,O=(0,f.useState)({isprint:(t=(j=e.helpShow)===null||j===void 0?void 0:j.isprint)!==null&&t!==void 0?t:!1,isset:(V=(r=e.helpShow)===null||r===void 0?void 0:r.isset)!==null&&V!==void 0?V:!1,ishelp:(z=(oe=e.helpShow)===null||oe===void 0?void 0:oe.ishelp)!==null&&z!==void 0?z:!1,isabout:(J=(fe=e.helpShow)===null||fe===void 0?void 0:fe.isabout)!==null&&J!==void 0?J:!1,wvh:(de=(ve=e.helpShow)===null||ve===void 0?void 0:ve.wvh)!==null&&de!==void 0?de:new it}),m=(0,T.Z)(O,2),E=m[0],w=m[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:c(E)})}}function c(t){var j=[];if(t.isprint){var V;j.push((0,n.jsx)(Me,{title:(V=t.wvh)===null||V===void 0?void 0:V.printText,name:"print",shape:"circle",icon:(0,n.jsx)(jn.Z,{}),onClick:M}))}if(t.isset){var r;j.push((0,n.jsx)(Me,{title:(r=t.wvh)===null||r===void 0?void 0:r.setText,name:"set",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:M}))}if(t.ishelp){var z;j.push((0,n.jsx)(Me,{title:(z=t.wvh)===null||z===void 0?void 0:z.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:M}))}if(t.isabout){var oe;j.push((0,n.jsx)(Me,{title:(oe=t.wvh)===null||oe===void 0?void 0:oe.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:M}))}return j.length>0&&j.unshift((0,n.jsx)(tn.Z,{type:"vertical"})),j.map(function(J){return J})}function B(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(at,(0,p.Z)({},e.searchShow))}var M=function(j,V){e.onClick!=null&&e.onClick(j,V)};function y(t){var j,V={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return V.disabled=(j=W(t))!==null&&j!==void 0?j:!1,V=K(V),e.iscircle&&(V.shape="circle",V.title=V.text,V.text=""),V}function K(t){return s.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Fn.Z,{component:Dn.Z})),g.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Tn.Z,{})),o.includes(t.name)&&(t.icon=(0,n.jsx)(Rn.Z,{})),a.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),Z.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(In.Z,{})),t}var _=function(j){return j.length==3?(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:10,children:(0,n.jsx)(se.Z,{justify:"start",children:j[0]})}),(0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)(se.Z,{justify:"end",children:j[1]})}),(0,n.jsx)(re.Z,{span:6,children:(0,n.jsx)(se.Z,{justify:"end",children:j[2]})})]}):j.length==2?(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(se.Z,{justify:"start",children:j[0]})}),(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(se.Z,{justify:"end",children:j[1]})})]}):j.length==1?(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(se.Z,{justify:"start",children:j[0]})})}):(0,n.jsx)(n.Fragment,{})};function d(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(re.Z,{children:B()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(re.Z,{children:R()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(re.Z,{children:I()})),e.isclosecard?_(t):(0,n.jsx)(Re.Z,{children:_(t)})}return d()},sn=lt,Ht=i(9715),$e=i(22712),ot=He.Z.TabPane,ut=function(e){var s,g=$e.Z.useForm(),o=(0,T.Z)(g,1),a=o[0],Z=(0,f.useState)(e.title),R=(0,T.Z)(Z,2),W=R[0],I=R[1],c=(0,f.useState)((s=e.isshow)!==null&&s!==void 0?s:!1),B=(0,T.Z)(c,2),M=B[0],y=B[1],K=(0,f.useState)(w(e.attr)),_=(0,T.Z)(K,2),d=_[0],t=_[1],j=(0,f.useState)(function(){return X(e.values)}),V=(0,T.Z)(j,2),r=V[0],z=V[1],oe=(0,f.useState)(!1),J=(0,T.Z)(oe,2),fe=J[0],de=J[1],ve=(0,f.useState)(!1),O=(0,T.Z)(ve,2),m=O[0],E=O[1];(0,f.useEffect)(function(){console.log(e.values),e.values!=null?z(X(e.values)):ue()},[e.values]),(0,f.useEffect)(function(){t(w(e.attr))},[e.attr]);function w(S){var b,u;return{items:S==null||(b=S.fields)===null||b===void 0?void 0:b.filter(function(C){return C.visible&&C.isedit}),models:S==null||(u=S.childmodels)===null||u===void 0?void 0:u.filter(function(C){return C.propertyname==null&&(C.propertyname=C.name),C.visible})}}function ie(){var S,b=[];return(S=d.items)===null||S===void 0||S.forEach(function(u){var C=ge(e.attr,u);e.onInitTextBox!=null&&e.onInitTextBox(u,txtprops),b.push((0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)($e.Z.Item,(0,p.Z)((0,p.Z)({},C),{},{children:(0,n.jsx)(Ye,{attr:u,onSearchBefore:function(U,le){e.onSearchData!=null&&e.onSearchData(U,function(te){le(te.model,te)})},onSearchData:function(U,le){e.onSearchData&&e.onSearchData(U,le)},children:r})}),u.field)}))}),e.onInitFormed!=null&&(a.setFieldDisabled=function(u,C){var N;(N=d.items)===null||N===void 0||N.forEach(function(U){var le;((le=U.field)===null||le===void 0?void 0:le.toLocaleLowerCase())==u.toLocaleLowerCase()&&(U.disabled=C)}),t(d)},a.setTitle=function(u){I(u)},a.show=function(){y(!0)},a.hide=function(){y(!1)},a.setValues=function(u){z(X(u))},a.clear=function(){ue()},a.setHideSearch=function(u){E(u)},a.setHideToolbar=function(u){de(u)},e.onInitFormed(a)),b}function X(S){var b;return S==null&&(S={}),a.setFieldsValue(S),d.models!=null&&((b=d.models)===null||b===void 0?void 0:b.length)>0&&(console.log(d),d.models.forEach(function(u){S[u.propertyname]?S[u.propertyname].total=S[u.propertyname].length:(S[u.propertyname]=[],S[u.propertyname].total=0),u.removeRows=[]})),S}function ue(){var S;a.resetFields();var b={};(S=d.models)===null||S===void 0||S.forEach(function(u){b[u.propertyname]||(b[u.propertyname]=[],b[u.propertyname].total=0)}),z(b)}function ge(S,b){var u={};u.name=b.field,u.label=b.title;var C=je(b);return b.disabled||(u.rules=C),e.onInitItem!=null&&e.onInitItem(b,u),u}function je(S){var b,u=[];if(S.required&&u.push({required:S.required}),(b=S.length)!==null&&b!==void 0?b:0>0){var C;u.push({max:(C=S.length)!==null&&C!==void 0?C:500,type:(0,Oe.mc)(S.type)})}return e.onFieldRules!=null&&(u=e.onFieldRules(S,u)),u}var Se=function(b){var u,C=Object.assign({},r);for(var N in b)C[N]=b[N];return d.models!=null&&((u=d.models)===null||u===void 0?void 0:u.length)>0&&d.models.forEach(function(U){var le;C[U.propertyname]!=null&&C[U.propertyname].forEach(function(te){te.isnew?te.modelState=1:te.modelState=2}),(le=U.removeRows)===null||le===void 0||le.forEach(function(te){te.modelState=3,C[U.propertyname].push(te)})}),console.log(C),C};function Ce(){return(0,n.jsx)($e.Z,{labelAlign:"left",form:a,onFinish:function(b){var u=Se(b);a.onFinish!=null&&a.onFinish(u),e.onFinish!=null&&e.onFinish(u)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(se.Z,{gutter:24,children:ie()})})}function me(){var S;if(d.models!=null&&((S=d.models)===null||S===void 0?void 0:S.length)>0){var b;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(b=d.models)===null||b===void 0?void 0:b.map(function(u,C){var N;return(0,n.jsx)(ot,{tab:u.title,children:(0,n.jsx)(Xe,{model:u,data:{rows:r[u.propertyname],total:(N=r[u.propertyname])===null||N===void 0?void 0:N.total},iscirclebutton:!0,closetoolbar:fe,closesearch:m,closecard:!0,onSearchData:function(le){e.onSearchData!=null&&(le.parent=r,le.childmodel=u,e.onSearchData(le,function(te){var Ee=Object.assign({},r);Ee[u.propertyname]=te.rows,Ee[u.propertyname].total=te.total,z(Ee)}))},onDataChange:function(le,te,Ee){console.log(le,te);var we=Object.assign({},r);we[u.propertyname]=le.rows,we[u.propertyname].total=le.total,console.log(we),Ee=="remove"&&te.forEach(function(Fe){Fe&&!Fe.isnew&&u.removeRows.push(Fe)}),z(we)}})},C)})})}return(0,n.jsx)(n.Fragment,{})}function $(){return e.ismodal?(0,n.jsxs)(Qe,{title:W,width:1100,visible:M,onCancel:function(){return y(!1)},onOk:function(){a.submit()},children:[(0,n.jsx)(Re.Z,{children:Ce()}),me()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Re.Z,{title:W,children:Ce()}),me()]})}return $()},fn=ut,cn=i(38535),rt=i(73218),Gt=i(34669),dt=i(82833),Jt=i(17462),qe=i(76772),_e=i(3182),vn=i(91220),st=i(94043),Ae=i.n(st),ft=i(43347),Ut=i(35556),hn=i(97880),ct=hn.Z.Step,vt=function(e){var s,g,o=(0,f.useState)((s=e.currentStep)!==null&&s!==void 0?s:0),a=(0,T.Z)(o,2),Z=a[0],R=a[1],W=(0,f.useState)((g=e.isShow)!==null&&g!==void 0?g:!1),I=(0,T.Z)(W,2),c=I[0],B=I[1];(0,f.useEffect)(function(){var d;B((d=e.isShow)!==null&&d!==void 0?d:!1)},[e.isShow]),(0,f.useEffect)(function(){var d;if(R((d=e.currentStep)!==null&&d!==void 0?d:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function M(d){return e.onCurrentStepComponent?e.onCurrentStepComponent(d):(0,n.jsx)(fn,{attr:e.attr,ismodal:!1})}function y(){var d;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(hn.Z,{current:Z,onChange:function(j){R(j),e.onChange&&e.onChange(j)},children:(d=e.stepItem)===null||d===void 0?void 0:d.map(function(t){return(0,n.jsx)(ct,(0,p.Z)({},t))})}),(0,n.jsx)(tn.Z,{}),M(Z)]})}function K(d){B(d),e.onShowChange&&e.onShowChange(d)}function _(){if(e.isModal){var d={onOk:function(){K(!1)},onCancel:function(){K(!1)}};return e.closeOk&&(d.footer=!1),(0,n.jsx)(Qe,(0,p.Z)((0,p.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:c},d),{},{children:y()}))}return e.isCard?(0,n.jsx)(Re.Z,{title:e.title,bordered:!1,children:y()}):y()}return _()},ht=vt,pe=i(54701),gt=i(58602),gn=i(32059);function mn(G,e,s){var g=G.map(function(I,c){return Object.assign({},{key:I.key,title:I.title,position:String.fromCharCode(65+c)+1})}).reduce(function(I,c){return Object.assign({},I,(0,gn.Z)({},c.position,{key:c.key,v:c.title}))},{}),o=e.map(function(I,c){return G.map(function(B,M){return Object.assign({},{content:I[B.key],position:String.fromCharCode(65+M)+(c+2)})})}).reduce(function(I,c){return I.concat(c)}).reduce(function(I,c){return Object.assign({},I,(0,gn.Z)({},c.position,{v:c.content}))},{}),a=Object.assign({},g,o),Z=Object.keys(a),R="".concat(Z[0],":").concat(Z[Z.length-1]),W={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},a,{"!ref":R,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};pe.NC(W,s)}function mt(G,e,s,g,o){return en.apply(this,arguments)}function en(){return en=(0,_e.Z)(Ae().mark(function G(e,s,g,o,a){var Z,R;return Ae().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:s>0&&(Z=[],e.fields.forEach(function(c){c.visible&&Z.push({title:c.title,key:c.field,item:c})}),R=Object.assign({},g),R.page=1,R.size=s,R.size>0&&o(R).then(function(c){if(c!=null&&c.success&&c.data&&c.data.rows){var B=c.data.rows;for(var M in B)for(var y in Z){var K=B[M][Z[y].key],_=rn(K,Z[y].item,B[M]);B[M][Z[y].key]=_!=null?_:""}mn(Z,B,a)}}));case 1:case"end":return I.stop()}},G)})),en.apply(this,arguments)}var St=function(e){var s,g=(0,f.useState)(0),o=(0,T.Z)(g,2),a=o[0],Z=o[1],R=(0,f.useState)((s=e.isShow)!==null&&s!==void 0?s:!1),W=(0,T.Z)(R,2),I=W[0],c=W[1],B=(0,f.useState)(0),M=(0,T.Z)(B,2),y=M[0],K=M[1],_=(0,f.useState)({model:void 0,data:{rows:[],total:0}}),d=(0,T.Z)(_,2),t=d[0],j=d[1],V=(0,f.useState)(N(e.attr)),r=(0,T.Z)(V,2),z=r[0],oe=r[1],J=(0,f.useState)({message:"",description:"",type:"success",count:0}),fe=(0,T.Z)(J,2),de=fe[0],ve=fe[1],O=(0,f.useState)(null),m=(0,T.Z)(O,2),E=m[0],w=m[1],ie=(0,f.useState)({model:null,rows:[],total:0}),X=(0,T.Z)(ie,2),ue=X[0],ge=X[1],je=(0,f.useState)(!0),Se=(0,T.Z)(je,2),Ce=Se[0],me=Se[1],$=(0,f.useState)(void 0),S=(0,T.Z)($,2),b=S[0],u=S[1];function C(){Z(0),K(0),j({model:void 0,data:{rows:[],total:0}}),ve({message:"",description:"",type:"success",count:0}),w(null),ge({model:null,rows:[],total:0}),me(!0),u(void 0)}function N(F){var h;return(h=F.fields)===null||h===void 0?void 0:h.filter(function(x){return x.visible&&!x.disabled})}(0,f.useEffect)(function(){c(e.isShow)},[e.isShow]),(0,f.useEffect)(function(){oe(N(e.attr))},[e.attr]);var U=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(x){setTimeout(function(){x(!0)},h)})};function le(){var F={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},h={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},x={title:"\u5BFC\u5165\u6570\u636E"},L=[F,h,x];return L}function te(F){var h={fields:[]};if(F.length>0)for(var x in F[0]){var L;(L=h.fields)===null||L===void 0||L.push({field:x,title:x,type:"string",visible:!0,sorter:!1})}return h}function Ee(F){var h=F.rowcount,x=F.data;if(h>0){K(h);for(var L=te(x),Q=[],P=0;P<6;P++)Q.push(x[P]);j({model:L,data:{rows:Q,total:5}})}}function we(){var F,h,x=new Map,L=new Map;(F=t.model)===null||F===void 0||(h=F.fields)===null||h===void 0||h.forEach(function(Y,k){x.set(k,Y.title)});var Q=[];z.forEach(function(Y,k){var ce,xe;L.set(k,Y.title);var q=Y.foreign&&Y.foreign.isfkey?"Name":"",ye=(ce=t.model)===null||ce===void 0||(xe=ce.fields)===null||xe===void 0?void 0:xe.find(function(Ge){return Ge.field==Y.field||Ge.field==Y.title}),De=void 0;if(ye==null||ye==null){var Ie;k<((Ie=t.model)===null||Ie===void 0?void 0:Ie.fields.length)&&(De=k),Q.push({id:k,source:De,target:k,defaultValue:"",foreignMap:q})}else{var Te=(0,vn.Z)(x.entries()),ke;try{for(Te.s();!(ke=Te.n()).done;){var Ne=ke.value;if(ye.title==Ne[1]||ye.field==Ne[1]){De=Ne[0];break}}}catch(Ge){Te.e(Ge)}finally{Te.f()}Q.push({id:k,source:De,target:k,defaultValue:"",foreignMap:q})}});var P=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:x},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:L},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];ge({model:{fields:P,isadd:!1,isedit:!0,isremove:!1},rows:Q,total:Q.length})}function Fe(F){var h={};for(var x in ue.rows){var L,Q,P=ue.rows[x],Y=(L=t.model)===null||L===void 0?void 0:L.fields[P.source];if(!((Y==null||Y==null)&&P.defaultValue=="")){var k=z[P.target];if(!(k==null||k==null)){if(P.defaultValue!=null&&P.defaultValue!=""){var ce;h[k.field]=P.defaultValue,(ce=k.foreign)!==null&&ce!==void 0&&ce.isfkey&&(h[k.field]=P[k.field]);continue}var xe=Y.field,q=F[xe];if(k.required&&(q==null||q==null||q=="")){v(h,"\u5BFC\u5165\u6570\u636E".concat(Y.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(k.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!(q==null||q==null||q=="")){if(k!=null&&k.comvtp&&k.comvtp.isvtp){var ye=(0,vn.Z)(k.comvtp.items.entries()),De;try{for(ye.s();!(De=ye.n()).done;){var Ie=De.value;if(q==Ie[1]){q=Ie[0];break}}}catch(ke){ye.e(ke)}finally{ye.f()}}if((Q=k.foreign)!==null&&Q!==void 0&&Q.isfkey&&b!=null&&b.has(k.field)){var Te=b.get(k.field);q=Te[q]}h[k.field]=q}}}}return h}function Ve(F){var h=new Map;return ue.rows.forEach(function(x){var L,Q=(L=t.model)===null||L===void 0?void 0:L.fields[x.source];if(Q){var P,Y=z[x.target],k=x.foreignMap==""?"Name":x.foreignMap;if((P=Y.foreign)!==null&&P!==void 0&&P.isfkey&&x.defaultValue==""){h.has(Y.field)||h.set(Y.field,new Map);var ce=h.get(Y.field);for(var xe in F){var q=F[xe],ye=q[Q.field];ye!=null&&ye!=""&&!ce.has(ye)&&(ce==null||ce.set(ye,k))}}}}),h}function ze(F){var h=Ve(F);if(h.size==0){me(!1),ve({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var x="";h.forEach(function(L,Q){var P=z.find(function(q){return q.field==Q}),Y=z.find(function(q){return q.type=="string"}).searchsymbol.find(function(q){return q.label=="\u7B49\u4E8E"}).value,k=[],ce="";L.forEach(function(q,ye){ce=q.toLowerCase(),k.push({name:q,symbol:Y,value:ye,relation:"||"})});var xe={field:P,foreign:P.foreign,whereList:k};e.onSearchData&&(U(200),e.onSearchData(xe,function(q){if(q&&q.rows.length>0)if(q.rows.length==L.size){console.log(L);for(var ye in q.rows){var De=q.rows[ye][ce];L.has(De)&&(L[De]=q.rows[ye].id)}u(h),me(!1),console.log(de.description),ve({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(P==null?void 0:P.title,"\u6570\u636E").concat(q.total,`\u9879\u3002
`),type:"info",count:0})}else L.forEach(function(Ie,Te){var ke=q.rows.find(function(Ne){return Ne[ce]==Te});x+="".concat(P==null?void 0:P.title,"\u4E2D\u672A\u627E\u5230").concat(ce,"\u4E3A").concat(Te,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),ke==null&&v(q.rows,x,0)});else x+="".concat(P==null?void 0:P.title,"\u4E2D\u672A\u627E\u5230").concat(ce,"\u4E3A").concat(k[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),v(q.rows,x,0)}))})}function Le(F){if(E==null||E.data==null){We.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var h=E.data;if(ue.rows.length<=0){We.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!Ce){if(F==h.length){ve({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:F}),me(!0);return}var x=Fe(h[F]);x!=null&&H(x,function(L,Q){ee(x,L,Q,F)})}}function ee(F,h,x,L){h?(L++,ve({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(F),type:"success",count:L}),U(200),Le(L)):v(F,x,L)}function H(F,h){return l.apply(this,arguments)}function l(){return l=(0,_e.Z)(Ae().mark(function F(h,x){return Ae().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:e.onAdd&&e.onAdd("add",h).then(function(){var P=(0,_e.Z)(Ae().mark(function Y(k){return Ae().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:if(console.log(k),k.ok!=null&&k.ok==!1&&(me(!0),x(!1,k.statusText)),!(k!=null&&k.success)){xe.next=8;break}return xe.next=5,U(200);case 5:x(!0),xe.next=10;break;case 8:me(!0),x(!1,k.message);case 10:case"end":return xe.stop()}},Y)}));return function(Y){return P.apply(this,arguments)}}());case 1:case"end":return Q.stop()}},F)})),l.apply(this,arguments)}function v(F,h,x){var L={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(F),description:h,type:"error",count:x,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var P=e.form;P.clear(),P.setHideSearch(!0),P.setTitle(e.title),P.show(),P.setValues(F),P.onFinish=function(Y){console.log(Y),P.hide(),H(Y,function(k,ce){ee(Y,k,ce,x)})}}},children:"\u4FEE\u6539"})})};ve(L)}function A(){var F={name:"file",accept:".xlsx, .xls",onChange:function(x){console.log(x);var L=new FileReader;L.onload=function(Q){try{var P=Q.target.result,Y=pe.ij(P,{type:"binary"}),k=[];for(var ce in Y.Sheets)if(Y.Sheets.hasOwnProperty(ce)){k=pe.P6.sheet_to_json(Y.Sheets[ce]);break}var xe={data:k,rowcount:k.length};w(xe),Ee(xe)}catch(q){nn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log(q)}},L.readAsBinaryString(x.file.originFileObj)}};return(0,n.jsxs)(Re.Z,{children:[(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(y,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"primary",onClick:function(){var x=[],L={};z.forEach(function(Q){x.push({title:Q.title,key:Q.field}),L[Q.field]=Q.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),mn(x,[L],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsxs)(gt.default,(0,p.Z)((0,p.Z)({},F),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(ft.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Ue,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,push:11,children:(0,n.jsx)(be.Z,{type:"primary",disabled:y<1,onClick:function(){Z(a+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function D(){var F={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:ue.model,data:{rows:ue.rows,total:ue.total},onDataChange:function(x){ge((0,p.Z)((0,p.Z)({},ue),{},{rows:x.rows}))},onGetFieldToEdit:function(x,L){if(x.field=="defaultValue"){var Q=L.target,P=z[Q];return P}return x},onEditRowing:function(x,L,Q){return Q!=null&&(x.defaultValue=String(Q)),!0},onSearchValueChange:function(x,L,Q){Q.text!=null&&(L.defaultValue=Q.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Xe,(0,p.Z)({},F))})}),(0,n.jsxs)(se.Z,{gutter:[16,16],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",onClick:function(){Z(a+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){Z(a-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function ne(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(y,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(de.count,"\u884C"),type:"info"})})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(dt.Z,{percent:parseInt((de.count/y*100).toString()),status:"active"})})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,(0,p.Z)({},de))})}),(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",disabled:Ce,onClick:function(){Le(de.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){Z(a-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function ae(F){c(F),e.onShowChange&&e.onShowChange(F),F||C()}function he(){return(0,n.jsx)(ht,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:I,stepItem:le(),currentStep:a,onChange:function(h){if(h==1&&we(),h==2&&E&&E.data){var x=E.data;ze(x)}Z(h)},onCurrentStepComponent:function(h){return h==0?A():h==1?D():h==2?ne():(0,n.jsx)(n.Fragment,{})},onShowChange:function(h){ae(h)}})}return he()},xt=St,yt=function(e){var s=(0,f.useState)(!1),g=(0,T.Z)(s,2),o=g[0],a=g[1],Z=(0,f.useState)(null),R=(0,T.Z)(Z,2),W=R[0],I=R[1],c=(0,f.useState)(0),B=(0,T.Z)(c,2),M=B[0],y=B[1],K=(0,f.useState)([]),_=(0,T.Z)(K,2),d=_[0],t=_[1],j=(0,f.useState)(void 0),V=(0,T.Z)(j,2),r=V[0],z=V[1],oe=(0,f.useState)({rows:[],total:0}),J=(0,T.Z)(oe,2),fe=J[0],de=J[1],ve=(0,f.useState)(!1),O=(0,T.Z)(ve,2),m=O[0],E=O[1],w=(0,f.useState)(null),ie=(0,T.Z)(w,2),X=ie[0],ue=ie[1],ge=(0,f.useState)({page:1,size:10,whereList:[],sortList:[]}),je=(0,T.Z)(ge,2),Se=je[0],Ce=je[1],me=(0,f.useState)(1),$=(0,T.Z)(me,2),S=$[0],b=$[1];if((0,f.useEffect)(function(){z(void 0),I(null),Ce({page:1,size:10,whereList:[],sortList:[]}),y(0),t([]),de({rows:[],total:0}),u()},[e.controller]),r==null)return(0,n.jsx)(n.Fragment,{});function u(){if(console.log("waypage.init"),console.log(e),!e.init){var ee,H=(ee=e.namespace)!==null&&ee!==void 0?ee:e.controller;console.log(H+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(l){l!=null&&(l.success?(z(l.data),l.data.autoload&&C({},function(v){de(v)})):te(l.message))})}function C(ee,H){y(0),a(!0),e.search(ee).then(function(l){if(l!=null)if(a(!1),l!=null&&l.success){if(l.data==null&&(l.data={rows:[],total:0}),l.data.rows==null&&(l.data.rows=[]),ee.foreign==null&&ee.childmodel==null&&d.length>0){var v=l.data.rows.find(function(A){return A.id==d[0]});v!=null?(t(d),y(d.length),I(v)):(t([]),y(0),I(null))}H?H(l.data):de(l.data)}else te(l.message)},function(l){console.log(l),a(!1)})}var N=function(H){var l=null;H.isselectrow&&(l=W),H.selectmultiple&&(l=d),U(H,l)},U=function(H,l){a(!0),e.execute(H.command,l).then(function(v){console.log(v),v!=null&&v.success?(a(!1),nn.default.success(H.name+"\u5B8C\u6210"),(r==null?void 0:r.viewtype)!="form"&&(X&&X.hide(),C(Se,function(A){de(A)}))):(a(!1),te(v.message))},function(v){console.log(v),a(!1)})};function le(ee){return typeof ee=="object"&&ee!==null}function te(ee){var H=ee;le(ee)&&(H=ee.message),ee.response&&(H=ee.response.message),We.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(rt.Z,{}),content:(0,n.jsx)("div",{children:H})})}function Ee(ee,H){X!=null&&X.clear(),X.setHideSearch(!0),X.setTitle((r==null?void 0:r.title)+"-"+ee.name),X.show(),H&&(X.setValues(H),X.setHideSearch(!1)),X.onFinish=function(l){console.log(l),U(ee,l)}}function we(ee){var H;console.log("renderToolbar - model:",r),console.log("renderToolbar - data:",fe),console.log("renderToolbar - selectCount:",M),console.log("renderToolbar - values:",W);var l=ee?{fields:r==null||(H=r.fields)===null||H===void 0?void 0:H.filter(function(v){var A;return(A=v.issearch)!==null&&A!==void 0?A:!0}),onSearch:function(A){a(!0);var D={page:1,whereList:[]};A!=null&&((0,Pe.isArray)(A)?D.whereList=A:D.whereList=[A]),Ce(D),b(1),C(D,function(ne){de(ne)})},onSearchData:C}:!1;try{return(0,n.jsx)(sn,{attrs:r==null?void 0:r.commands,isselectrow:!0,selectcount:M,commandShow:!0,isshow:!ee,onClick:function(A,D){if(console.log(A),A=="ImportData"||A=="importdata"){E(!0);return}if(A=="ExportData"||A=="exportdata"){mt(r,fe.total,Se,e.search,e.title+".xlsx");return}if(A=="add"){if((r==null?void 0:r.viewtype)=="form"){X.onFinish=function(ne){console.log(ne),U(D,ne)},X.submit();return}Ee(D);return}if(A=="edit"){Ee(D,W);return}N(D)},searchShow:l})}catch(v){return console.error("renderToolbar error:",v),(0,n.jsx)("div",{children:"\u5DE5\u5177\u680F\u6E32\u67D3\u9519\u8BEF"})}}function Fe(){return(0,n.jsx)(Ue,{attr:r,data:fe,isselect:!0,isexpandable:!0,loading:o,current:S,onSelectRows:function(H,l){console.log(H),console.log(l),t(l),y(l.length),I(H)},onSearchData:function(H,l){if(H.parent&&H.childmodel){C(H,function(v){l(v)});return}a(!0),b(H.page),H.whereList=Se.whereList,Ce(H),C(H,function(v){de(v)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(H,l){var v,A=r==null||(v=r.commands)===null||v===void 0?void 0:v.find(function(D){return D.command=="edit"&&D.visible});A!=null&&Ee(A,l)}})}function Ve(ee){return(0,n.jsx)(fn,{attr:r,title:e.title,ismodal:ee,onInitFormed:function(l){ue(l)},onSearchData:C})}function ze(){return(r==null?void 0:r.viewtype)=="form"?Le():(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:we(!0)})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Fe()})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ve(!0)})}),(0,n.jsx)(xt,{title:e.title,isShow:m,attr:r,onAdd:e.execute,form:X,onShowChange:function(H){E(H),H||C(Se)},onSearchData:C})]})}function Le(){return(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:we(!1)})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ve(!1)})})]})}return ze()};function Ct(G,e){var s=e.controller;e.namespace!=null&&(s=e.namespace);var g=function(R){return{type:s+"/init",payload:R}},o=function(R){return{type:s+"/search",payload:R}},a=function(R){return{type:s+"/execute",payload:R}};return{dispatch:G,init:function(){return G(g({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(R){var W=e.namespace+"/"+e.service+"/"+e.controller;return G(o({c:W,item:R,s:e.service}))},execute:function(R,W){var I=e.namespace+"/"+e.service+"/"+e.controller;return G(a({c:I,command:R,item:W,s:e.service}))}}}var Zt=(0,xn.$j)(function(){},Ct)(yt)},20067:function(){}}]);
