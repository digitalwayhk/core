(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(Zt,Sn,a){"use strict";a.d(Sn,{Z:function(){return Ct}});var jt=a(13062),se=a(71230),Et=a(89032),re=a(15746),bt=a(71194),Le=a(48889),wt=a(34792),nn=a(48086),w=a(2824),s=a(67294),xn=a(28216),Ft=a(58024),Me=a(39144),Dt=a(48736),tn=a(27049),Tt=a(49111),Ke=a(19650),Rt=a(30887),an=a(54689),_=a(11849),yn=a(69610),Cn=a(54941),Zn=a(57254),jn=a(7945),En=a(24616),bn=a(63270),wn=a(3050),Fn=a(16165),Dn=a(49101),Tn=a(73171),Rn=a(8212),Mn=a(65233),Bn=a(20924),In=a(25592),Mt=a(59250),On=a(13013),Bt=a(22385),ln=a(94199),It=a(57663),we=a(71577),An=a(57119),n=a(85893),Vn=function(e){var f,x,d,l,b,R,P,M,v,I,A,Z={key:(f=e.key)!==null&&f!==void 0?f:e.name,name:(x=e.name)!==null&&x!==void 0?x:"",title:(d=e.title)!==null&&d!==void 0?d:"",text:e.text,danger:(l=e.danger)!==null&&l!==void 0?l:!1,block:(b=e.block)!==null&&b!==void 0?b:!1,type:(R=e.type)!==null&&R!==void 0?R:"default",target:e.target,size:(P=e.size)!==null&&P!==void 0?P:"default",shape:(M=e.shape)!==null&&M!==void 0?M:"",icon:(v=e.icon)!==null&&v!==void 0?v:"",ghost:(I=e.ghost)!==null&&I!==void 0?I:!1,disabled:(A=e.disabled)!==null&&A!==void 0?A:!1},N=(0,s.useState)(!1),q=(0,w.Z)(N,2),u=q[0],t=q[1];function g(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(z){return z.command==e.name}):null}var V=function(){if(e.onClick!=null)try{t({delay:100});var ie=g();ie!=null&&ie.isalert?Le.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(Z.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(Z)}}):e.onClick(Z)}finally{t(!1)}};function o(){return e.ismenu?(0,n.jsx)(On.Z,{overlay:e.menu,children:(0,n.jsx)(ln.Z,{title:Z.title,children:(0,n.jsx)(we.Z,(0,_.Z)((0,_.Z)({},Z),{},{onClick:V,loading:u,children:Z.text}))})}):(0,n.jsx)(ln.Z,{title:Z.title,children:(0,n.jsx)(we.Z,(0,_.Z)((0,_.Z)({},Z),{},{onClick:V,loading:u,children:Z.text}))})}return o()},Be=Vn,Ot=a(47673),Je=a(4107),At=a(36877),kn=a(96607),Vt=a(77883),Ln=a(70507),kt=a(77576),Wn=a(12028),Lt=a(43358),zn=a(34041),Wt=a(53400),un=a(41505),Pn=a(76010),We=a(96486),Oe=a(86582),zt=a(8963),Nn=a(68297),Pt=a(18106),He=a(58634),Kn=a(30381),on=a.n(Kn),Ae=a(75308);function rn(J,e,f){var x,d,l=(0,Ae.MM)(e,J);if((x=e.comvtp)!==null&&x!==void 0&&x.isvtp){var b=new Map(e.comvtp.items);l=b.get(l)}if((d=e.foreign)!==null&&d!==void 0&&d.isfkey){var R=e.foreign.oneobjectfield,P=e.foreign.onedisplayname;f[R]!=null&&(l=f[R][P])}if(e.type=="boolean"&&(l=l?"\u662F":"\u5426"),e.type=="datetime"){var M;l=l!=""?on()(l).format((M=e.datatimetype)===null||M===void 0?void 0:M.dateformat).toString():""}return l}var Hn=function(e,f,x,d){var l,b=e.attr,R=[];function P(v,I,A){var Z=rn(v,I,A);return e.onFieldRender!=null?e.onFieldRender(I,Z,A):(0,n.jsx)(n.Fragment,{children:Z})}var M=function(I,A){return e.onColumnToEdit?e.onColumnToEdit(I,A):(e.onGetFieldToEdit&&(I=e.onGetFieldToEdit(I,A)),d(A),(0,n.jsx)(Ye,{attr:I,value:x[I.field],onChange:function(N){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(A,I.field,N))){console.log(N);var q=Object.assign({},x);A[I.field]=N,q[I.field]=N,d(q)}},onSearchValueChange:function(N){e.onSearchValueChange&&e.onSearchValueChange(I,A,N)},onSearchBefore:function(N,q){e.onSearchData&&e.onSearchData(N,function(u){q(u.model,u)})},onSearchData:e.onSearchData}))};return b==null||(l=b.fields)===null||l===void 0||l.filter(function(v){return v.visible}).forEach(function(v){var I;R.push({dataIndex:v.field,title:v.title,sorter:(I=v.sorter)!==null&&I!==void 0?I:!0,render:function(Z,N){if(N!=null)return f&&N.editable&&(v.isedit==null||v.isedit==!0)?M(v,N):P(Z,v,N)}})}),R},Gn=He.Z.TabPane,Jn=function J(e){var f,x,d,l,b,R=(0,s.useState)((f=e.loading)!==null&&f!==void 0?f:!1),P=(0,w.Z)(R,2),M=P[0],v=P[1],I=(0,s.useState)((x=e.data)!==null&&x!==void 0?x:{rows:[],total:0}),A=(0,w.Z)(I,2),Z=A[0],N=A[1],q=(0,s.useState)((d=e.rowedit)!==null&&d!==void 0?d:!1),u=(0,w.Z)(q,2),t=u[0],g=u[1],V=(0,s.useState)((l=e.current)!==null&&l!==void 0?l:1),o=(0,w.Z)(V,2),z=o[0],ie=o[1],G=(0,s.useState)(10),ce=(0,w.Z)(G,2),de=ce[0],ve=ce[1],k=(0,s.useState)([]),h=(0,w.Z)(k,2),F=h[0],j=h[1],ae=(0,s.useState)((b=e.selectType)!==null&&b!==void 0?b:"radio"),U=(0,w.Z)(ae,2),ue=U[0],he=U[1],je=(0,s.useState)(),ge=(0,w.Z)(je,2),ye=ge[0],me=ge[1],Y=(0,s.useState)({}),m=(0,w.Z)(Y,2),y=m[0],i=m[1];(0,s.useEffect)(function(){var r;N((r=e.data)!==null&&r!==void 0?r:{rows:[],total:0})},[e.data]),(0,s.useEffect)(function(){var r;g((r=e.rowedit)!==null&&r!==void 0?r:!1)},[e.rowedit]),(0,s.useEffect)(function(){var r;v((r=e.loading)!==null&&r!==void 0?r:!1)},[e.loading]),(0,s.useEffect)(function(){var r;ie((r=e.current)!==null&&r!==void 0?r:1)},[e.current]);var S=function(E,B,T){var te,oe,Ze=function(O){v(!1),N(O)},De=function(O){if(O.column==null)return"";var ee={name:O.field,isdesc:!1};return O.order=="descend"&&(ee.isdesc=!0),ee};v(!0),ie((te=E.current)!==null&&te!==void 0?te:1),ve((oe=E.pageSize)!==null&&oe!==void 0?oe:10);try{var D,c,C={page:(D=E.current)!==null&&D!==void 0?D:1,size:(c=E.pageSize)!==null&&c!==void 0?c:10,sortList:[]};if(T!=null)if((0,We.isArray)(T))T.forEach(function(H){var O=De(H);O!=""&&H.sortList.push(O)});else{var L=De(T);L!=""&&C.sortList.push(L)}e.onSearchData!=null&&e.onSearchData(C,Ze)}finally{v(!1)}},K=function(E,B){var T=F.length<=E.length;if(j(E),e.onSelectRows!=null)if(E.length>0){var te=B[B.length-1];T||(te=null,E.length==1&&(te=Z.rows.find(function(oe){return oe.id==E[0]}))),e.onSelectRows(te,E,T)}else e.onSelectRows(null,E,!1)},Q=function(){if(!!e.isselect)return{selectedRowKeys:F,fixed:!0,type:ue,columnTitle:ye,hideSelectAll:!1,columnWidth:"32px",onChange:K}};function ne(r){r=="checkbox"&&(he("radio"),j([]),e.onSelectStateChange&&e.onSelectStateChange(!1),me(p()))}function p(){return(0,n.jsx)(we.Z,{type:"link",onClick:function(){me(null),he("checkbox"),j([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function Ee(r){if(e.isedit){r.editable=!t;var E=(0,Oe.Z)(Z.rows);E.forEach(function(B){B.id==r.id?B.editable=!t:B.editable&&(B.editable=!1)}),g(!t)}}function Fe(){var r;if(e.isexpandable&&(e==null||(r=e.attr)===null||r===void 0?void 0:r.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(B,T){var te;if(!!B&&(e==null||(te=e.attr)===null||te===void 0?void 0:te.childmodels)!=null&&e.attr.childmodels.length>0){var oe,Ze=e==null||(oe=e.attr)===null||oe===void 0?void 0:oe.childmodels[0];if(T[Ze.propertyname]||(T[Ze.propertyname]=[]),T[Ze.propertyname].total=T[Ze.propertyname].length,T[Ze.propertyname].total==0){var De={page:1,size:10};be(De,Ze,T)}}},expandedRowRender:Pe}:e.onExpandable(e.attr)}function be(r,E,B){r.childmodel=E,r.parent=B,e.onSearchData!=null&&e.onSearchData(r,function(T){var te=(0,Oe.Z)(Z.rows),oe=te.findIndex(function(Ze){return Ze.id==B.id});te[oe][E.propertyname]=T.rows,te[oe][E.propertyname].total1=T.total,N({rows:te,total:Z.total})})}var ze=function(E,B){if(e.onExpandedRowTabPane){var T=e.onExpandedRowTabPane(E,B);if(T!=null)return T}return(0,n.jsx)(J,{isselect:!1,isedit:!1,isclosecard:!0,attr:E,data:{rows:B[E.propertyname],total:B[E.propertyname].total1},onSearchData:function(oe){be(oe,E,B)}},"id")},Pe=function(E){var B;if((e==null||(B=e.attr)===null||B===void 0?void 0:B.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(te){var oe=e.attr.childmodels[Number(te)];be({},oe,E)},children:e.attr.childmodels.map(function(T,te){return E[T.propertyname]||(E[T.propertyname]=[]),E[T.propertyname].total=E[T.propertyname].length,(0,n.jsx)(Gn,{tab:T.title,children:ze(T,E)},te)})})};function le(){var r=Hn(e,t,y,i),E="id";return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:E,columns:r,rowSelection:Q(),scroll:{x:r.length*150},dataSource:Z.rows,pagination:{current:z,pageSize:de,total:Z.total,hideOnSinglePage:!0,showTotal:function(T){return"\u603B ".concat(T," \u884C")}},loading:M,expandable:Fe(),onChange:S,onRow:function(T){return{onClick:function(oe){oe.stopPropagation();try{var Ze,De;if(((Ze=Q())===null||Ze===void 0?void 0:Ze.type)=="radio"&&K([T[E]],[T]),((De=Q())===null||De===void 0?void 0:De.type)=="checkbox"){var D=T[E],c=[];F.includes(D)?c=F.filter(function(C){return C!=D}):(c=(0,Oe.Z)(F),c.push(D)),K(c,[T])}}finally{e.onRowClick&&e.onRowClick(oe,T)}},onDoubleClick:function(oe){oe.stopPropagation(),Ee(T),e.onRowDoubleClick&&e.onRowDoubleClick(oe,T)},onMouseEnter:function(oe){e.onRowMouseEnter&&e.onRowMouseEnter(oe,T)},onMouseLeave:function(oe){e.onMouseLeave&&e.onMouseLeave(oe,T)}}}})}function X(){return e.isclosecard?le():(0,n.jsx)(Me.Z,{children:le()})}return X()},Ue=Jn,Un=a(61193),Qn=a.n(Un),Xn=function(e){var f=(0,s.useState)({left:0,top:0,bottom:0,right:0}),x=(0,w.Z)(f,2),d=x[0],l=x[1],b=(0,s.useState)(!0),R=(0,w.Z)(b,2),P=R[0],M=R[1],v=s.createRef(),I=function(q,u){var t,g,V,o=(t=window)===null||t===void 0||(g=t.document)===null||g===void 0?void 0:g.documentElement,z=o.clientWidth,ie=o.clientHeight,G=v==null||(V=v.current)===null||V===void 0?void 0:V.getBoundingClientRect();l({left:-(G==null?void 0:G.left)+(u==null?void 0:u.x),right:z-((G==null?void 0:G.right)-(u==null?void 0:u.x)),top:-(G==null?void 0:G.top)+(u==null?void 0:u.y),bottom:ie-((G==null?void 0:G.bottom)-(u==null?void 0:u.y))})};function A(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){P&&M(!1)},onMouseOut:function(){M(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function Z(){return(0,n.jsx)(Le.Z,(0,_.Z)((0,_.Z)({},e),{},{title:A(),modalRender:function(q){return(0,n.jsx)(Qn(),{disabled:P,bounds:d,onStart:function(t,g){return I(t,g)},children:(0,n.jsx)("div",{ref:v,children:q})})}}))}return Z()},Qe=Xn,Yn=function(e){var f,x,d=(0,s.useState)([]),l=(0,w.Z)(d,2),b=l[0],R=l[1],P=(0,s.useState)(null),M=(0,w.Z)(P,2),v=M[0],I=M[1],A=(0,s.useState)(!1),Z=(0,w.Z)(A,2),N=Z[0],q=Z[1],u=(0,s.useState)(e.data),t=(0,w.Z)(u,2),g=t[0],V=t[1],o=(0,s.useState)(ue()),z=(0,w.Z)(o,1),ie=z[0],G=(0,s.useState)((f=e.commandShow)!==null&&f!==void 0?f:!0),ce=(0,w.Z)(G,1),de=ce[0],ve=(0,s.useState)((x=e.modelshow)!==null&&x!==void 0?x:!1),k=(0,w.Z)(ve,2),h=k[0],F=k[1];(0,s.useEffect)(function(){V(e.data)},[e.data]),(0,s.useEffect)(function(){var Y;F((Y=e.modelshow)!==null&&Y!==void 0?Y:!1)},[e.modelshow]);var j={page:1,size:10,whereList:[],sortList:[]},ae=function(){var m,y,i=on()().valueOf(),S={id:i,isnew:!0,editable:!0};if((m=e.model)===null||m===void 0||(y=m.fields)===null||y===void 0||y.forEach(function(p){p.field!=null&&p.field!="id"&&(S[p.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(S))){var K=[],Q=1;g!=null&&g.rows!=null&&(K=(0,Oe.Z)(g.rows),K.forEach(function(p){p.editable=!1}),Q=g.total+Q);var ne=[S].concat((0,Oe.Z)(K));q(!0),e.onAdded!=null&&e.onAdded(S),e.onDataChange!=null?e.onDataChange({rows:ne,total:Q},S,"add"):V({rows:ne,total:Q})}},U=function(){if(b.length>0){var m=[],y=[],i=(0,Oe.Z)(g.rows);b.forEach(function(K){if(K!=null){var Q=i.findIndex(function(p){return p.id==K?e.onRemoveRowing!=null&&!e.onRemoveRowing(p)?!1:(p.isnew||m.push(K),!0):!1}),ne=i.splice(Q,1);e.onRemoveed!=null&&e.onRemoveed(ne[0]),y.push(ne[0])}});var S={rows:i,total:g.total-1};e.onDataChange!=null?y.length>0&&e.onDataChange(S,y,"remove"):V(S)}};function ue(){var Y=[];return e.model!=null&&(e.model.isadd&&Y.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&Y.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&(Y=e.onGetCommands(Y)),Y}function he(Y,m){F(Y),e.onModalChange&&e.onModalChange(Y,m)}function je(){var Y;if(!e.closetoolbar)return(0,n.jsx)(sn,{iscircle:e.iscirclebutton,commandShow:de,selectcount:b.length,attrs:ie,isclosecard:!1,onClick:function(y,i){e.onCommandClicking&&e.onCommandClicking(i),y=="add"&&ae(),y=="remove"&&U(),e.onCommandClicked&&e.onCommandClicked(i)},searchShow:e.closesearch?!1:{fields:(Y=e.model)===null||Y===void 0?void 0:Y.fields,onSearch:function(y){j.whereList=[],y!=null&&((0,We.isArray)(y)?j.whereList=y:j.whereList=[y]),j.page=1,j.sortList=[],e.onSearchData!=null&&e.onSearchData(j,function(i){V(i)})},onSearchData:e.onSearchData}})}function ge(){var Y,m,y;return(0,n.jsx)(Ue,{attr:e.model,data:g,isedit:!e.closeedit,rowedit:N,selectType:(Y=e.selectType)!==null&&Y!==void 0?Y:"checkbox",isselect:(m=e.isselect)!==null&&m!==void 0?m:!0,isclosecard:(y=e.closecard)!==null&&y!==void 0?y:!0,onSelectRows:function(S,K){R(K),I(S)},onSearchData:function(S,K){if(S.foreign&&S.field){e.onSearchData&&e.onSearchData(S,K);return}j.page=S.page,j.size=S.size,j.sortList=S.sortList,e.onSearchData!=null&&e.onSearchData(j,function(Q){V(Q)})},onRowDataChangeing:function(S,K,Q){return e.onEditRowing!=null?e.onEditRowing(S,K,Q):(!S.isnew&&e.onDataChange!=null&&e.onDataChange(g,S,"edit"),!0)},onRowDoubleClick:function(S,K){K.editable!=null&&q(K.editable),e.ismodal&&h&&he(!1,K)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(S,K,Q){K.isnew&&(K[Q.rowfield]=Q.row),e.onSearchValueChange&&e.onSearchValueChange(S,K,Q)}})}function ye(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[je(),ge()]}):(0,n.jsxs)(Me.Z,{children:[je(),ge()]})}function me(){if(e.ismodal){var Y;return(0,n.jsx)(Qe,{title:(Y=e.model)===null||Y===void 0?void 0:Y.title,width:600,visible:h,onCancel:function(){he(!1,null)},onOk:function(){he(!1,v)},children:(0,n.jsx)(n.Fragment,{children:ye()})})}else return ye()}return me()},Xe=Yn,$n=un.Z.RangePicker,qn=Je.Z.Search,Ce;(function(J){J.Input="Input",J.TextArea="Input.TextArea",J.InputNumber="InputNumber",J.Switch="Switch",J.DatePicker="DatePicker",J.RangePicker="RangePicker",J.Search="Input.Search",J.Avatar="Avatar",J.Select="Select"})(Ce||(Ce={}));var dn=function(e){var f,x={maxLength:500,size:"middle",placeholder:"",disabled:(f=e.disabled)!==null&&f!==void 0?f:!1,style:{width:"100%"},texttype:Ce.Input};for(var d in x)e.options!=null&&e.options[d]!=null&&(x[d]=e.options[d]);return e.width!=null&&(x.style.width=e.width),x.texttype=_n(e,x),x},_n=function(e,f){var x=e.textType,d=e.attr;if(d!=null){if((d.type=="int"||d.type=="int32"||d.type=="int64"||d.type=="decimal")&&(x=Ce.InputNumber,f.min=d.min,d.precision!=null&&d.precision>0&&(f.precision=d.precision),f.picker=void 0),d.type=="datetime"&&(x=Ce.DatePicker),d.type=="boolean"&&(x=Ce.Switch,e.search)){x=Ce.Select;var l=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];f.options=l}if(d.comvtp!=null&&d.comvtp.isvtp){x=Ce.Select;var b=[];(0,We.isMap)(d.comvtp.items)||(d.comvtp.items=new Map(d.comvtp.items)),d.comvtp.items.forEach(function(R,P){b.push({label:R,value:P})}),f.options=b}d.foreign!=null&&d.foreign.isfkey&&(x=Ce.Search),d.length!=null&&d.length>0&&(f.maxLength=d.length),e.disabled==null&&d.disabled!=null&&(f.disabled=d.disabled),e.search&&(f.disabled=!1)}return x==null&&(x=Ce.Input),x},pn=function(e){var f=(0,s.useState)(function(){return dn(e)}),x=(0,w.Z)(f,2),d=x[0],l=x[1],b=(0,s.useState)({isshow:!1,model:void 0,data:void 0}),R=(0,w.Z)(b,2),P=R[0],M=R[1],v=(0,s.useState)({row:void 0,value:"",text:"",rowfield:""}),I=(0,w.Z)(v,2),A=I[0],Z=I[1],N=(0,Pn.Z)(e.defaultValue,{value:g(e.value),onChange:function(h,F){if(console.log(h),e.onChange!=null){var j=V(h);console.log(j),e.onChange(j)}}}),q=(0,w.Z)(N,2),u=q[0],t=q[1];(0,s.useEffect)(function(){if(e.search){var k;A.field!=((k=e.attr)===null||k===void 0?void 0:k.field)&&o(null),l(dn(e))}},[e.attr]),(0,s.useEffect)(function(){var k;if(((k=e.attr)===null||k===void 0?void 0:k.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&A.row==null&&e.value!=null){var h=e.children[e.attr.foreign.oneobjectfield];o(h)}},[e.value]);function g(k){var h=e.attr;return(0,Ae.MM)(h,k)}function V(k){var h=e.attr;switch(d.texttype){case Ce.Select:return(h==null?void 0:h.type)=="string"?k.label:(0,Ae.Nz)(h,k)}return(0,Ae.Nz)(h,k)}function o(k){var h={value:"",text:"",row:void 0,rowfield:"",field:""};if(k){var F,j,ae,U,ue,he,je,ge,ye,me,Y=(F=(j=e.attr)===null||j===void 0||(ae=j.foreign)===null||ae===void 0?void 0:ae.oneobjectfieldkey)!==null&&F!==void 0?F:"",m=(U=(ue=e.attr)===null||ue===void 0||(he=ue.foreign)===null||he===void 0?void 0:he.onedisplayname)!==null&&U!==void 0?U:"";console.log(Y+"---"+m),h.row=k,h.value=k[Y],h.text=k[m],h.rowfield=(je=(ge=e.attr)===null||ge===void 0||(ye=ge.foreign)===null||ye===void 0?void 0:ye.oneobjectfield)!==null&&je!==void 0?je:"",h.field=(me=e.attr)===null||me===void 0?void 0:me.field,console.log(h)}Z(h),t(h.value),e.onSearchValueChange&&e.onSearchValueChange(h)}function z(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(qn,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:A.text,onSearch:function(h){if(e.onSearchBefore!=null){var F,j={foreign:(F=e.attr)===null||F===void 0?void 0:F.foreign,value:h,field:e.attr};e.onSearchBefore(j,function(ae,U){var ue;(ae.title==null||ae.title=="")&&(ae.title=(ue=e.attr)===null||ue===void 0?void 0:ue.title),M({isshow:!0,model:ae,data:U})})}}})),(0,n.jsx)(Xe,{ismodal:!0,modelshow:P.isshow,model:P.model,data:P.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(h,F){var j=(0,_.Z)({},P);j.isshow=h,console.log(j),M(j),o(F)},onSearchData:function(h,F){var j;h.field=e.attr,h.foreign=(j=e.attr)===null||j===void 0?void 0:j.foreign,e.onSearchData!=null&&e.onSearchData(h,F)}})]})}function ie(){var k=e.attr;return(k==null?void 0:k.type)=="string"&&(d.labelInValue=!0),(0,n.jsx)(zn.Z,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:u,onChange:t}))}function G(){return(0,n.jsx)(Wn.Z,{size:"default",checked:u,onChange:t})}function ce(){var k=e.attr,h=void 0,F=void 0;if(console.log(k),k.datatimetype&&(k.datatimetype.istime&&(h={format:k.datatimetype.timeformat}),F=k.datatimetype.dateformat),console.log(h),e.search){var j;return(0,n.jsx)($n,{size:"middle",showTime:h,format:F,style:d.style,value:u,allowEmpty:[!0,!0],picker:(j=e.options)===null||j===void 0?void 0:j.picker,onChange:t})}else return(0,n.jsx)(un.Z,(0,_.Z)((0,_.Z)({},d),{},{format:F,showTime:h,size:"middle",picker:"date",value:u,onChange:t}))}function de(){return(0,n.jsx)(Ln.Z,(0,_.Z)((0,_.Z)({},d),{},{value:u,onChange:t}))}function ve(){switch(d.texttype){case Ce.InputNumber:return de();case Ce.DatePicker:return ce();case Ce.Switch:return G();case Ce.Select:return ie();case Ce.Search:return z()}return(0,n.jsx)(Je.Z,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:u,onChange:function(h){t(h.target.value)}}))}return ve()},Ye=pn,et=a(76570),Nt=null,nt=function(e){var f=new Map;f.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),f.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),f.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var x=(0,s.useState)({value:"",attr:{type:"string"}}),d=(0,w.Z)(x,2),l=d[0],b=d[1],R=(0,s.useState)(""),P=(0,w.Z)(R,2),M=P[0],v=P[1],I=(0,s.useState)({type:"string"}),A=(0,w.Z)(I,2),Z=A[0],N=A[1],q=(0,s.useState)({name:"*",type:"string",symbol:""}),u=(0,w.Z)(q,2),t=u[0],g=u[1],V=(0,s.useState)({picker:null}),o=(0,w.Z)(V,2),z=o[0],ie=o[1],G=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(h){if(h.issearch){var F,j=(F=h.searchsymbol)!==null&&F!==void 0?F:f.get(h.type);h.type=="datetime"&&(j=f.get(h.type)),h.type=="decimal"&&(j=f.get("int")),h.foreign&&h.foreign.isfkey&&(j=void 0),G.push({label:h.title,value:h.field,children:j})}});function ce(){return(0,n.jsx)(kn.Z,{style:{width:"140px"},options:G,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(F){var j;console.log(F);var ae=F[0],U=(j=e.fields)===null||j===void 0?void 0:j.find(function(he){return he.field==ae});if(g({name:ae,symbol:F[1],type:U==null?void 0:U.type}),t.name!=ae&&(b(Object.assign(l,{value:"",attr:U})),v(""),N(U),(U==null?void 0:U.type)=="datetime")){var ue=(0,_.Z)({},z);ue.picker=F[1],ie(ue)}}})}function de(){return(0,n.jsx)(Ye,{width:"240px",options:z,search:!0,name:t.name,attr:Z,value:M,onChange:function(F){console.log(F),v(F),b({value:F,attr:l.attr})},onSearchBefore:function(F,j){e.onSearchData&&e.onSearchData(F,function(ae){j(ae.model,ae)})},onSearchData:e.onSearchData})}function ve(){return(0,n.jsx)(we.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(et.Z,{}),onClick:function(){console.log(l);var F=(0,Ae.Nz)(Z,l.value);console.log(F);var j={name:t.name,symbol:t.symbol,value:F};if(j.name=="*"&&j.value=="")e.onSearch();else{if(Z.type=="datetime"&&l.value!=""&&(0,We.isArray)(F)){var ae=[];return l.value[0]!=null&&(j.symbol=">=",j.value=l.value[0],ae.push(j)),l.value[1]!=null&&ae.push({name:t.name,symbol:"<=",value:l.value[1]}),e.onSearch(ae)}e.onSearch(j)}}})}function k(){return(0,n.jsxs)(Je.Z.Group,{compact:!0,children:[ce(),de(),ve()]})}return k()},tt=nt,at=function(){function J(){(0,yn.Z)(this,J),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Cn.Z)(J,[{key:"onPrint",value:function(f){}},{key:"onSet",value:function(f){}},{key:"onHelp",value:function(f){}},{key:"onAbout",value:function(f){}}]),J}(),it=function(e){var f=["add","create"],x=["remove","delete"],d=["update","edit"],l=["ImportData","import"],b=["ExportData","export"];function R(){var t,g=[],V=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(o){if(o.issplit&&o.splitname!=null)if(V.has(o.splitname)){var z=V.get(o.splitname);z==null||z.push(o)}else V.set(o.splitname,[o]);else g.push(o)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:g.map(function(o){if(V.has(o.command)){var z,ie=(0,n.jsx)(an.Z,{children:(z=V.get(o.command))===null||z===void 0?void 0:z.map(function(G,ce){return(0,n.jsx)(an.Z.Item,{children:(0,n.jsx)(Be,(0,_.Z)((0,_.Z)({},Z(G)),{},{onClick:function(){return A(G.command,G)},toolbar:e}),ce)},ce)})});return(0,n.jsx)(Be,(0,_.Z)((0,_.Z)({},Z(o)),{},{icon:(0,n.jsx)(Zn.Z,{}),ismenu:!0,menu:ie,onClick:function(){return A(o.command,o)},toolbar:e}))}else return(0,n.jsx)(Be,(0,_.Z)((0,_.Z)({},Z(o)),{},{onClick:function(){return A(o.command,o)},toolbar:e}))})})}function P(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function M(){if(e.helpShow!=null&&e.helpShow!=!1){var t,g,V,o,z,ie,G,ce,de,ve,k=(0,s.useState)({isprint:(t=(g=e.helpShow)===null||g===void 0?void 0:g.isprint)!==null&&t!==void 0?t:!1,isset:(V=(o=e.helpShow)===null||o===void 0?void 0:o.isset)!==null&&V!==void 0?V:!1,ishelp:(z=(ie=e.helpShow)===null||ie===void 0?void 0:ie.ishelp)!==null&&z!==void 0?z:!1,isabout:(G=(ce=e.helpShow)===null||ce===void 0?void 0:ce.isabout)!==null&&G!==void 0?G:!1,wvh:(de=(ve=e.helpShow)===null||ve===void 0?void 0:ve.wvh)!==null&&de!==void 0?de:new at}),h=(0,w.Z)(k,2),F=h[0],j=h[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:v(F)})}}function v(t){var g=[];if(t.isprint){var V;g.push((0,n.jsx)(Be,{title:(V=t.wvh)===null||V===void 0?void 0:V.printText,name:"print",shape:"circle",icon:(0,n.jsx)(jn.Z,{}),onClick:A}))}if(t.isset){var o;g.push((0,n.jsx)(Be,{title:(o=t.wvh)===null||o===void 0?void 0:o.setText,name:"set",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:A}))}if(t.ishelp){var z;g.push((0,n.jsx)(Be,{title:(z=t.wvh)===null||z===void 0?void 0:z.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:A}))}if(t.isabout){var ie;g.push((0,n.jsx)(Be,{title:(ie=t.wvh)===null||ie===void 0?void 0:ie.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:A}))}return g.length>0&&g.unshift((0,n.jsx)(tn.Z,{type:"vertical"})),g.map(function(G){return G})}function I(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(tt,(0,_.Z)({},e.searchShow))}var A=function(g,V){e.onClick!=null&&e.onClick(g,V)};function Z(t){var g,V={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return V.disabled=(g=P(t))!==null&&g!==void 0?g:!1,V=N(V),e.iscircle&&(V.shape="circle",V.title=V.text,V.text=""),V}function N(t){return f.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Fn.Z,{component:Dn.Z})),x.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Tn.Z,{})),d.includes(t.name)&&(t.icon=(0,n.jsx)(Rn.Z,{})),l.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),b.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(In.Z,{})),t}var q=function(g){return g.length==3?(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:10,children:(0,n.jsx)(se.Z,{justify:"start",children:g[0]})}),(0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)(se.Z,{justify:"end",children:g[1]})}),(0,n.jsx)(re.Z,{span:6,children:(0,n.jsx)(se.Z,{justify:"end",children:g[2]})})]}):g.length==2?(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(se.Z,{justify:"start",children:g[0]})}),(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(se.Z,{justify:"end",children:g[1]})})]}):g.length==1?(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(se.Z,{justify:"start",children:g[0]})})}):(0,n.jsx)(n.Fragment,{})};function u(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(re.Z,{children:I()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(re.Z,{children:R()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(re.Z,{children:M()})),e.isclosecard?q(t):(0,n.jsx)(Me.Z,{children:q(t)})}return u()},sn=it,Kt=a(9715),$e=a(22712),lt=He.Z.TabPane,ut=function(e){var f,x=$e.Z.useForm(),d=(0,w.Z)(x,1),l=d[0],b=(0,s.useState)(e.title),R=(0,w.Z)(b,2),P=R[0],M=R[1],v=(0,s.useState)((f=e.isshow)!==null&&f!==void 0?f:!1),I=(0,w.Z)(v,2),A=I[0],Z=I[1],N=(0,s.useState)(j(e.attr)),q=(0,w.Z)(N,2),u=q[0],t=q[1],g=(0,s.useState)(function(){return U(e.values)}),V=(0,w.Z)(g,2),o=V[0],z=V[1],ie=(0,s.useState)(!1),G=(0,w.Z)(ie,2),ce=G[0],de=G[1],ve=(0,s.useState)(!1),k=(0,w.Z)(ve,2),h=k[0],F=k[1];(0,s.useEffect)(function(){console.log(e.values),e.values!=null?z(U(e.values)):ue()},[e.values]),(0,s.useEffect)(function(){t(j(e.attr))},[e.attr]);function j(m){var y,i;return{items:m==null||(y=m.fields)===null||y===void 0?void 0:y.filter(function(S){return S.visible&&S.isedit}),models:m==null||(i=m.childmodels)===null||i===void 0?void 0:i.filter(function(S){return S.propertyname==null&&(S.propertyname=S.name),S.visible})}}function ae(){var m,y=[];return(m=u.items)===null||m===void 0||m.forEach(function(i){var S=he(e.attr,i);e.onInitTextBox!=null&&e.onInitTextBox(i,txtprops),y.push((0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)($e.Z.Item,(0,_.Z)((0,_.Z)({},S),{},{children:(0,n.jsx)(Ye,{attr:i,onSearchBefore:function(Q,ne){e.onSearchData!=null&&e.onSearchData(Q,function(p){ne(p.model,p)})},onSearchData:function(Q,ne){e.onSearchData&&e.onSearchData(Q,ne)},children:o})}),i.field)}))}),e.onInitFormed!=null&&(l.setFieldDisabled=function(i,S){var K;(K=u.items)===null||K===void 0||K.forEach(function(Q){var ne;((ne=Q.field)===null||ne===void 0?void 0:ne.toLocaleLowerCase())==i.toLocaleLowerCase()&&(Q.disabled=S)}),t(u)},l.setTitle=function(i){M(i)},l.show=function(){Z(!0)},l.hide=function(){Z(!1)},l.setValues=function(i){z(U(i))},l.clear=function(){ue()},l.setHideSearch=function(i){F(i)},l.setHideToolbar=function(i){de(i)},e.onInitFormed(l)),y}function U(m){var y;return m==null&&(m={}),l.setFieldsValue(m),u.models!=null&&((y=u.models)===null||y===void 0?void 0:y.length)>0&&(console.log(u),u.models.forEach(function(i){m[i.propertyname]?m[i.propertyname].total=m[i.propertyname].length:(m[i.propertyname]=[],m[i.propertyname].total=0),i.removeRows=[]})),m}function ue(){var m;l.resetFields();var y={};(m=u.models)===null||m===void 0||m.forEach(function(i){y[i.propertyname]||(y[i.propertyname]=[],y[i.propertyname].total=0)}),z(y)}function he(m,y){var i={};i.name=y.field,i.label=y.title;var S=je(y);return y.disabled||(i.rules=S),e.onInitItem!=null&&e.onInitItem(y,i),i}function je(m){var y,i=[];if(m.required&&i.push({required:m.required}),(y=m.length)!==null&&y!==void 0?y:0>0){var S;i.push({max:(S=m.length)!==null&&S!==void 0?S:500,type:(0,Ae.mc)(m.type)})}return e.onFieldRules!=null&&(i=e.onFieldRules(m,i)),i}var ge=function(y){var i,S=Object.assign({},o);for(var K in y)S[K]=y[K];return u.models!=null&&((i=u.models)===null||i===void 0?void 0:i.length)>0&&u.models.forEach(function(Q){var ne;S[Q.propertyname]!=null&&S[Q.propertyname].forEach(function(p){p.isnew?(p.id=null,p.modelState=1):p.modelState=2}),(ne=Q.removeRows)===null||ne===void 0||ne.forEach(function(p){p.modelState=3,S[Q.propertyname].push(p)})}),S};function ye(){return(0,n.jsx)($e.Z,{labelAlign:"left",form:l,onFinish:function(y){var i=ge(y);console.log(i),l.onFinish!=null&&l.onFinish(i),e.onFinish!=null&&e.onFinish(i)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(se.Z,{gutter:24,children:ae()})})}function me(){var m;if(u.models!=null&&((m=u.models)===null||m===void 0?void 0:m.length)>0){var y;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(y=u.models)===null||y===void 0?void 0:y.map(function(i,S){var K;return(0,n.jsx)(lt,{tab:i.title,children:(0,n.jsx)(Xe,{model:i,data:{rows:o[i.propertyname],total:(K=o[i.propertyname])===null||K===void 0?void 0:K.total},iscirclebutton:!0,closetoolbar:ce,closesearch:h,closecard:!0,onSearchData:function(ne){e.onSearchData!=null&&(ne.parent=o,ne.childmodel=i,e.onSearchData(ne,function(p){var Ee=Object.assign({},o);Ee[i.propertyname]=p.rows,Ee[i.propertyname].total=p.total,z(Ee)}))},onDataChange:function(ne,p,Ee){console.log(ne,p);var Fe=Object.assign({},o);Fe[i.propertyname]=ne.rows,Fe[i.propertyname].total=ne.total,console.log(Fe),Ee=="remove"&&p.forEach(function(be){be&&!be.isnew&&i.removeRows.push(be)}),z(Fe)}})},S)})})}return(0,n.jsx)(n.Fragment,{})}function Y(){return e.ismodal?(0,n.jsxs)(Qe,{title:P,width:1100,visible:A,onCancel:function(){return Z(!1)},onOk:function(){l.submit()},children:[(0,n.jsx)(Me.Z,{children:ye()}),me()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Me.Z,{title:P,children:ye()}),me()]})}return Y()},fn=ut,cn=a(38535),ot=a(73218),Ht=a(34669),rt=a(82833),Gt=a(17462),qe=a(76772),_e=a(3182),vn=a(91220),dt=a(94043),Ve=a.n(dt),st=a(43347),Jt=a(35556),hn=a(97880),ft=hn.Z.Step,ct=function(e){var f,x,d=(0,s.useState)((f=e.currentStep)!==null&&f!==void 0?f:0),l=(0,w.Z)(d,2),b=l[0],R=l[1],P=(0,s.useState)((x=e.isShow)!==null&&x!==void 0?x:!1),M=(0,w.Z)(P,2),v=M[0],I=M[1];(0,s.useEffect)(function(){var u;I((u=e.isShow)!==null&&u!==void 0?u:!1)},[e.isShow]),(0,s.useEffect)(function(){var u;if(R((u=e.currentStep)!==null&&u!==void 0?u:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function A(u){return e.onCurrentStepComponent?e.onCurrentStepComponent(u):(0,n.jsx)(fn,{attr:e.attr,ismodal:!1})}function Z(){var u;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(hn.Z,{current:b,onChange:function(g){R(g),e.onChange&&e.onChange(g)},children:(u=e.stepItem)===null||u===void 0?void 0:u.map(function(t){return(0,n.jsx)(ft,(0,_.Z)({},t))})}),(0,n.jsx)(tn.Z,{}),A(b)]})}function N(u){I(u),e.onShowChange&&e.onShowChange(u)}function q(){if(e.isModal){var u={onOk:function(){N(!1)},onCancel:function(){N(!1)}};return e.closeOk&&(u.footer=!1),(0,n.jsx)(Qe,(0,_.Z)((0,_.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:v},u),{},{children:Z()}))}return e.isCard?(0,n.jsx)(Me.Z,{title:e.title,bordered:!1,children:Z()}):Z()}return q()},vt=ct,pe=a(54701),ht=a(58602),mn=a(32059);function gn(J,e,f){var x=J.map(function(M,v){return Object.assign({},{key:M.key,title:M.title,position:String.fromCharCode(65+v)+1})}).reduce(function(M,v){return Object.assign({},M,(0,mn.Z)({},v.position,{key:v.key,v:v.title}))},{}),d=e.map(function(M,v){return J.map(function(I,A){return Object.assign({},{content:M[I.key],position:String.fromCharCode(65+A)+(v+2)})})}).reduce(function(M,v){return M.concat(v)}).reduce(function(M,v){return Object.assign({},M,(0,mn.Z)({},v.position,{v:v.content}))},{}),l=Object.assign({},x,d),b=Object.keys(l),R="".concat(b[0],":").concat(b[b.length-1]),P={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},l,{"!ref":R,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};pe.NC(P,f)}function mt(J,e,f,x,d){return en.apply(this,arguments)}function en(){return en=(0,_e.Z)(Ve().mark(function J(e,f,x,d,l){var b,R;return Ve().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:f>0&&(b=[],e.fields.forEach(function(v){v.visible&&b.push({title:v.title,key:v.field,item:v})}),R=Object.assign({},x),R.page=1,R.size=f,R.size>0&&d(R).then(function(v){if(v!=null&&v.success&&v.data&&v.data.rows){var I=v.data.rows;for(var A in I)for(var Z in b){var N=I[A][b[Z].key],q=rn(N,b[Z].item,I[A]);I[A][b[Z].key]=q!=null?q:""}gn(b,I,l)}}));case 1:case"end":return M.stop()}},J)})),en.apply(this,arguments)}var gt=function(e){var f,x=(0,s.useState)(0),d=(0,w.Z)(x,2),l=d[0],b=d[1],R=(0,s.useState)((f=e.isShow)!==null&&f!==void 0?f:!1),P=(0,w.Z)(R,2),M=P[0],v=P[1],I=(0,s.useState)(0),A=(0,w.Z)(I,2),Z=A[0],N=A[1],q=(0,s.useState)({model:void 0,data:{rows:[],total:0}}),u=(0,w.Z)(q,2),t=u[0],g=u[1],V=(0,s.useState)(K(e.attr)),o=(0,w.Z)(V,2),z=o[0],ie=o[1],G=(0,s.useState)({message:"",description:"",type:"success",count:0}),ce=(0,w.Z)(G,2),de=ce[0],ve=ce[1],k=(0,s.useState)(null),h=(0,w.Z)(k,2),F=h[0],j=h[1],ae=(0,s.useState)({model:null,rows:[],total:0}),U=(0,w.Z)(ae,2),ue=U[0],he=U[1],je=(0,s.useState)(!0),ge=(0,w.Z)(je,2),ye=ge[0],me=ge[1],Y=(0,s.useState)(void 0),m=(0,w.Z)(Y,2),y=m[0],i=m[1];function S(){b(0),N(0),g({model:void 0,data:{rows:[],total:0}}),ve({message:"",description:"",type:"success",count:0}),j(null),he({model:null,rows:[],total:0}),me(!0),i(void 0)}function K(D){var c;return(c=D.fields)===null||c===void 0?void 0:c.filter(function(C){return C.visible&&!C.disabled})}(0,s.useEffect)(function(){v(e.isShow)},[e.isShow]),(0,s.useEffect)(function(){ie(K(e.attr))},[e.attr]);var Q=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(C){setTimeout(function(){C(!0)},c)})};function ne(){var D={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},c={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},C={title:"\u5BFC\u5165\u6570\u636E"},L=[D,c,C];return L}function p(D){var c={fields:[]};if(D.length>0)for(var C in D[0]){var L;(L=c.fields)===null||L===void 0||L.push({field:C,title:C,type:"string",visible:!0,sorter:!1})}return c}function Ee(D){var c=D.rowcount,C=D.data;if(c>0){N(c);for(var L=p(C),H=[],O=0;O<6;O++)H.push(C[O]);g({model:L,data:{rows:H,total:5}})}}function Fe(){var D,c,C=new Map,L=new Map;(D=t.model)===null||D===void 0||(c=D.fields)===null||c===void 0||c.forEach(function(ee,W){C.set(W,ee.title)});var H=[];z.forEach(function(ee,W){var fe,Se;L.set(W,ee.title);var $=ee.foreign&&ee.foreign.isfkey?"Name":"",xe=(fe=t.model)===null||fe===void 0||(Se=fe.fields)===null||Se===void 0?void 0:Se.find(function(Ge){return Ge.field==ee.field||Ge.field==ee.title}),Te=void 0;if(xe==null||xe==null){var Ie;W<((Ie=t.model)===null||Ie===void 0?void 0:Ie.fields.length)&&(Te=W),H.push({id:W,source:Te,target:W,defaultValue:"",foreignMap:$})}else{var Re=(0,vn.Z)(C.entries()),ke;try{for(Re.s();!(ke=Re.n()).done;){var Ne=ke.value;if(xe.title==Ne[1]||xe.field==Ne[1]){Te=Ne[0];break}}}catch(Ge){Re.e(Ge)}finally{Re.f()}H.push({id:W,source:Te,target:W,defaultValue:"",foreignMap:$})}});var O=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:C},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:L},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];he({model:{fields:O,isadd:!1,isedit:!0,isremove:!1},rows:H,total:H.length})}function be(D){var c={};for(var C in ue.rows){var L,H,O=ue.rows[C],ee=(L=t.model)===null||L===void 0?void 0:L.fields[O.source];if(!((ee==null||ee==null)&&O.defaultValue=="")){var W=z[O.target];if(!(W==null||W==null)){if(O.defaultValue!=null&&O.defaultValue!=""){var fe;c[W.field]=O.defaultValue,(fe=W.foreign)!==null&&fe!==void 0&&fe.isfkey&&(c[W.field]=O[W.field]);continue}var Se=ee.field,$=D[Se];if(W.required&&($==null||$==null||$=="")){B(c,"\u5BFC\u5165\u6570\u636E".concat(ee.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(W.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!($==null||$==null||$=="")){if(W!=null&&W.comvtp&&W.comvtp.isvtp){var xe=(0,vn.Z)(W.comvtp.items.entries()),Te;try{for(xe.s();!(Te=xe.n()).done;){var Ie=Te.value;if($==Ie[1]){$=Ie[0];break}}}catch(ke){xe.e(ke)}finally{xe.f()}}if((H=W.foreign)!==null&&H!==void 0&&H.isfkey&&y!=null&&y.has(W.field)){var Re=y.get(W.field);$=Re[$]}c[W.field]=$}}}}return c}function ze(D){var c=new Map;return ue.rows.forEach(function(C){var L,H=(L=t.model)===null||L===void 0?void 0:L.fields[C.source];if(H){var O,ee=z[C.target],W=C.foreignMap==""?"Name":C.foreignMap;if((O=ee.foreign)!==null&&O!==void 0&&O.isfkey&&C.defaultValue==""){c.has(ee.field)||c.set(ee.field,new Map);var fe=c.get(ee.field);for(var Se in D){var $=D[Se],xe=$[H.field];xe!=null&&xe!=""&&!fe.has(xe)&&(fe==null||fe.set(xe,W))}}}}),c}function Pe(D){var c=ze(D);if(c.size==0){me(!1),ve({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var C="";c.forEach(function(L,H){var O=z.find(function($){return $.field==H}),ee=z.find(function($){return $.type=="string"}).searchsymbol.find(function($){return $.label=="\u7B49\u4E8E"}).value,W=[],fe="";L.forEach(function($,xe){fe=$.toLowerCase(),W.push({name:$,symbol:ee,value:xe,relation:"||"})});var Se={field:O,foreign:O.foreign,whereList:W};e.onSearchData&&(Q(200),e.onSearchData(Se,function($){if($&&$.rows.length>0)if($.rows.length==L.size){console.log(L);for(var xe in $.rows){var Te=$.rows[xe][fe];L.has(Te)&&(L[Te]=$.rows[xe].id)}i(c),me(!1),console.log(de.description),ve({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(O==null?void 0:O.title,"\u6570\u636E").concat($.total,`\u9879\u3002
`),type:"info",count:0})}else L.forEach(function(Ie,Re){var ke=$.rows.find(function(Ne){return Ne[fe]==Re});C+="".concat(O==null?void 0:O.title,"\u4E2D\u672A\u627E\u5230").concat(fe,"\u4E3A").concat(Re,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),ke==null&&B($.rows,C,0)});else C+="".concat(O==null?void 0:O.title,"\u4E2D\u672A\u627E\u5230").concat(fe,"\u4E3A").concat(W[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),B($.rows,C,0)}))})}function le(D){if(F==null||F.data==null){Le.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var c=F.data;if(ue.rows.length<=0){Le.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!ye){if(D==c.length){ve({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:D}),me(!0);return}var C=be(c[D]);C!=null&&r(C,function(L,H){X(C,L,H,D)})}}function X(D,c,C,L){c?(L++,ve({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(D),type:"success",count:L}),Q(200),le(L)):B(D,C,L)}function r(D,c){return E.apply(this,arguments)}function E(){return E=(0,_e.Z)(Ve().mark(function D(c,C){return Ve().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:e.onAdd&&e.onAdd("add",c).then(function(){var O=(0,_e.Z)(Ve().mark(function ee(W){return Ve().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(console.log(W),W.ok!=null&&W.ok==!1&&(me(!0),C(!1,W.statusText)),!(W!=null&&W.success)){Se.next=8;break}return Se.next=5,Q(200);case 5:C(!0),Se.next=10;break;case 8:me(!0),C(!1,W.message);case 10:case"end":return Se.stop()}},ee)}));return function(ee){return O.apply(this,arguments)}}());case 1:case"end":return H.stop()}},D)})),E.apply(this,arguments)}function B(D,c,C){var L={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(D),description:c,type:"error",count:C,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(we.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var O=e.form;O.clear(),O.setHideSearch(!0),O.setTitle(e.title),O.show(),O.setValues(D),O.onFinish=function(ee){console.log(ee),O.hide(),r(ee,function(W,fe){X(ee,W,fe,C)})}}},children:"\u4FEE\u6539"})})};ve(L)}function T(){var D={name:"file",accept:".xlsx, .xls",onChange:function(C){console.log(C);var L=new FileReader;L.onload=function(H){try{var O=H.target.result,ee=pe.ij(O,{type:"binary"}),W=[];for(var fe in ee.Sheets)if(ee.Sheets.hasOwnProperty(fe)){W=pe.P6.sheet_to_json(ee.Sheets[fe]);break}var Se={data:W,rowcount:W.length};j(Se),Ee(Se)}catch($){nn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log($)}},L.readAsBinaryString(C.file.originFileObj)}};return(0,n.jsxs)(Me.Z,{children:[(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(Z,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(we.Z,{size:"small",type:"primary",onClick:function(){var C=[],L={};z.forEach(function(H){C.push({title:H.title,key:H.field}),L[H.field]=H.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),gn(C,[L],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsxs)(ht.default,(0,_.Z)((0,_.Z)({},D),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(st.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Ue,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,push:11,children:(0,n.jsx)(we.Z,{type:"primary",disabled:Z<1,onClick:function(){b(l+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function te(){var D={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:ue.model,data:{rows:ue.rows,total:ue.total},onDataChange:function(C){he((0,_.Z)((0,_.Z)({},ue),{},{rows:C.rows}))},onGetFieldToEdit:function(C,L){if(C.field=="defaultValue"){var H=L.target,O=z[H];return O}return C},onEditRowing:function(C,L,H){return H!=null&&(C.defaultValue=String(H)),!0},onSearchValueChange:function(C,L,H){H.text!=null&&(L.defaultValue=H.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Xe,(0,_.Z)({},D))})}),(0,n.jsxs)(se.Z,{gutter:[16,16],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(we.Z,{type:"primary",onClick:function(){b(l+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(we.Z,{onClick:function(){b(l-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function oe(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(Z,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(de.count,"\u884C"),type:"info"})})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(rt.Z,{percent:parseInt((de.count/Z*100).toString()),status:"active"})})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,(0,_.Z)({},de))})}),(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(we.Z,{type:"primary",disabled:ye,onClick:function(){le(de.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(we.Z,{onClick:function(){b(l-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function Ze(D){v(D),e.onShowChange&&e.onShowChange(D),D||S()}function De(){return(0,n.jsx)(vt,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:M,stepItem:ne(),currentStep:l,onChange:function(c){if(c==1&&Fe(),c==2&&F&&F.data){var C=F.data;Pe(C)}b(c)},onCurrentStepComponent:function(c){return c==0?T():c==1?te():c==2?oe():(0,n.jsx)(n.Fragment,{})},onShowChange:function(c){Ze(c)}})}return De()},St=gt,xt=function(e){var f=(0,s.useState)(!1),x=(0,w.Z)(f,2),d=x[0],l=x[1],b=(0,s.useState)(null),R=(0,w.Z)(b,2),P=R[0],M=R[1],v=(0,s.useState)(0),I=(0,w.Z)(v,2),A=I[0],Z=I[1],N=(0,s.useState)([]),q=(0,w.Z)(N,2),u=q[0],t=q[1],g=(0,s.useState)(void 0),V=(0,w.Z)(g,2),o=V[0],z=V[1],ie=(0,s.useState)({rows:[],total:0}),G=(0,w.Z)(ie,2),ce=G[0],de=G[1],ve=(0,s.useState)(!1),k=(0,w.Z)(ve,2),h=k[0],F=k[1],j=(0,s.useState)(null),ae=(0,w.Z)(j,2),U=ae[0],ue=ae[1],he=(0,s.useState)({page:1,size:10,whereList:[],sortList:[]}),je=(0,w.Z)(he,2),ge=je[0],ye=je[1],me=(0,s.useState)(1),Y=(0,w.Z)(me,2),m=Y[0],y=Y[1];if((0,s.useEffect)(function(){z(void 0),M(null),Z(0),t([]),de({rows:[],total:0}),i()},[e.controller]),o==null)return(0,n.jsx)(n.Fragment,{});function i(){if(console.log("waypage.init"),console.log(e),!e.init){var le,X=(le=e.namespace)!==null&&le!==void 0?le:e.controller;console.log(X+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(r){r!=null&&(r.success?(z(r.data),r.data.autoload&&S({},function(E){de(E)})):ne(r.message.message))})}function S(le,X){Z(0),l(!0),e.search(le).then(function(r){if(r!=null)if(l(!1),r!=null&&r.success){if(r.data.rows==null&&(r.data.rows=[]),le.foreign==null&&le.childmodel==null&&u.length>0){var E=r.data.rows.find(function(B){return B.id==u[0]});E!=null?(t(u),Z(u.length),M(E)):(t([]),Z(0),M(null))}X?X(r.data):de(r.data)}else ne(r.message.message)},function(r){console.log(r),l(!1)})}var K=function(X){var r=null;X.isselectrow&&(r=P),X.selectmultiple&&(r=u),Q(X,r)},Q=function(X,r){l(!0),e.execute(X.command,r).then(function(E){console.log(E),E!=null&&E.success?(nn.default.success(X.name+"\u5B8C\u6210"),(o==null?void 0:o.viewtype)!="form"&&(U&&U.hide(),S(ge,function(B){de(B)}))):(l(!1),ne(E.message.message))})};function ne(le){Le.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(ot.Z,{}),content:(0,n.jsx)("div",{children:le})})}function p(le,X){U!=null&&U.clear(),U.setHideSearch(!0),U.setTitle((o==null?void 0:o.title)+"-"+le.name),U.show(),X&&(U.setValues(X),U.setHideSearch(!1)),U.onFinish=function(r){console.log(r),Q(le,r)}}function Ee(le){var X,r=le?{fields:o==null||(X=o.fields)===null||X===void 0?void 0:X.filter(function(E){var B;return(B=E.issearch)!==null&&B!==void 0?B:!0}),onSearch:function(B){l(!0);var T={page:1,whereList:[]};B!=null&&((0,We.isArray)(B)?T.whereList=B:T.whereList=[B]),ye(T),y(1),S(T,function(te){de(te)})},onSearchData:S}:!1;return(0,n.jsx)(sn,{attrs:o==null?void 0:o.commands,isselectrow:!0,selectcount:A,commandShow:!0,isshow:!le,onClick:function(B,T){if(console.log(B),B=="ImportData"||B=="importdata"){F(!0);return}if(B=="ExportData"||B=="exportdata"){mt(o,ce.total,ge,e.search,e.title+".xlsx");return}if(B=="add"){if((o==null?void 0:o.viewtype)=="form"){U.onFinish=function(te){console.log(te),Q(T,te)},U.submit();return}p(T);return}if(B=="edit"){p(T,P);return}K(T)},searchShow:r})}function Fe(){return(0,n.jsx)(Ue,{attr:o,data:ce,isselect:!0,isexpandable:!0,loading:d,current:m,onSelectRows:function(X,r){console.log(X),console.log(r),t(r),Z(r.length),M(X)},onSearchData:function(X,r){if(X.parent&&X.childmodel){S(X,function(E){r(E)});return}l(!0),y(X.page),X.whereList=ge.whereList,ye(X),S(X,function(E){de(E)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(X,r){var E,B=o==null||(E=o.commands)===null||E===void 0?void 0:E.find(function(T){return T.command=="edit"&&T.visible});B!=null&&p(B,r)}})}function be(le){return(0,n.jsx)(fn,{attr:o,title:e.title,ismodal:le,onInitFormed:function(r){ue(r)},onSearchData:S})}function ze(){return(o==null?void 0:o.viewtype)=="form"?Pe():(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ee(!0)})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Fe()})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:be(!0)})}),(0,n.jsx)(St,{title:e.title,isShow:h,attr:o,onAdd:e.execute,form:U,onShowChange:function(X){F(X),X||S(ge)},onSearchData:S})]})}function Pe(){return(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ee(!1)})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:be(!1)})})]})}return ze()};function yt(J,e){var f=e.controller;e.namespace!=null&&(f=e.namespace);var x=function(R){return{type:f+"/init",payload:R}},d=function(R){return{type:f+"/search",payload:R}},l=function(R){return{type:f+"/execute",payload:R}};return{dispatch:J,init:function(){return J(x({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(R){var P=e.namespace+"/"+e.service+"/"+e.controller;return J(d({c:P,item:R,s:e.service}))},execute:function(R,P){var M=e.namespace+"/"+e.service+"/"+e.controller;return J(l({c:M,command:R,item:P,s:e.service}))}}}var Ct=(0,xn.$j)(function(){},yt)(xt)},20067:function(){}}]);
