(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(Zt,Sn,a){"use strict";a.d(Sn,{Z:function(){return Ct}});var jt=a(13062),ce=a(71230),Et=a(89032),re=a(15746),bt=a(71194),We=a(48889),wt=a(34792),nn=a(48086),D=a(2824),s=a(67294),xn=a(28216),Ft=a(58024),Re=a(39144),Dt=a(48736),tn=a(27049),Tt=a(49111),Ke=a(19650),Rt=a(30887),an=a(54689),ee=a(11849),yn=a(69610),Cn=a(54941),Zn=a(57254),jn=a(7945),En=a(24616),bn=a(63270),wn=a(3050),Fn=a(16165),Dn=a(49101),Tn=a(73171),Rn=a(8212),Mn=a(65233),Bn=a(20924),In=a(25592),Mt=a(59250),On=a(13013),Bt=a(22385),ln=a(94199),It=a(57663),be=a(71577),An=a(57119),n=a(85893),Vn=function(e){var c,j,r,i,w,B,P,I,f,R,M,x={key:(c=e.key)!==null&&c!==void 0?c:e.name,name:(j=e.name)!==null&&j!==void 0?j:"",title:(r=e.title)!==null&&r!==void 0?r:"",text:e.text,danger:(i=e.danger)!==null&&i!==void 0?i:!1,block:(w=e.block)!==null&&w!==void 0?w:!1,type:(B=e.type)!==null&&B!==void 0?B:"default",target:e.target,size:(P=e.size)!==null&&P!==void 0?P:"default",shape:(I=e.shape)!==null&&I!==void 0?I:"",icon:(f=e.icon)!==null&&f!==void 0?f:"",ghost:(R=e.ghost)!==null&&R!==void 0?R:!1,disabled:(M=e.disabled)!==null&&M!==void 0?M:!1},N=(0,s.useState)(!1),_=(0,D.Z)(N,2),u=_[0],t=_[1];function Z(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(L){return L.command==e.name}):null}var k=function(){if(e.onClick!=null)try{t({delay:100});var ue=Z();ue!=null&&ue.isalert?We.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(x.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(x)}}):e.onClick(x)}finally{t(!1)}};function o(){return e.ismenu?(0,n.jsx)(On.Z,{overlay:e.menu,children:(0,n.jsx)(ln.Z,{title:x.title,children:(0,n.jsx)(be.Z,(0,ee.Z)((0,ee.Z)({},x),{},{onClick:k,loading:u,children:x.text}))})}):(0,n.jsx)(ln.Z,{title:x.title,children:(0,n.jsx)(be.Z,(0,ee.Z)((0,ee.Z)({},x),{},{onClick:k,loading:u,children:x.text}))})}return o()},Me=Vn,Ot=a(47673),Je=a(4107),At=a(36877),kn=a(96607),Vt=a(77883),Ln=a(70507),kt=a(77576),Wn=a(12028),Lt=a(43358),zn=a(34041),Wt=a(53400),un=a(41505),Pn=a(76010),ze=a(96486),Be=a(86582),zt=a(8963),Nn=a(68297),Pt=a(18106),He=a(58634),Kn=a(30381),on=a.n(Kn),Oe=a(75308);function rn(Q,e,c){var j,r,i=(0,Oe.MM)(e,Q);if((j=e.comvtp)!==null&&j!==void 0&&j.isvtp){var w=new Map(e.comvtp.items);i=w.get(i)}if((r=e.foreign)!==null&&r!==void 0&&r.isfkey){var B=e.foreign.oneobjectfield,P=e.foreign.onedisplayname;c[B]!=null&&(i=c[B][P])}if(e.type=="boolean"&&(i=i?"\u662F":"\u5426"),e.type=="datetime"){var I,f;if(i==""||i==null)return i;var R=(I=e.datatimetype)===null||I===void 0?void 0:I.dateformat;if((f=e.datatimetype)!==null&&f!==void 0&&f.istime){var M,x;R=((M=e.datatimetype)===null||M===void 0?void 0:M.dateformat)+" "+((x=e.datatimetype)===null||x===void 0?void 0:x.timeformat)}i=on()(i).format(R)}return i}var Hn=function(e,c,j,r){var i,w=e.attr,B=[];function P(f,R,M){var x=rn(f,R,M);return e.onFieldRender!=null?e.onFieldRender(R,x,M):(0,n.jsx)(n.Fragment,{children:x})}var I=function(R,M){return e.onColumnToEdit?e.onColumnToEdit(R,M):(e.onGetFieldToEdit&&(R=e.onGetFieldToEdit(R,M)),r(M),(0,n.jsx)(Ye,{attr:R,value:j[R.field],onChange:function(N){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(M,R.field,N))){console.log(N);var _=Object.assign({},j);M[R.field]=N,_[R.field]=N,r(_)}},onSearchValueChange:function(N){e.onSearchValueChange&&e.onSearchValueChange(R,M,N)},onSearchBefore:function(N,_){e.onSearchData&&e.onSearchData(N,function(u){_(u.model,u)})},onSearchData:e.onSearchData}))};return w==null||(i=w.fields)===null||i===void 0||i.filter(function(f){return f.visible}).forEach(function(f){var R;B.push({dataIndex:f.field,title:f.title,sorter:(R=f.sorter)!==null&&R!==void 0?R:!0,render:function(x,N){if(N!=null)return c&&N.editable&&(f.isedit==null||f.isedit==!0)?I(f,N):P(x,f,N)}})}),B},Gn=He.Z.TabPane,Jn=function Q(e){var c,j,r,i,w,B=(0,s.useState)((c=e.loading)!==null&&c!==void 0?c:!1),P=(0,D.Z)(B,2),I=P[0],f=P[1],R=(0,s.useState)((j=e.data)!==null&&j!==void 0?j:{rows:[],total:0}),M=(0,D.Z)(R,2),x=M[0],N=M[1],_=(0,s.useState)((r=e.rowedit)!==null&&r!==void 0?r:!1),u=(0,D.Z)(_,2),t=u[0],Z=u[1],k=(0,s.useState)((i=e.current)!==null&&i!==void 0?i:1),o=(0,D.Z)(k,2),L=o[0],ue=o[1],G=(0,s.useState)(10),ve=(0,D.Z)(G,2),de=ve[0],he=ve[1],O=(0,s.useState)([]),h=(0,D.Z)(O,2),E=h[0],F=h[1],ie=(0,s.useState)((w=e.selectType)!==null&&w!==void 0?w:"radio"),Y=(0,D.Z)(ie,2),oe=Y[0],me=Y[1],je=(0,s.useState)(),Se=(0,D.Z)(je,2),Ce=Se[0],ge=Se[1],$=(0,s.useState)({}),m=(0,D.Z)($,2),b=m[0],l=m[1];(0,s.useEffect)(function(){var g;N((g=e.data)!==null&&g!==void 0?g:{rows:[],total:0})},[e.data]),(0,s.useEffect)(function(){var g;Z((g=e.rowedit)!==null&&g!==void 0?g:!1)},[e.rowedit]),(0,s.useEffect)(function(){var g;f((g=e.loading)!==null&&g!==void 0?g:!1)},[e.loading]),(0,s.useEffect)(function(){var g;ue((g=e.current)!==null&&g!==void 0?g:1)},[e.current]);var y=function(C,A,K){var p,fe,v=function(T){f(!1),N(T)},d=function(T){if(T.column==null)return"";var se={name:T.field,isdesc:!1};return T.order=="descend"&&(se.isdesc=!0),se};f(!0),ue((p=C.current)!==null&&p!==void 0?p:1),he((fe=C.pageSize)!==null&&fe!==void 0?fe:10);try{var S,V,X={page:(S=C.current)!==null&&S!==void 0?S:1,size:(V=C.pageSize)!==null&&V!==void 0?V:10,sortList:[]};if(K!=null)if((0,ze.isArray)(K))K.forEach(function(te){var T=d(te);T!=""&&te.sortList.push(T)});else{var z=d(K);z!=""&&X.sortList.push(z)}e.onSearchData!=null&&e.onSearchData(X,v)}finally{f(!1)}},W=function(C,A){var K=E.length<=C.length;if(F(C),e.onSelectRows!=null)if(C.length>0){var p=A[A.length-1];K||(p=null,C.length==1&&(p=x.rows.find(function(fe){return fe.id==C[0]}))),e.onSelectRows(p,C,K)}else e.onSelectRows(null,C,!1)},J=function(){if(!!e.isselect)return{selectedRowKeys:E,fixed:!0,type:oe,columnTitle:Ce,hideSelectAll:!1,columnWidth:"32px",onChange:W}};function le(g){g=="checkbox"&&(me("radio"),setSelecteds([]),e.onSelectStateChange&&e.onSelectStateChange(!1),ge(ae()))}function ae(){return(0,n.jsx)(be.Z,{type:"link",onClick:function(){ge(null),me("checkbox"),setSelecteds([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function Ee(g){if(e.isedit){g.editable=!t;var C=(0,Be.Z)(x.rows);C.forEach(function(A){A.id==g.id?A.editable=!t:A.editable&&(A.editable=!1)}),Z(!t)}}function we(){var g;if(e.isexpandable&&(e==null||(g=e.attr)===null||g===void 0?void 0:g.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(A,K){var p;if(!!A&&(ke(K,ne),(e==null||(p=e.attr)===null||p===void 0?void 0:p.childmodels)!=null&&e.attr.childmodels.length>0)){var fe,v=e==null||(fe=e.attr)===null||fe===void 0?void 0:fe.childmodels[0];if(K[v.propertyname]||(K[v.propertyname]=[]),K[v.propertyname].total=K[v.propertyname].length,K[v.propertyname].total==0){var d={page:1,size:10};Fe(d,v,K)}}},expandedRowRender:Pe}:e.onExpandable(e.attr)}function Fe(g,C,A){g.childmodel=C,g.parent=A,e.onSearchData!=null&&e.onSearchData(g,function(K){var p=(0,Be.Z)(x.rows),fe=p.findIndex(function(v){return v.id==A.id});p[fe][C.propertyname]=K.rows,p[fe][C.propertyname].total1=K.total,N({rows:p,total:x.total})})}var Ve=function(C,A){if(e.onExpandedRowTabPane){var K=e.onExpandedRowTabPane(C,A);if(K!=null)return K}return(0,n.jsx)(Q,{isselect:!1,isedit:!1,isclosecard:!0,attr:C,data:{rows:A[C.propertyname],total:A[C.propertyname].total1},onSearchData:function(fe){Fe(fe,C,A)}},"id")},Pe=function(C){var A;if((e==null||(A=e.attr)===null||A===void 0?void 0:A.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(p){var fe=e.attr.childmodels[Number(p)];Fe({},fe,C)},children:e.attr.childmodels.map(function(K,p){return C[K.propertyname]||(C[K.propertyname]=[]),C[K.propertyname].total=C[K.propertyname].length,(0,n.jsx)(Gn,{tab:K.title,children:Ve(K,C)},p)})})},ke=function(C,A){try{var K,p;if(((K=J())===null||K===void 0?void 0:K.type)=="radio"&&W([C[A]],[C]),((p=J())===null||p===void 0?void 0:p.type)=="checkbox"){var fe=C[A],v=[];E.includes(fe)?v=E.filter(function(d){return d!=fe}):(v=(0,Be.Z)(E),v.push(fe)),W(v,[C])}}catch(d){console.log(d)}},ne="id";function U(){var g=Hn(e,t,b,l);return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:ne,columns:g,rowSelection:J(),scroll:{x:g.length*150},dataSource:x.rows,pagination:{current:L,pageSize:de,total:x.total,hideOnSinglePage:!0,showTotal:function(A){return"\u603B ".concat(A," \u884C")}},loading:I,expandable:we(),onChange:y,onRow:function(A){return{onClick:function(p){p.stopPropagation();try{var fe,v;if(((fe=J())===null||fe===void 0?void 0:fe.type)=="radio"&&W([A[ne]],[A]),((v=J())===null||v===void 0?void 0:v.type)=="checkbox"){var d=A[ne],S=[];E.includes(d)?S=E.filter(function(V){return V!=d}):(S=(0,Be.Z)(E),S.push(d)),W(S,[A])}}finally{e.onRowClick&&e.onRowClick(p,A)}},onDoubleClick:function(p){p.stopPropagation(),Ee(A),e.onRowDoubleClick&&e.onRowDoubleClick(p,A)},onMouseEnter:function(p){e.onRowMouseEnter&&e.onRowMouseEnter(p,A)},onMouseLeave:function(p){e.onMouseLeave&&e.onMouseLeave(p,A)}}}})}function H(){return e.isclosecard?U():(0,n.jsx)(Re.Z,{children:U()})}return H()},Ue=Jn,Un=a(61193),Qn=a.n(Un),Xn=function(e){var c=(0,s.useState)({left:0,top:0,bottom:0,right:0}),j=(0,D.Z)(c,2),r=j[0],i=j[1],w=(0,s.useState)(!0),B=(0,D.Z)(w,2),P=B[0],I=B[1],f=s.createRef(),R=function(_,u){var t,Z,k,o=(t=window)===null||t===void 0||(Z=t.document)===null||Z===void 0?void 0:Z.documentElement,L=o.clientWidth,ue=o.clientHeight,G=f==null||(k=f.current)===null||k===void 0?void 0:k.getBoundingClientRect();i({left:-(G==null?void 0:G.left)+(u==null?void 0:u.x),right:L-((G==null?void 0:G.right)-(u==null?void 0:u.x)),top:-(G==null?void 0:G.top)+(u==null?void 0:u.y),bottom:ue-((G==null?void 0:G.bottom)-(u==null?void 0:u.y))})};function M(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){P&&I(!1)},onMouseOut:function(){I(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function x(){return(0,n.jsx)(We.Z,(0,ee.Z)((0,ee.Z)({},e),{},{title:M(),modalRender:function(_){return(0,n.jsx)(Qn(),{disabled:P,bounds:r,onStart:function(t,Z){return R(t,Z)},children:(0,n.jsx)("div",{ref:f,children:_})})}}))}return x()},Qe=Xn,Yn=function(e){var c,j,r=(0,s.useState)([]),i=(0,D.Z)(r,2),w=i[0],B=i[1],P=(0,s.useState)(null),I=(0,D.Z)(P,2),f=I[0],R=I[1],M=(0,s.useState)(!1),x=(0,D.Z)(M,2),N=x[0],_=x[1],u=(0,s.useState)(e.data),t=(0,D.Z)(u,2),Z=t[0],k=t[1],o=(0,s.useState)(oe()),L=(0,D.Z)(o,1),ue=L[0],G=(0,s.useState)((c=e.commandShow)!==null&&c!==void 0?c:!0),ve=(0,D.Z)(G,1),de=ve[0],he=(0,s.useState)((j=e.modelshow)!==null&&j!==void 0?j:!1),O=(0,D.Z)(he,2),h=O[0],E=O[1];(0,s.useEffect)(function(){k(e.data)},[e.data]),(0,s.useEffect)(function(){var $;E(($=e.modelshow)!==null&&$!==void 0?$:!1)},[e.modelshow]);var F={page:1,size:10,whereList:[],sortList:[]},ie=function(){var m,b,l=on()().valueOf().toString(),y={id:l,isnew:!0,editable:!0};if((m=e.model)===null||m===void 0||(b=m.fields)===null||b===void 0||b.forEach(function(ae){ae.field!=null&&ae.field!="id"&&(y[ae.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(y))){var W=[],J=1;Z!=null&&Z.rows!=null&&(W=(0,Be.Z)(Z.rows),W.forEach(function(ae){ae.editable=!1}),J=Z.total+J);var le=[y].concat((0,Be.Z)(W));_(!0),e.onAdded!=null&&e.onAdded(y),e.onDataChange!=null?e.onDataChange({rows:le,total:J},y,"add"):k({rows:le,total:J})}},Y=function(){if(w.length>0){var m=[],b=[],l=(0,Be.Z)(Z.rows);w.forEach(function(W){if(W!=null){var J=l.findIndex(function(ae){return ae.id==W?e.onRemoveRowing!=null&&!e.onRemoveRowing(ae)?!1:(ae.isnew||m.push(W),!0):!1}),le=l.splice(J,1);e.onRemoveed!=null&&e.onRemoveed(le[0]),b.push(le[0])}});var y={rows:l,total:Z.total-1};e.onDataChange!=null?b.length>0&&e.onDataChange(y,b,"remove"):k(y)}};function oe(){var $=[];return e.model!=null&&(e.model.isadd&&$.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&$.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&($=e.onGetCommands($)),$}function me($,m){E($),e.onModalChange&&e.onModalChange($,m)}function je(){var $;if(!e.closetoolbar)return(0,n.jsx)(sn,{iscircle:e.iscirclebutton,commandShow:de,selectcount:w.length,attrs:ue,isclosecard:!1,onClick:function(b,l){e.onCommandClicking&&e.onCommandClicking(l),b=="add"&&ie(),b=="remove"&&Y(),e.onCommandClicked&&e.onCommandClicked(l)},searchShow:e.closesearch?!1:{fields:($=e.model)===null||$===void 0?void 0:$.fields,onSearch:function(b){F.whereList=[],b!=null&&((0,ze.isArray)(b)?F.whereList=b:F.whereList=[b]),F.page=1,F.sortList=[],e.onSearchData!=null&&e.onSearchData(F,function(l){k(l)})},onSearchData:e.onSearchData}})}function Se(){var $,m,b;return(0,n.jsx)(Ue,{attr:e.model,data:Z,isedit:!e.closeedit,rowedit:N,selectType:($=e.selectType)!==null&&$!==void 0?$:"checkbox",isselect:(m=e.isselect)!==null&&m!==void 0?m:!0,isclosecard:(b=e.closecard)!==null&&b!==void 0?b:!0,onSelectRows:function(y,W){console.log(y),console.log(W),B(W),R(y)},onSearchData:function(y,W){if(y.foreign&&y.field){e.onSearchData&&e.onSearchData(y,W);return}F.page=y.page,F.size=y.size,F.sortList=y.sortList,e.onSearchData!=null&&e.onSearchData(F,function(J){k(J)})},onRowDataChangeing:function(y,W,J){return e.onEditRowing!=null?e.onEditRowing(y,W,J):(!y.isnew&&e.onDataChange!=null&&e.onDataChange(Z,y,"edit"),!0)},onRowDoubleClick:function(y,W){W.editable!=null&&_(W.editable),e.ismodal&&h&&me(!1,W)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(y,W,J){W.isnew&&(W[J.rowfield]=J.row),e.onSearchValueChange&&e.onSearchValueChange(y,W,J)}})}function Ce(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[je(),Se()]}):(0,n.jsxs)(Re.Z,{children:[je(),Se()]})}function ge(){if(e.ismodal){var $;return(0,n.jsx)(Qe,{title:($=e.model)===null||$===void 0?void 0:$.title,width:600,visible:h,onCancel:function(){me(!1,null)},onOk:function(){me(!1,f)},children:(0,n.jsx)(n.Fragment,{children:Ce()})})}else return Ce()}return ge()},Xe=Yn,$n=un.Z.RangePicker,qn=Je.Z.Search,Ze;(function(Q){Q.Input="Input",Q.TextArea="Input.TextArea",Q.InputNumber="InputNumber",Q.Switch="Switch",Q.DatePicker="DatePicker",Q.RangePicker="RangePicker",Q.Search="Input.Search",Q.Avatar="Avatar",Q.Select="Select"})(Ze||(Ze={}));var dn=function(e){var c,j={maxLength:500,size:"middle",placeholder:"",disabled:(c=e.disabled)!==null&&c!==void 0?c:!1,style:{width:"100%"},texttype:Ze.Input};for(var r in j)e.options!=null&&e.options[r]!=null&&(j[r]=e.options[r]);return e.width!=null&&(j.style.width=e.width),j.texttype=_n(e,j),j},_n=function(e,c){var j=e.textType,r=e.attr;if(r!=null){if((r.type=="int"||r.type=="int32"||r.type=="int64"||r.type=="decimal")&&(j=Ze.InputNumber,c.min=r.min,r.precision!=null&&r.precision>0&&(c.precision=r.precision),c.picker=void 0),r.type=="datetime"&&(j=Ze.DatePicker),r.type=="boolean"&&(j=Ze.Switch,e.search)){j=Ze.Select;var i=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];c.options=i}if(r.comvtp!=null&&r.comvtp.isvtp){j=Ze.Select;var w=[];(0,ze.isMap)(r.comvtp.items)||(r.comvtp.items=new Map(r.comvtp.items)),r.comvtp.items.forEach(function(B,P){w.push({label:B,value:P})}),c.options=w}r.foreign!=null&&r.foreign.isfkey&&(j=Ze.Search),r.length!=null&&r.length>0&&(c.maxLength=r.length),e.disabled==null&&r.disabled!=null&&(c.disabled=r.disabled),e.search&&(c.disabled=!1)}return j==null&&(j=Ze.Input),j},pn=function(e){console.log(e),console.log(e.defaultValue);var c=(0,s.useState)(function(){return dn(e)}),j=(0,D.Z)(c,2),r=j[0],i=j[1],w=(0,s.useState)({isshow:!1,model:void 0,data:void 0}),B=(0,D.Z)(w,2),P=B[0],I=B[1],f=(0,s.useState)({row:void 0,value:"",text:"",rowfield:""}),R=(0,D.Z)(f,2),M=R[0],x=R[1],N=(0,Pn.Z)(e.defaultValue,{value:Z(e.value),onChange:function(h,E){if(console.log(h),e.onChange!=null){var F=k(h);console.log(F),e.onChange(F)}}}),_=(0,D.Z)(N,2),u=_[0],t=_[1];(0,s.useEffect)(function(){if(e.search){var O;M.field!=((O=e.attr)===null||O===void 0?void 0:O.field)&&o(null),i(dn(e))}},[e.attr]),(0,s.useEffect)(function(){var O;if(((O=e.attr)===null||O===void 0?void 0:O.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&M.row==null&&e.value!=null){var h=e.children[e.attr.foreign.oneobjectfield];o(h)}},[e.value]);function Z(O){var h=e.attr;return(0,Oe.MM)(h,O)}function k(O){var h=e.attr;switch(r.texttype){case Ze.Select:return(h==null?void 0:h.type)=="string"?O.label:(0,Oe.Nz)(h,O)}return(0,Oe.Nz)(h,O)}function o(O){var h={value:"",text:"",row:void 0,rowfield:"",field:""};if(O){var E,F,ie,Y,oe,me,je,Se,Ce,ge,$=(E=(F=e.attr)===null||F===void 0||(ie=F.foreign)===null||ie===void 0?void 0:ie.oneobjectfieldkey)!==null&&E!==void 0?E:"",m=(Y=(oe=e.attr)===null||oe===void 0||(me=oe.foreign)===null||me===void 0?void 0:me.onedisplayname)!==null&&Y!==void 0?Y:"";console.log($+"---"+m),h.row=O,h.value=O[$],h.text=O[m],h.rowfield=(je=(Se=e.attr)===null||Se===void 0||(Ce=Se.foreign)===null||Ce===void 0?void 0:Ce.oneobjectfield)!==null&&je!==void 0?je:"",h.field=(ge=e.attr)===null||ge===void 0?void 0:ge.field,console.log(h)}x(h),t(h.value),e.onSearchValueChange&&e.onSearchValueChange(h)}function L(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(qn,(0,ee.Z)((0,ee.Z)({},r),{},{size:"middle",value:M.text,onSearch:function(h){if(e.onSearchBefore!=null){var E,F={foreign:(E=e.attr)===null||E===void 0?void 0:E.foreign,value:h,field:e.attr};e.onSearchBefore(F,function(ie,Y){var oe;(ie.title==null||ie.title=="")&&(ie.title=(oe=e.attr)===null||oe===void 0?void 0:oe.title),I({isshow:!0,model:ie,data:Y})})}}})),(0,n.jsx)(Xe,{ismodal:!0,modelshow:P.isshow,model:P.model,data:P.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(h,E){var F=(0,ee.Z)({},P);F.isshow=h,console.log(F),I(F),o(E)},onSearchData:function(h,E){var F;h.field=e.attr,h.foreign=(F=e.attr)===null||F===void 0?void 0:F.foreign,e.onSearchData!=null&&e.onSearchData(h,E)}})]})}function ue(){var O=e.attr;return(O==null?void 0:O.type)=="string"&&(r.labelInValue=!0),(0,n.jsx)(zn.Z,(0,ee.Z)((0,ee.Z)({},r),{},{size:"middle",value:u,onChange:t}))}function G(){return(0,n.jsx)(Wn.Z,{size:"default",checked:u,onChange:t})}function ve(){var O=e.attr,h=void 0,E=void 0;if(console.log(O),O&&O.datatimetype&&(O.datatimetype.istime&&(h={format:O.datatimetype.timeformat}),E=O.datatimetype.dateformat,O.datatimetype.istime&&(E=E+" "+O.datatimetype.timeformat)),e.search){var F;return(0,n.jsx)($n,{size:"middle",showTime:h,format:E,style:r.style,value:u,allowEmpty:[!0,!0],picker:(F=e.options)===null||F===void 0?void 0:F.picker,onChange:t})}else return(0,n.jsx)(un.Z,(0,ee.Z)((0,ee.Z)({},r),{},{format:E,showTime:h,size:"middle",picker:"date",value:u,onChange:t}))}function de(){return(0,n.jsx)(Ln.Z,(0,ee.Z)((0,ee.Z)({},r),{},{value:u,onChange:t}))}function he(){switch(r.texttype){case Ze.InputNumber:return de();case Ze.DatePicker:return ve();case Ze.Switch:return G();case Ze.Select:return ue();case Ze.Search:return L()}return(0,n.jsx)(Je.Z,(0,ee.Z)((0,ee.Z)({},r),{},{size:"middle",value:u,onChange:function(h){t(h.target.value)}}))}return he()},Ye=pn,et=a(76570),Nt=null,nt=function(e){var c=new Map;c.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),c.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),c.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var j=(0,s.useState)({value:"",attr:{type:"string"}}),r=(0,D.Z)(j,2),i=r[0],w=r[1],B=(0,s.useState)(""),P=(0,D.Z)(B,2),I=P[0],f=P[1],R=(0,s.useState)({type:"string"}),M=(0,D.Z)(R,2),x=M[0],N=M[1],_=(0,s.useState)({name:"*",type:"string",symbol:""}),u=(0,D.Z)(_,2),t=u[0],Z=u[1],k=(0,s.useState)({picker:null}),o=(0,D.Z)(k,2),L=o[0],ue=o[1],G=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(h){if(h.issearch){var E,F=(E=h.searchsymbol)!==null&&E!==void 0?E:c.get(h.type);h.type=="datetime"&&(F=c.get(h.type)),h.type=="decimal"&&(F=c.get("int")),h.foreign&&h.foreign.isfkey&&(F=void 0),G.push({label:h.title,value:h.field,children:F})}});function ve(){return(0,n.jsx)(kn.Z,{style:{width:"140px"},options:G,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(E){var F;console.log(E);var ie=E[0],Y=(F=e.fields)===null||F===void 0?void 0:F.find(function(me){return me.field==ie});if(Z({name:ie,symbol:E[1],type:Y==null?void 0:Y.type}),t.name!=ie&&(w(Object.assign(i,{value:"",attr:Y})),f(""),N(Y),(Y==null?void 0:Y.type)=="datetime")){var oe=(0,ee.Z)({},L);oe.picker=E[1],ue(oe)}}})}function de(){return(0,n.jsx)(Ye,{width:"240px",options:L,search:!0,name:t.name,attr:x,value:I,onChange:function(E){console.log(E),f(E),w({value:E,attr:i.attr})},onSearchBefore:function(E,F){e.onSearchData&&e.onSearchData(E,function(ie){F(ie.model,ie)})},onSearchData:e.onSearchData})}function he(){return(0,n.jsx)(be.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(et.Z,{}),onClick:function(){console.log(i);var E=(0,Oe.Nz)(x,i.value);console.log(E);var F={name:t.name,symbol:t.symbol,value:E};if(F.name=="*"&&F.value=="")e.onSearch();else{if(x.type=="datetime"&&i.value!=""&&(0,ze.isArray)(E)){var ie=[];return i.value[0]!=null&&(F.symbol=">=",F.value=i.value[0],ie.push(F)),i.value[1]!=null&&ie.push({name:t.name,symbol:"<=",value:i.value[1]}),e.onSearch(ie)}e.onSearch(F)}}})}function O(){return(0,n.jsxs)(Je.Z.Group,{compact:!0,children:[ve(),de(),he()]})}return O()},tt=nt,at=function(){function Q(){(0,yn.Z)(this,Q),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Cn.Z)(Q,[{key:"onPrint",value:function(c){}},{key:"onSet",value:function(c){}},{key:"onHelp",value:function(c){}},{key:"onAbout",value:function(c){}}]),Q}(),it=function(e){var c=["add","create"],j=["remove","delete"],r=["update","edit"],i=["ImportData","import"],w=["ExportData","export"];function B(){var t,Z=[],k=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(o){if(o.issplit&&o.splitname!=null)if(k.has(o.splitname)){var L=k.get(o.splitname);L==null||L.push(o)}else k.set(o.splitname,[o]);else Z.push(o)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:Z.map(function(o){if(k.has(o.command)){var L,ue=(0,n.jsx)(an.Z,{children:(L=k.get(o.command))===null||L===void 0?void 0:L.map(function(G,ve){return(0,n.jsx)(an.Z.Item,{children:(0,n.jsx)(Me,(0,ee.Z)((0,ee.Z)({},x(G)),{},{onClick:function(){return M(G.command,G)},toolbar:e}),ve)},ve)})});return(0,n.jsx)(Me,(0,ee.Z)((0,ee.Z)({},x(o)),{},{icon:(0,n.jsx)(Zn.Z,{}),ismenu:!0,menu:ue,onClick:function(){return M(o.command,o)},toolbar:e}))}else return(0,n.jsx)(Me,(0,ee.Z)((0,ee.Z)({},x(o)),{},{onClick:function(){return M(o.command,o)},toolbar:e}))})})}function P(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function I(){if(e.helpShow!=null&&e.helpShow!=!1){var t,Z,k,o,L,ue,G,ve,de,he,O=(0,s.useState)({isprint:(t=(Z=e.helpShow)===null||Z===void 0?void 0:Z.isprint)!==null&&t!==void 0?t:!1,isset:(k=(o=e.helpShow)===null||o===void 0?void 0:o.isset)!==null&&k!==void 0?k:!1,ishelp:(L=(ue=e.helpShow)===null||ue===void 0?void 0:ue.ishelp)!==null&&L!==void 0?L:!1,isabout:(G=(ve=e.helpShow)===null||ve===void 0?void 0:ve.isabout)!==null&&G!==void 0?G:!1,wvh:(de=(he=e.helpShow)===null||he===void 0?void 0:he.wvh)!==null&&de!==void 0?de:new at}),h=(0,D.Z)(O,2),E=h[0],F=h[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:f(E)})}}function f(t){var Z=[];if(t.isprint){var k;Z.push((0,n.jsx)(Me,{title:(k=t.wvh)===null||k===void 0?void 0:k.printText,name:"print",shape:"circle",icon:(0,n.jsx)(jn.Z,{}),onClick:M}))}if(t.isset){var o;Z.push((0,n.jsx)(Me,{title:(o=t.wvh)===null||o===void 0?void 0:o.setText,name:"set",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:M}))}if(t.ishelp){var L;Z.push((0,n.jsx)(Me,{title:(L=t.wvh)===null||L===void 0?void 0:L.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:M}))}if(t.isabout){var ue;Z.push((0,n.jsx)(Me,{title:(ue=t.wvh)===null||ue===void 0?void 0:ue.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:M}))}return Z.length>0&&Z.unshift((0,n.jsx)(tn.Z,{type:"vertical"})),Z.map(function(G){return G})}function R(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(tt,(0,ee.Z)({},e.searchShow))}var M=function(Z,k){e.onClick!=null&&e.onClick(Z,k)};function x(t){var Z,k={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return k.disabled=(Z=P(t))!==null&&Z!==void 0?Z:!1,k=N(k),e.iscircle&&(k.shape="circle",k.title=k.text,k.text=""),k}function N(t){return c.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Fn.Z,{component:Dn.Z})),j.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Tn.Z,{})),r.includes(t.name)&&(t.icon=(0,n.jsx)(Rn.Z,{})),i.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),w.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(In.Z,{})),t}var _=function(Z){return Z.length==3?(0,n.jsxs)(ce.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:10,children:(0,n.jsx)(ce.Z,{justify:"start",children:Z[0]})}),(0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)(ce.Z,{justify:"end",children:Z[1]})}),(0,n.jsx)(re.Z,{span:6,children:(0,n.jsx)(ce.Z,{justify:"end",children:Z[2]})})]}):Z.length==2?(0,n.jsxs)(ce.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(ce.Z,{justify:"start",children:Z[0]})}),(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(ce.Z,{justify:"end",children:Z[1]})})]}):Z.length==1?(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(ce.Z,{justify:"start",children:Z[0]})})}):(0,n.jsx)(n.Fragment,{})};function u(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(re.Z,{children:R()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(re.Z,{children:B()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(re.Z,{children:I()})),e.isclosecard?_(t):(0,n.jsx)(Re.Z,{children:_(t)})}return u()},sn=it,Kt=a(9715),$e=a(22712),lt=He.Z.TabPane,ut=function(e){var c,j=$e.Z.useForm(),r=(0,D.Z)(j,1),i=r[0],w=(0,s.useState)(e.title),B=(0,D.Z)(w,2),P=B[0],I=B[1],f=(0,s.useState)((c=e.isshow)!==null&&c!==void 0?c:!1),R=(0,D.Z)(f,2),M=R[0],x=R[1],N=(0,s.useState)(F(e.attr)),_=(0,D.Z)(N,2),u=_[0],t=_[1],Z=(0,s.useState)(function(){return Y(e.values)}),k=(0,D.Z)(Z,2),o=k[0],L=k[1],ue=(0,s.useState)(!1),G=(0,D.Z)(ue,2),ve=G[0],de=G[1],he=(0,s.useState)(!1),O=(0,D.Z)(he,2),h=O[0],E=O[1];(0,s.useEffect)(function(){console.log(e.values),e.values!=null?L(Y(e.values)):oe()},[e.values]),(0,s.useEffect)(function(){t(F(e.attr))},[e.attr]);function F(m){var b,l;return{items:m==null||(b=m.fields)===null||b===void 0?void 0:b.filter(function(y){return y.visible&&y.isedit}),models:m==null||(l=m.childmodels)===null||l===void 0?void 0:l.filter(function(y){return y.propertyname==null&&(y.propertyname=y.name),y.visible})}}function ie(){var m,b=[];return(m=u.items)===null||m===void 0||m.forEach(function(l){var y=me(e.attr,l);e.onInitTextBox!=null&&e.onInitTextBox(l,txtprops),b.push((0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)($e.Z.Item,(0,ee.Z)((0,ee.Z)({},y),{},{children:(0,n.jsx)(Ye,{attr:l,defaultValue:l.defaultvalue,onSearchBefore:function(J,le){e.onSearchData!=null&&e.onSearchData(J,function(ae){le(ae.model,ae)})},onSearchData:function(J,le){e.onSearchData&&e.onSearchData(J,le)},children:o})}),l.field)}))}),e.onInitFormed!=null&&(i.setFieldDisabled=function(l,y){var W;(W=u.items)===null||W===void 0||W.forEach(function(J){var le;((le=J.field)===null||le===void 0?void 0:le.toLocaleLowerCase())==l.toLocaleLowerCase()&&(J.disabled=y)}),t(u)},i.setTitle=function(l){I(l)},i.show=function(){x(!0)},i.hide=function(){x(!1)},i.setValues=function(l){L(Y(l))},i.clear=function(){oe()},i.setHideSearch=function(l){E(l)},i.setHideToolbar=function(l){de(l)},e.onInitFormed(i)),b}function Y(m){var b;return m==null&&(m={}),i.setFieldsValue(m),u.models!=null&&((b=u.models)===null||b===void 0?void 0:b.length)>0&&(console.log(u),u.models.forEach(function(l){m[l.propertyname]?m[l.propertyname].total=m[l.propertyname].length:(m[l.propertyname]=[],m[l.propertyname].total=0),l.removeRows=[]})),m}function oe(){var m;i.resetFields();var b={};(m=u.models)===null||m===void 0||m.forEach(function(l){b[l.propertyname]||(b[l.propertyname]=[],b[l.propertyname].total=0)}),L(b)}function me(m,b){var l={};l.name=b.field,l.label=b.title;var y=je(b);return b.disabled||(l.rules=y),e.onInitItem!=null&&e.onInitItem(b,l),l}function je(m){var b,l=[];if(m.required&&l.push({required:m.required}),(b=m.length)!==null&&b!==void 0?b:0>0){var y;l.push({max:(y=m.length)!==null&&y!==void 0?y:500,type:(0,Oe.mc)(m.type)})}return e.onFieldRules!=null&&(l=e.onFieldRules(m,l)),l}var Se=function(b){var l,y=Object.assign({},o);for(var W in b)y[W]=b[W];return u.models!=null&&((l=u.models)===null||l===void 0?void 0:l.length)>0&&u.models.forEach(function(J){var le;y[J.propertyname]!=null&&y[J.propertyname].forEach(function(ae){ae.isnew?ae.modelState=1:ae.modelState=2}),(le=J.removeRows)===null||le===void 0||le.forEach(function(ae){ae.modelState=3,y[J.propertyname].push(ae)})}),console.log(y),y};function Ce(){return(0,n.jsx)($e.Z,{labelAlign:"left",form:i,onFinish:function(b){var l=Se(b);i.onFinish!=null&&i.onFinish(l),e.onFinish!=null&&e.onFinish(l)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(ce.Z,{gutter:24,children:ie()})})}function ge(){var m;if(u.models!=null&&((m=u.models)===null||m===void 0?void 0:m.length)>0){var b;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(b=u.models)===null||b===void 0?void 0:b.map(function(l,y){var W;return(0,n.jsx)(lt,{tab:l.title,children:(0,n.jsx)(Xe,{model:l,data:{rows:o[l.propertyname],total:(W=o[l.propertyname])===null||W===void 0?void 0:W.total},iscirclebutton:!0,closetoolbar:ve,closesearch:h,closecard:!0,onSearchData:function(le){e.onSearchData!=null&&(le.parent=o,le.childmodel=l,e.onSearchData(le,function(ae){var Ee=Object.assign({},o);Ee[l.propertyname]=ae.rows,Ee[l.propertyname].total=ae.total,L(Ee)}))},onDataChange:function(le,ae,Ee){console.log(le,ae);var we=Object.assign({},o);we[l.propertyname]=le.rows,we[l.propertyname].total=le.total,console.log(we),Ee=="remove"&&ae.forEach(function(Fe){Fe&&!Fe.isnew&&l.removeRows.push(Fe)}),L(we)}})},y)})})}return(0,n.jsx)(n.Fragment,{})}function $(){return e.ismodal?(0,n.jsxs)(Qe,{title:P,width:1100,visible:M,onCancel:function(){return x(!1)},onOk:function(){i.submit()},children:[(0,n.jsx)(Re.Z,{children:Ce()}),ge()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Re.Z,{title:P,children:Ce()}),ge()]})}return $()},fn=ut,cn=a(38535),ot=a(73218),Ht=a(34669),rt=a(82833),Gt=a(17462),qe=a(76772),_e=a(3182),vn=a(91220),dt=a(94043),Ae=a.n(dt),st=a(43347),Jt=a(35556),hn=a(97880),ft=hn.Z.Step,ct=function(e){var c,j,r=(0,s.useState)((c=e.currentStep)!==null&&c!==void 0?c:0),i=(0,D.Z)(r,2),w=i[0],B=i[1],P=(0,s.useState)((j=e.isShow)!==null&&j!==void 0?j:!1),I=(0,D.Z)(P,2),f=I[0],R=I[1];(0,s.useEffect)(function(){var u;R((u=e.isShow)!==null&&u!==void 0?u:!1)},[e.isShow]),(0,s.useEffect)(function(){var u;if(B((u=e.currentStep)!==null&&u!==void 0?u:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function M(u){return e.onCurrentStepComponent?e.onCurrentStepComponent(u):(0,n.jsx)(fn,{attr:e.attr,ismodal:!1})}function x(){var u;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(hn.Z,{current:w,onChange:function(Z){B(Z),e.onChange&&e.onChange(Z)},children:(u=e.stepItem)===null||u===void 0?void 0:u.map(function(t){return(0,n.jsx)(ft,(0,ee.Z)({},t))})}),(0,n.jsx)(tn.Z,{}),M(w)]})}function N(u){R(u),e.onShowChange&&e.onShowChange(u)}function _(){if(e.isModal){var u={onOk:function(){N(!1)},onCancel:function(){N(!1)}};return e.closeOk&&(u.footer=!1),(0,n.jsx)(Qe,(0,ee.Z)((0,ee.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:f},u),{},{children:x()}))}return e.isCard?(0,n.jsx)(Re.Z,{title:e.title,bordered:!1,children:x()}):x()}return _()},vt=ct,pe=a(54701),ht=a(58602),mn=a(32059);function gn(Q,e,c){var j=Q.map(function(I,f){return Object.assign({},{key:I.key,title:I.title,position:String.fromCharCode(65+f)+1})}).reduce(function(I,f){return Object.assign({},I,(0,mn.Z)({},f.position,{key:f.key,v:f.title}))},{}),r=e.map(function(I,f){return Q.map(function(R,M){return Object.assign({},{content:I[R.key],position:String.fromCharCode(65+M)+(f+2)})})}).reduce(function(I,f){return I.concat(f)}).reduce(function(I,f){return Object.assign({},I,(0,mn.Z)({},f.position,{v:f.content}))},{}),i=Object.assign({},j,r),w=Object.keys(i),B="".concat(w[0],":").concat(w[w.length-1]),P={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},i,{"!ref":B,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};pe.NC(P,c)}function mt(Q,e,c,j,r){return en.apply(this,arguments)}function en(){return en=(0,_e.Z)(Ae().mark(function Q(e,c,j,r,i){var w,B;return Ae().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:c>0&&(w=[],e.fields.forEach(function(f){f.visible&&w.push({title:f.title,key:f.field,item:f})}),B=Object.assign({},j),B.page=1,B.size=c,B.size>0&&r(B).then(function(f){if(f!=null&&f.success&&f.data&&f.data.rows){var R=f.data.rows;for(var M in R)for(var x in w){var N=R[M][w[x].key],_=rn(N,w[x].item,R[M]);R[M][w[x].key]=_!=null?_:""}gn(w,R,i)}}));case 1:case"end":return I.stop()}},Q)})),en.apply(this,arguments)}var gt=function(e){var c,j=(0,s.useState)(0),r=(0,D.Z)(j,2),i=r[0],w=r[1],B=(0,s.useState)((c=e.isShow)!==null&&c!==void 0?c:!1),P=(0,D.Z)(B,2),I=P[0],f=P[1],R=(0,s.useState)(0),M=(0,D.Z)(R,2),x=M[0],N=M[1],_=(0,s.useState)({model:void 0,data:{rows:[],total:0}}),u=(0,D.Z)(_,2),t=u[0],Z=u[1],k=(0,s.useState)(W(e.attr)),o=(0,D.Z)(k,2),L=o[0],ue=o[1],G=(0,s.useState)({message:"",description:"",type:"success",count:0}),ve=(0,D.Z)(G,2),de=ve[0],he=ve[1],O=(0,s.useState)(null),h=(0,D.Z)(O,2),E=h[0],F=h[1],ie=(0,s.useState)({model:null,rows:[],total:0}),Y=(0,D.Z)(ie,2),oe=Y[0],me=Y[1],je=(0,s.useState)(!0),Se=(0,D.Z)(je,2),Ce=Se[0],ge=Se[1],$=(0,s.useState)(void 0),m=(0,D.Z)($,2),b=m[0],l=m[1];function y(){w(0),N(0),Z({model:void 0,data:{rows:[],total:0}}),he({message:"",description:"",type:"success",count:0}),F(null),me({model:null,rows:[],total:0}),ge(!0),l(void 0)}function W(v){var d;return(d=v.fields)===null||d===void 0?void 0:d.filter(function(S){return S.visible&&!S.disabled})}(0,s.useEffect)(function(){f(e.isShow)},[e.isShow]),(0,s.useEffect)(function(){ue(W(e.attr))},[e.attr]);var J=function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(S){setTimeout(function(){S(!0)},d)})};function le(){var v={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},d={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},S={title:"\u5BFC\u5165\u6570\u636E"},V=[v,d,S];return V}function ae(v){var d={fields:[]};if(v.length>0)for(var S in v[0]){var V;(V=d.fields)===null||V===void 0||V.push({field:S,title:S,type:"string",visible:!0,sorter:!1})}return d}function Ee(v){var d=v.rowcount,S=v.data;if(d>0){N(d);for(var V=ae(S),X=[],z=0;z<6;z++)X.push(S[z]);Z({model:V,data:{rows:X,total:5}})}}function we(){var v,d,S=new Map,V=new Map;(v=t.model)===null||v===void 0||(d=v.fields)===null||d===void 0||d.forEach(function(te,T){S.set(T,te.title)});var X=[];L.forEach(function(te,T){var se,xe;V.set(T,te.title);var q=te.foreign&&te.foreign.isfkey?"Name":"",ye=(se=t.model)===null||se===void 0||(xe=se.fields)===null||xe===void 0?void 0:xe.find(function(Ge){return Ge.field==te.field||Ge.field==te.title}),De=void 0;if(ye==null||ye==null){var Ie;T<((Ie=t.model)===null||Ie===void 0?void 0:Ie.fields.length)&&(De=T),X.push({id:T,source:De,target:T,defaultValue:"",foreignMap:q})}else{var Te=(0,vn.Z)(S.entries()),Le;try{for(Te.s();!(Le=Te.n()).done;){var Ne=Le.value;if(ye.title==Ne[1]||ye.field==Ne[1]){De=Ne[0];break}}}catch(Ge){Te.e(Ge)}finally{Te.f()}X.push({id:T,source:De,target:T,defaultValue:"",foreignMap:q})}});var z=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:S},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:V},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];me({model:{fields:z,isadd:!1,isedit:!0,isremove:!1},rows:X,total:X.length})}function Fe(v){var d={};for(var S in oe.rows){var V,X,z=oe.rows[S],te=(V=t.model)===null||V===void 0?void 0:V.fields[z.source];if(!((te==null||te==null)&&z.defaultValue=="")){var T=L[z.target];if(!(T==null||T==null)){if(z.defaultValue!=null&&z.defaultValue!=""){var se;d[T.field]=z.defaultValue,(se=T.foreign)!==null&&se!==void 0&&se.isfkey&&(d[T.field]=z[T.field]);continue}var xe=te.field,q=v[xe];if(T.required&&(q==null||q==null||q=="")){g(d,"\u5BFC\u5165\u6570\u636E".concat(te.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(T.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!(q==null||q==null||q=="")){if(T!=null&&T.comvtp&&T.comvtp.isvtp){var ye=(0,vn.Z)(T.comvtp.items.entries()),De;try{for(ye.s();!(De=ye.n()).done;){var Ie=De.value;if(q==Ie[1]){q=Ie[0];break}}}catch(Le){ye.e(Le)}finally{ye.f()}}if((X=T.foreign)!==null&&X!==void 0&&X.isfkey&&b!=null&&b.has(T.field)){var Te=b.get(T.field);q=Te[q]}d[T.field]=q}}}}return d}function Ve(v){var d=new Map;return oe.rows.forEach(function(S){var V,X=(V=t.model)===null||V===void 0?void 0:V.fields[S.source];if(X){var z,te=L[S.target],T=S.foreignMap==""?"Name":S.foreignMap;if((z=te.foreign)!==null&&z!==void 0&&z.isfkey&&S.defaultValue==""){d.has(te.field)||d.set(te.field,new Map);var se=d.get(te.field);for(var xe in v){var q=v[xe],ye=q[X.field];ye!=null&&ye!=""&&!se.has(ye)&&(se==null||se.set(ye,T))}}}}),d}function Pe(v){var d=Ve(v);if(d.size==0){ge(!1),he({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var S="";d.forEach(function(V,X){var z=L.find(function(q){return q.field==X}),te=L.find(function(q){return q.type=="string"}).searchsymbol.find(function(q){return q.label=="\u7B49\u4E8E"}).value,T=[],se="";V.forEach(function(q,ye){se=q.toLowerCase(),T.push({name:q,symbol:te,value:ye,relation:"||"})});var xe={field:z,foreign:z.foreign,whereList:T};e.onSearchData&&(J(200),e.onSearchData(xe,function(q){if(q&&q.rows.length>0)if(q.rows.length==V.size){console.log(V);for(var ye in q.rows){var De=q.rows[ye][se];V.has(De)&&(V[De]=q.rows[ye].id)}l(d),ge(!1),console.log(de.description),he({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(z==null?void 0:z.title,"\u6570\u636E").concat(q.total,`\u9879\u3002
`),type:"info",count:0})}else V.forEach(function(Ie,Te){var Le=q.rows.find(function(Ne){return Ne[se]==Te});S+="".concat(z==null?void 0:z.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(Te,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),Le==null&&g(q.rows,S,0)});else S+="".concat(z==null?void 0:z.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(T[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),g(q.rows,S,0)}))})}function ke(v){if(E==null||E.data==null){We.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var d=E.data;if(oe.rows.length<=0){We.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!Ce){if(v==d.length){he({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:v}),ge(!0);return}var S=Fe(d[v]);S!=null&&U(S,function(V,X){ne(S,V,X,v)})}}function ne(v,d,S,V){d?(V++,he({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(v),type:"success",count:V}),J(200),ke(V)):g(v,S,V)}function U(v,d){return H.apply(this,arguments)}function H(){return H=(0,_e.Z)(Ae().mark(function v(d,S){return Ae().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:e.onAdd&&e.onAdd("add",d).then(function(){var z=(0,_e.Z)(Ae().mark(function te(T){return Ae().wrap(function(xe){for(;;)switch(xe.prev=xe.next){case 0:if(console.log(T),T.ok!=null&&T.ok==!1&&(ge(!0),S(!1,T.statusText)),!(T!=null&&T.success)){xe.next=8;break}return xe.next=5,J(200);case 5:S(!0),xe.next=10;break;case 8:ge(!0),S(!1,T.message);case 10:case"end":return xe.stop()}},te)}));return function(te){return z.apply(this,arguments)}}());case 1:case"end":return X.stop()}},v)})),H.apply(this,arguments)}function g(v,d,S){var V={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(v),description:d,type:"error",count:S,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var z=e.form;z.clear(),z.setHideSearch(!0),z.setTitle(e.title),z.show(),z.setValues(v),z.onFinish=function(te){console.log(te),z.hide(),U(te,function(T,se){ne(te,T,se,S)})}}},children:"\u4FEE\u6539"})})};he(V)}function C(){var v={name:"file",accept:".xlsx, .xls",onChange:function(S){console.log(S);var V=new FileReader;V.onload=function(X){try{var z=X.target.result,te=pe.ij(z,{type:"binary"}),T=[];for(var se in te.Sheets)if(te.Sheets.hasOwnProperty(se)){T=pe.P6.sheet_to_json(te.Sheets[se]);break}var xe={data:T,rowcount:T.length};F(xe),Ee(xe)}catch(q){nn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log(q)}},V.readAsBinaryString(S.file.originFileObj)}};return(0,n.jsxs)(Re.Z,{children:[(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(x,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"primary",onClick:function(){var S=[],V={};L.forEach(function(X){S.push({title:X.title,key:X.field}),V[X.field]=X.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),gn(S,[V],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsxs)(ht.default,(0,ee.Z)((0,ee.Z)({},v),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(st.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Ue,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,push:11,children:(0,n.jsx)(be.Z,{type:"primary",disabled:x<1,onClick:function(){w(i+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function A(){var v={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:oe.model,data:{rows:oe.rows,total:oe.total},onDataChange:function(S){me((0,ee.Z)((0,ee.Z)({},oe),{},{rows:S.rows}))},onGetFieldToEdit:function(S,V){if(S.field=="defaultValue"){var X=V.target,z=L[X];return z}return S},onEditRowing:function(S,V,X){return X!=null&&(S.defaultValue=String(X)),!0},onSearchValueChange:function(S,V,X){X.text!=null&&(V.defaultValue=X.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Xe,(0,ee.Z)({},v))})}),(0,n.jsxs)(ce.Z,{gutter:[16,16],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",onClick:function(){w(i+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){w(i-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function K(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(x,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(de.count,"\u884C"),type:"info"})})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(rt.Z,{percent:parseInt((de.count/x*100).toString()),status:"active"})})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,(0,ee.Z)({},de))})}),(0,n.jsxs)(ce.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",disabled:Ce,onClick:function(){ke(de.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){w(i-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function p(v){f(v),e.onShowChange&&e.onShowChange(v),v||y()}function fe(){return(0,n.jsx)(vt,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:I,stepItem:le(),currentStep:i,onChange:function(d){if(d==1&&we(),d==2&&E&&E.data){var S=E.data;Pe(S)}w(d)},onCurrentStepComponent:function(d){return d==0?C():d==1?A():d==2?K():(0,n.jsx)(n.Fragment,{})},onShowChange:function(d){p(d)}})}return fe()},St=gt,xt=function(e){var c=(0,s.useState)(!1),j=(0,D.Z)(c,2),r=j[0],i=j[1],w=(0,s.useState)(null),B=(0,D.Z)(w,2),P=B[0],I=B[1],f=(0,s.useState)(0),R=(0,D.Z)(f,2),M=R[0],x=R[1],N=(0,s.useState)([]),_=(0,D.Z)(N,2),u=_[0],t=_[1],Z=(0,s.useState)(void 0),k=(0,D.Z)(Z,2),o=k[0],L=k[1],ue=(0,s.useState)({rows:[],total:0}),G=(0,D.Z)(ue,2),ve=G[0],de=G[1],he=(0,s.useState)(!1),O=(0,D.Z)(he,2),h=O[0],E=O[1],F=(0,s.useState)(null),ie=(0,D.Z)(F,2),Y=ie[0],oe=ie[1],me=(0,s.useState)({page:1,size:10,whereList:[],sortList:[]}),je=(0,D.Z)(me,2),Se=je[0],Ce=je[1],ge=(0,s.useState)(1),$=(0,D.Z)(ge,2),m=$[0],b=$[1];if((0,s.useEffect)(function(){L(void 0),I(null),x(0),t([]),de({rows:[],total:0}),l()},[e.controller]),o==null)return(0,n.jsx)(n.Fragment,{});function l(){if(console.log("waypage.init"),console.log(e),!e.init){var ne,U=(ne=e.namespace)!==null&&ne!==void 0?ne:e.controller;console.log(U+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(H){H!=null&&(H.success?(L(H.data),H.data.autoload&&y({},function(g){de(g)})):ae(H.message))})}function y(ne,U){x(0),i(!0),e.search(ne).then(function(H){if(H!=null)if(i(!1),H!=null&&H.success){if(H.data.rows==null&&(H.data.rows=[]),ne.foreign==null&&ne.childmodel==null&&u.length>0){var g=H.data.rows.find(function(C){return C.id==u[0]});g!=null?(t(u),x(u.length),I(g)):(t([]),x(0),I(null))}U?U(H.data):de(H.data)}else ae(H.message)},function(H){console.log(H),i(!1)})}var W=function(U){var H=null;U.isselectrow&&(H=P),U.selectmultiple&&(H=u),J(U,H)},J=function(U,H){i(!0),e.execute(U.command,H).then(function(g){console.log(g),g!=null&&g.success?(i(!1),nn.default.success(U.name+"\u5B8C\u6210"),(o==null?void 0:o.viewtype)!="form"&&(Y&&Y.hide(),y(Se,function(C){de(C)}))):(i(!1),ae(g.message))},function(g){console.log(g),i(!1)})};function le(ne){return typeof ne=="object"&&ne!==null}function ae(ne){var U=ne;le(ne)&&(U=ne.message),We.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(ot.Z,{}),content:(0,n.jsx)("div",{children:U})})}function Ee(ne,U){Y!=null&&Y.clear(),Y.setHideSearch(!0),Y.setTitle((o==null?void 0:o.title)+"-"+ne.name),Y.show(),U&&(Y.setValues(U),Y.setHideSearch(!1)),Y.onFinish=function(H){console.log(H),J(ne,H)}}function we(ne){var U,H=ne?{fields:o==null||(U=o.fields)===null||U===void 0?void 0:U.filter(function(g){var C;return(C=g.issearch)!==null&&C!==void 0?C:!0}),onSearch:function(C){i(!0);var A={page:1,whereList:[]};C!=null&&((0,ze.isArray)(C)?A.whereList=C:A.whereList=[C]),Ce(A),b(1),y(A,function(K){de(K)})},onSearchData:y}:!1;return(0,n.jsx)(sn,{attrs:o==null?void 0:o.commands,isselectrow:!0,selectcount:M,commandShow:!0,isshow:!ne,onClick:function(C,A){if(console.log(C),C=="ImportData"||C=="importdata"){E(!0);return}if(C=="ExportData"||C=="exportdata"){mt(o,ve.total,Se,e.search,e.title+".xlsx");return}if(C=="add"){if((o==null?void 0:o.viewtype)=="form"){Y.onFinish=function(K){console.log(K),J(A,K)},Y.submit();return}Ee(A);return}if(C=="edit"){Ee(A,P);return}W(A)},searchShow:H})}function Fe(){return(0,n.jsx)(Ue,{attr:o,data:ve,isselect:!0,isexpandable:!0,loading:r,current:m,onSelectRows:function(U,H){t(H),x(H.length),I(U)},onSearchData:function(U,H){if(U.parent&&U.childmodel){y(U,function(g){H(g)});return}i(!0),b(U.page),U.whereList=Se.whereList,Ce(U),y(U,function(g){de(g)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(U,H){var g,C=o==null||(g=o.commands)===null||g===void 0?void 0:g.find(function(A){return A.command=="edit"&&A.visible});C!=null&&Ee(C,H)}})}function Ve(ne){return(0,n.jsx)(fn,{attr:o,title:e.title,ismodal:ne,onInitFormed:function(H){oe(H)},onSearchData:y})}function Pe(){return(o==null?void 0:o.viewtype)=="form"?ke():(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:we(!0)})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Fe()})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ve(!0)})}),(0,n.jsx)(St,{title:e.title,isShow:h,attr:o,onAdd:e.execute,form:Y,onShowChange:function(U){E(U),U||y(Se)},onSearchData:y})]})}function ke(){return(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:we(!1)})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ve(!1)})})]})}return Pe()};function yt(Q,e){var c=e.controller;e.namespace!=null&&(c=e.namespace);var j=function(B){return{type:c+"/init",payload:B}},r=function(B){return{type:c+"/search",payload:B}},i=function(B){return{type:c+"/execute",payload:B}};return{dispatch:Q,init:function(){return Q(j({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(B){var P=e.namespace+"/"+e.service+"/"+e.controller;return Q(r({c:P,item:B,s:e.service}))},execute:function(B,P){var I=e.namespace+"/"+e.service+"/"+e.controller;return Q(i({c:I,command:B,item:P,s:e.service}))}}}var Ct=(0,xn.$j)(function(){},yt)(xt)},20067:function(){}}]);
