(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["8249b95c"],{"38f1a38b":function(e,t,r){"use strict";r.d(t,"__esModule",{value:!0}),r.d(t,"default",{enumerable:!0,get:function(){return p;}});var o=r("777fffbe"),a=r("1dda0c16"),l=r("6e3566fd"),i=r("1711f983"),s=o._(r("04463b55")),n=o._(r("3d1c988c")),d=o._(r("682f84e5")),c=o._(r("90ea153d")),u=o._(r("42e71898")),f=r("622d38cd");let g=e=>{try{let t=e.split(".");if(3!==t.length)throw Error("Invalid JWT token format");let r=t[1],o=atob(r.replace(/-/g,"+").replace(/_/g,"/")),a=JSON.parse(o);return console.log("===== JWT Token \u89E3\u6790\u7ED3\u679C ====="),console.log("Claims:",a),a;}catch(e){throw console.error("JWT Token \u89E3\u6790\u5931\u8D25:",e),Error("Token \u89E3\u6790\u5931\u8D25");}},h=e=>({userid:e.id||e.sub,name:e.name||e.displayName,email:e.email,avatar:e.avatar,signature:e.bio,title:e.title,group:e.owner,tags:[],notifyCount:0,unreadCount:0,country:e.country||e.region,access:"user",geographic:{province:{label:"",key:""},city:{label:"",key:""}},address:e.location||"",phone:e.phone||""});var p=()=>{let[e,t]=(0,l.useState)(!0),[r,o]=(0,l.useState)(null),[p,m]=(0,l.useState)({}),{setInitialState:y}=(0,i.useModel)("@@initialState");return((0,l.useEffect)(()=>{(async()=>{try{let{code:e,state:t}=(0,f.handleSigninCallback)(),r=await (0,f.fetchCasdoorConfig)(),o=window.location.origin,a=r.ismanage?"&type=manage":"",l=`${r.BackgroundCallbackURL}?code=${e}&state=${t}${a}`,s=`${o}${l}`,n=await fetch(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"}}),d=await n.text();if(!n.ok)throw Error(`\u{540E}\u{7AEF}\u{8FD4}\u{56DE}\u{9519}\u{8BEF}: ${n.status}`);let c=JSON.parse(d);if(!c.success||!c.data)throw Error("\u540E\u7AEF\u672A\u8FD4\u56DE\u6709\u6548\u7684 token");let u=c.data;localStorage.setItem("casdoor_token",u);let p=g(u),m=h(p);localStorage.setItem("casdoor_user",JSON.stringify(m)),await y(e=>({...e,currentUser:m}));let x=sessionStorage.getItem("redirect_url")||"/";sessionStorage.removeItem("redirect_url"),console.log("\u2705 \u767B\u5F55\u6210\u529F\uFF0C10\u6BEB\u79D2\u540E\u8DF3\u8F6C\u5230:",x),setTimeout(()=>{i.history.push(x);},10);}catch(e){console.error("===== \u6574\u4F53\u5904\u7406\u5931\u8D25 ====="),console.error("Error:",e),o(e.message||"\u767B\u5F55\u5904\u7406\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5"),t(!1);}})();},[y]),e&&!r)?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",padding:"24px",backgroundColor:"#f0f2f5"},children:(0,a.jsx)(c.default,{title:"\u767B\u5F55\u56DE\u8C03\u5904\u7406\u4E2D",style:{width:"100%",maxWidth:900},extra:(0,a.jsx)(s.default,{indicator:(0,a.jsx)(u.default,{style:{fontSize:24},spin:!0})})})}):r?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",padding:"24px",backgroundColor:"#f0f2f5"},children:(0,a.jsxs)(c.default,{style:{width:"100%",maxWidth:900},children:[(0,a.jsx)(n.default,{status:"error",title:"\u767B\u5F55\u5931\u8D25",subTitle:r,extra:[(0,a.jsx)(d.default,{type:"primary",onClick:()=>{sessionStorage.removeItem("redirect_url"),i.history.push("/user/login");},children:"\u8FD4\u56DE\u767B\u5F55"},"retry")]}),p.logs&&(0,a.jsxs)("div",{style:{marginTop:24,textAlign:"left"},children:[(0,a.jsx)("h3",{children:"\u{1F50D} \u8BE6\u7EC6\u9519\u8BEF\u4FE1\u606F\uFF1A"}),(0,a.jsx)("pre",{style:{padding:12,backgroundColor:"#fff2f0",borderRadius:4,fontSize:11,overflow:"auto",border:"1px solid #ffccc7",maxHeight:500},children:JSON.stringify(p,null,2)})]})]})}):null;};}}]);
//# sourceMappingURL=8249b95c-async.4737b80b.js.map