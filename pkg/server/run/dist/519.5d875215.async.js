(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(Zt,Sn,a){"use strict";a.d(Sn,{Z:function(){return Ct}});var jt=a(13062),de=a(71230),Et=a(89032),oe=a(15746),bt=a(71194),We=a(48889),wt=a(34792),nn=a(48086),F=a(2824),f=a(67294),xn=a(28216),Ft=a(58024),Re=a(39144),Dt=a(48736),tn=a(27049),Tt=a(49111),Ke=a(19650),Rt=a(30887),an=a(54689),_=a(11849),yn=a(69610),Cn=a(54941),Zn=a(57254),jn=a(7945),En=a(24616),bn=a(63270),wn=a(3050),Fn=a(16165),Dn=a(49101),Tn=a(73171),Rn=a(8212),Mn=a(65233),Bn=a(20924),In=a(25592),Mt=a(59250),On=a(13013),Bt=a(22385),ln=a(94199),It=a(57663),Ee=a(71577),An=a(57119),n=a(85893),Vn=function(e){var c,C,d,i,w,R,P,M,h,I,A,E={key:(c=e.key)!==null&&c!==void 0?c:e.name,name:(C=e.name)!==null&&C!==void 0?C:"",title:(d=e.title)!==null&&d!==void 0?d:"",text:e.text,danger:(i=e.danger)!==null&&i!==void 0?i:!1,block:(w=e.block)!==null&&w!==void 0?w:!1,type:(R=e.type)!==null&&R!==void 0?R:"default",target:e.target,size:(P=e.size)!==null&&P!==void 0?P:"default",shape:(M=e.shape)!==null&&M!==void 0?M:"",icon:(h=e.icon)!==null&&h!==void 0?h:"",ghost:(I=e.ghost)!==null&&I!==void 0?I:!1,disabled:(A=e.disabled)!==null&&A!==void 0?A:!1},N=(0,f.useState)(!1),q=(0,F.Z)(N,2),u=q[0],t=q[1];function y(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(z){return z.command==e.name}):null}var V=function(){if(e.onClick!=null)try{t({delay:100});var le=y();le!=null&&le.isalert?We.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(E.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(E)}}):e.onClick(E)}finally{t(!1)}};function o(){return e.ismenu?(0,n.jsx)(On.Z,{overlay:e.menu,children:(0,n.jsx)(ln.Z,{title:E.title,children:(0,n.jsx)(Ee.Z,(0,_.Z)((0,_.Z)({},E),{},{onClick:V,loading:u,children:E.text}))})}):(0,n.jsx)(ln.Z,{title:E.title,children:(0,n.jsx)(Ee.Z,(0,_.Z)((0,_.Z)({},E),{},{onClick:V,loading:u,children:E.text}))})}return o()},Me=Vn,Ot=a(47673),Je=a(4107),At=a(36877),kn=a(96607),Vt=a(77883),Ln=a(70507),kt=a(77576),Wn=a(12028),Lt=a(43358),zn=a(34041),Wt=a(53400),un=a(41505),Pn=a(76010),ze=a(96486),Oe=a(86582),zt=a(8963),Nn=a(68297),Pt=a(18106),He=a(58634),Kn=a(30381),on=a.n(Kn),Ae=a(75308);function rn(J,e,c){var C,d,i=(0,Ae.MM)(e,J);if((C=e.comvtp)!==null&&C!==void 0&&C.isvtp){var w=new Map(e.comvtp.items);i=w.get(i)}if((d=e.foreign)!==null&&d!==void 0&&d.isfkey){var R=e.foreign.oneobjectfield,P=e.foreign.onedisplayname;c[R]!=null&&(i=c[R][P])}if(e.type=="boolean"&&(i=i?"\u662F":"\u5426"),e.type=="datetime"){var M;i=i!=""?on()(i).format((M=e.datatimetype)===null||M===void 0?void 0:M.dateformat).toString():""}return i}var Hn=function(e,c,C,d){var i,w=e.attr,R=[];function P(h,I,A){var E=rn(h,I,A);return e.onFieldRender!=null?e.onFieldRender(I,E,A):(0,n.jsx)(n.Fragment,{children:E})}var M=function(I,A){return e.onColumnToEdit?e.onColumnToEdit(I,A):(e.onGetFieldToEdit&&(I=e.onGetFieldToEdit(I,A)),d(A),(0,n.jsx)(Ye,{attr:I,value:C[I.field],onChange:function(N){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(A,I.field,N))){console.log(N);var q=Object.assign({},C);A[I.field]=N,q[I.field]=N,d(q)}},onSearchValueChange:function(N){e.onSearchValueChange&&e.onSearchValueChange(I,A,N)},onSearchBefore:function(N,q){e.onSearchData&&e.onSearchData(N,function(u){q(u.model,u)})},onSearchData:e.onSearchData}))};return w==null||(i=w.fields)===null||i===void 0||i.filter(function(h){return h.visible}).forEach(function(h){var I;R.push({dataIndex:h.field,title:h.title,sorter:(I=h.sorter)!==null&&I!==void 0?I:!0,render:function(E,N){if(N!=null)return c&&N.editable&&(h.isedit==null||h.isedit==!0)?M(h,N):P(E,h,N)}})}),R},Gn=He.Z.TabPane,Jn=function J(e){var c,C,d,i,w,R=(0,f.useState)((c=e.loading)!==null&&c!==void 0?c:!1),P=(0,F.Z)(R,2),M=P[0],h=P[1],I=(0,f.useState)((C=e.data)!==null&&C!==void 0?C:{rows:[],total:0}),A=(0,F.Z)(I,2),E=A[0],N=A[1],q=(0,f.useState)((d=e.rowedit)!==null&&d!==void 0?d:!1),u=(0,F.Z)(q,2),t=u[0],y=u[1],V=(0,f.useState)((i=e.current)!==null&&i!==void 0?i:1),o=(0,F.Z)(V,2),z=o[0],le=o[1],G=(0,f.useState)(10),fe=(0,F.Z)(G,2),re=fe[0],ce=fe[1],k=(0,f.useState)([]),m=(0,F.Z)(k,2),D=m[0],b=m[1],ae=(0,f.useState)((w=e.selectType)!==null&&w!==void 0?w:"radio"),U=(0,F.Z)(ae,2),ue=U[0],ve=U[1],Ze=(0,f.useState)(),me=(0,F.Z)(Ze,2),xe=me[0],he=me[1],Y=(0,f.useState)({}),g=(0,F.Z)(Y,2),Z=g[0],l=g[1];(0,f.useEffect)(function(){var s;N((s=e.data)!==null&&s!==void 0?s:{rows:[],total:0})},[e.data]),(0,f.useEffect)(function(){var s;y((s=e.rowedit)!==null&&s!==void 0?s:!1)},[e.rowedit]),(0,f.useEffect)(function(){var s;h((s=e.loading)!==null&&s!==void 0?s:!1)},[e.loading]),(0,f.useEffect)(function(){var s;le((s=e.current)!==null&&s!==void 0?s:1)},[e.current]);var S=function(r,B,x){var X,ne,Ce=function(O){h(!1),N(O)},Fe=function(O){if(O.column==null)return"";var te={name:O.field,isdesc:!1};return O.order=="descend"&&(te.isdesc=!0),te};h(!0),le((X=r.current)!==null&&X!==void 0?X:1),ce((ne=r.pageSize)!==null&&ne!==void 0?ne:10);try{var T,v,j={page:(T=r.current)!==null&&T!==void 0?T:1,size:(v=r.pageSize)!==null&&v!==void 0?v:10,sortList:[]};if(x!=null)if((0,ze.isArray)(x))x.forEach(function(H){var O=Fe(H);O!=""&&H.sortList.push(O)});else{var L=Fe(x);L!=""&&j.sortList.push(L)}e.onSearchData!=null&&e.onSearchData(j,Ce)}finally{h(!1)}},K=function(r,B){var x=D.length<=r.length;if(b(r),e.onSelectRows!=null)if(r.length>0){var X=B[B.length-1];x||(X=null,r.length==1&&(X=E.rows.find(function(ne){return ne.id==r[0]}))),e.onSelectRows(X,r,x)}else e.onSelectRows(null,r,!1)},Q=function(){if(!!e.isselect)return{selectedRowKeys:D,fixed:!0,type:ue,columnTitle:xe,hideSelectAll:!1,columnWidth:"32px",onChange:K}};function ie(s){s=="checkbox"&&(ve("radio"),b([]),e.onSelectStateChange&&e.onSelectStateChange(!1),he(p()))}function p(){return(0,n.jsx)(Ee.Z,{type:"link",onClick:function(){he(null),ve("checkbox"),b([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function je(s){if(e.isedit){s.editable=!t;var r=(0,Oe.Z)(E.rows);r.forEach(function(B){B.id==s.id?B.editable=!t:B.editable&&(B.editable=!1)}),y(!t)}}function be(){var s;if(e.isexpandable&&(e==null||(s=e.attr)===null||s===void 0?void 0:s.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(B,x){var X;if(!!B&&(e==null||(X=e.attr)===null||X===void 0?void 0:X.childmodels)!=null&&e.attr.childmodels.length>0){var ne,Ce=e==null||(ne=e.attr)===null||ne===void 0?void 0:ne.childmodels[0];if(x[Ce.propertyname]||(x[Ce.propertyname]=[]),x[Ce.propertyname].total=x[Ce.propertyname].length,x[Ce.propertyname].total==0){var Fe={page:1,size:10};we(Fe,Ce,x)}}},expandedRowRender:Pe}:e.onExpandable(e.attr)}function we(s,r,B){s.childmodel=r,s.parent=B,e.onSearchData!=null&&e.onSearchData(s,function(x){var X=(0,Oe.Z)(E.rows),ne=X.findIndex(function(Ce){return Ce.id==B.id});X[ne][r.propertyname]=x.rows,X[ne][r.propertyname].total1=x.total,N({rows:X,total:E.total})})}var ke=function(r,B){if(e.onExpandedRowTabPane){var x=e.onExpandedRowTabPane(r,B);if(x!=null)return x}return(0,n.jsx)(J,{isselect:!1,isedit:!1,isclosecard:!0,attr:r,data:{rows:B[r.propertyname],total:B[r.propertyname].total1},onSearchData:function(ne){we(ne,r,B)}},"id")},Pe=function(r){var B;if((e==null||(B=e.attr)===null||B===void 0?void 0:B.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(X){var ne=e.attr.childmodels[Number(X)];we({},ne,r)},children:e.attr.childmodels.map(function(x,X){return r[x.propertyname]||(r[x.propertyname]=[]),r[x.propertyname].total=r[x.propertyname].length,(0,n.jsx)(Gn,{tab:x.title,children:ke(x,r)},X)})})};function Be(){var s=Hn(e,t,Z,l),r="id";return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:r,columns:s,rowSelection:Q(),scroll:{x:s.length*150},dataSource:E.rows,pagination:{current:z,pageSize:re,total:E.total,hideOnSinglePage:!0,showTotal:function(x){return"\u603B ".concat(x," \u884C")}},loading:M,expandable:be(),onChange:S,onRow:function(x){return{onClick:function(ne){ne.stopPropagation();try{var Ce,Fe;if(((Ce=Q())===null||Ce===void 0?void 0:Ce.type)=="radio"&&K([x[r]],[x]),((Fe=Q())===null||Fe===void 0?void 0:Fe.type)=="checkbox"){var T=x[r],v=[];D.includes(T)?v=D.filter(function(j){return j!=T}):(v=(0,Oe.Z)(D),v.push(T)),K(v,[x])}}finally{e.onRowClick&&e.onRowClick(ne,x)}},onDoubleClick:function(ne){ne.stopPropagation(),je(x),e.onRowDoubleClick&&e.onRowDoubleClick(ne,x)},onMouseEnter:function(ne){e.onRowMouseEnter&&e.onRowMouseEnter(ne,x)},onMouseLeave:function(ne){e.onMouseLeave&&e.onMouseLeave(ne,x)}}}})}function ee(){return e.isclosecard?Be():(0,n.jsx)(Re.Z,{children:Be()})}return ee()},Ue=Jn,Un=a(61193),Qn=a.n(Un),Xn=function(e){var c=(0,f.useState)({left:0,top:0,bottom:0,right:0}),C=(0,F.Z)(c,2),d=C[0],i=C[1],w=(0,f.useState)(!0),R=(0,F.Z)(w,2),P=R[0],M=R[1],h=f.createRef(),I=function(q,u){var t,y,V,o=(t=window)===null||t===void 0||(y=t.document)===null||y===void 0?void 0:y.documentElement,z=o.clientWidth,le=o.clientHeight,G=h==null||(V=h.current)===null||V===void 0?void 0:V.getBoundingClientRect();i({left:-(G==null?void 0:G.left)+(u==null?void 0:u.x),right:z-((G==null?void 0:G.right)-(u==null?void 0:u.x)),top:-(G==null?void 0:G.top)+(u==null?void 0:u.y),bottom:le-((G==null?void 0:G.bottom)-(u==null?void 0:u.y))})};function A(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){P&&M(!1)},onMouseOut:function(){M(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function E(){return(0,n.jsx)(We.Z,(0,_.Z)((0,_.Z)({},e),{},{title:A(),modalRender:function(q){return(0,n.jsx)(Qn(),{disabled:P,bounds:d,onStart:function(t,y){return I(t,y)},children:(0,n.jsx)("div",{ref:h,children:q})})}}))}return E()},Qe=Xn,Yn=function(e){var c,C,d=(0,f.useState)([]),i=(0,F.Z)(d,2),w=i[0],R=i[1],P=(0,f.useState)(null),M=(0,F.Z)(P,2),h=M[0],I=M[1],A=(0,f.useState)(!1),E=(0,F.Z)(A,2),N=E[0],q=E[1],u=(0,f.useState)(e.data),t=(0,F.Z)(u,2),y=t[0],V=t[1],o=(0,f.useState)(ue()),z=(0,F.Z)(o,1),le=z[0],G=(0,f.useState)((c=e.commandShow)!==null&&c!==void 0?c:!0),fe=(0,F.Z)(G,1),re=fe[0],ce=(0,f.useState)((C=e.modelshow)!==null&&C!==void 0?C:!1),k=(0,F.Z)(ce,2),m=k[0],D=k[1];(0,f.useEffect)(function(){V(e.data)},[e.data]),(0,f.useEffect)(function(){var Y;D((Y=e.modelshow)!==null&&Y!==void 0?Y:!1)},[e.modelshow]);var b={page:1,size:10,whereList:[],sortList:[]},ae=function(){var g,Z,l=on()().valueOf().toString(),S={id:l,isnew:!0,editable:!0};if((g=e.model)===null||g===void 0||(Z=g.fields)===null||Z===void 0||Z.forEach(function(p){p.field!=null&&p.field!="id"&&(S[p.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(S))){var K=[],Q=1;y!=null&&y.rows!=null&&(K=(0,Oe.Z)(y.rows),K.forEach(function(p){p.editable=!1}),Q=y.total+Q);var ie=[S].concat((0,Oe.Z)(K));q(!0),e.onAdded!=null&&e.onAdded(S),e.onDataChange!=null?e.onDataChange({rows:ie,total:Q},S,"add"):V({rows:ie,total:Q})}},U=function(){if(w.length>0){var g=[],Z=[],l=(0,Oe.Z)(y.rows);w.forEach(function(K){if(K!=null){var Q=l.findIndex(function(p){return p.id==K?e.onRemoveRowing!=null&&!e.onRemoveRowing(p)?!1:(p.isnew||g.push(K),!0):!1}),ie=l.splice(Q,1);e.onRemoveed!=null&&e.onRemoveed(ie[0]),Z.push(ie[0])}});var S={rows:l,total:y.total-1};e.onDataChange!=null?Z.length>0&&e.onDataChange(S,Z,"remove"):V(S)}};function ue(){var Y=[];return e.model!=null&&(e.model.isadd&&Y.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&Y.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&(Y=e.onGetCommands(Y)),Y}function ve(Y,g){D(Y),e.onModalChange&&e.onModalChange(Y,g)}function Ze(){var Y;if(!e.closetoolbar)return(0,n.jsx)(sn,{iscircle:e.iscirclebutton,commandShow:re,selectcount:w.length,attrs:le,isclosecard:!1,onClick:function(Z,l){e.onCommandClicking&&e.onCommandClicking(l),Z=="add"&&ae(),Z=="remove"&&U(),e.onCommandClicked&&e.onCommandClicked(l)},searchShow:e.closesearch?!1:{fields:(Y=e.model)===null||Y===void 0?void 0:Y.fields,onSearch:function(Z){b.whereList=[],Z!=null&&((0,ze.isArray)(Z)?b.whereList=Z:b.whereList=[Z]),b.page=1,b.sortList=[],e.onSearchData!=null&&e.onSearchData(b,function(l){V(l)})},onSearchData:e.onSearchData}})}function me(){var Y,g,Z;return(0,n.jsx)(Ue,{attr:e.model,data:y,isedit:!e.closeedit,rowedit:N,selectType:(Y=e.selectType)!==null&&Y!==void 0?Y:"checkbox",isselect:(g=e.isselect)!==null&&g!==void 0?g:!0,isclosecard:(Z=e.closecard)!==null&&Z!==void 0?Z:!0,onSelectRows:function(S,K){console.log(S),console.log(K),R(K),I(S)},onSearchData:function(S,K){if(S.foreign&&S.field){e.onSearchData&&e.onSearchData(S,K);return}b.page=S.page,b.size=S.size,b.sortList=S.sortList,e.onSearchData!=null&&e.onSearchData(b,function(Q){V(Q)})},onRowDataChangeing:function(S,K,Q){return e.onEditRowing!=null?e.onEditRowing(S,K,Q):(!S.isnew&&e.onDataChange!=null&&e.onDataChange(y,S,"edit"),!0)},onRowDoubleClick:function(S,K){K.editable!=null&&q(K.editable),e.ismodal&&m&&ve(!1,K)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(S,K,Q){K.isnew&&(K[Q.rowfield]=Q.row),e.onSearchValueChange&&e.onSearchValueChange(S,K,Q)}})}function xe(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[Ze(),me()]}):(0,n.jsxs)(Re.Z,{children:[Ze(),me()]})}function he(){if(e.ismodal){var Y;return(0,n.jsx)(Qe,{title:(Y=e.model)===null||Y===void 0?void 0:Y.title,width:600,visible:m,onCancel:function(){ve(!1,null)},onOk:function(){ve(!1,h)},children:(0,n.jsx)(n.Fragment,{children:xe()})})}else return xe()}return he()},Xe=Yn,$n=un.Z.RangePicker,qn=Je.Z.Search,ye;(function(J){J.Input="Input",J.TextArea="Input.TextArea",J.InputNumber="InputNumber",J.Switch="Switch",J.DatePicker="DatePicker",J.RangePicker="RangePicker",J.Search="Input.Search",J.Avatar="Avatar",J.Select="Select"})(ye||(ye={}));var dn=function(e){var c,C={maxLength:500,size:"middle",placeholder:"",disabled:(c=e.disabled)!==null&&c!==void 0?c:!1,style:{width:"100%"},texttype:ye.Input};for(var d in C)e.options!=null&&e.options[d]!=null&&(C[d]=e.options[d]);return e.width!=null&&(C.style.width=e.width),C.texttype=_n(e,C),C},_n=function(e,c){var C=e.textType,d=e.attr;if(d!=null){if((d.type=="int"||d.type=="int32"||d.type=="int64"||d.type=="decimal")&&(C=ye.InputNumber,c.min=d.min,d.precision!=null&&d.precision>0&&(c.precision=d.precision),c.picker=void 0),d.type=="datetime"&&(C=ye.DatePicker),d.type=="boolean"&&(C=ye.Switch,e.search)){C=ye.Select;var i=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];c.options=i}if(d.comvtp!=null&&d.comvtp.isvtp){C=ye.Select;var w=[];(0,ze.isMap)(d.comvtp.items)||(d.comvtp.items=new Map(d.comvtp.items)),d.comvtp.items.forEach(function(R,P){w.push({label:R,value:P})}),c.options=w}d.foreign!=null&&d.foreign.isfkey&&(C=ye.Search),d.length!=null&&d.length>0&&(c.maxLength=d.length),e.disabled==null&&d.disabled!=null&&(c.disabled=d.disabled),e.search&&(c.disabled=!1)}return C==null&&(C=ye.Input),C},pn=function(e){var c=(0,f.useState)(function(){return dn(e)}),C=(0,F.Z)(c,2),d=C[0],i=C[1],w=(0,f.useState)({isshow:!1,model:void 0,data:void 0}),R=(0,F.Z)(w,2),P=R[0],M=R[1],h=(0,f.useState)({row:void 0,value:"",text:"",rowfield:""}),I=(0,F.Z)(h,2),A=I[0],E=I[1],N=(0,Pn.Z)(e.defaultValue,{value:y(e.value),onChange:function(m,D){if(console.log(m),e.onChange!=null){var b=V(m);console.log(b),e.onChange(b)}}}),q=(0,F.Z)(N,2),u=q[0],t=q[1];(0,f.useEffect)(function(){if(e.search){var k;A.field!=((k=e.attr)===null||k===void 0?void 0:k.field)&&o(null),i(dn(e))}},[e.attr]),(0,f.useEffect)(function(){var k;if(((k=e.attr)===null||k===void 0?void 0:k.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&A.row==null&&e.value!=null){var m=e.children[e.attr.foreign.oneobjectfield];o(m)}},[e.value]);function y(k){var m=e.attr;return(0,Ae.MM)(m,k)}function V(k){var m=e.attr;switch(d.texttype){case ye.Select:return(m==null?void 0:m.type)=="string"?k.label:(0,Ae.Nz)(m,k)}return(0,Ae.Nz)(m,k)}function o(k){var m={value:"",text:"",row:void 0,rowfield:"",field:""};if(k){var D,b,ae,U,ue,ve,Ze,me,xe,he,Y=(D=(b=e.attr)===null||b===void 0||(ae=b.foreign)===null||ae===void 0?void 0:ae.oneobjectfieldkey)!==null&&D!==void 0?D:"",g=(U=(ue=e.attr)===null||ue===void 0||(ve=ue.foreign)===null||ve===void 0?void 0:ve.onedisplayname)!==null&&U!==void 0?U:"";console.log(Y+"---"+g),m.row=k,m.value=k[Y],m.text=k[g],m.rowfield=(Ze=(me=e.attr)===null||me===void 0||(xe=me.foreign)===null||xe===void 0?void 0:xe.oneobjectfield)!==null&&Ze!==void 0?Ze:"",m.field=(he=e.attr)===null||he===void 0?void 0:he.field,console.log(m)}E(m),t(m.value),e.onSearchValueChange&&e.onSearchValueChange(m)}function z(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(qn,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:A.text,onSearch:function(m){if(e.onSearchBefore!=null){var D,b={foreign:(D=e.attr)===null||D===void 0?void 0:D.foreign,value:m,field:e.attr};e.onSearchBefore(b,function(ae,U){var ue;(ae.title==null||ae.title=="")&&(ae.title=(ue=e.attr)===null||ue===void 0?void 0:ue.title),M({isshow:!0,model:ae,data:U})})}}})),(0,n.jsx)(Xe,{ismodal:!0,modelshow:P.isshow,model:P.model,data:P.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(m,D){var b=(0,_.Z)({},P);b.isshow=m,console.log(b),M(b),o(D)},onSearchData:function(m,D){var b;m.field=e.attr,m.foreign=(b=e.attr)===null||b===void 0?void 0:b.foreign,e.onSearchData!=null&&e.onSearchData(m,D)}})]})}function le(){var k=e.attr;return(k==null?void 0:k.type)=="string"&&(d.labelInValue=!0),(0,n.jsx)(zn.Z,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:u,onChange:t}))}function G(){return(0,n.jsx)(Wn.Z,{size:"default",checked:u,onChange:t})}function fe(){var k=e.attr,m=void 0,D=void 0;if(console.log(k),k&&k.datatimetype&&(k.datatimetype.istime&&(m={format:k.datatimetype.timeformat}),D=k.datatimetype.dateformat),e.search){var b;return(0,n.jsx)($n,{size:"middle",showTime:m,format:D,style:d.style,value:u,allowEmpty:[!0,!0],picker:(b=e.options)===null||b===void 0?void 0:b.picker,onChange:t})}else return(0,n.jsx)(un.Z,(0,_.Z)((0,_.Z)({},d),{},{format:D,showTime:m,size:"middle",picker:"date",value:u,onChange:t}))}function re(){return(0,n.jsx)(Ln.Z,(0,_.Z)((0,_.Z)({},d),{},{value:u,onChange:t}))}function ce(){switch(d.texttype){case ye.InputNumber:return re();case ye.DatePicker:return fe();case ye.Switch:return G();case ye.Select:return le();case ye.Search:return z()}return(0,n.jsx)(Je.Z,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:u,onChange:function(m){t(m.target.value)}}))}return ce()},Ye=pn,et=a(76570),Nt=null,nt=function(e){var c=new Map;c.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),c.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),c.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var C=(0,f.useState)({value:"",attr:{type:"string"}}),d=(0,F.Z)(C,2),i=d[0],w=d[1],R=(0,f.useState)(""),P=(0,F.Z)(R,2),M=P[0],h=P[1],I=(0,f.useState)({type:"string"}),A=(0,F.Z)(I,2),E=A[0],N=A[1],q=(0,f.useState)({name:"*",type:"string",symbol:""}),u=(0,F.Z)(q,2),t=u[0],y=u[1],V=(0,f.useState)({picker:null}),o=(0,F.Z)(V,2),z=o[0],le=o[1],G=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(m){if(m.issearch){var D,b=(D=m.searchsymbol)!==null&&D!==void 0?D:c.get(m.type);m.type=="datetime"&&(b=c.get(m.type)),m.type=="decimal"&&(b=c.get("int")),m.foreign&&m.foreign.isfkey&&(b=void 0),G.push({label:m.title,value:m.field,children:b})}});function fe(){return(0,n.jsx)(kn.Z,{style:{width:"140px"},options:G,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(D){var b;console.log(D);var ae=D[0],U=(b=e.fields)===null||b===void 0?void 0:b.find(function(ve){return ve.field==ae});if(y({name:ae,symbol:D[1],type:U==null?void 0:U.type}),t.name!=ae&&(w(Object.assign(i,{value:"",attr:U})),h(""),N(U),(U==null?void 0:U.type)=="datetime")){var ue=(0,_.Z)({},z);ue.picker=D[1],le(ue)}}})}function re(){return(0,n.jsx)(Ye,{width:"240px",options:z,search:!0,name:t.name,attr:E,value:M,onChange:function(D){console.log(D),h(D),w({value:D,attr:i.attr})},onSearchBefore:function(D,b){e.onSearchData&&e.onSearchData(D,function(ae){b(ae.model,ae)})},onSearchData:e.onSearchData})}function ce(){return(0,n.jsx)(Ee.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(et.Z,{}),onClick:function(){console.log(i);var D=(0,Ae.Nz)(E,i.value);console.log(D);var b={name:t.name,symbol:t.symbol,value:D};if(b.name=="*"&&b.value=="")e.onSearch();else{if(E.type=="datetime"&&i.value!=""&&(0,ze.isArray)(D)){var ae=[];return i.value[0]!=null&&(b.symbol=">=",b.value=i.value[0],ae.push(b)),i.value[1]!=null&&ae.push({name:t.name,symbol:"<=",value:i.value[1]}),e.onSearch(ae)}e.onSearch(b)}}})}function k(){return(0,n.jsxs)(Je.Z.Group,{compact:!0,children:[fe(),re(),ce()]})}return k()},tt=nt,at=function(){function J(){(0,yn.Z)(this,J),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Cn.Z)(J,[{key:"onPrint",value:function(c){}},{key:"onSet",value:function(c){}},{key:"onHelp",value:function(c){}},{key:"onAbout",value:function(c){}}]),J}(),it=function(e){var c=["add","create"],C=["remove","delete"],d=["update","edit"],i=["ImportData","import"],w=["ExportData","export"];function R(){var t,y=[],V=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(o){if(o.issplit&&o.splitname!=null)if(V.has(o.splitname)){var z=V.get(o.splitname);z==null||z.push(o)}else V.set(o.splitname,[o]);else y.push(o)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:y.map(function(o){if(V.has(o.command)){var z,le=(0,n.jsx)(an.Z,{children:(z=V.get(o.command))===null||z===void 0?void 0:z.map(function(G,fe){return(0,n.jsx)(an.Z.Item,{children:(0,n.jsx)(Me,(0,_.Z)((0,_.Z)({},E(G)),{},{onClick:function(){return A(G.command,G)},toolbar:e}),fe)},fe)})});return(0,n.jsx)(Me,(0,_.Z)((0,_.Z)({},E(o)),{},{icon:(0,n.jsx)(Zn.Z,{}),ismenu:!0,menu:le,onClick:function(){return A(o.command,o)},toolbar:e}))}else return(0,n.jsx)(Me,(0,_.Z)((0,_.Z)({},E(o)),{},{onClick:function(){return A(o.command,o)},toolbar:e}))})})}function P(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function M(){if(e.helpShow!=null&&e.helpShow!=!1){var t,y,V,o,z,le,G,fe,re,ce,k=(0,f.useState)({isprint:(t=(y=e.helpShow)===null||y===void 0?void 0:y.isprint)!==null&&t!==void 0?t:!1,isset:(V=(o=e.helpShow)===null||o===void 0?void 0:o.isset)!==null&&V!==void 0?V:!1,ishelp:(z=(le=e.helpShow)===null||le===void 0?void 0:le.ishelp)!==null&&z!==void 0?z:!1,isabout:(G=(fe=e.helpShow)===null||fe===void 0?void 0:fe.isabout)!==null&&G!==void 0?G:!1,wvh:(re=(ce=e.helpShow)===null||ce===void 0?void 0:ce.wvh)!==null&&re!==void 0?re:new at}),m=(0,F.Z)(k,2),D=m[0],b=m[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:h(D)})}}function h(t){var y=[];if(t.isprint){var V;y.push((0,n.jsx)(Me,{title:(V=t.wvh)===null||V===void 0?void 0:V.printText,name:"print",shape:"circle",icon:(0,n.jsx)(jn.Z,{}),onClick:A}))}if(t.isset){var o;y.push((0,n.jsx)(Me,{title:(o=t.wvh)===null||o===void 0?void 0:o.setText,name:"set",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:A}))}if(t.ishelp){var z;y.push((0,n.jsx)(Me,{title:(z=t.wvh)===null||z===void 0?void 0:z.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:A}))}if(t.isabout){var le;y.push((0,n.jsx)(Me,{title:(le=t.wvh)===null||le===void 0?void 0:le.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:A}))}return y.length>0&&y.unshift((0,n.jsx)(tn.Z,{type:"vertical"})),y.map(function(G){return G})}function I(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(tt,(0,_.Z)({},e.searchShow))}var A=function(y,V){e.onClick!=null&&e.onClick(y,V)};function E(t){var y,V={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return V.disabled=(y=P(t))!==null&&y!==void 0?y:!1,V=N(V),e.iscircle&&(V.shape="circle",V.title=V.text,V.text=""),V}function N(t){return c.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Fn.Z,{component:Dn.Z})),C.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Tn.Z,{})),d.includes(t.name)&&(t.icon=(0,n.jsx)(Rn.Z,{})),i.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),w.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(In.Z,{})),t}var q=function(y){return y.length==3?(0,n.jsxs)(de.Z,{gutter:[8,8],children:[(0,n.jsx)(oe.Z,{span:10,children:(0,n.jsx)(de.Z,{justify:"start",children:y[0]})}),(0,n.jsx)(oe.Z,{span:8,children:(0,n.jsx)(de.Z,{justify:"end",children:y[1]})}),(0,n.jsx)(oe.Z,{span:6,children:(0,n.jsx)(de.Z,{justify:"end",children:y[2]})})]}):y.length==2?(0,n.jsxs)(de.Z,{gutter:[8,8],children:[(0,n.jsx)(oe.Z,{span:12,children:(0,n.jsx)(de.Z,{justify:"start",children:y[0]})}),(0,n.jsx)(oe.Z,{span:12,children:(0,n.jsx)(de.Z,{justify:"end",children:y[1]})})]}):y.length==1?(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(de.Z,{justify:"start",children:y[0]})})}):(0,n.jsx)(n.Fragment,{})};function u(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(oe.Z,{children:I()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(oe.Z,{children:R()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(oe.Z,{children:M()})),e.isclosecard?q(t):(0,n.jsx)(Re.Z,{children:q(t)})}return u()},sn=it,Kt=a(9715),$e=a(22712),lt=He.Z.TabPane,ut=function(e){var c,C=$e.Z.useForm(),d=(0,F.Z)(C,1),i=d[0],w=(0,f.useState)(e.title),R=(0,F.Z)(w,2),P=R[0],M=R[1],h=(0,f.useState)((c=e.isshow)!==null&&c!==void 0?c:!1),I=(0,F.Z)(h,2),A=I[0],E=I[1],N=(0,f.useState)(b(e.attr)),q=(0,F.Z)(N,2),u=q[0],t=q[1],y=(0,f.useState)(function(){return U(e.values)}),V=(0,F.Z)(y,2),o=V[0],z=V[1],le=(0,f.useState)(!1),G=(0,F.Z)(le,2),fe=G[0],re=G[1],ce=(0,f.useState)(!1),k=(0,F.Z)(ce,2),m=k[0],D=k[1];(0,f.useEffect)(function(){console.log(e.values),e.values!=null?z(U(e.values)):ue()},[e.values]),(0,f.useEffect)(function(){t(b(e.attr))},[e.attr]);function b(g){var Z,l;return{items:g==null||(Z=g.fields)===null||Z===void 0?void 0:Z.filter(function(S){return S.visible&&S.isedit}),models:g==null||(l=g.childmodels)===null||l===void 0?void 0:l.filter(function(S){return S.propertyname==null&&(S.propertyname=S.name),S.visible})}}function ae(){var g,Z=[];return(g=u.items)===null||g===void 0||g.forEach(function(l){var S=ve(e.attr,l);e.onInitTextBox!=null&&e.onInitTextBox(l,txtprops),Z.push((0,n.jsx)(oe.Z,{span:8,children:(0,n.jsx)($e.Z.Item,(0,_.Z)((0,_.Z)({},S),{},{children:(0,n.jsx)(Ye,{attr:l,onSearchBefore:function(Q,ie){e.onSearchData!=null&&e.onSearchData(Q,function(p){ie(p.model,p)})},onSearchData:function(Q,ie){e.onSearchData&&e.onSearchData(Q,ie)},children:o})}),l.field)}))}),e.onInitFormed!=null&&(i.setFieldDisabled=function(l,S){var K;(K=u.items)===null||K===void 0||K.forEach(function(Q){var ie;((ie=Q.field)===null||ie===void 0?void 0:ie.toLocaleLowerCase())==l.toLocaleLowerCase()&&(Q.disabled=S)}),t(u)},i.setTitle=function(l){M(l)},i.show=function(){E(!0)},i.hide=function(){E(!1)},i.setValues=function(l){z(U(l))},i.clear=function(){ue()},i.setHideSearch=function(l){D(l)},i.setHideToolbar=function(l){re(l)},e.onInitFormed(i)),Z}function U(g){var Z;return g==null&&(g={}),i.setFieldsValue(g),u.models!=null&&((Z=u.models)===null||Z===void 0?void 0:Z.length)>0&&(console.log(u),u.models.forEach(function(l){g[l.propertyname]?g[l.propertyname].total=g[l.propertyname].length:(g[l.propertyname]=[],g[l.propertyname].total=0),l.removeRows=[]})),g}function ue(){var g;i.resetFields();var Z={};(g=u.models)===null||g===void 0||g.forEach(function(l){Z[l.propertyname]||(Z[l.propertyname]=[],Z[l.propertyname].total=0)}),z(Z)}function ve(g,Z){var l={};l.name=Z.field,l.label=Z.title;var S=Ze(Z);return Z.disabled||(l.rules=S),e.onInitItem!=null&&e.onInitItem(Z,l),l}function Ze(g){var Z,l=[];if(g.required&&l.push({required:g.required}),(Z=g.length)!==null&&Z!==void 0?Z:0>0){var S;l.push({max:(S=g.length)!==null&&S!==void 0?S:500,type:(0,Ae.mc)(g.type)})}return e.onFieldRules!=null&&(l=e.onFieldRules(g,l)),l}var me=function(Z){var l,S=Object.assign({},o);for(var K in Z)S[K]=Z[K];return u.models!=null&&((l=u.models)===null||l===void 0?void 0:l.length)>0&&u.models.forEach(function(Q){var ie;S[Q.propertyname]!=null&&S[Q.propertyname].forEach(function(p){p.isnew?p.modelState=1:p.modelState=2}),(ie=Q.removeRows)===null||ie===void 0||ie.forEach(function(p){p.modelState=3,S[Q.propertyname].push(p)})}),console.log(S),S};function xe(){return(0,n.jsx)($e.Z,{labelAlign:"left",form:i,onFinish:function(Z){var l=me(Z);i.onFinish!=null&&i.onFinish(l),e.onFinish!=null&&e.onFinish(l)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(de.Z,{gutter:24,children:ae()})})}function he(){var g;if(u.models!=null&&((g=u.models)===null||g===void 0?void 0:g.length)>0){var Z;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(Z=u.models)===null||Z===void 0?void 0:Z.map(function(l,S){var K;return(0,n.jsx)(lt,{tab:l.title,children:(0,n.jsx)(Xe,{model:l,data:{rows:o[l.propertyname],total:(K=o[l.propertyname])===null||K===void 0?void 0:K.total},iscirclebutton:!0,closetoolbar:fe,closesearch:m,closecard:!0,onSearchData:function(ie){e.onSearchData!=null&&(ie.parent=o,ie.childmodel=l,e.onSearchData(ie,function(p){var je=Object.assign({},o);je[l.propertyname]=p.rows,je[l.propertyname].total=p.total,z(je)}))},onDataChange:function(ie,p,je){console.log(ie,p);var be=Object.assign({},o);be[l.propertyname]=ie.rows,be[l.propertyname].total=ie.total,console.log(be),je=="remove"&&p.forEach(function(we){we&&!we.isnew&&l.removeRows.push(we)}),z(be)}})},S)})})}return(0,n.jsx)(n.Fragment,{})}function Y(){return e.ismodal?(0,n.jsxs)(Qe,{title:P,width:1100,visible:A,onCancel:function(){return E(!1)},onOk:function(){i.submit()},children:[(0,n.jsx)(Re.Z,{children:xe()}),he()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Re.Z,{title:P,children:xe()}),he()]})}return Y()},fn=ut,cn=a(38535),ot=a(73218),Ht=a(34669),rt=a(82833),Gt=a(17462),qe=a(76772),_e=a(3182),vn=a(91220),dt=a(94043),Ve=a.n(dt),st=a(43347),Jt=a(35556),hn=a(97880),ft=hn.Z.Step,ct=function(e){var c,C,d=(0,f.useState)((c=e.currentStep)!==null&&c!==void 0?c:0),i=(0,F.Z)(d,2),w=i[0],R=i[1],P=(0,f.useState)((C=e.isShow)!==null&&C!==void 0?C:!1),M=(0,F.Z)(P,2),h=M[0],I=M[1];(0,f.useEffect)(function(){var u;I((u=e.isShow)!==null&&u!==void 0?u:!1)},[e.isShow]),(0,f.useEffect)(function(){var u;if(R((u=e.currentStep)!==null&&u!==void 0?u:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function A(u){return e.onCurrentStepComponent?e.onCurrentStepComponent(u):(0,n.jsx)(fn,{attr:e.attr,ismodal:!1})}function E(){var u;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(hn.Z,{current:w,onChange:function(y){R(y),e.onChange&&e.onChange(y)},children:(u=e.stepItem)===null||u===void 0?void 0:u.map(function(t){return(0,n.jsx)(ft,(0,_.Z)({},t))})}),(0,n.jsx)(tn.Z,{}),A(w)]})}function N(u){I(u),e.onShowChange&&e.onShowChange(u)}function q(){if(e.isModal){var u={onOk:function(){N(!1)},onCancel:function(){N(!1)}};return e.closeOk&&(u.footer=!1),(0,n.jsx)(Qe,(0,_.Z)((0,_.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:h},u),{},{children:E()}))}return e.isCard?(0,n.jsx)(Re.Z,{title:e.title,bordered:!1,children:E()}):E()}return q()},vt=ct,pe=a(54701),ht=a(58602),mn=a(32059);function gn(J,e,c){var C=J.map(function(M,h){return Object.assign({},{key:M.key,title:M.title,position:String.fromCharCode(65+h)+1})}).reduce(function(M,h){return Object.assign({},M,(0,mn.Z)({},h.position,{key:h.key,v:h.title}))},{}),d=e.map(function(M,h){return J.map(function(I,A){return Object.assign({},{content:M[I.key],position:String.fromCharCode(65+A)+(h+2)})})}).reduce(function(M,h){return M.concat(h)}).reduce(function(M,h){return Object.assign({},M,(0,mn.Z)({},h.position,{v:h.content}))},{}),i=Object.assign({},C,d),w=Object.keys(i),R="".concat(w[0],":").concat(w[w.length-1]),P={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},i,{"!ref":R,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};pe.NC(P,c)}function mt(J,e,c,C,d){return en.apply(this,arguments)}function en(){return en=(0,_e.Z)(Ve().mark(function J(e,c,C,d,i){var w,R;return Ve().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:c>0&&(w=[],e.fields.forEach(function(h){h.visible&&w.push({title:h.title,key:h.field,item:h})}),R=Object.assign({},C),R.page=1,R.size=c,R.size>0&&d(R).then(function(h){if(h!=null&&h.success&&h.data&&h.data.rows){var I=h.data.rows;for(var A in I)for(var E in w){var N=I[A][w[E].key],q=rn(N,w[E].item,I[A]);I[A][w[E].key]=q!=null?q:""}gn(w,I,i)}}));case 1:case"end":return M.stop()}},J)})),en.apply(this,arguments)}var gt=function(e){var c,C=(0,f.useState)(0),d=(0,F.Z)(C,2),i=d[0],w=d[1],R=(0,f.useState)((c=e.isShow)!==null&&c!==void 0?c:!1),P=(0,F.Z)(R,2),M=P[0],h=P[1],I=(0,f.useState)(0),A=(0,F.Z)(I,2),E=A[0],N=A[1],q=(0,f.useState)({model:void 0,data:{rows:[],total:0}}),u=(0,F.Z)(q,2),t=u[0],y=u[1],V=(0,f.useState)(K(e.attr)),o=(0,F.Z)(V,2),z=o[0],le=o[1],G=(0,f.useState)({message:"",description:"",type:"success",count:0}),fe=(0,F.Z)(G,2),re=fe[0],ce=fe[1],k=(0,f.useState)(null),m=(0,F.Z)(k,2),D=m[0],b=m[1],ae=(0,f.useState)({model:null,rows:[],total:0}),U=(0,F.Z)(ae,2),ue=U[0],ve=U[1],Ze=(0,f.useState)(!0),me=(0,F.Z)(Ze,2),xe=me[0],he=me[1],Y=(0,f.useState)(void 0),g=(0,F.Z)(Y,2),Z=g[0],l=g[1];function S(){w(0),N(0),y({model:void 0,data:{rows:[],total:0}}),ce({message:"",description:"",type:"success",count:0}),b(null),ve({model:null,rows:[],total:0}),he(!0),l(void 0)}function K(T){var v;return(v=T.fields)===null||v===void 0?void 0:v.filter(function(j){return j.visible&&!j.disabled})}(0,f.useEffect)(function(){h(e.isShow)},[e.isShow]),(0,f.useEffect)(function(){le(K(e.attr))},[e.attr]);var Q=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(j){setTimeout(function(){j(!0)},v)})};function ie(){var T={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},v={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},j={title:"\u5BFC\u5165\u6570\u636E"},L=[T,v,j];return L}function p(T){var v={fields:[]};if(T.length>0)for(var j in T[0]){var L;(L=v.fields)===null||L===void 0||L.push({field:j,title:j,type:"string",visible:!0,sorter:!1})}return v}function je(T){var v=T.rowcount,j=T.data;if(v>0){N(v);for(var L=p(j),H=[],O=0;O<6;O++)H.push(j[O]);y({model:L,data:{rows:H,total:5}})}}function be(){var T,v,j=new Map,L=new Map;(T=t.model)===null||T===void 0||(v=T.fields)===null||v===void 0||v.forEach(function(te,W){j.set(W,te.title)});var H=[];z.forEach(function(te,W){var se,ge;L.set(W,te.title);var $=te.foreign&&te.foreign.isfkey?"Name":"",Se=(se=t.model)===null||se===void 0||(ge=se.fields)===null||ge===void 0?void 0:ge.find(function(Ge){return Ge.field==te.field||Ge.field==te.title}),De=void 0;if(Se==null||Se==null){var Ie;W<((Ie=t.model)===null||Ie===void 0?void 0:Ie.fields.length)&&(De=W),H.push({id:W,source:De,target:W,defaultValue:"",foreignMap:$})}else{var Te=(0,vn.Z)(j.entries()),Le;try{for(Te.s();!(Le=Te.n()).done;){var Ne=Le.value;if(Se.title==Ne[1]||Se.field==Ne[1]){De=Ne[0];break}}}catch(Ge){Te.e(Ge)}finally{Te.f()}H.push({id:W,source:De,target:W,defaultValue:"",foreignMap:$})}});var O=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:j},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:L},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];ve({model:{fields:O,isadd:!1,isedit:!0,isremove:!1},rows:H,total:H.length})}function we(T){var v={};for(var j in ue.rows){var L,H,O=ue.rows[j],te=(L=t.model)===null||L===void 0?void 0:L.fields[O.source];if(!((te==null||te==null)&&O.defaultValue=="")){var W=z[O.target];if(!(W==null||W==null)){if(O.defaultValue!=null&&O.defaultValue!=""){var se;v[W.field]=O.defaultValue,(se=W.foreign)!==null&&se!==void 0&&se.isfkey&&(v[W.field]=O[W.field]);continue}var ge=te.field,$=T[ge];if(W.required&&($==null||$==null||$=="")){B(v,"\u5BFC\u5165\u6570\u636E".concat(te.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(W.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!($==null||$==null||$=="")){if(W!=null&&W.comvtp&&W.comvtp.isvtp){var Se=(0,vn.Z)(W.comvtp.items.entries()),De;try{for(Se.s();!(De=Se.n()).done;){var Ie=De.value;if($==Ie[1]){$=Ie[0];break}}}catch(Le){Se.e(Le)}finally{Se.f()}}if((H=W.foreign)!==null&&H!==void 0&&H.isfkey&&Z!=null&&Z.has(W.field)){var Te=Z.get(W.field);$=Te[$]}v[W.field]=$}}}}return v}function ke(T){var v=new Map;return ue.rows.forEach(function(j){var L,H=(L=t.model)===null||L===void 0?void 0:L.fields[j.source];if(H){var O,te=z[j.target],W=j.foreignMap==""?"Name":j.foreignMap;if((O=te.foreign)!==null&&O!==void 0&&O.isfkey&&j.defaultValue==""){v.has(te.field)||v.set(te.field,new Map);var se=v.get(te.field);for(var ge in T){var $=T[ge],Se=$[H.field];Se!=null&&Se!=""&&!se.has(Se)&&(se==null||se.set(Se,W))}}}}),v}function Pe(T){var v=ke(T);if(v.size==0){he(!1),ce({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var j="";v.forEach(function(L,H){var O=z.find(function($){return $.field==H}),te=z.find(function($){return $.type=="string"}).searchsymbol.find(function($){return $.label=="\u7B49\u4E8E"}).value,W=[],se="";L.forEach(function($,Se){se=$.toLowerCase(),W.push({name:$,symbol:te,value:Se,relation:"||"})});var ge={field:O,foreign:O.foreign,whereList:W};e.onSearchData&&(Q(200),e.onSearchData(ge,function($){if($&&$.rows.length>0)if($.rows.length==L.size){console.log(L);for(var Se in $.rows){var De=$.rows[Se][se];L.has(De)&&(L[De]=$.rows[Se].id)}l(v),he(!1),console.log(re.description),ce({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(O==null?void 0:O.title,"\u6570\u636E").concat($.total,`\u9879\u3002
`),type:"info",count:0})}else L.forEach(function(Ie,Te){var Le=$.rows.find(function(Ne){return Ne[se]==Te});j+="".concat(O==null?void 0:O.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(Te,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),Le==null&&B($.rows,j,0)});else j+="".concat(O==null?void 0:O.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(W[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),B($.rows,j,0)}))})}function Be(T){if(D==null||D.data==null){We.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var v=D.data;if(ue.rows.length<=0){We.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!xe){if(T==v.length){ce({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:T}),he(!0);return}var j=we(v[T]);j!=null&&s(j,function(L,H){ee(j,L,H,T)})}}function ee(T,v,j,L){v?(L++,ce({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(T),type:"success",count:L}),Q(200),Be(L)):B(T,j,L)}function s(T,v){return r.apply(this,arguments)}function r(){return r=(0,_e.Z)(Ve().mark(function T(v,j){return Ve().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:e.onAdd&&e.onAdd("add",v).then(function(){var O=(0,_e.Z)(Ve().mark(function te(W){return Ve().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(console.log(W),W.ok!=null&&W.ok==!1&&(he(!0),j(!1,W.statusText)),!(W!=null&&W.success)){ge.next=8;break}return ge.next=5,Q(200);case 5:j(!0),ge.next=10;break;case 8:he(!0),j(!1,W.message);case 10:case"end":return ge.stop()}},te)}));return function(te){return O.apply(this,arguments)}}());case 1:case"end":return H.stop()}},T)})),r.apply(this,arguments)}function B(T,v,j){var L={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(T),description:v,type:"error",count:j,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(Ee.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var O=e.form;O.clear(),O.setHideSearch(!0),O.setTitle(e.title),O.show(),O.setValues(T),O.onFinish=function(te){console.log(te),O.hide(),s(te,function(W,se){ee(te,W,se,j)})}}},children:"\u4FEE\u6539"})})};ce(L)}function x(){var T={name:"file",accept:".xlsx, .xls",onChange:function(j){console.log(j);var L=new FileReader;L.onload=function(H){try{var O=H.target.result,te=pe.ij(O,{type:"binary"}),W=[];for(var se in te.Sheets)if(te.Sheets.hasOwnProperty(se)){W=pe.P6.sheet_to_json(te.Sheets[se]);break}var ge={data:W,rowcount:W.length};b(ge),je(ge)}catch($){nn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log($)}},L.readAsBinaryString(j.file.originFileObj)}};return(0,n.jsxs)(Re.Z,{children:[(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(qe.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(E,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(Ee.Z,{size:"small",type:"primary",onClick:function(){var j=[],L={};z.forEach(function(H){j.push({title:H.title,key:H.field}),L[H.field]=H.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),gn(j,[L],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsxs)(ht.default,(0,_.Z)((0,_.Z)({},T),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(st.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(Ue,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,push:11,children:(0,n.jsx)(Ee.Z,{type:"primary",disabled:E<1,onClick:function(){w(i+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function X(){var T={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:ue.model,data:{rows:ue.rows,total:ue.total},onDataChange:function(j){ve((0,_.Z)((0,_.Z)({},ue),{},{rows:j.rows}))},onGetFieldToEdit:function(j,L){if(j.field=="defaultValue"){var H=L.target,O=z[H];return O}return j},onEditRowing:function(j,L,H){return H!=null&&(j.defaultValue=String(H)),!0},onSearchValueChange:function(j,L,H){H.text!=null&&(L.defaultValue=H.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(Xe,(0,_.Z)({},T))})}),(0,n.jsxs)(de.Z,{gutter:[16,16],children:[(0,n.jsx)(oe.Z,{span:12,push:10,children:(0,n.jsx)(Ee.Z,{type:"primary",onClick:function(){w(i+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(oe.Z,{span:12,push:1,children:(0,n.jsx)(Ee.Z,{onClick:function(){w(i-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function ne(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(qe.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(E,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(re.count,"\u884C"),type:"info"})})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(rt.Z,{percent:parseInt((re.count/E*100).toString()),status:"active"})})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(qe.Z,(0,_.Z)({},re))})}),(0,n.jsxs)(de.Z,{gutter:[8,8],children:[(0,n.jsx)(oe.Z,{span:12,push:10,children:(0,n.jsx)(Ee.Z,{type:"primary",disabled:xe,onClick:function(){Be(re.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(oe.Z,{span:12,push:1,children:(0,n.jsx)(Ee.Z,{onClick:function(){w(i-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function Ce(T){h(T),e.onShowChange&&e.onShowChange(T),T||S()}function Fe(){return(0,n.jsx)(vt,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:M,stepItem:ie(),currentStep:i,onChange:function(v){if(v==1&&be(),v==2&&D&&D.data){var j=D.data;Pe(j)}w(v)},onCurrentStepComponent:function(v){return v==0?x():v==1?X():v==2?ne():(0,n.jsx)(n.Fragment,{})},onShowChange:function(v){Ce(v)}})}return Fe()},St=gt,xt=function(e){var c=(0,f.useState)(!1),C=(0,F.Z)(c,2),d=C[0],i=C[1],w=(0,f.useState)(null),R=(0,F.Z)(w,2),P=R[0],M=R[1],h=(0,f.useState)(0),I=(0,F.Z)(h,2),A=I[0],E=I[1],N=(0,f.useState)([]),q=(0,F.Z)(N,2),u=q[0],t=q[1],y=(0,f.useState)(void 0),V=(0,F.Z)(y,2),o=V[0],z=V[1],le=(0,f.useState)({rows:[],total:0}),G=(0,F.Z)(le,2),fe=G[0],re=G[1],ce=(0,f.useState)(!1),k=(0,F.Z)(ce,2),m=k[0],D=k[1],b=(0,f.useState)(null),ae=(0,F.Z)(b,2),U=ae[0],ue=ae[1],ve=(0,f.useState)({page:1,size:10,whereList:[],sortList:[]}),Ze=(0,F.Z)(ve,2),me=Ze[0],xe=Ze[1],he=(0,f.useState)(1),Y=(0,F.Z)(he,2),g=Y[0],Z=Y[1];if((0,f.useEffect)(function(){z(void 0),M(null),E(0),t([]),re({rows:[],total:0}),l()},[e.controller]),o==null)return(0,n.jsx)(n.Fragment,{});function l(){if(console.log("waypage.init"),console.log(e),!e.init){var ee,s=(ee=e.namespace)!==null&&ee!==void 0?ee:e.controller;console.log(s+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(r){r!=null&&(r.success?(z(r.data),r.data.autoload&&S({},function(B){re(B)})):p(r.message))})}function S(ee,s){E(0),i(!0),e.search(ee).then(function(r){if(r!=null)if(i(!1),r!=null&&r.success){if(r.data.rows==null&&(r.data.rows=[]),ee.foreign==null&&ee.childmodel==null&&u.length>0){var B=r.data.rows.find(function(x){return x.id==u[0]});B!=null?(t(u),E(u.length),M(B)):(t([]),E(0),M(null))}s?s(r.data):re(r.data)}else p(r.message)},function(r){console.log(r),i(!1)})}var K=function(s){var r=null;s.isselectrow&&(r=P),s.selectmultiple&&(r=u),Q(s,r)},Q=function(s,r){i(!0),e.execute(s.command,r).then(function(B){console.log(B),B!=null&&B.success?(i(!1),nn.default.success(s.name+"\u5B8C\u6210"),(o==null?void 0:o.viewtype)!="form"&&(U&&U.hide(),S(me,function(x){re(x)}))):(i(!1),p(B.message))},function(B){console.log(B),i(!1)})};function ie(ee){return typeof ee=="object"&&ee!==null}function p(ee){var s=ee;ie(ee)&&(s=ee.message),We.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(ot.Z,{}),content:(0,n.jsx)("div",{children:s})})}function je(ee,s){U!=null&&U.clear(),U.setHideSearch(!0),U.setTitle((o==null?void 0:o.title)+"-"+ee.name),U.show(),s&&(U.setValues(s),U.setHideSearch(!1)),U.onFinish=function(r){console.log(r),Q(ee,r)}}function be(ee){var s,r=ee?{fields:o==null||(s=o.fields)===null||s===void 0?void 0:s.filter(function(B){var x;return(x=B.issearch)!==null&&x!==void 0?x:!0}),onSearch:function(x){i(!0);var X={page:1,whereList:[]};x!=null&&((0,ze.isArray)(x)?X.whereList=x:X.whereList=[x]),xe(X),Z(1),S(X,function(ne){re(ne)})},onSearchData:S}:!1;return(0,n.jsx)(sn,{attrs:o==null?void 0:o.commands,isselectrow:!0,selectcount:A,commandShow:!0,isshow:!ee,onClick:function(x,X){if(console.log(x),x=="ImportData"||x=="importdata"){D(!0);return}if(x=="ExportData"||x=="exportdata"){mt(o,fe.total,me,e.search,e.title+".xlsx");return}if(x=="add"){if((o==null?void 0:o.viewtype)=="form"){U.onFinish=function(ne){console.log(ne),Q(X,ne)},U.submit();return}je(X);return}if(x=="edit"){je(X,P);return}K(X)},searchShow:r})}function we(){return(0,n.jsx)(Ue,{attr:o,data:fe,isselect:!0,isexpandable:!0,loading:d,current:g,onSelectRows:function(s,r){console.log(s),console.log(r),t(r),E(r.length),M(s)},onSearchData:function(s,r){if(s.parent&&s.childmodel){S(s,function(B){r(B)});return}i(!0),Z(s.page),s.whereList=me.whereList,xe(s),S(s,function(B){re(B)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(s,r){var B,x=o==null||(B=o.commands)===null||B===void 0?void 0:B.find(function(X){return X.command=="edit"&&X.visible});x!=null&&je(x,r)}})}function ke(ee){return(0,n.jsx)(fn,{attr:o,title:e.title,ismodal:ee,onInitFormed:function(r){ue(r)},onSearchData:S})}function Pe(){return(o==null?void 0:o.viewtype)=="form"?Be():(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:be(!0)})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:we()})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:ke(!0)})}),(0,n.jsx)(St,{title:e.title,isShow:m,attr:o,onAdd:e.execute,form:U,onShowChange:function(s){D(s),s||S(me)},onSearchData:S})]})}function Be(){return(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:be(!1)})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:ke(!1)})})]})}return Pe()};function yt(J,e){var c=e.controller;e.namespace!=null&&(c=e.namespace);var C=function(R){return{type:c+"/init",payload:R}},d=function(R){return{type:c+"/search",payload:R}},i=function(R){return{type:c+"/execute",payload:R}};return{dispatch:J,init:function(){return J(C({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(R){var P=e.namespace+"/"+e.service+"/"+e.controller;return J(d({c:P,item:R,s:e.service}))},execute:function(R,P){var M=e.namespace+"/"+e.service+"/"+e.controller;return J(i({c:M,command:R,item:P,s:e.service}))}}}var Ct=(0,xn.$j)(function(){},yt)(xt)},20067:function(){}}]);
