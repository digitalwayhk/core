(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(Zt,Sn,a){"use strict";a.d(Sn,{Z:function(){return Ct}});var jt=a(13062),re=a(71230),Et=a(89032),ue=a(15746),bt=a(71194),We=a(48889),wt=a(34792),nn=a(48086),F=a(2824),s=a(67294),xn=a(28216),Ft=a(58024),Te=a(39144),Dt=a(48736),tn=a(27049),Tt=a(49111),Ke=a(19650),Rt=a(30887),an=a(54689),p=a(11849),yn=a(69610),Cn=a(54941),Zn=a(57254),jn=a(7945),En=a(24616),bn=a(63270),wn=a(3050),Fn=a(16165),Dn=a(49101),Tn=a(73171),Rn=a(8212),Mn=a(65233),Bn=a(20924),In=a(25592),Mt=a(59250),On=a(13013),Bt=a(22385),ln=a(94199),It=a(57663),be=a(71577),An=a(57119),n=a(85893),Vn=function(e){var f,x,u,o,E,M,K,O,v,B,A,w={key:(f=e.key)!==null&&f!==void 0?f:e.name,name:(x=e.name)!==null&&x!==void 0?x:"",title:(u=e.title)!==null&&u!==void 0?u:"",text:e.text,danger:(o=e.danger)!==null&&o!==void 0?o:!1,block:(E=e.block)!==null&&E!==void 0?E:!1,type:(M=e.type)!==null&&M!==void 0?M:"default",target:e.target,size:(K=e.size)!==null&&K!==void 0?K:"default",shape:(O=e.shape)!==null&&O!==void 0?O:"",icon:(v=e.icon)!==null&&v!==void 0?v:"",ghost:(B=e.ghost)!==null&&B!==void 0?B:!1,disabled:(A=e.disabled)!==null&&A!==void 0?A:!1},H=(0,s.useState)(!1),_=(0,F.Z)(H,2),r=_[0],t=_[1];function g(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(N){return N.command==e.name}):null}var V=function(){if(e.onClick!=null)try{t({delay:100});var ie=g();ie!=null&&ie.isalert?We.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(w.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(w)}}):e.onClick(w)}finally{t(!1)}};function l(){return e.ismenu?(0,n.jsx)(On.Z,{overlay:e.menu,children:(0,n.jsx)(ln.Z,{title:w.title,children:(0,n.jsx)(be.Z,(0,p.Z)((0,p.Z)({},w),{},{onClick:V,loading:r,children:w.text}))})}):(0,n.jsx)(ln.Z,{title:w.title,children:(0,n.jsx)(be.Z,(0,p.Z)((0,p.Z)({},w),{},{onClick:V,loading:r,children:w.text}))})}return l()},Re=Vn,Ot=a(47673),Je=a(4107),At=a(36877),kn=a(96607),Vt=a(77883),Ln=a(70507),kt=a(77576),Wn=a(12028),Lt=a(43358),Pn=a(34041),Wt=a(53400),un=a(41505),zn=a(76010),Pe=a(96486),Ie=a(86582),Pt=a(8963),Nn=a(68297),zt=a(18106),He=a(58634),Kn=a(30381),on=a.n(Kn),Oe=a(75308);function rn(Q,e,f){var x,u,o=(0,Oe.MM)(e,Q);if((x=e.comvtp)!==null&&x!==void 0&&x.isvtp){var E=new Map(e.comvtp.items);o=E.get(o)}if((u=e.foreign)!==null&&u!==void 0&&u.isfkey){var M=e.foreign.oneobjectfield,K=e.foreign.onedisplayname;f[M]!=null&&(o=f[M][K])}if(e.type=="boolean"&&(o=o?"\u662F":"\u5426"),e.type=="datetime"){var O;o=o!=""?on()(o).format((O=e.datatimetype)===null||O===void 0?void 0:O.dateformat).toString():""}return o}var Hn=function(e,f,x,u){var o,E=e.attr,M=[];function K(v,B,A){var w=rn(v,B,A);return e.onFieldRender!=null?e.onFieldRender(B,w,A):(0,n.jsx)(n.Fragment,{children:w})}var O=function(B,A){return e.onColumnToEdit?e.onColumnToEdit(B,A):(e.onGetFieldToEdit&&(B=e.onGetFieldToEdit(B,A)),u(A),(0,n.jsx)(Ye,{attr:B,value:x[B.field],onChange:function(H){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(A,B.field,H))){console.log(H);var _=Object.assign({},x);A[B.field]=H,_[B.field]=H,u(_)}},onSearchValueChange:function(H){e.onSearchValueChange&&e.onSearchValueChange(B,A,H)},onSearchBefore:function(H,_){e.onSearchData&&e.onSearchData(H,function(r){_(r.model,r)})},onSearchData:e.onSearchData}))};return E==null||(o=E.fields)===null||o===void 0||o.filter(function(v){return v.visible}).forEach(function(v){var B;M.push({dataIndex:v.field,title:v.title,sorter:(B=v.sorter)!==null&&B!==void 0?B:!0,render:function(w,H){if(H!=null)return f&&H.editable&&(v.isedit==null||v.isedit==!0)?O(v,H):K(w,v,H)}})}),M},Gn=He.Z.TabPane,Jn=function Q(e){var f,x,u,o,E,M=(0,s.useState)((f=e.loading)!==null&&f!==void 0?f:!1),K=(0,F.Z)(M,2),O=K[0],v=K[1],B=(0,s.useState)((x=e.data)!==null&&x!==void 0?x:{rows:[],total:0}),A=(0,F.Z)(B,2),w=A[0],H=A[1],_=(0,s.useState)((u=e.rowedit)!==null&&u!==void 0?u:!1),r=(0,F.Z)(_,2),t=r[0],g=r[1],V=(0,s.useState)((o=e.current)!==null&&o!==void 0?o:1),l=(0,F.Z)(V,2),N=l[0],ie=l[1],U=(0,s.useState)(10),se=(0,F.Z)(U,2),oe=se[0],fe=se[1],k=(0,s.useState)([]),h=(0,F.Z)(k,2),D=h[0],j=h[1],te=(0,s.useState)((E=e.selectType)!==null&&E!==void 0?E:"radio"),Y=(0,F.Z)(te,2),le=Y[0],ve=Y[1],Ce=(0,s.useState)(),me=(0,F.Z)(Ce,2),xe=me[0],he=me[1],$=(0,s.useState)({}),m=(0,F.Z)($,2),y=m[0],i=m[1];(0,s.useEffect)(function(){var C;H((C=e.data)!==null&&C!==void 0?C:{rows:[],total:0})},[e.data]),(0,s.useEffect)(function(){var C;g((C=e.rowedit)!==null&&C!==void 0?C:!1)},[e.rowedit]),(0,s.useEffect)(function(){var C;v((C=e.loading)!==null&&C!==void 0?C:!1)},[e.loading]),(0,s.useEffect)(function(){var C;ie((C=e.current)!==null&&C!==void 0?C:1)},[e.current]);var T=function(d,S,b){var P,X,ce=function(I){v(!1),H(I)},we=function(I){if(I.column==null)return"";var ee={name:I.field,isdesc:!1};return I.order=="descend"&&(ee.isdesc=!0),ee};v(!0),ie((P=d.current)!==null&&P!==void 0?P:1),fe((X=d.pageSize)!==null&&X!==void 0?X:10);try{var R,c,Z={page:(R=d.current)!==null&&R!==void 0?R:1,size:(c=d.pageSize)!==null&&c!==void 0?c:10,sortList:[]};if(b!=null)if((0,Pe.isArray)(b))b.forEach(function(J){var I=we(J);I!=""&&J.sortList.push(I)});else{var L=we(b);L!=""&&Z.sortList.push(L)}e.onSearchData!=null&&e.onSearchData(Z,ce)}finally{v(!1)}},G=function(d,S){var b=D.length<=d.length;if(j(d),e.onSelectRows!=null)if(d.length>0){var P=S[S.length-1];b||(P=null,d.length==1&&(P=w.rows.find(function(X){return X.id==d[0]}))),e.onSelectRows(P,d,b)}else e.onSelectRows(null,d,!1)},W=function(){if(!!e.isselect)return{selectedRowKeys:D,fixed:!0,type:le,columnTitle:xe,hideSelectAll:!1,columnWidth:"32px",onChange:G}};function ae(C){C=="checkbox"&&(ve("radio"),j([]),e.onSelectStateChange&&e.onSelectStateChange(!1),he(ne()))}function ne(){return(0,n.jsx)(be.Z,{type:"link",onClick:function(){he(null),ve("checkbox"),j([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function Ze(C){if(e.isedit){C.editable=!t;var d=(0,Ie.Z)(w.rows);d.forEach(function(S){S.id==C.id?S.editable=!t:S.editable&&(S.editable=!1)}),g(!t)}}function je(){var C;if(e.isexpandable&&(e==null||(C=e.attr)===null||C===void 0?void 0:C.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(S,b){var P;if(!!S&&(e==null||(P=e.attr)===null||P===void 0?void 0:P.childmodels)!=null&&e.attr.childmodels.length>0){var X,ce=e==null||(X=e.attr)===null||X===void 0?void 0:X.childmodels[0];if(b[ce.propertyname]||(b[ce.propertyname]=[]),b[ce.propertyname].total=b[ce.propertyname].length,b[ce.propertyname].total==0){var we={page:1,size:10};Ee(we,ce,b)}}},expandedRowRender:Ve}:e.onExpandable(e.attr)}function Ee(C,d,S){C.childmodel=d,C.parent=S,e.onSearchData!=null&&e.onSearchData(C,function(b){var P=(0,Ie.Z)(w.rows),X=P.findIndex(function(ce){return ce.id==S.id});P[X][d.propertyname]=b.rows,P[X][d.propertyname].total1=b.total,H({rows:P,total:w.total})})}var ze=function(d,S){if(e.onExpandedRowTabPane){var b=e.onExpandedRowTabPane(d,S);if(b!=null)return b}return(0,n.jsx)(Q,{isselect:!1,isedit:!1,isclosecard:!0,attr:d,data:{rows:S[d.propertyname],total:S[d.propertyname].total1},onSearchData:function(X){Ee(X,d,S)}},"id")},Ve=function(d){var S;if((e==null||(S=e.attr)===null||S===void 0?void 0:S.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(P){var X=e.attr.childmodels[Number(P)];Ee({},X,d)},children:e.attr.childmodels.map(function(b,P){return d[b.propertyname]||(d[b.propertyname]=[]),d[b.propertyname].total=d[b.propertyname].length,(0,n.jsx)(Gn,{tab:b.title,children:ze(b,d)},P)})})};function Me(){var C=Hn(e,t,y,i),d="id";return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:d,columns:C,rowSelection:W(),scroll:{x:C.length*150},dataSource:w.rows,pagination:{current:N,pageSize:oe,total:w.total,hideOnSinglePage:!0,showTotal:function(b){return"\u603B ".concat(b," \u884C")}},loading:O,expandable:je(),onChange:T,onRow:function(b){return{onClick:function(X){X.stopPropagation();try{var ce,we;if(((ce=W())===null||ce===void 0?void 0:ce.type)=="radio"&&G([b[d]],[b]),((we=W())===null||we===void 0?void 0:we.type)=="checkbox"){var R=b[d],c=[];D.includes(R)?c=D.filter(function(Z){return Z!=R}):(c=(0,Ie.Z)(D),c.push(R)),G(c,[b])}}finally{e.onRowClick&&e.onRowClick(X,b)}},onDoubleClick:function(X){X.stopPropagation(),Ze(b),e.onRowDoubleClick&&e.onRowDoubleClick(X,b)},onMouseEnter:function(X){e.onRowMouseEnter&&e.onRowMouseEnter(X,b)},onMouseLeave:function(X){e.onMouseLeave&&e.onMouseLeave(X,b)}}}})}function ke(){return e.isclosecard?Me():(0,n.jsx)(Te.Z,{children:Me()})}return ke()},Ue=Jn,Un=a(61193),Qn=a.n(Un),Xn=function(e){var f=(0,s.useState)({left:0,top:0,bottom:0,right:0}),x=(0,F.Z)(f,2),u=x[0],o=x[1],E=(0,s.useState)(!0),M=(0,F.Z)(E,2),K=M[0],O=M[1],v=s.createRef(),B=function(_,r){var t,g,V,l=(t=window)===null||t===void 0||(g=t.document)===null||g===void 0?void 0:g.documentElement,N=l.clientWidth,ie=l.clientHeight,U=v==null||(V=v.current)===null||V===void 0?void 0:V.getBoundingClientRect();o({left:-(U==null?void 0:U.left)+(r==null?void 0:r.x),right:N-((U==null?void 0:U.right)-(r==null?void 0:r.x)),top:-(U==null?void 0:U.top)+(r==null?void 0:r.y),bottom:ie-((U==null?void 0:U.bottom)-(r==null?void 0:r.y))})};function A(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){K&&O(!1)},onMouseOut:function(){O(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function w(){return(0,n.jsx)(We.Z,(0,p.Z)((0,p.Z)({},e),{},{title:A(),modalRender:function(_){return(0,n.jsx)(Qn(),{disabled:K,bounds:u,onStart:function(t,g){return B(t,g)},children:(0,n.jsx)("div",{ref:v,children:_})})}}))}return w()},Qe=Xn,Yn=function(e){var f,x,u=(0,s.useState)([]),o=(0,F.Z)(u,2),E=o[0],M=o[1],K=(0,s.useState)(null),O=(0,F.Z)(K,2),v=O[0],B=O[1],A=(0,s.useState)(!1),w=(0,F.Z)(A,2),H=w[0],_=w[1],r=(0,s.useState)(e.data),t=(0,F.Z)(r,2),g=t[0],V=t[1],l=(0,s.useState)(le()),N=(0,F.Z)(l,1),ie=N[0],U=(0,s.useState)((f=e.commandShow)!==null&&f!==void 0?f:!0),se=(0,F.Z)(U,1),oe=se[0],fe=(0,s.useState)((x=e.modelshow)!==null&&x!==void 0?x:!1),k=(0,F.Z)(fe,2),h=k[0],D=k[1];(0,s.useEffect)(function(){V(e.data)},[e.data]),(0,s.useEffect)(function(){var $;D(($=e.modelshow)!==null&&$!==void 0?$:!1)},[e.modelshow]);var j={page:1,size:10,whereList:[],sortList:[]},te=function(){var m,y,i=on()().valueOf(),T={id:i,isnew:!0,editable:!0};if((m=e.model)===null||m===void 0||(y=m.fields)===null||y===void 0||y.forEach(function(ne){ne.field!=null&&ne.field!="id"&&(T[ne.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(T))){var G=[],W=1;g!=null&&g.rows!=null&&(G=(0,Ie.Z)(g.rows),G.forEach(function(ne){ne.editable=!1}),W=g.total+W);var ae=[T].concat((0,Ie.Z)(G));_(!0),e.onAdded!=null&&e.onAdded(T),e.onDataChange!=null?e.onDataChange({rows:ae,total:W},T,"add"):V({rows:ae,total:W})}},Y=function(){if(E.length>0){var m=[],y=[],i=(0,Ie.Z)(g.rows);E.forEach(function(G){if(G!=null){var W=i.findIndex(function(ne){return ne.id==G?e.onRemoveRowing!=null&&!e.onRemoveRowing(ne)?!1:(ne.isnew||m.push(G),!0):!1}),ae=i.splice(W,1);e.onRemoveed!=null&&e.onRemoveed(ae[0]),y.push(ae[0])}});var T={rows:i,total:g.total-1};e.onDataChange!=null?y.length>0&&e.onDataChange(T,y,"remove"):V(T)}};function le(){var $=[];return e.model!=null&&(e.model.isadd&&$.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&$.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&($=e.onGetCommands($)),$}function ve($,m){D($),e.onModalChange&&e.onModalChange($,m)}function Ce(){var $;if(!e.closetoolbar)return(0,n.jsx)(sn,{iscircle:e.iscirclebutton,commandShow:oe,selectcount:E.length,attrs:ie,isclosecard:!1,onClick:function(y,i){e.onCommandClicking&&e.onCommandClicking(i),y=="add"&&te(),y=="remove"&&Y(),e.onCommandClicked&&e.onCommandClicked(i)},searchShow:e.closesearch?!1:{fields:($=e.model)===null||$===void 0?void 0:$.fields,onSearch:function(y){j.whereList=[],y!=null&&((0,Pe.isArray)(y)?j.whereList=y:j.whereList=[y]),j.page=1,j.sortList=[],e.onSearchData!=null&&e.onSearchData(j,function(i){V(i)})},onSearchData:e.onSearchData}})}function me(){var $,m,y;return(0,n.jsx)(Ue,{attr:e.model,data:g,isedit:!e.closeedit,rowedit:H,selectType:($=e.selectType)!==null&&$!==void 0?$:"checkbox",isselect:(m=e.isselect)!==null&&m!==void 0?m:!0,isclosecard:(y=e.closecard)!==null&&y!==void 0?y:!0,onSelectRows:function(T,G){M(G),B(T)},onSearchData:function(T,G){if(T.foreign&&T.field){e.onSearchData&&e.onSearchData(T,G);return}j.page=T.page,j.size=T.size,j.sortList=T.sortList,e.onSearchData!=null&&e.onSearchData(j,function(W){V(W)})},onRowDataChangeing:function(T,G,W){return e.onEditRowing!=null?e.onEditRowing(T,G,W):(!T.isnew&&e.onDataChange!=null&&e.onDataChange(g,T,"edit"),!0)},onRowDoubleClick:function(T,G){G.editable!=null&&_(G.editable),e.ismodal&&h&&ve(!1,G)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(T,G,W){G.isnew&&(G[W.rowfield]=W.row),e.onSearchValueChange&&e.onSearchValueChange(T,G,W)}})}function xe(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[Ce(),me()]}):(0,n.jsxs)(Te.Z,{children:[Ce(),me()]})}function he(){if(e.ismodal){var $;return(0,n.jsx)(Qe,{title:($=e.model)===null||$===void 0?void 0:$.title,width:600,visible:h,onCancel:function(){ve(!1,null)},onOk:function(){ve(!1,v)},children:(0,n.jsx)(n.Fragment,{children:xe()})})}else return xe()}return he()},Xe=Yn,$n=un.Z.RangePicker,qn=Je.Z.Search,ye;(function(Q){Q.Input="Input",Q.TextArea="Input.TextArea",Q.InputNumber="InputNumber",Q.Switch="Switch",Q.DatePicker="DatePicker",Q.RangePicker="RangePicker",Q.Search="Input.Search",Q.Avatar="Avatar",Q.Select="Select"})(ye||(ye={}));var dn=function(e){var f,x={maxLength:500,size:"middle",placeholder:"",disabled:(f=e.disabled)!==null&&f!==void 0?f:!1,style:{width:"100%"},texttype:ye.Input};for(var u in x)e.options!=null&&e.options[u]!=null&&(x[u]=e.options[u]);return e.width!=null&&(x.style.width=e.width),x.texttype=_n(e,x),x},_n=function(e,f){var x=e.textType,u=e.attr;if(u!=null){if((u.type=="int"||u.type=="int32"||u.type=="int64"||u.type=="decimal")&&(x=ye.InputNumber,f.min=u.min,u.precision!=null&&u.precision>0&&(f.precision=u.precision),f.picker=void 0),u.type=="datetime"&&(x=ye.DatePicker),u.type=="boolean"&&(x=ye.Switch,e.search)){x=ye.Select;var o=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];f.options=o}if(u.comvtp!=null&&u.comvtp.isvtp){x=ye.Select;var E=[];(0,Pe.isMap)(u.comvtp.items)||(u.comvtp.items=new Map(u.comvtp.items)),u.comvtp.items.forEach(function(M,K){E.push({label:M,value:K})}),f.options=E}u.foreign!=null&&u.foreign.isfkey&&(x=ye.Search),u.length!=null&&u.length>0&&(f.maxLength=u.length),e.disabled==null&&u.disabled!=null&&(f.disabled=u.disabled),e.search&&(f.disabled=!1)}return x==null&&(x=ye.Input),x},pn=function(e){var f=(0,s.useState)(function(){return dn(e)}),x=(0,F.Z)(f,2),u=x[0],o=x[1],E=(0,s.useState)({isshow:!1,model:void 0,data:void 0}),M=(0,F.Z)(E,2),K=M[0],O=M[1],v=(0,s.useState)({row:void 0,value:"",text:"",rowfield:""}),B=(0,F.Z)(v,2),A=B[0],w=B[1],H=(0,zn.Z)(e.defaultValue,{value:g(e.value),onChange:function(h,D){if(console.log(h),e.onChange!=null){var j=V(h);console.log(j),e.onChange(j)}}}),_=(0,F.Z)(H,2),r=_[0],t=_[1];(0,s.useEffect)(function(){if(e.search){var k;A.field!=((k=e.attr)===null||k===void 0?void 0:k.field)&&l(null),o(dn(e))}},[e.attr]),(0,s.useEffect)(function(){var k;if(((k=e.attr)===null||k===void 0?void 0:k.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&A.row==null&&e.value!=null){var h=e.children[e.attr.foreign.oneobjectfield];l(h)}},[e.value]);function g(k){var h=e.attr;return(0,Oe.MM)(h,k)}function V(k){var h=e.attr;switch(u.texttype){case ye.Select:return(h==null?void 0:h.type)=="string"?k.label:(0,Oe.Nz)(h,k)}return(0,Oe.Nz)(h,k)}function l(k){var h={value:"",text:"",row:void 0,rowfield:"",field:""};if(k){var D,j,te,Y,le,ve,Ce,me,xe,he,$=(D=(j=e.attr)===null||j===void 0||(te=j.foreign)===null||te===void 0?void 0:te.oneobjectfieldkey)!==null&&D!==void 0?D:"",m=(Y=(le=e.attr)===null||le===void 0||(ve=le.foreign)===null||ve===void 0?void 0:ve.onedisplayname)!==null&&Y!==void 0?Y:"";console.log($+"---"+m),h.row=k,h.value=k[$],h.text=k[m],h.rowfield=(Ce=(me=e.attr)===null||me===void 0||(xe=me.foreign)===null||xe===void 0?void 0:xe.oneobjectfield)!==null&&Ce!==void 0?Ce:"",h.field=(he=e.attr)===null||he===void 0?void 0:he.field,console.log(h)}w(h),t(h.value),e.onSearchValueChange&&e.onSearchValueChange(h)}function N(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(qn,(0,p.Z)((0,p.Z)({},u),{},{size:"middle",value:A.text,onSearch:function(h){if(e.onSearchBefore!=null){var D,j={foreign:(D=e.attr)===null||D===void 0?void 0:D.foreign,value:h,field:e.attr};e.onSearchBefore(j,function(te,Y){var le;(te.title==null||te.title=="")&&(te.title=(le=e.attr)===null||le===void 0?void 0:le.title),O({isshow:!0,model:te,data:Y})})}}})),(0,n.jsx)(Xe,{ismodal:!0,modelshow:K.isshow,model:K.model,data:K.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(h,D){var j=(0,p.Z)({},K);j.isshow=h,console.log(j),O(j),l(D)},onSearchData:function(h,D){var j;h.field=e.attr,h.foreign=(j=e.attr)===null||j===void 0?void 0:j.foreign,e.onSearchData!=null&&e.onSearchData(h,D)}})]})}function ie(){var k=e.attr;return(k==null?void 0:k.type)=="string"&&(u.labelInValue=!0),(0,n.jsx)(Pn.Z,(0,p.Z)((0,p.Z)({},u),{},{size:"middle",value:r,onChange:t}))}function U(){return(0,n.jsx)(Wn.Z,{size:"default",checked:r,onChange:t})}function se(){var k=e.attr,h=void 0,D=void 0;if(console.log(k),k.datatimetype&&(k.datatimetype.istime&&(h={format:k.datatimetype.timeformat}),D=k.datatimetype.dateformat),console.log(h),e.search){var j;return(0,n.jsx)($n,{size:"middle",showTime:h,format:D,style:u.style,value:r,allowEmpty:[!0,!0],picker:(j=e.options)===null||j===void 0?void 0:j.picker,onChange:t})}else return(0,n.jsx)(un.Z,(0,p.Z)((0,p.Z)({},u),{},{format:D,showTime:h,size:"middle",picker:"date",value:r,onChange:t}))}function oe(){return(0,n.jsx)(Ln.Z,(0,p.Z)((0,p.Z)({},u),{},{value:r,onChange:t}))}function fe(){switch(u.texttype){case ye.InputNumber:return oe();case ye.DatePicker:return se();case ye.Switch:return U();case ye.Select:return ie();case ye.Search:return N()}return(0,n.jsx)(Je.Z,(0,p.Z)((0,p.Z)({},u),{},{size:"middle",value:r,onChange:function(h){t(h.target.value)}}))}return fe()},Ye=pn,et=a(76570),Nt=null,nt=function(e){var f=new Map;f.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),f.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),f.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var x=(0,s.useState)({value:"",attr:{type:"string"}}),u=(0,F.Z)(x,2),o=u[0],E=u[1],M=(0,s.useState)(""),K=(0,F.Z)(M,2),O=K[0],v=K[1],B=(0,s.useState)({type:"string"}),A=(0,F.Z)(B,2),w=A[0],H=A[1],_=(0,s.useState)({name:"*",type:"string",symbol:""}),r=(0,F.Z)(_,2),t=r[0],g=r[1],V=(0,s.useState)({picker:null}),l=(0,F.Z)(V,2),N=l[0],ie=l[1],U=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(h){if(h.issearch){var D,j=(D=h.searchsymbol)!==null&&D!==void 0?D:f.get(h.type);h.type=="datetime"&&(j=f.get(h.type)),h.type=="decimal"&&(j=f.get("int")),h.foreign&&h.foreign.isfkey&&(j=void 0),U.push({label:h.title,value:h.field,children:j})}});function se(){return(0,n.jsx)(kn.Z,{style:{width:"140px"},options:U,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(D){var j;console.log(D);var te=D[0],Y=(j=e.fields)===null||j===void 0?void 0:j.find(function(ve){return ve.field==te});if(g({name:te,symbol:D[1],type:Y==null?void 0:Y.type}),t.name!=te&&(E(Object.assign(o,{value:"",attr:Y})),v(""),H(Y),(Y==null?void 0:Y.type)=="datetime")){var le=(0,p.Z)({},N);le.picker=D[1],ie(le)}}})}function oe(){return(0,n.jsx)(Ye,{width:"240px",options:N,search:!0,name:t.name,attr:w,value:O,onChange:function(D){console.log(D),v(D),E({value:D,attr:o.attr})},onSearchBefore:function(D,j){e.onSearchData&&e.onSearchData(D,function(te){j(te.model,te)})},onSearchData:e.onSearchData})}function fe(){return(0,n.jsx)(be.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(et.Z,{}),onClick:function(){console.log(o);var D=(0,Oe.Nz)(w,o.value);console.log(D);var j={name:t.name,symbol:t.symbol,value:D};if(j.name=="*"&&j.value=="")e.onSearch();else{if(w.type=="datetime"&&o.value!=""&&(0,Pe.isArray)(D)){var te=[];return o.value[0]!=null&&(j.symbol=">=",j.value=o.value[0],te.push(j)),o.value[1]!=null&&te.push({name:t.name,symbol:"<=",value:o.value[1]}),e.onSearch(te)}e.onSearch(j)}}})}function k(){return(0,n.jsxs)(Je.Z.Group,{compact:!0,children:[se(),oe(),fe()]})}return k()},tt=nt,at=function(){function Q(){(0,yn.Z)(this,Q),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Cn.Z)(Q,[{key:"onPrint",value:function(f){}},{key:"onSet",value:function(f){}},{key:"onHelp",value:function(f){}},{key:"onAbout",value:function(f){}}]),Q}(),it=function(e){var f=["add","create"],x=["remove","delete"],u=["update","edit"],o=["ImportData","import"],E=["ExportData","export"];function M(){var t,g=[],V=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(l){if(l.issplit&&l.splitname!=null)if(V.has(l.splitname)){var N=V.get(l.splitname);N==null||N.push(l)}else V.set(l.splitname,[l]);else g.push(l)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:g.map(function(l){if(V.has(l.command)){var N,ie=(0,n.jsx)(an.Z,{children:(N=V.get(l.command))===null||N===void 0?void 0:N.map(function(U,se){return(0,n.jsx)(an.Z.Item,{children:(0,n.jsx)(Re,(0,p.Z)((0,p.Z)({},w(U)),{},{onClick:function(){return A(U.command,U)},toolbar:e}),se)},se)})});return(0,n.jsx)(Re,(0,p.Z)((0,p.Z)({},w(l)),{},{icon:(0,n.jsx)(Zn.Z,{}),ismenu:!0,menu:ie,onClick:function(){return A(l.command,l)},toolbar:e}))}else return(0,n.jsx)(Re,(0,p.Z)((0,p.Z)({},w(l)),{},{onClick:function(){return A(l.command,l)},toolbar:e}))})})}function K(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function O(){if(e.helpShow!=null&&e.helpShow!=!1){var t,g,V,l,N,ie,U,se,oe,fe,k=(0,s.useState)({isprint:(t=(g=e.helpShow)===null||g===void 0?void 0:g.isprint)!==null&&t!==void 0?t:!1,isset:(V=(l=e.helpShow)===null||l===void 0?void 0:l.isset)!==null&&V!==void 0?V:!1,ishelp:(N=(ie=e.helpShow)===null||ie===void 0?void 0:ie.ishelp)!==null&&N!==void 0?N:!1,isabout:(U=(se=e.helpShow)===null||se===void 0?void 0:se.isabout)!==null&&U!==void 0?U:!1,wvh:(oe=(fe=e.helpShow)===null||fe===void 0?void 0:fe.wvh)!==null&&oe!==void 0?oe:new at}),h=(0,F.Z)(k,2),D=h[0],j=h[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:v(D)})}}function v(t){var g=[];if(t.isprint){var V;g.push((0,n.jsx)(Re,{title:(V=t.wvh)===null||V===void 0?void 0:V.printText,name:"print",shape:"circle",icon:(0,n.jsx)(jn.Z,{}),onClick:A}))}if(t.isset){var l;g.push((0,n.jsx)(Re,{title:(l=t.wvh)===null||l===void 0?void 0:l.setText,name:"set",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:A}))}if(t.ishelp){var N;g.push((0,n.jsx)(Re,{title:(N=t.wvh)===null||N===void 0?void 0:N.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:A}))}if(t.isabout){var ie;g.push((0,n.jsx)(Re,{title:(ie=t.wvh)===null||ie===void 0?void 0:ie.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:A}))}return g.length>0&&g.unshift((0,n.jsx)(tn.Z,{type:"vertical"})),g.map(function(U){return U})}function B(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(tt,(0,p.Z)({},e.searchShow))}var A=function(g,V){e.onClick!=null&&e.onClick(g,V)};function w(t){var g,V={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return V.disabled=(g=K(t))!==null&&g!==void 0?g:!1,V=H(V),e.iscircle&&(V.shape="circle",V.title=V.text,V.text=""),V}function H(t){return f.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Fn.Z,{component:Dn.Z})),x.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Tn.Z,{})),u.includes(t.name)&&(t.icon=(0,n.jsx)(Rn.Z,{})),o.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),E.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(In.Z,{})),t}var _=function(g){return g.length==3?(0,n.jsxs)(re.Z,{gutter:[8,8],children:[(0,n.jsx)(ue.Z,{span:10,children:(0,n.jsx)(re.Z,{justify:"start",children:g[0]})}),(0,n.jsx)(ue.Z,{span:8,children:(0,n.jsx)(re.Z,{justify:"end",children:g[1]})}),(0,n.jsx)(ue.Z,{span:6,children:(0,n.jsx)(re.Z,{justify:"end",children:g[2]})})]}):g.length==2?(0,n.jsxs)(re.Z,{gutter:[8,8],children:[(0,n.jsx)(ue.Z,{span:12,children:(0,n.jsx)(re.Z,{justify:"start",children:g[0]})}),(0,n.jsx)(ue.Z,{span:12,children:(0,n.jsx)(re.Z,{justify:"end",children:g[1]})})]}):g.length==1?(0,n.jsx)(re.Z,{gutter:[8,8],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsx)(re.Z,{justify:"start",children:g[0]})})}):(0,n.jsx)(n.Fragment,{})};function r(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(ue.Z,{children:B()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(ue.Z,{children:M()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(ue.Z,{children:O()})),e.isclosecard?_(t):(0,n.jsx)(Te.Z,{children:_(t)})}return r()},sn=it,Kt=a(9715),$e=a(22712),lt=He.Z.TabPane,ut=function(e){var f,x=$e.Z.useForm(),u=(0,F.Z)(x,1),o=u[0],E=(0,s.useState)(e.title),M=(0,F.Z)(E,2),K=M[0],O=M[1],v=(0,s.useState)((f=e.isshow)!==null&&f!==void 0?f:!1),B=(0,F.Z)(v,2),A=B[0],w=B[1],H=(0,s.useState)(j(e.attr)),_=(0,F.Z)(H,2),r=_[0],t=_[1],g=(0,s.useState)(function(){return Y(e.values)}),V=(0,F.Z)(g,2),l=V[0],N=V[1],ie=(0,s.useState)(!1),U=(0,F.Z)(ie,2),se=U[0],oe=U[1],fe=(0,s.useState)(!1),k=(0,F.Z)(fe,2),h=k[0],D=k[1];(0,s.useEffect)(function(){console.log(e.values),e.values!=null?N(Y(e.values)):le()},[e.values]),(0,s.useEffect)(function(){t(j(e.attr))},[e.attr]);function j(m){var y,i;return{items:m==null||(y=m.fields)===null||y===void 0?void 0:y.filter(function(T){return T.visible&&T.isedit}),models:m==null||(i=m.childmodels)===null||i===void 0?void 0:i.filter(function(T){return T.propertyname==null&&(T.propertyname=T.name),T.visible})}}function te(){var m,y=[];return(m=r.items)===null||m===void 0||m.forEach(function(i){var T=ve(e.attr,i);e.onInitTextBox!=null&&e.onInitTextBox(i,txtprops),y.push((0,n.jsx)(ue.Z,{span:8,children:(0,n.jsx)($e.Z.Item,(0,p.Z)((0,p.Z)({},T),{},{children:(0,n.jsx)(Ye,{attr:i,onSearchBefore:function(W,ae){e.onSearchData!=null&&e.onSearchData(W,function(ne){ae(ne.model,ne)})},onSearchData:function(W,ae){e.onSearchData&&e.onSearchData(W,ae)},children:l})}),i.field)}))}),e.onInitFormed!=null&&(o.setFieldDisabled=function(i,T){var G;(G=r.items)===null||G===void 0||G.forEach(function(W){var ae;((ae=W.field)===null||ae===void 0?void 0:ae.toLocaleLowerCase())==i.toLocaleLowerCase()&&(W.disabled=T)}),t(r)},o.setTitle=function(i){O(i)},o.show=function(){w(!0)},o.hide=function(){w(!1)},o.setValues=function(i){N(Y(i))},o.clear=function(){le()},o.setHideSearch=function(i){D(i)},o.setHideToolbar=function(i){oe(i)},e.onInitFormed(o)),y}function Y(m){var y;return m==null&&(m={}),o.setFieldsValue(m),r.models!=null&&((y=r.models)===null||y===void 0?void 0:y.length)>0&&(console.log(r),r.models.forEach(function(i){m[i.propertyname]?m[i.propertyname].total=m[i.propertyname].length:(m[i.propertyname]=[],m[i.propertyname].total=0),i.removeRows=[]})),m}function le(){var m;o.resetFields();var y={};(m=r.models)===null||m===void 0||m.forEach(function(i){y[i.propertyname]||(y[i.propertyname]=[],y[i.propertyname].total=0)}),N(y)}function ve(m,y){var i={};i.name=y.field,i.label=y.title;var T=Ce(y);return y.disabled||(i.rules=T),e.onInitItem!=null&&e.onInitItem(y,i),i}function Ce(m){var y,i=[];if(m.required&&i.push({required:m.required}),(y=m.length)!==null&&y!==void 0?y:0>0){var T;i.push({max:(T=m.length)!==null&&T!==void 0?T:500,type:(0,Oe.mc)(m.type)})}return e.onFieldRules!=null&&(i=e.onFieldRules(m,i)),i}var me=function(y){var i,T=Object.assign({},l);for(var G in y)T[G]=y[G];return r.models!=null&&((i=r.models)===null||i===void 0?void 0:i.length)>0&&r.models.forEach(function(W){var ae;(ae=W.removeRows)===null||ae===void 0||ae.forEach(function(ne){ne.modelState=3,T[W.propertyname].push(ne)}),T[W.propertyname]!=null&&T[W.propertyname].forEach(function(ne){ne.isnew&&(ne.id=null)})}),T};function xe(){return(0,n.jsx)($e.Z,{labelAlign:"left",form:o,onFinish:function(y){var i=me(y);console.log(i),o.onFinish!=null&&o.onFinish(i),e.onFinish!=null&&e.onFinish(i)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(re.Z,{gutter:24,children:te()})})}function he(){var m;if(r.models!=null&&((m=r.models)===null||m===void 0?void 0:m.length)>0){var y;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(y=r.models)===null||y===void 0?void 0:y.map(function(i,T){var G;return(0,n.jsx)(lt,{tab:i.title,children:(0,n.jsx)(Xe,{model:i,data:{rows:l[i.propertyname],total:(G=l[i.propertyname])===null||G===void 0?void 0:G.total},iscirclebutton:!0,closetoolbar:se,closesearch:h,closecard:!0,onSearchData:function(ae){e.onSearchData!=null&&(ae.parent=l,ae.childmodel=i,e.onSearchData(ae,function(ne){var Ze=Object.assign({},l);Ze[i.propertyname]=ne.rows,Ze[i.propertyname].total=ne.total,N(Ze)}))},onDataChange:function(ae,ne,Ze){console.log(ae,ne);var je=Object.assign({},l);je[i.propertyname]=ae.rows,je[i.propertyname].total=ae.total,console.log(je),Ze=="remove"&&ne.forEach(function(Ee){Ee&&!Ee.isnew&&i.removeRows.push(Ee)}),N(je)}})},T)})})}return(0,n.jsx)(n.Fragment,{})}function $(){return e.ismodal?(0,n.jsxs)(Qe,{title:K,width:1100,visible:A,onCancel:function(){return w(!1)},onOk:function(){o.submit()},children:[(0,n.jsx)(Te.Z,{children:xe()}),he()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Te.Z,{title:K,children:xe()}),he()]})}return $()},fn=ut,cn=a(38535),ot=a(73218),Ht=a(34669),rt=a(82833),Gt=a(17462),qe=a(76772),_e=a(3182),vn=a(91220),dt=a(94043),Ae=a.n(dt),st=a(43347),Jt=a(35556),hn=a(97880),ft=hn.Z.Step,ct=function(e){var f,x,u=(0,s.useState)((f=e.currentStep)!==null&&f!==void 0?f:0),o=(0,F.Z)(u,2),E=o[0],M=o[1],K=(0,s.useState)((x=e.isShow)!==null&&x!==void 0?x:!1),O=(0,F.Z)(K,2),v=O[0],B=O[1];(0,s.useEffect)(function(){var r;B((r=e.isShow)!==null&&r!==void 0?r:!1)},[e.isShow]),(0,s.useEffect)(function(){var r;if(M((r=e.currentStep)!==null&&r!==void 0?r:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function A(r){return e.onCurrentStepComponent?e.onCurrentStepComponent(r):(0,n.jsx)(fn,{attr:e.attr,ismodal:!1})}function w(){var r;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(hn.Z,{current:E,onChange:function(g){M(g),e.onChange&&e.onChange(g)},children:(r=e.stepItem)===null||r===void 0?void 0:r.map(function(t){return(0,n.jsx)(ft,(0,p.Z)({},t))})}),(0,n.jsx)(tn.Z,{}),A(E)]})}function H(r){B(r),e.onShowChange&&e.onShowChange(r)}function _(){if(e.isModal){var r={onOk:function(){H(!1)},onCancel:function(){H(!1)}};return e.closeOk&&(r.footer=!1),(0,n.jsx)(Qe,(0,p.Z)((0,p.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:v},r),{},{children:w()}))}return e.isCard?(0,n.jsx)(Te.Z,{title:e.title,bordered:!1,children:w()}):w()}return _()},vt=ct,pe=a(54701),ht=a(58602),mn=a(32059);function gn(Q,e,f){var x=Q.map(function(O,v){return Object.assign({},{key:O.key,title:O.title,position:String.fromCharCode(65+v)+1})}).reduce(function(O,v){return Object.assign({},O,(0,mn.Z)({},v.position,{key:v.key,v:v.title}))},{}),u=e.map(function(O,v){return Q.map(function(B,A){return Object.assign({},{content:O[B.key],position:String.fromCharCode(65+A)+(v+2)})})}).reduce(function(O,v){return O.concat(v)}).reduce(function(O,v){return Object.assign({},O,(0,mn.Z)({},v.position,{v:v.content}))},{}),o=Object.assign({},x,u),E=Object.keys(o),M="".concat(E[0],":").concat(E[E.length-1]),K={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},o,{"!ref":M,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};pe.NC(K,f)}function mt(Q,e,f,x,u){return en.apply(this,arguments)}function en(){return en=(0,_e.Z)(Ae().mark(function Q(e,f,x,u,o){var E,M;return Ae().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:f>0&&(E=[],e.fields.forEach(function(v){v.visible&&E.push({title:v.title,key:v.field,item:v})}),M=Object.assign({},x),M.page=1,M.size=1e3,u(M).then(function(v){if(v!=null&&v.success&&v.data&&v.data.rows){var B=v.data.rows;for(var A in B)for(var w in E){var H=B[A][E[w].key],_=rn(H,E[w].item,B[A]);B[A][E[w].key]=_!=null?_:""}gn(E,B,o)}}));case 1:case"end":return O.stop()}},Q)})),en.apply(this,arguments)}var gt=function(e){var f,x=(0,s.useState)(0),u=(0,F.Z)(x,2),o=u[0],E=u[1],M=(0,s.useState)((f=e.isShow)!==null&&f!==void 0?f:!1),K=(0,F.Z)(M,2),O=K[0],v=K[1],B=(0,s.useState)(0),A=(0,F.Z)(B,2),w=A[0],H=A[1],_=(0,s.useState)({model:void 0,data:{rows:[],total:0}}),r=(0,F.Z)(_,2),t=r[0],g=r[1],V=(0,s.useState)(G(e.attr)),l=(0,F.Z)(V,2),N=l[0],ie=l[1],U=(0,s.useState)({message:"",description:"",type:"success",count:0}),se=(0,F.Z)(U,2),oe=se[0],fe=se[1],k=(0,s.useState)(null),h=(0,F.Z)(k,2),D=h[0],j=h[1],te=(0,s.useState)({model:null,rows:[],total:0}),Y=(0,F.Z)(te,2),le=Y[0],ve=Y[1],Ce=(0,s.useState)(!0),me=(0,F.Z)(Ce,2),xe=me[0],he=me[1],$=(0,s.useState)(void 0),m=(0,F.Z)($,2),y=m[0],i=m[1];function T(){E(0),H(0),g({model:void 0,data:{rows:[],total:0}}),fe({message:"",description:"",type:"success",count:0}),j(null),ve({model:null,rows:[],total:0}),he(!0),i(void 0)}function G(R){var c;return(c=R.fields)===null||c===void 0?void 0:c.filter(function(Z){return Z.visible&&!Z.disabled})}(0,s.useEffect)(function(){v(e.isShow)},[e.isShow]),(0,s.useEffect)(function(){ie(G(e.attr))},[e.attr]);var W=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(Z){setTimeout(function(){Z(!0)},c)})};function ae(){var R={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},c={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},Z={title:"\u5BFC\u5165\u6570\u636E"},L=[R,c,Z];return L}function ne(R){var c={fields:[]};if(R.length>0)for(var Z in R[0]){var L;(L=c.fields)===null||L===void 0||L.push({field:Z,title:Z,type:"string",visible:!0,sorter:!1})}return c}function Ze(R){var c=R.rowcount,Z=R.data;if(c>0){H(c);for(var L=ne(Z),J=[],I=0;I<6;I++)J.push(Z[I]);g({model:L,data:{rows:J,total:5}})}}function je(){var R,c,Z=new Map,L=new Map;(R=t.model)===null||R===void 0||(c=R.fields)===null||c===void 0||c.forEach(function(ee,z){Z.set(z,ee.title)});var J=[];N.forEach(function(ee,z){var de,ge;L.set(z,ee.title);var q=ee.foreign&&ee.foreign.isfkey?"Name":"",Se=(de=t.model)===null||de===void 0||(ge=de.fields)===null||ge===void 0?void 0:ge.find(function(Ge){return Ge.field==ee.field||Ge.field==ee.title}),Fe=void 0;if(Se==null||Se==null){var Be;z<((Be=t.model)===null||Be===void 0?void 0:Be.fields.length)&&(Fe=z),J.push({id:z,source:Fe,target:z,defaultValue:"",foreignMap:q})}else{var De=(0,vn.Z)(Z.entries()),Le;try{for(De.s();!(Le=De.n()).done;){var Ne=Le.value;if(Se.title==Ne[1]||Se.field==Ne[1]){Fe=Ne[0];break}}}catch(Ge){De.e(Ge)}finally{De.f()}J.push({id:z,source:Fe,target:z,defaultValue:"",foreignMap:q})}});var I=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:Z},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:L},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];ve({model:{fields:I,isadd:!1,isedit:!0,isremove:!1},rows:J,total:J.length})}function Ee(R){var c={};for(var Z in le.rows){var L,J,I=le.rows[Z],ee=(L=t.model)===null||L===void 0?void 0:L.fields[I.source];if(!((ee==null||ee==null)&&I.defaultValue=="")){var z=N[I.target];if(!(z==null||z==null)){if(I.defaultValue!=null&&I.defaultValue!=""){var de;c[z.field]=I.defaultValue,(de=z.foreign)!==null&&de!==void 0&&de.isfkey&&(c[z.field]=I[z.field]);continue}var ge=ee.field,q=R[ge];if(z.required&&(q==null||q==null||q=="")){S(c,"\u5BFC\u5165\u6570\u636E".concat(ee.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(z.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!(q==null||q==null||q=="")){if(z!=null&&z.comvtp&&z.comvtp.isvtp){var Se=(0,vn.Z)(z.comvtp.items.entries()),Fe;try{for(Se.s();!(Fe=Se.n()).done;){var Be=Fe.value;if(q==Be[1]){q=Be[0];break}}}catch(Le){Se.e(Le)}finally{Se.f()}}if((J=z.foreign)!==null&&J!==void 0&&J.isfkey&&y!=null&&y.has(z.field)){var De=y.get(z.field);q=De[q]}c[z.field]=q}}}}return c}function ze(R){var c=new Map;return le.rows.forEach(function(Z){var L,J=(L=t.model)===null||L===void 0?void 0:L.fields[Z.source];if(J){var I,ee=N[Z.target],z=Z.foreignMap==""?"Name":Z.foreignMap;if((I=ee.foreign)!==null&&I!==void 0&&I.isfkey&&Z.defaultValue==""){c.has(ee.field)||c.set(ee.field,new Map);var de=c.get(ee.field);for(var ge in R){var q=R[ge],Se=q[J.field];Se!=null&&Se!=""&&!de.has(Se)&&(de==null||de.set(Se,z))}}}}),c}function Ve(R){var c=ze(R);if(c.size==0){he(!1),fe({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var Z="";c.forEach(function(L,J){var I=N.find(function(q){return q.field==J}),ee=N.find(function(q){return q.type=="string"}).searchsymbol.find(function(q){return q.label=="\u7B49\u4E8E"}).value,z=[],de="";L.forEach(function(q,Se){de=q.toLowerCase(),z.push({name:q,symbol:ee,value:Se,relation:"||"})});var ge={field:I,foreign:I.foreign,whereList:z};e.onSearchData&&(W(200),e.onSearchData(ge,function(q){if(q&&q.rows.length>0)if(q.rows.length==L.size){console.log(L);for(var Se in q.rows){var Fe=q.rows[Se][de];L.has(Fe)&&(L[Fe]=q.rows[Se].id)}i(c),he(!1),console.log(oe.description),fe({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(I==null?void 0:I.title,"\u6570\u636E").concat(q.total,`\u9879\u3002
`),type:"info",count:0})}else L.forEach(function(Be,De){var Le=q.rows.find(function(Ne){return Ne[de]==De});Z+="".concat(I==null?void 0:I.title,"\u4E2D\u672A\u627E\u5230").concat(de,"\u4E3A").concat(De,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),Le==null&&S(q.rows,Z,0)});else Z+="".concat(I==null?void 0:I.title,"\u4E2D\u672A\u627E\u5230").concat(de,"\u4E3A").concat(z[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),S(q.rows,Z,0)}))})}function Me(R){if(D==null||D.data==null){We.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var c=D.data;if(le.rows.length<=0){We.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!xe){if(R==c.length){fe({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:R}),he(!0);return}var Z=Ee(c[R]);Z!=null&&C(Z,function(L,J){ke(Z,L,J,R)})}}function ke(R,c,Z,L){c?(L++,fe({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(R),type:"success",count:L}),W(200),Me(L)):S(R,Z,L)}function C(R,c){return d.apply(this,arguments)}function d(){return d=(0,_e.Z)(Ae().mark(function R(c,Z){return Ae().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:e.onAdd&&e.onAdd("add",c).then(function(){var I=(0,_e.Z)(Ae().mark(function ee(z){return Ae().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(console.log(z),z.ok!=null&&z.ok==!1&&(he(!0),Z(!1,z.statusText)),!(z!=null&&z.success)){ge.next=8;break}return ge.next=5,W(200);case 5:Z(!0),ge.next=10;break;case 8:he(!0),Z(!1,z.message);case 10:case"end":return ge.stop()}},ee)}));return function(ee){return I.apply(this,arguments)}}());case 1:case"end":return J.stop()}},R)})),d.apply(this,arguments)}function S(R,c,Z){var L={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(R),description:c,type:"error",count:Z,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var I=e.form;I.clear(),I.setHideSearch(!0),I.setTitle(e.title),I.show(),I.setValues(R),I.onFinish=function(ee){console.log(ee),I.hide(),C(ee,function(z,de){ke(ee,z,de,Z)})}}},children:"\u4FEE\u6539"})})};fe(L)}function b(){var R={name:"file",accept:".xlsx, .xls",onChange:function(Z){console.log(Z);var L=new FileReader;L.onload=function(J){try{var I=J.target.result,ee=pe.ij(I,{type:"binary"}),z=[];for(var de in ee.Sheets)if(ee.Sheets.hasOwnProperty(de)){z=pe.P6.sheet_to_json(ee.Sheets[de]);break}var ge={data:z,rowcount:z.length};j(ge),Ze(ge)}catch(q){nn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log(q)}},L.readAsBinaryString(Z.file.originFileObj)}};return(0,n.jsxs)(Te.Z,{children:[(0,n.jsx)(re.Z,{gutter:[8,8],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsx)(qe.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(w,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"primary",onClick:function(){var Z=[],L={};N.forEach(function(J){Z.push({title:J.title,key:J.field}),L[J.field]=J.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),gn(Z,[L],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(re.Z,{gutter:[8,8],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsxs)(ht.default,(0,p.Z)((0,p.Z)({},R),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(st.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(re.Z,{gutter:[8,8],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsx)(Ue,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(re.Z,{gutter:[8,8],children:(0,n.jsx)(ue.Z,{span:24,push:11,children:(0,n.jsx)(be.Z,{type:"primary",disabled:w<1,onClick:function(){E(o+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function P(){var R={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:le.model,data:{rows:le.rows,total:le.total},onDataChange:function(Z){ve((0,p.Z)((0,p.Z)({},le),{},{rows:Z.rows}))},onGetFieldToEdit:function(Z,L){if(Z.field=="defaultValue"){var J=L.target,I=N[J];return I}return Z},onEditRowing:function(Z,L,J){return J!=null&&(Z.defaultValue=String(J)),!0},onSearchValueChange:function(Z,L,J){J.text!=null&&(L.defaultValue=J.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsx)(Xe,(0,p.Z)({},R))})}),(0,n.jsxs)(re.Z,{gutter:[16,16],children:[(0,n.jsx)(ue.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",onClick:function(){E(o+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(ue.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){E(o-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function X(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsx)(qe.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(w,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(oe.count,"\u884C"),type:"info"})})}),(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsx)(rt.Z,{percent:parseInt((oe.count/w*100).toString()),status:"active"})})}),(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:(0,n.jsx)(qe.Z,(0,p.Z)({},oe))})}),(0,n.jsxs)(re.Z,{gutter:[8,8],children:[(0,n.jsx)(ue.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",disabled:xe,onClick:function(){Me(oe.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(ue.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){E(o-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function ce(R){v(R),e.onShowChange&&e.onShowChange(R),R||T()}function we(){return(0,n.jsx)(vt,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:O,stepItem:ae(),currentStep:o,onChange:function(c){if(c==1&&je(),c==2&&D&&D.data){var Z=D.data;Ve(Z)}E(c)},onCurrentStepComponent:function(c){return c==0?b():c==1?P():c==2?X():(0,n.jsx)(n.Fragment,{})},onShowChange:function(c){ce(c)}})}return we()},St=gt,xt=function(e){var f=(0,s.useState)(!1),x=(0,F.Z)(f,2),u=x[0],o=x[1],E=(0,s.useState)(null),M=(0,F.Z)(E,2),K=M[0],O=M[1],v=(0,s.useState)(0),B=(0,F.Z)(v,2),A=B[0],w=B[1],H=(0,s.useState)([]),_=(0,F.Z)(H,2),r=_[0],t=_[1],g=(0,s.useState)(void 0),V=(0,F.Z)(g,2),l=V[0],N=V[1],ie=(0,s.useState)({rows:[],total:0}),U=(0,F.Z)(ie,2),se=U[0],oe=U[1],fe=(0,s.useState)(!1),k=(0,F.Z)(fe,2),h=k[0],D=k[1],j=(0,s.useState)(null),te=(0,F.Z)(j,2),Y=te[0],le=te[1],ve=(0,s.useState)({page:1,size:10,whereList:[],sortList:[]}),Ce=(0,F.Z)(ve,2),me=Ce[0],xe=Ce[1],he=(0,s.useState)(1),$=(0,F.Z)(he,2),m=$[0],y=$[1];if((0,s.useEffect)(function(){N(void 0),O(null),w(0),t([]),oe({rows:[],total:0}),i()},[e.controller]),l==null)return(0,n.jsx)(n.Fragment,{});function i(){if(console.log("waypage.init"),console.log(e),!e.init){var C,d=(C=e.namespace)!==null&&C!==void 0?C:e.controller;console.log(d+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(S){S!=null&&(S.success?(N(S.data),S.data.autoload&&W({},function(b){oe(b)})):Ze(S.message.message))})}var T=null,G=null;function W(C,d){T=C,G=d,e.search(C).then(function(S){S!=null&&(o(!1),S!=null&&S.success?(S.data.rows==null&&(S.data.rows=[]),d?d(S.data):oe(S.data)):Ze(S.message.message))})}var ae=function(d){var S=null;d.isselectrow&&(S=K),d.selectmultiple&&(S=r),ne(d,S)},ne=function(d,S){e.execute(d.command,S).then(function(b){console.log(b),b!=null&&b.success?(nn.default.success(d.name+"\u5B8C\u6210"),(l==null?void 0:l.viewtype)!="form"&&(Y&&Y.hide(),T!=null&&G!=null?(console.log("tempSearchItem"),W(T,G)):(console.log("2"),W(me,function(P){oe(P)})))):Ze(b.message.message)})};function Ze(C){We.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(ot.Z,{}),content:(0,n.jsx)("div",{children:C})})}function je(C,d){Y!=null&&Y.clear(),Y.setHideSearch(!0),Y.setTitle((l==null?void 0:l.title)+"-"+C.name),Y.show(),d&&(Y.setValues(d),Y.setHideSearch(!1)),Y.onFinish=function(S){console.log(S),ne(C,S)}}function Ee(C){var d,S=C?{fields:l==null||(d=l.fields)===null||d===void 0?void 0:d.filter(function(b){var P;return(P=b.issearch)!==null&&P!==void 0?P:!0}),onSearch:function(P){o(!0);var X={page:1,whereList:[]};P!=null&&((0,Pe.isArray)(P)?X.whereList=P:X.whereList=[P]),xe(X),y(1),W(X,function(ce){oe(ce)})},onSearchData:W}:!1;return(0,n.jsx)(sn,{attrs:l==null?void 0:l.commands,isselectrow:!0,selectcount:A,commandShow:!0,isshow:!C,onClick:function(P,X){if(console.log(P),P=="ImportData"){D(!0);return}if(P=="ExportData"){mt(l,se.total,me,e.search,e.title+".xlsx");return}if(P=="add"){if((l==null?void 0:l.viewtype)=="form"){Y.onFinish=function(ce){console.log(ce),ne(X,ce)},Y.submit();return}je(X);return}if(P=="edit"){je(X,K);return}ae(X)},searchShow:S})}function ze(){return(0,n.jsx)(Ue,{attr:l,data:se,isselect:!0,isexpandable:!0,loading:u,current:m,onSelectRows:function(d,S){t(S),w(S.length),O(d)},onSearchData:function(d,S){if(d.parent&&d.childmodel){W(d,function(b){S(b)});return}o(!0),y(d.page),d.whereList=me.whereList,xe(d),W(d,function(b){oe(b)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(d,S){var b,P=l==null||(b=l.commands)===null||b===void 0?void 0:b.find(function(X){return X.command=="edit"&&X.visible});P!=null&&je(P,S)}})}function Ve(C){return(0,n.jsx)(fn,{attr:l,title:e.title,ismodal:C,onInitFormed:function(S){le(S)},onSearchData:W})}function Me(){return(l==null?void 0:l.viewtype)=="form"?ke():(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:Ee(!0)})}),(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:ze()})}),(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:Ve(!0)})}),(0,n.jsx)(St,{title:e.title,isShow:h,attr:l,onAdd:e.execute,form:Y,onShowChange:function(d){D(d),d||W(me)},onSearchData:W})]})}function ke(){return(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:Ee(!1)})}),(0,n.jsx)(re.Z,{gutter:[16,16],children:(0,n.jsx)(ue.Z,{span:24,children:Ve(!1)})})]})}return Me()};function yt(Q,e){var f=e.controller;e.namespace!=null&&(f=e.namespace);var x=function(M){return{type:f+"/init",payload:M}},u=function(M){return{type:f+"/search",payload:M}},o=function(M){return{type:f+"/execute",payload:M}};return{dispatch:Q,init:function(){return Q(x({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(M){var K=e.namespace+"/"+e.service+"/"+e.controller;return Q(u({c:K,item:M,s:e.service}))},execute:function(M,K){var O=e.namespace+"/"+e.service+"/"+e.controller;return Q(o({c:O,command:M,item:K,s:e.service}))}}}var Ct=(0,xn.$j)(function(){},yt)(xt)},20067:function(){}}]);
