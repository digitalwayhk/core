(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(Zt,Sn,a){"use strict";a.d(Sn,{Z:function(){return Ct}});var jt=a(13062),de=a(71230),Et=a(89032),oe=a(15746),bt=a(71194),We=a(48889),wt=a(34792),nn=a(48086),D=a(2824),f=a(67294),xn=a(28216),Ft=a(58024),Re=a(39144),Dt=a(48736),tn=a(27049),Tt=a(49111),Ke=a(19650),Rt=a(30887),an=a(54689),_=a(11849),yn=a(69610),Cn=a(54941),Zn=a(57254),jn=a(7945),En=a(24616),bn=a(63270),wn=a(3050),Fn=a(16165),Dn=a(49101),Tn=a(73171),Rn=a(8212),Mn=a(65233),Bn=a(20924),In=a(25592),Mt=a(59250),On=a(13013),Bt=a(22385),ln=a(94199),It=a(57663),Ee=a(71577),An=a(57119),n=a(85893),Vn=function(e){var v,Z,d,i,w,B,P,I,c,R,M,S={key:(v=e.key)!==null&&v!==void 0?v:e.name,name:(Z=e.name)!==null&&Z!==void 0?Z:"",title:(d=e.title)!==null&&d!==void 0?d:"",text:e.text,danger:(i=e.danger)!==null&&i!==void 0?i:!1,block:(w=e.block)!==null&&w!==void 0?w:!1,type:(B=e.type)!==null&&B!==void 0?B:"default",target:e.target,size:(P=e.size)!==null&&P!==void 0?P:"default",shape:(I=e.shape)!==null&&I!==void 0?I:"",icon:(c=e.icon)!==null&&c!==void 0?c:"",ghost:(R=e.ghost)!==null&&R!==void 0?R:!1,disabled:(M=e.disabled)!==null&&M!==void 0?M:!1},N=(0,f.useState)(!1),q=(0,D.Z)(N,2),u=q[0],t=q[1];function C(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(z){return z.command==e.name}):null}var k=function(){if(e.onClick!=null)try{t({delay:100});var le=C();le!=null&&le.isalert?We.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(S.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(S)}}):e.onClick(S)}finally{t(!1)}};function o(){return e.ismenu?(0,n.jsx)(On.Z,{overlay:e.menu,children:(0,n.jsx)(ln.Z,{title:S.title,children:(0,n.jsx)(Ee.Z,(0,_.Z)((0,_.Z)({},S),{},{onClick:k,loading:u,children:S.text}))})}):(0,n.jsx)(ln.Z,{title:S.title,children:(0,n.jsx)(Ee.Z,(0,_.Z)((0,_.Z)({},S),{},{onClick:k,loading:u,children:S.text}))})}return o()},Me=Vn,Ot=a(47673),Je=a(4107),At=a(36877),kn=a(96607),Vt=a(77883),Ln=a(70507),kt=a(77576),Wn=a(12028),Lt=a(43358),zn=a(34041),Wt=a(53400),un=a(41505),Pn=a(76010),ze=a(96486),Oe=a(86582),zt=a(8963),Nn=a(68297),Pt=a(18106),He=a(58634),Kn=a(30381),on=a.n(Kn),Ae=a(75308);function rn(J,e,v){var Z,d,i=(0,Ae.MM)(e,J);if((Z=e.comvtp)!==null&&Z!==void 0&&Z.isvtp){var w=new Map(e.comvtp.items);i=w.get(i)}if((d=e.foreign)!==null&&d!==void 0&&d.isfkey){var B=e.foreign.oneobjectfield,P=e.foreign.onedisplayname;v[B]!=null&&(i=v[B][P])}if(e.type=="boolean"&&(i=i?"\u662F":"\u5426"),e.type=="datetime"){var I,c;if(i==""||i==null)return i;var R=(I=e.datatimetype)===null||I===void 0?void 0:I.dateformat;if((c=e.datatimetype)!==null&&c!==void 0&&c.istime){var M,S;R=((M=e.datatimetype)===null||M===void 0?void 0:M.dateformat)+" "+((S=e.datatimetype)===null||S===void 0?void 0:S.timeformat)}i=on()(i).format(R)}return i}var Hn=function(e,v,Z,d){var i,w=e.attr,B=[];function P(c,R,M){var S=rn(c,R,M);return e.onFieldRender!=null?e.onFieldRender(R,S,M):(0,n.jsx)(n.Fragment,{children:S})}var I=function(R,M){return e.onColumnToEdit?e.onColumnToEdit(R,M):(e.onGetFieldToEdit&&(R=e.onGetFieldToEdit(R,M)),d(M),(0,n.jsx)(Ye,{attr:R,value:Z[R.field],onChange:function(N){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(M,R.field,N))){console.log(N);var q=Object.assign({},Z);M[R.field]=N,q[R.field]=N,d(q)}},onSearchValueChange:function(N){e.onSearchValueChange&&e.onSearchValueChange(R,M,N)},onSearchBefore:function(N,q){e.onSearchData&&e.onSearchData(N,function(u){q(u.model,u)})},onSearchData:e.onSearchData}))};return w==null||(i=w.fields)===null||i===void 0||i.filter(function(c){return c.visible}).forEach(function(c){var R;B.push({dataIndex:c.field,title:c.title,sorter:(R=c.sorter)!==null&&R!==void 0?R:!0,render:function(S,N){if(N!=null)return v&&N.editable&&(c.isedit==null||c.isedit==!0)?I(c,N):P(S,c,N)}})}),B},Gn=He.Z.TabPane,Jn=function J(e){var v,Z,d,i,w,B=(0,f.useState)((v=e.loading)!==null&&v!==void 0?v:!1),P=(0,D.Z)(B,2),I=P[0],c=P[1],R=(0,f.useState)((Z=e.data)!==null&&Z!==void 0?Z:{rows:[],total:0}),M=(0,D.Z)(R,2),S=M[0],N=M[1],q=(0,f.useState)((d=e.rowedit)!==null&&d!==void 0?d:!1),u=(0,D.Z)(q,2),t=u[0],C=u[1],k=(0,f.useState)((i=e.current)!==null&&i!==void 0?i:1),o=(0,D.Z)(k,2),z=o[0],le=o[1],G=(0,f.useState)(10),fe=(0,D.Z)(G,2),re=fe[0],ce=fe[1],O=(0,f.useState)([]),m=(0,D.Z)(O,2),F=m[0],b=m[1],ae=(0,f.useState)((w=e.selectType)!==null&&w!==void 0?w:"radio"),U=(0,D.Z)(ae,2),ue=U[0],ve=U[1],Ze=(0,f.useState)(),me=(0,D.Z)(Ze,2),xe=me[0],he=me[1],Y=(0,f.useState)({}),g=(0,D.Z)(Y,2),j=g[0],l=g[1];(0,f.useEffect)(function(){var s;N((s=e.data)!==null&&s!==void 0?s:{rows:[],total:0})},[e.data]),(0,f.useEffect)(function(){var s;C((s=e.rowedit)!==null&&s!==void 0?s:!1)},[e.rowedit]),(0,f.useEffect)(function(){var s;c((s=e.loading)!==null&&s!==void 0?s:!1)},[e.loading]),(0,f.useEffect)(function(){var s;le((s=e.current)!==null&&s!==void 0?s:1)},[e.current]);var x=function(r,A,y){var X,ne,Ce=function(V){c(!1),N(V)},Fe=function(V){if(V.column==null)return"";var te={name:V.field,isdesc:!1};return V.order=="descend"&&(te.isdesc=!0),te};c(!0),le((X=r.current)!==null&&X!==void 0?X:1),ce((ne=r.pageSize)!==null&&ne!==void 0?ne:10);try{var T,h,E={page:(T=r.current)!==null&&T!==void 0?T:1,size:(h=r.pageSize)!==null&&h!==void 0?h:10,sortList:[]};if(y!=null)if((0,ze.isArray)(y))y.forEach(function(H){var V=Fe(H);V!=""&&H.sortList.push(V)});else{var L=Fe(y);L!=""&&E.sortList.push(L)}e.onSearchData!=null&&e.onSearchData(E,Ce)}finally{c(!1)}},K=function(r,A){var y=F.length<=r.length;if(b(r),e.onSelectRows!=null)if(r.length>0){var X=A[A.length-1];y||(X=null,r.length==1&&(X=S.rows.find(function(ne){return ne.id==r[0]}))),e.onSelectRows(X,r,y)}else e.onSelectRows(null,r,!1)},Q=function(){if(!!e.isselect)return{selectedRowKeys:F,fixed:!0,type:ue,columnTitle:xe,hideSelectAll:!1,columnWidth:"32px",onChange:K}};function ie(s){s=="checkbox"&&(ve("radio"),b([]),e.onSelectStateChange&&e.onSelectStateChange(!1),he(p()))}function p(){return(0,n.jsx)(Ee.Z,{type:"link",onClick:function(){he(null),ve("checkbox"),b([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function je(s){if(e.isedit){s.editable=!t;var r=(0,Oe.Z)(S.rows);r.forEach(function(A){A.id==s.id?A.editable=!t:A.editable&&(A.editable=!1)}),C(!t)}}function be(){var s;if(e.isexpandable&&(e==null||(s=e.attr)===null||s===void 0?void 0:s.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(A,y){var X;if(!!A&&(e==null||(X=e.attr)===null||X===void 0?void 0:X.childmodels)!=null&&e.attr.childmodels.length>0){var ne,Ce=e==null||(ne=e.attr)===null||ne===void 0?void 0:ne.childmodels[0];if(y[Ce.propertyname]||(y[Ce.propertyname]=[]),y[Ce.propertyname].total=y[Ce.propertyname].length,y[Ce.propertyname].total==0){var Fe={page:1,size:10};we(Fe,Ce,y)}}},expandedRowRender:Pe}:e.onExpandable(e.attr)}function we(s,r,A){s.childmodel=r,s.parent=A,e.onSearchData!=null&&e.onSearchData(s,function(y){var X=(0,Oe.Z)(S.rows),ne=X.findIndex(function(Ce){return Ce.id==A.id});X[ne][r.propertyname]=y.rows,X[ne][r.propertyname].total1=y.total,N({rows:X,total:S.total})})}var ke=function(r,A){if(e.onExpandedRowTabPane){var y=e.onExpandedRowTabPane(r,A);if(y!=null)return y}return(0,n.jsx)(J,{isselect:!1,isedit:!1,isclosecard:!0,attr:r,data:{rows:A[r.propertyname],total:A[r.propertyname].total1},onSearchData:function(ne){we(ne,r,A)}},"id")},Pe=function(r){var A;if((e==null||(A=e.attr)===null||A===void 0?void 0:A.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(X){var ne=e.attr.childmodels[Number(X)];we({},ne,r)},children:e.attr.childmodels.map(function(y,X){return r[y.propertyname]||(r[y.propertyname]=[]),r[y.propertyname].total=r[y.propertyname].length,(0,n.jsx)(Gn,{tab:y.title,children:ke(y,r)},X)})})};function Be(){var s=Hn(e,t,j,l),r="id";return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:r,columns:s,rowSelection:Q(),scroll:{x:s.length*150},dataSource:S.rows,pagination:{current:z,pageSize:re,total:S.total,hideOnSinglePage:!0,showTotal:function(y){return"\u603B ".concat(y," \u884C")}},loading:I,expandable:be(),onChange:x,onRow:function(y){return{onClick:function(ne){ne.stopPropagation();try{var Ce,Fe;if(((Ce=Q())===null||Ce===void 0?void 0:Ce.type)=="radio"&&K([y[r]],[y]),((Fe=Q())===null||Fe===void 0?void 0:Fe.type)=="checkbox"){var T=y[r],h=[];F.includes(T)?h=F.filter(function(E){return E!=T}):(h=(0,Oe.Z)(F),h.push(T)),K(h,[y])}}finally{e.onRowClick&&e.onRowClick(ne,y)}},onDoubleClick:function(ne){ne.stopPropagation(),je(y),e.onRowDoubleClick&&e.onRowDoubleClick(ne,y)},onMouseEnter:function(ne){e.onRowMouseEnter&&e.onRowMouseEnter(ne,y)},onMouseLeave:function(ne){e.onMouseLeave&&e.onMouseLeave(ne,y)}}}})}function ee(){return e.isclosecard?Be():(0,n.jsx)(Re.Z,{children:Be()})}return ee()},Ue=Jn,Un=a(61193),Qn=a.n(Un),Xn=function(e){var v=(0,f.useState)({left:0,top:0,bottom:0,right:0}),Z=(0,D.Z)(v,2),d=Z[0],i=Z[1],w=(0,f.useState)(!0),B=(0,D.Z)(w,2),P=B[0],I=B[1],c=f.createRef(),R=function(q,u){var t,C,k,o=(t=window)===null||t===void 0||(C=t.document)===null||C===void 0?void 0:C.documentElement,z=o.clientWidth,le=o.clientHeight,G=c==null||(k=c.current)===null||k===void 0?void 0:k.getBoundingClientRect();i({left:-(G==null?void 0:G.left)+(u==null?void 0:u.x),right:z-((G==null?void 0:G.right)-(u==null?void 0:u.x)),top:-(G==null?void 0:G.top)+(u==null?void 0:u.y),bottom:le-((G==null?void 0:G.bottom)-(u==null?void 0:u.y))})};function M(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){P&&I(!1)},onMouseOut:function(){I(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function S(){return(0,n.jsx)(We.Z,(0,_.Z)((0,_.Z)({},e),{},{title:M(),modalRender:function(q){return(0,n.jsx)(Qn(),{disabled:P,bounds:d,onStart:function(t,C){return R(t,C)},children:(0,n.jsx)("div",{ref:c,children:q})})}}))}return S()},Qe=Xn,Yn=function(e){var v,Z,d=(0,f.useState)([]),i=(0,D.Z)(d,2),w=i[0],B=i[1],P=(0,f.useState)(null),I=(0,D.Z)(P,2),c=I[0],R=I[1],M=(0,f.useState)(!1),S=(0,D.Z)(M,2),N=S[0],q=S[1],u=(0,f.useState)(e.data),t=(0,D.Z)(u,2),C=t[0],k=t[1],o=(0,f.useState)(ue()),z=(0,D.Z)(o,1),le=z[0],G=(0,f.useState)((v=e.commandShow)!==null&&v!==void 0?v:!0),fe=(0,D.Z)(G,1),re=fe[0],ce=(0,f.useState)((Z=e.modelshow)!==null&&Z!==void 0?Z:!1),O=(0,D.Z)(ce,2),m=O[0],F=O[1];(0,f.useEffect)(function(){k(e.data)},[e.data]),(0,f.useEffect)(function(){var Y;F((Y=e.modelshow)!==null&&Y!==void 0?Y:!1)},[e.modelshow]);var b={page:1,size:10,whereList:[],sortList:[]},ae=function(){var g,j,l=on()().valueOf().toString(),x={id:l,isnew:!0,editable:!0};if((g=e.model)===null||g===void 0||(j=g.fields)===null||j===void 0||j.forEach(function(p){p.field!=null&&p.field!="id"&&(x[p.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(x))){var K=[],Q=1;C!=null&&C.rows!=null&&(K=(0,Oe.Z)(C.rows),K.forEach(function(p){p.editable=!1}),Q=C.total+Q);var ie=[x].concat((0,Oe.Z)(K));q(!0),e.onAdded!=null&&e.onAdded(x),e.onDataChange!=null?e.onDataChange({rows:ie,total:Q},x,"add"):k({rows:ie,total:Q})}},U=function(){if(w.length>0){var g=[],j=[],l=(0,Oe.Z)(C.rows);w.forEach(function(K){if(K!=null){var Q=l.findIndex(function(p){return p.id==K?e.onRemoveRowing!=null&&!e.onRemoveRowing(p)?!1:(p.isnew||g.push(K),!0):!1}),ie=l.splice(Q,1);e.onRemoveed!=null&&e.onRemoveed(ie[0]),j.push(ie[0])}});var x={rows:l,total:C.total-1};e.onDataChange!=null?j.length>0&&e.onDataChange(x,j,"remove"):k(x)}};function ue(){var Y=[];return e.model!=null&&(e.model.isadd&&Y.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&Y.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&(Y=e.onGetCommands(Y)),Y}function ve(Y,g){F(Y),e.onModalChange&&e.onModalChange(Y,g)}function Ze(){var Y;if(!e.closetoolbar)return(0,n.jsx)(sn,{iscircle:e.iscirclebutton,commandShow:re,selectcount:w.length,attrs:le,isclosecard:!1,onClick:function(j,l){e.onCommandClicking&&e.onCommandClicking(l),j=="add"&&ae(),j=="remove"&&U(),e.onCommandClicked&&e.onCommandClicked(l)},searchShow:e.closesearch?!1:{fields:(Y=e.model)===null||Y===void 0?void 0:Y.fields,onSearch:function(j){b.whereList=[],j!=null&&((0,ze.isArray)(j)?b.whereList=j:b.whereList=[j]),b.page=1,b.sortList=[],e.onSearchData!=null&&e.onSearchData(b,function(l){k(l)})},onSearchData:e.onSearchData}})}function me(){var Y,g,j;return(0,n.jsx)(Ue,{attr:e.model,data:C,isedit:!e.closeedit,rowedit:N,selectType:(Y=e.selectType)!==null&&Y!==void 0?Y:"checkbox",isselect:(g=e.isselect)!==null&&g!==void 0?g:!0,isclosecard:(j=e.closecard)!==null&&j!==void 0?j:!0,onSelectRows:function(x,K){console.log(x),console.log(K),B(K),R(x)},onSearchData:function(x,K){if(x.foreign&&x.field){e.onSearchData&&e.onSearchData(x,K);return}b.page=x.page,b.size=x.size,b.sortList=x.sortList,e.onSearchData!=null&&e.onSearchData(b,function(Q){k(Q)})},onRowDataChangeing:function(x,K,Q){return e.onEditRowing!=null?e.onEditRowing(x,K,Q):(!x.isnew&&e.onDataChange!=null&&e.onDataChange(C,x,"edit"),!0)},onRowDoubleClick:function(x,K){K.editable!=null&&q(K.editable),e.ismodal&&m&&ve(!1,K)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(x,K,Q){K.isnew&&(K[Q.rowfield]=Q.row),e.onSearchValueChange&&e.onSearchValueChange(x,K,Q)}})}function xe(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[Ze(),me()]}):(0,n.jsxs)(Re.Z,{children:[Ze(),me()]})}function he(){if(e.ismodal){var Y;return(0,n.jsx)(Qe,{title:(Y=e.model)===null||Y===void 0?void 0:Y.title,width:600,visible:m,onCancel:function(){ve(!1,null)},onOk:function(){ve(!1,c)},children:(0,n.jsx)(n.Fragment,{children:xe()})})}else return xe()}return he()},Xe=Yn,$n=un.Z.RangePicker,qn=Je.Z.Search,ye;(function(J){J.Input="Input",J.TextArea="Input.TextArea",J.InputNumber="InputNumber",J.Switch="Switch",J.DatePicker="DatePicker",J.RangePicker="RangePicker",J.Search="Input.Search",J.Avatar="Avatar",J.Select="Select"})(ye||(ye={}));var dn=function(e){var v,Z={maxLength:500,size:"middle",placeholder:"",disabled:(v=e.disabled)!==null&&v!==void 0?v:!1,style:{width:"100%"},texttype:ye.Input};for(var d in Z)e.options!=null&&e.options[d]!=null&&(Z[d]=e.options[d]);return e.width!=null&&(Z.style.width=e.width),Z.texttype=_n(e,Z),Z},_n=function(e,v){var Z=e.textType,d=e.attr;if(d!=null){if((d.type=="int"||d.type=="int32"||d.type=="int64"||d.type=="decimal")&&(Z=ye.InputNumber,v.min=d.min,d.precision!=null&&d.precision>0&&(v.precision=d.precision),v.picker=void 0),d.type=="datetime"&&(Z=ye.DatePicker),d.type=="boolean"&&(Z=ye.Switch,e.search)){Z=ye.Select;var i=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];v.options=i}if(d.comvtp!=null&&d.comvtp.isvtp){Z=ye.Select;var w=[];(0,ze.isMap)(d.comvtp.items)||(d.comvtp.items=new Map(d.comvtp.items)),d.comvtp.items.forEach(function(B,P){w.push({label:B,value:P})}),v.options=w}d.foreign!=null&&d.foreign.isfkey&&(Z=ye.Search),d.length!=null&&d.length>0&&(v.maxLength=d.length),e.disabled==null&&d.disabled!=null&&(v.disabled=d.disabled),e.search&&(v.disabled=!1)}return Z==null&&(Z=ye.Input),Z},pn=function(e){var v=(0,f.useState)(function(){return dn(e)}),Z=(0,D.Z)(v,2),d=Z[0],i=Z[1],w=(0,f.useState)({isshow:!1,model:void 0,data:void 0}),B=(0,D.Z)(w,2),P=B[0],I=B[1],c=(0,f.useState)({row:void 0,value:"",text:"",rowfield:""}),R=(0,D.Z)(c,2),M=R[0],S=R[1],N=(0,Pn.Z)(e.defaultValue,{value:C(e.value),onChange:function(m,F){if(console.log(m),e.onChange!=null){var b=k(m);console.log(b),e.onChange(b)}}}),q=(0,D.Z)(N,2),u=q[0],t=q[1];(0,f.useEffect)(function(){if(e.search){var O;M.field!=((O=e.attr)===null||O===void 0?void 0:O.field)&&o(null),i(dn(e))}},[e.attr]),(0,f.useEffect)(function(){var O;if(((O=e.attr)===null||O===void 0?void 0:O.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&M.row==null&&e.value!=null){var m=e.children[e.attr.foreign.oneobjectfield];o(m)}},[e.value]);function C(O){var m=e.attr;return(0,Ae.MM)(m,O)}function k(O){var m=e.attr;switch(d.texttype){case ye.Select:return(m==null?void 0:m.type)=="string"?O.label:(0,Ae.Nz)(m,O)}return(0,Ae.Nz)(m,O)}function o(O){var m={value:"",text:"",row:void 0,rowfield:"",field:""};if(O){var F,b,ae,U,ue,ve,Ze,me,xe,he,Y=(F=(b=e.attr)===null||b===void 0||(ae=b.foreign)===null||ae===void 0?void 0:ae.oneobjectfieldkey)!==null&&F!==void 0?F:"",g=(U=(ue=e.attr)===null||ue===void 0||(ve=ue.foreign)===null||ve===void 0?void 0:ve.onedisplayname)!==null&&U!==void 0?U:"";console.log(Y+"---"+g),m.row=O,m.value=O[Y],m.text=O[g],m.rowfield=(Ze=(me=e.attr)===null||me===void 0||(xe=me.foreign)===null||xe===void 0?void 0:xe.oneobjectfield)!==null&&Ze!==void 0?Ze:"",m.field=(he=e.attr)===null||he===void 0?void 0:he.field,console.log(m)}S(m),t(m.value),e.onSearchValueChange&&e.onSearchValueChange(m)}function z(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(qn,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:M.text,onSearch:function(m){if(e.onSearchBefore!=null){var F,b={foreign:(F=e.attr)===null||F===void 0?void 0:F.foreign,value:m,field:e.attr};e.onSearchBefore(b,function(ae,U){var ue;(ae.title==null||ae.title=="")&&(ae.title=(ue=e.attr)===null||ue===void 0?void 0:ue.title),I({isshow:!0,model:ae,data:U})})}}})),(0,n.jsx)(Xe,{ismodal:!0,modelshow:P.isshow,model:P.model,data:P.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(m,F){var b=(0,_.Z)({},P);b.isshow=m,console.log(b),I(b),o(F)},onSearchData:function(m,F){var b;m.field=e.attr,m.foreign=(b=e.attr)===null||b===void 0?void 0:b.foreign,e.onSearchData!=null&&e.onSearchData(m,F)}})]})}function le(){var O=e.attr;return(O==null?void 0:O.type)=="string"&&(d.labelInValue=!0),(0,n.jsx)(zn.Z,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:u,onChange:t}))}function G(){return(0,n.jsx)(Wn.Z,{size:"default",checked:u,onChange:t})}function fe(){var O=e.attr,m=void 0,F=void 0;if(console.log(O),O&&O.datatimetype&&(O.datatimetype.istime&&(m={format:O.datatimetype.timeformat}),F=O.datatimetype.dateformat,O.datatimetype.istime&&(F=F+" "+O.datatimetype.timeformat)),e.search){var b;return(0,n.jsx)($n,{size:"middle",showTime:m,format:F,style:d.style,value:u,allowEmpty:[!0,!0],picker:(b=e.options)===null||b===void 0?void 0:b.picker,onChange:t})}else return(0,n.jsx)(un.Z,(0,_.Z)((0,_.Z)({},d),{},{format:F,showTime:m,size:"middle",picker:"date",value:u,onChange:t}))}function re(){return(0,n.jsx)(Ln.Z,(0,_.Z)((0,_.Z)({},d),{},{value:u,onChange:t}))}function ce(){switch(d.texttype){case ye.InputNumber:return re();case ye.DatePicker:return fe();case ye.Switch:return G();case ye.Select:return le();case ye.Search:return z()}return(0,n.jsx)(Je.Z,(0,_.Z)((0,_.Z)({},d),{},{size:"middle",value:u,onChange:function(m){t(m.target.value)}}))}return ce()},Ye=pn,et=a(76570),Nt=null,nt=function(e){var v=new Map;v.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),v.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),v.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var Z=(0,f.useState)({value:"",attr:{type:"string"}}),d=(0,D.Z)(Z,2),i=d[0],w=d[1],B=(0,f.useState)(""),P=(0,D.Z)(B,2),I=P[0],c=P[1],R=(0,f.useState)({type:"string"}),M=(0,D.Z)(R,2),S=M[0],N=M[1],q=(0,f.useState)({name:"*",type:"string",symbol:""}),u=(0,D.Z)(q,2),t=u[0],C=u[1],k=(0,f.useState)({picker:null}),o=(0,D.Z)(k,2),z=o[0],le=o[1],G=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(m){if(m.issearch){var F,b=(F=m.searchsymbol)!==null&&F!==void 0?F:v.get(m.type);m.type=="datetime"&&(b=v.get(m.type)),m.type=="decimal"&&(b=v.get("int")),m.foreign&&m.foreign.isfkey&&(b=void 0),G.push({label:m.title,value:m.field,children:b})}});function fe(){return(0,n.jsx)(kn.Z,{style:{width:"140px"},options:G,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(F){var b;console.log(F);var ae=F[0],U=(b=e.fields)===null||b===void 0?void 0:b.find(function(ve){return ve.field==ae});if(C({name:ae,symbol:F[1],type:U==null?void 0:U.type}),t.name!=ae&&(w(Object.assign(i,{value:"",attr:U})),c(""),N(U),(U==null?void 0:U.type)=="datetime")){var ue=(0,_.Z)({},z);ue.picker=F[1],le(ue)}}})}function re(){return(0,n.jsx)(Ye,{width:"240px",options:z,search:!0,name:t.name,attr:S,value:I,onChange:function(F){console.log(F),c(F),w({value:F,attr:i.attr})},onSearchBefore:function(F,b){e.onSearchData&&e.onSearchData(F,function(ae){b(ae.model,ae)})},onSearchData:e.onSearchData})}function ce(){return(0,n.jsx)(Ee.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(et.Z,{}),onClick:function(){console.log(i);var F=(0,Ae.Nz)(S,i.value);console.log(F);var b={name:t.name,symbol:t.symbol,value:F};if(b.name=="*"&&b.value=="")e.onSearch();else{if(S.type=="datetime"&&i.value!=""&&(0,ze.isArray)(F)){var ae=[];return i.value[0]!=null&&(b.symbol=">=",b.value=i.value[0],ae.push(b)),i.value[1]!=null&&ae.push({name:t.name,symbol:"<=",value:i.value[1]}),e.onSearch(ae)}e.onSearch(b)}}})}function O(){return(0,n.jsxs)(Je.Z.Group,{compact:!0,children:[fe(),re(),ce()]})}return O()},tt=nt,at=function(){function J(){(0,yn.Z)(this,J),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Cn.Z)(J,[{key:"onPrint",value:function(v){}},{key:"onSet",value:function(v){}},{key:"onHelp",value:function(v){}},{key:"onAbout",value:function(v){}}]),J}(),it=function(e){var v=["add","create"],Z=["remove","delete"],d=["update","edit"],i=["ImportData","import"],w=["ExportData","export"];function B(){var t,C=[],k=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(o){if(o.issplit&&o.splitname!=null)if(k.has(o.splitname)){var z=k.get(o.splitname);z==null||z.push(o)}else k.set(o.splitname,[o]);else C.push(o)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:C.map(function(o){if(k.has(o.command)){var z,le=(0,n.jsx)(an.Z,{children:(z=k.get(o.command))===null||z===void 0?void 0:z.map(function(G,fe){return(0,n.jsx)(an.Z.Item,{children:(0,n.jsx)(Me,(0,_.Z)((0,_.Z)({},S(G)),{},{onClick:function(){return M(G.command,G)},toolbar:e}),fe)},fe)})});return(0,n.jsx)(Me,(0,_.Z)((0,_.Z)({},S(o)),{},{icon:(0,n.jsx)(Zn.Z,{}),ismenu:!0,menu:le,onClick:function(){return M(o.command,o)},toolbar:e}))}else return(0,n.jsx)(Me,(0,_.Z)((0,_.Z)({},S(o)),{},{onClick:function(){return M(o.command,o)},toolbar:e}))})})}function P(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function I(){if(e.helpShow!=null&&e.helpShow!=!1){var t,C,k,o,z,le,G,fe,re,ce,O=(0,f.useState)({isprint:(t=(C=e.helpShow)===null||C===void 0?void 0:C.isprint)!==null&&t!==void 0?t:!1,isset:(k=(o=e.helpShow)===null||o===void 0?void 0:o.isset)!==null&&k!==void 0?k:!1,ishelp:(z=(le=e.helpShow)===null||le===void 0?void 0:le.ishelp)!==null&&z!==void 0?z:!1,isabout:(G=(fe=e.helpShow)===null||fe===void 0?void 0:fe.isabout)!==null&&G!==void 0?G:!1,wvh:(re=(ce=e.helpShow)===null||ce===void 0?void 0:ce.wvh)!==null&&re!==void 0?re:new at}),m=(0,D.Z)(O,2),F=m[0],b=m[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:c(F)})}}function c(t){var C=[];if(t.isprint){var k;C.push((0,n.jsx)(Me,{title:(k=t.wvh)===null||k===void 0?void 0:k.printText,name:"print",shape:"circle",icon:(0,n.jsx)(jn.Z,{}),onClick:M}))}if(t.isset){var o;C.push((0,n.jsx)(Me,{title:(o=t.wvh)===null||o===void 0?void 0:o.setText,name:"set",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:M}))}if(t.ishelp){var z;C.push((0,n.jsx)(Me,{title:(z=t.wvh)===null||z===void 0?void 0:z.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:M}))}if(t.isabout){var le;C.push((0,n.jsx)(Me,{title:(le=t.wvh)===null||le===void 0?void 0:le.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:M}))}return C.length>0&&C.unshift((0,n.jsx)(tn.Z,{type:"vertical"})),C.map(function(G){return G})}function R(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(tt,(0,_.Z)({},e.searchShow))}var M=function(C,k){e.onClick!=null&&e.onClick(C,k)};function S(t){var C,k={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return k.disabled=(C=P(t))!==null&&C!==void 0?C:!1,k=N(k),e.iscircle&&(k.shape="circle",k.title=k.text,k.text=""),k}function N(t){return v.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Fn.Z,{component:Dn.Z})),Z.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Tn.Z,{})),d.includes(t.name)&&(t.icon=(0,n.jsx)(Rn.Z,{})),i.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),w.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(In.Z,{})),t}var q=function(C){return C.length==3?(0,n.jsxs)(de.Z,{gutter:[8,8],children:[(0,n.jsx)(oe.Z,{span:10,children:(0,n.jsx)(de.Z,{justify:"start",children:C[0]})}),(0,n.jsx)(oe.Z,{span:8,children:(0,n.jsx)(de.Z,{justify:"end",children:C[1]})}),(0,n.jsx)(oe.Z,{span:6,children:(0,n.jsx)(de.Z,{justify:"end",children:C[2]})})]}):C.length==2?(0,n.jsxs)(de.Z,{gutter:[8,8],children:[(0,n.jsx)(oe.Z,{span:12,children:(0,n.jsx)(de.Z,{justify:"start",children:C[0]})}),(0,n.jsx)(oe.Z,{span:12,children:(0,n.jsx)(de.Z,{justify:"end",children:C[1]})})]}):C.length==1?(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(de.Z,{justify:"start",children:C[0]})})}):(0,n.jsx)(n.Fragment,{})};function u(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(oe.Z,{children:R()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(oe.Z,{children:B()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(oe.Z,{children:I()})),e.isclosecard?q(t):(0,n.jsx)(Re.Z,{children:q(t)})}return u()},sn=it,Kt=a(9715),$e=a(22712),lt=He.Z.TabPane,ut=function(e){var v,Z=$e.Z.useForm(),d=(0,D.Z)(Z,1),i=d[0],w=(0,f.useState)(e.title),B=(0,D.Z)(w,2),P=B[0],I=B[1],c=(0,f.useState)((v=e.isshow)!==null&&v!==void 0?v:!1),R=(0,D.Z)(c,2),M=R[0],S=R[1],N=(0,f.useState)(b(e.attr)),q=(0,D.Z)(N,2),u=q[0],t=q[1],C=(0,f.useState)(function(){return U(e.values)}),k=(0,D.Z)(C,2),o=k[0],z=k[1],le=(0,f.useState)(!1),G=(0,D.Z)(le,2),fe=G[0],re=G[1],ce=(0,f.useState)(!1),O=(0,D.Z)(ce,2),m=O[0],F=O[1];(0,f.useEffect)(function(){console.log(e.values),e.values!=null?z(U(e.values)):ue()},[e.values]),(0,f.useEffect)(function(){t(b(e.attr))},[e.attr]);function b(g){var j,l;return{items:g==null||(j=g.fields)===null||j===void 0?void 0:j.filter(function(x){return x.visible&&x.isedit}),models:g==null||(l=g.childmodels)===null||l===void 0?void 0:l.filter(function(x){return x.propertyname==null&&(x.propertyname=x.name),x.visible})}}function ae(){var g,j=[];return(g=u.items)===null||g===void 0||g.forEach(function(l){var x=ve(e.attr,l);e.onInitTextBox!=null&&e.onInitTextBox(l,txtprops),j.push((0,n.jsx)(oe.Z,{span:8,children:(0,n.jsx)($e.Z.Item,(0,_.Z)((0,_.Z)({},x),{},{children:(0,n.jsx)(Ye,{attr:l,onSearchBefore:function(Q,ie){e.onSearchData!=null&&e.onSearchData(Q,function(p){ie(p.model,p)})},onSearchData:function(Q,ie){e.onSearchData&&e.onSearchData(Q,ie)},children:o})}),l.field)}))}),e.onInitFormed!=null&&(i.setFieldDisabled=function(l,x){var K;(K=u.items)===null||K===void 0||K.forEach(function(Q){var ie;((ie=Q.field)===null||ie===void 0?void 0:ie.toLocaleLowerCase())==l.toLocaleLowerCase()&&(Q.disabled=x)}),t(u)},i.setTitle=function(l){I(l)},i.show=function(){S(!0)},i.hide=function(){S(!1)},i.setValues=function(l){z(U(l))},i.clear=function(){ue()},i.setHideSearch=function(l){F(l)},i.setHideToolbar=function(l){re(l)},e.onInitFormed(i)),j}function U(g){var j;return g==null&&(g={}),i.setFieldsValue(g),u.models!=null&&((j=u.models)===null||j===void 0?void 0:j.length)>0&&(console.log(u),u.models.forEach(function(l){g[l.propertyname]?g[l.propertyname].total=g[l.propertyname].length:(g[l.propertyname]=[],g[l.propertyname].total=0),l.removeRows=[]})),g}function ue(){var g;i.resetFields();var j={};(g=u.models)===null||g===void 0||g.forEach(function(l){j[l.propertyname]||(j[l.propertyname]=[],j[l.propertyname].total=0)}),z(j)}function ve(g,j){var l={};l.name=j.field,l.label=j.title;var x=Ze(j);return j.disabled||(l.rules=x),e.onInitItem!=null&&e.onInitItem(j,l),l}function Ze(g){var j,l=[];if(g.required&&l.push({required:g.required}),(j=g.length)!==null&&j!==void 0?j:0>0){var x;l.push({max:(x=g.length)!==null&&x!==void 0?x:500,type:(0,Ae.mc)(g.type)})}return e.onFieldRules!=null&&(l=e.onFieldRules(g,l)),l}var me=function(j){var l,x=Object.assign({},o);for(var K in j)x[K]=j[K];return u.models!=null&&((l=u.models)===null||l===void 0?void 0:l.length)>0&&u.models.forEach(function(Q){var ie;x[Q.propertyname]!=null&&x[Q.propertyname].forEach(function(p){p.isnew?p.modelState=1:p.modelState=2}),(ie=Q.removeRows)===null||ie===void 0||ie.forEach(function(p){p.modelState=3,x[Q.propertyname].push(p)})}),console.log(x),x};function xe(){return(0,n.jsx)($e.Z,{labelAlign:"left",form:i,onFinish:function(j){var l=me(j);i.onFinish!=null&&i.onFinish(l),e.onFinish!=null&&e.onFinish(l)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(de.Z,{gutter:24,children:ae()})})}function he(){var g;if(u.models!=null&&((g=u.models)===null||g===void 0?void 0:g.length)>0){var j;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(j=u.models)===null||j===void 0?void 0:j.map(function(l,x){var K;return(0,n.jsx)(lt,{tab:l.title,children:(0,n.jsx)(Xe,{model:l,data:{rows:o[l.propertyname],total:(K=o[l.propertyname])===null||K===void 0?void 0:K.total},iscirclebutton:!0,closetoolbar:fe,closesearch:m,closecard:!0,onSearchData:function(ie){e.onSearchData!=null&&(ie.parent=o,ie.childmodel=l,e.onSearchData(ie,function(p){var je=Object.assign({},o);je[l.propertyname]=p.rows,je[l.propertyname].total=p.total,z(je)}))},onDataChange:function(ie,p,je){console.log(ie,p);var be=Object.assign({},o);be[l.propertyname]=ie.rows,be[l.propertyname].total=ie.total,console.log(be),je=="remove"&&p.forEach(function(we){we&&!we.isnew&&l.removeRows.push(we)}),z(be)}})},x)})})}return(0,n.jsx)(n.Fragment,{})}function Y(){return e.ismodal?(0,n.jsxs)(Qe,{title:P,width:1100,visible:M,onCancel:function(){return S(!1)},onOk:function(){i.submit()},children:[(0,n.jsx)(Re.Z,{children:xe()}),he()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Re.Z,{title:P,children:xe()}),he()]})}return Y()},fn=ut,cn=a(38535),ot=a(73218),Ht=a(34669),rt=a(82833),Gt=a(17462),qe=a(76772),_e=a(3182),vn=a(91220),dt=a(94043),Ve=a.n(dt),st=a(43347),Jt=a(35556),hn=a(97880),ft=hn.Z.Step,ct=function(e){var v,Z,d=(0,f.useState)((v=e.currentStep)!==null&&v!==void 0?v:0),i=(0,D.Z)(d,2),w=i[0],B=i[1],P=(0,f.useState)((Z=e.isShow)!==null&&Z!==void 0?Z:!1),I=(0,D.Z)(P,2),c=I[0],R=I[1];(0,f.useEffect)(function(){var u;R((u=e.isShow)!==null&&u!==void 0?u:!1)},[e.isShow]),(0,f.useEffect)(function(){var u;if(B((u=e.currentStep)!==null&&u!==void 0?u:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function M(u){return e.onCurrentStepComponent?e.onCurrentStepComponent(u):(0,n.jsx)(fn,{attr:e.attr,ismodal:!1})}function S(){var u;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(hn.Z,{current:w,onChange:function(C){B(C),e.onChange&&e.onChange(C)},children:(u=e.stepItem)===null||u===void 0?void 0:u.map(function(t){return(0,n.jsx)(ft,(0,_.Z)({},t))})}),(0,n.jsx)(tn.Z,{}),M(w)]})}function N(u){R(u),e.onShowChange&&e.onShowChange(u)}function q(){if(e.isModal){var u={onOk:function(){N(!1)},onCancel:function(){N(!1)}};return e.closeOk&&(u.footer=!1),(0,n.jsx)(Qe,(0,_.Z)((0,_.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:c},u),{},{children:S()}))}return e.isCard?(0,n.jsx)(Re.Z,{title:e.title,bordered:!1,children:S()}):S()}return q()},vt=ct,pe=a(54701),ht=a(58602),mn=a(32059);function gn(J,e,v){var Z=J.map(function(I,c){return Object.assign({},{key:I.key,title:I.title,position:String.fromCharCode(65+c)+1})}).reduce(function(I,c){return Object.assign({},I,(0,mn.Z)({},c.position,{key:c.key,v:c.title}))},{}),d=e.map(function(I,c){return J.map(function(R,M){return Object.assign({},{content:I[R.key],position:String.fromCharCode(65+M)+(c+2)})})}).reduce(function(I,c){return I.concat(c)}).reduce(function(I,c){return Object.assign({},I,(0,mn.Z)({},c.position,{v:c.content}))},{}),i=Object.assign({},Z,d),w=Object.keys(i),B="".concat(w[0],":").concat(w[w.length-1]),P={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},i,{"!ref":B,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};pe.NC(P,v)}function mt(J,e,v,Z,d){return en.apply(this,arguments)}function en(){return en=(0,_e.Z)(Ve().mark(function J(e,v,Z,d,i){var w,B;return Ve().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:v>0&&(w=[],e.fields.forEach(function(c){c.visible&&w.push({title:c.title,key:c.field,item:c})}),B=Object.assign({},Z),B.page=1,B.size=v,B.size>0&&d(B).then(function(c){if(c!=null&&c.success&&c.data&&c.data.rows){var R=c.data.rows;for(var M in R)for(var S in w){var N=R[M][w[S].key],q=rn(N,w[S].item,R[M]);R[M][w[S].key]=q!=null?q:""}gn(w,R,i)}}));case 1:case"end":return I.stop()}},J)})),en.apply(this,arguments)}var gt=function(e){var v,Z=(0,f.useState)(0),d=(0,D.Z)(Z,2),i=d[0],w=d[1],B=(0,f.useState)((v=e.isShow)!==null&&v!==void 0?v:!1),P=(0,D.Z)(B,2),I=P[0],c=P[1],R=(0,f.useState)(0),M=(0,D.Z)(R,2),S=M[0],N=M[1],q=(0,f.useState)({model:void 0,data:{rows:[],total:0}}),u=(0,D.Z)(q,2),t=u[0],C=u[1],k=(0,f.useState)(K(e.attr)),o=(0,D.Z)(k,2),z=o[0],le=o[1],G=(0,f.useState)({message:"",description:"",type:"success",count:0}),fe=(0,D.Z)(G,2),re=fe[0],ce=fe[1],O=(0,f.useState)(null),m=(0,D.Z)(O,2),F=m[0],b=m[1],ae=(0,f.useState)({model:null,rows:[],total:0}),U=(0,D.Z)(ae,2),ue=U[0],ve=U[1],Ze=(0,f.useState)(!0),me=(0,D.Z)(Ze,2),xe=me[0],he=me[1],Y=(0,f.useState)(void 0),g=(0,D.Z)(Y,2),j=g[0],l=g[1];function x(){w(0),N(0),C({model:void 0,data:{rows:[],total:0}}),ce({message:"",description:"",type:"success",count:0}),b(null),ve({model:null,rows:[],total:0}),he(!0),l(void 0)}function K(T){var h;return(h=T.fields)===null||h===void 0?void 0:h.filter(function(E){return E.visible&&!E.disabled})}(0,f.useEffect)(function(){c(e.isShow)},[e.isShow]),(0,f.useEffect)(function(){le(K(e.attr))},[e.attr]);var Q=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(E){setTimeout(function(){E(!0)},h)})};function ie(){var T={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},h={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},E={title:"\u5BFC\u5165\u6570\u636E"},L=[T,h,E];return L}function p(T){var h={fields:[]};if(T.length>0)for(var E in T[0]){var L;(L=h.fields)===null||L===void 0||L.push({field:E,title:E,type:"string",visible:!0,sorter:!1})}return h}function je(T){var h=T.rowcount,E=T.data;if(h>0){N(h);for(var L=p(E),H=[],V=0;V<6;V++)H.push(E[V]);C({model:L,data:{rows:H,total:5}})}}function be(){var T,h,E=new Map,L=new Map;(T=t.model)===null||T===void 0||(h=T.fields)===null||h===void 0||h.forEach(function(te,W){E.set(W,te.title)});var H=[];z.forEach(function(te,W){var se,ge;L.set(W,te.title);var $=te.foreign&&te.foreign.isfkey?"Name":"",Se=(se=t.model)===null||se===void 0||(ge=se.fields)===null||ge===void 0?void 0:ge.find(function(Ge){return Ge.field==te.field||Ge.field==te.title}),De=void 0;if(Se==null||Se==null){var Ie;W<((Ie=t.model)===null||Ie===void 0?void 0:Ie.fields.length)&&(De=W),H.push({id:W,source:De,target:W,defaultValue:"",foreignMap:$})}else{var Te=(0,vn.Z)(E.entries()),Le;try{for(Te.s();!(Le=Te.n()).done;){var Ne=Le.value;if(Se.title==Ne[1]||Se.field==Ne[1]){De=Ne[0];break}}}catch(Ge){Te.e(Ge)}finally{Te.f()}H.push({id:W,source:De,target:W,defaultValue:"",foreignMap:$})}});var V=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:E},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:L},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];ve({model:{fields:V,isadd:!1,isedit:!0,isremove:!1},rows:H,total:H.length})}function we(T){var h={};for(var E in ue.rows){var L,H,V=ue.rows[E],te=(L=t.model)===null||L===void 0?void 0:L.fields[V.source];if(!((te==null||te==null)&&V.defaultValue=="")){var W=z[V.target];if(!(W==null||W==null)){if(V.defaultValue!=null&&V.defaultValue!=""){var se;h[W.field]=V.defaultValue,(se=W.foreign)!==null&&se!==void 0&&se.isfkey&&(h[W.field]=V[W.field]);continue}var ge=te.field,$=T[ge];if(W.required&&($==null||$==null||$=="")){A(h,"\u5BFC\u5165\u6570\u636E".concat(te.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(W.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!($==null||$==null||$=="")){if(W!=null&&W.comvtp&&W.comvtp.isvtp){var Se=(0,vn.Z)(W.comvtp.items.entries()),De;try{for(Se.s();!(De=Se.n()).done;){var Ie=De.value;if($==Ie[1]){$=Ie[0];break}}}catch(Le){Se.e(Le)}finally{Se.f()}}if((H=W.foreign)!==null&&H!==void 0&&H.isfkey&&j!=null&&j.has(W.field)){var Te=j.get(W.field);$=Te[$]}h[W.field]=$}}}}return h}function ke(T){var h=new Map;return ue.rows.forEach(function(E){var L,H=(L=t.model)===null||L===void 0?void 0:L.fields[E.source];if(H){var V,te=z[E.target],W=E.foreignMap==""?"Name":E.foreignMap;if((V=te.foreign)!==null&&V!==void 0&&V.isfkey&&E.defaultValue==""){h.has(te.field)||h.set(te.field,new Map);var se=h.get(te.field);for(var ge in T){var $=T[ge],Se=$[H.field];Se!=null&&Se!=""&&!se.has(Se)&&(se==null||se.set(Se,W))}}}}),h}function Pe(T){var h=ke(T);if(h.size==0){he(!1),ce({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var E="";h.forEach(function(L,H){var V=z.find(function($){return $.field==H}),te=z.find(function($){return $.type=="string"}).searchsymbol.find(function($){return $.label=="\u7B49\u4E8E"}).value,W=[],se="";L.forEach(function($,Se){se=$.toLowerCase(),W.push({name:$,symbol:te,value:Se,relation:"||"})});var ge={field:V,foreign:V.foreign,whereList:W};e.onSearchData&&(Q(200),e.onSearchData(ge,function($){if($&&$.rows.length>0)if($.rows.length==L.size){console.log(L);for(var Se in $.rows){var De=$.rows[Se][se];L.has(De)&&(L[De]=$.rows[Se].id)}l(h),he(!1),console.log(re.description),ce({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(V==null?void 0:V.title,"\u6570\u636E").concat($.total,`\u9879\u3002
`),type:"info",count:0})}else L.forEach(function(Ie,Te){var Le=$.rows.find(function(Ne){return Ne[se]==Te});E+="".concat(V==null?void 0:V.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(Te,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),Le==null&&A($.rows,E,0)});else E+="".concat(V==null?void 0:V.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(W[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),A($.rows,E,0)}))})}function Be(T){if(F==null||F.data==null){We.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var h=F.data;if(ue.rows.length<=0){We.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!xe){if(T==h.length){ce({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:T}),he(!0);return}var E=we(h[T]);E!=null&&s(E,function(L,H){ee(E,L,H,T)})}}function ee(T,h,E,L){h?(L++,ce({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(T),type:"success",count:L}),Q(200),Be(L)):A(T,E,L)}function s(T,h){return r.apply(this,arguments)}function r(){return r=(0,_e.Z)(Ve().mark(function T(h,E){return Ve().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:e.onAdd&&e.onAdd("add",h).then(function(){var V=(0,_e.Z)(Ve().mark(function te(W){return Ve().wrap(function(ge){for(;;)switch(ge.prev=ge.next){case 0:if(console.log(W),W.ok!=null&&W.ok==!1&&(he(!0),E(!1,W.statusText)),!(W!=null&&W.success)){ge.next=8;break}return ge.next=5,Q(200);case 5:E(!0),ge.next=10;break;case 8:he(!0),E(!1,W.message);case 10:case"end":return ge.stop()}},te)}));return function(te){return V.apply(this,arguments)}}());case 1:case"end":return H.stop()}},T)})),r.apply(this,arguments)}function A(T,h,E){var L={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(T),description:h,type:"error",count:E,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(Ee.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var V=e.form;V.clear(),V.setHideSearch(!0),V.setTitle(e.title),V.show(),V.setValues(T),V.onFinish=function(te){console.log(te),V.hide(),s(te,function(W,se){ee(te,W,se,E)})}}},children:"\u4FEE\u6539"})})};ce(L)}function y(){var T={name:"file",accept:".xlsx, .xls",onChange:function(E){console.log(E);var L=new FileReader;L.onload=function(H){try{var V=H.target.result,te=pe.ij(V,{type:"binary"}),W=[];for(var se in te.Sheets)if(te.Sheets.hasOwnProperty(se)){W=pe.P6.sheet_to_json(te.Sheets[se]);break}var ge={data:W,rowcount:W.length};b(ge),je(ge)}catch($){nn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log($)}},L.readAsBinaryString(E.file.originFileObj)}};return(0,n.jsxs)(Re.Z,{children:[(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(qe.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(S,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(Ee.Z,{size:"small",type:"primary",onClick:function(){var E=[],L={};z.forEach(function(H){E.push({title:H.title,key:H.field}),L[H.field]=H.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),gn(E,[L],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsxs)(ht.default,(0,_.Z)((0,_.Z)({},T),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(st.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(Ue,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(de.Z,{gutter:[8,8],children:(0,n.jsx)(oe.Z,{span:24,push:11,children:(0,n.jsx)(Ee.Z,{type:"primary",disabled:S<1,onClick:function(){w(i+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function X(){var T={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:ue.model,data:{rows:ue.rows,total:ue.total},onDataChange:function(E){ve((0,_.Z)((0,_.Z)({},ue),{},{rows:E.rows}))},onGetFieldToEdit:function(E,L){if(E.field=="defaultValue"){var H=L.target,V=z[H];return V}return E},onEditRowing:function(E,L,H){return H!=null&&(E.defaultValue=String(H)),!0},onSearchValueChange:function(E,L,H){H.text!=null&&(L.defaultValue=H.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(Xe,(0,_.Z)({},T))})}),(0,n.jsxs)(de.Z,{gutter:[16,16],children:[(0,n.jsx)(oe.Z,{span:12,push:10,children:(0,n.jsx)(Ee.Z,{type:"primary",onClick:function(){w(i+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(oe.Z,{span:12,push:1,children:(0,n.jsx)(Ee.Z,{onClick:function(){w(i-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function ne(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(qe.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(S,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(re.count,"\u884C"),type:"info"})})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(rt.Z,{percent:parseInt((re.count/S*100).toString()),status:"active"})})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:(0,n.jsx)(qe.Z,(0,_.Z)({},re))})}),(0,n.jsxs)(de.Z,{gutter:[8,8],children:[(0,n.jsx)(oe.Z,{span:12,push:10,children:(0,n.jsx)(Ee.Z,{type:"primary",disabled:xe,onClick:function(){Be(re.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(oe.Z,{span:12,push:1,children:(0,n.jsx)(Ee.Z,{onClick:function(){w(i-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function Ce(T){c(T),e.onShowChange&&e.onShowChange(T),T||x()}function Fe(){return(0,n.jsx)(vt,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:I,stepItem:ie(),currentStep:i,onChange:function(h){if(h==1&&be(),h==2&&F&&F.data){var E=F.data;Pe(E)}w(h)},onCurrentStepComponent:function(h){return h==0?y():h==1?X():h==2?ne():(0,n.jsx)(n.Fragment,{})},onShowChange:function(h){Ce(h)}})}return Fe()},St=gt,xt=function(e){var v=(0,f.useState)(!1),Z=(0,D.Z)(v,2),d=Z[0],i=Z[1],w=(0,f.useState)(null),B=(0,D.Z)(w,2),P=B[0],I=B[1],c=(0,f.useState)(0),R=(0,D.Z)(c,2),M=R[0],S=R[1],N=(0,f.useState)([]),q=(0,D.Z)(N,2),u=q[0],t=q[1],C=(0,f.useState)(void 0),k=(0,D.Z)(C,2),o=k[0],z=k[1],le=(0,f.useState)({rows:[],total:0}),G=(0,D.Z)(le,2),fe=G[0],re=G[1],ce=(0,f.useState)(!1),O=(0,D.Z)(ce,2),m=O[0],F=O[1],b=(0,f.useState)(null),ae=(0,D.Z)(b,2),U=ae[0],ue=ae[1],ve=(0,f.useState)({page:1,size:10,whereList:[],sortList:[]}),Ze=(0,D.Z)(ve,2),me=Ze[0],xe=Ze[1],he=(0,f.useState)(1),Y=(0,D.Z)(he,2),g=Y[0],j=Y[1];if((0,f.useEffect)(function(){z(void 0),I(null),S(0),t([]),re({rows:[],total:0}),l()},[e.controller]),o==null)return(0,n.jsx)(n.Fragment,{});function l(){if(console.log("waypage.init"),console.log(e),!e.init){var ee,s=(ee=e.namespace)!==null&&ee!==void 0?ee:e.controller;console.log(s+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(r){r!=null&&(r.success?(z(r.data),r.data.autoload&&x({},function(A){re(A)})):p(r.message))})}function x(ee,s){S(0),i(!0),e.search(ee).then(function(r){if(r!=null)if(i(!1),r!=null&&r.success){if(r.data.rows==null&&(r.data.rows=[]),ee.foreign==null&&ee.childmodel==null&&u.length>0){var A=r.data.rows.find(function(y){return y.id==u[0]});A!=null?(t(u),S(u.length),I(A)):(t([]),S(0),I(null))}s?s(r.data):re(r.data)}else p(r.message)},function(r){console.log(r),i(!1)})}var K=function(s){var r=null;s.isselectrow&&(r=P),s.selectmultiple&&(r=u),Q(s,r)},Q=function(s,r){i(!0),e.execute(s.command,r).then(function(A){console.log(A),A!=null&&A.success?(i(!1),nn.default.success(s.name+"\u5B8C\u6210"),(o==null?void 0:o.viewtype)!="form"&&(U&&U.hide(),x(me,function(y){re(y)}))):(i(!1),p(A.message))},function(A){console.log(A),i(!1)})};function ie(ee){return typeof ee=="object"&&ee!==null}function p(ee){var s=ee;ie(ee)&&(s=ee.message),We.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(ot.Z,{}),content:(0,n.jsx)("div",{children:s})})}function je(ee,s){U!=null&&U.clear(),U.setHideSearch(!0),U.setTitle((o==null?void 0:o.title)+"-"+ee.name),U.show(),s&&(U.setValues(s),U.setHideSearch(!1)),U.onFinish=function(r){console.log(r),Q(ee,r)}}function be(ee){var s,r=ee?{fields:o==null||(s=o.fields)===null||s===void 0?void 0:s.filter(function(A){var y;return(y=A.issearch)!==null&&y!==void 0?y:!0}),onSearch:function(y){i(!0);var X={page:1,whereList:[]};y!=null&&((0,ze.isArray)(y)?X.whereList=y:X.whereList=[y]),xe(X),j(1),x(X,function(ne){re(ne)})},onSearchData:x}:!1;return(0,n.jsx)(sn,{attrs:o==null?void 0:o.commands,isselectrow:!0,selectcount:M,commandShow:!0,isshow:!ee,onClick:function(y,X){if(console.log(y),y=="ImportData"||y=="importdata"){F(!0);return}if(y=="ExportData"||y=="exportdata"){mt(o,fe.total,me,e.search,e.title+".xlsx");return}if(y=="add"){if((o==null?void 0:o.viewtype)=="form"){U.onFinish=function(ne){console.log(ne),Q(X,ne)},U.submit();return}je(X);return}if(y=="edit"){je(X,P);return}K(X)},searchShow:r})}function we(){return(0,n.jsx)(Ue,{attr:o,data:fe,isselect:!0,isexpandable:!0,loading:d,current:g,onSelectRows:function(s,r){console.log(s),console.log(r),t(r),S(r.length),I(s)},onSearchData:function(s,r){if(s.parent&&s.childmodel){x(s,function(A){r(A)});return}i(!0),j(s.page),s.whereList=me.whereList,xe(s),x(s,function(A){re(A)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(s,r){var A,y=o==null||(A=o.commands)===null||A===void 0?void 0:A.find(function(X){return X.command=="edit"&&X.visible});y!=null&&je(y,r)}})}function ke(ee){return(0,n.jsx)(fn,{attr:o,title:e.title,ismodal:ee,onInitFormed:function(r){ue(r)},onSearchData:x})}function Pe(){return(o==null?void 0:o.viewtype)=="form"?Be():(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:be(!0)})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:we()})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:ke(!0)})}),(0,n.jsx)(St,{title:e.title,isShow:m,attr:o,onAdd:e.execute,form:U,onShowChange:function(s){F(s),s||x(me)},onSearchData:x})]})}function Be(){return(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:be(!1)})}),(0,n.jsx)(de.Z,{gutter:[16,16],children:(0,n.jsx)(oe.Z,{span:24,children:ke(!1)})})]})}return Pe()};function yt(J,e){var v=e.controller;e.namespace!=null&&(v=e.namespace);var Z=function(B){return{type:v+"/init",payload:B}},d=function(B){return{type:v+"/search",payload:B}},i=function(B){return{type:v+"/execute",payload:B}};return{dispatch:J,init:function(){return J(Z({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(B){var P=e.namespace+"/"+e.service+"/"+e.controller;return J(d({c:P,item:B,s:e.service}))},execute:function(B,P){var I=e.namespace+"/"+e.service+"/"+e.controller;return J(i({c:I,command:B,item:P,s:e.service}))}}}var Ct=(0,xn.$j)(function(){},yt)(xt)},20067:function(){}}]);
