(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(Zt,Sn,a){"use strict";a.d(Sn,{Z:function(){return Ct}});var jt=a(13062),se=a(71230),Et=a(89032),re=a(15746),bt=a(71194),Le=a(48889),wt=a(34792),nn=a(48086),w=a(2824),d=a(67294),xn=a(28216),Ft=a(58024),Me=a(39144),Dt=a(48736),tn=a(27049),Tt=a(49111),Ke=a(19650),Rt=a(30887),an=a(54689),_=a(11849),yn=a(69610),Cn=a(54941),Zn=a(57254),jn=a(7945),En=a(24616),bn=a(63270),wn=a(3050),Fn=a(16165),Dn=a(49101),Tn=a(73171),Rn=a(8212),Mn=a(65233),Bn=a(20924),In=a(25592),Mt=a(59250),On=a(13013),Bt=a(22385),ln=a(94199),It=a(57663),we=a(71577),An=a(57119),n=a(85893),Vn=function(e){var s,y,r,u,E,R,P,M,h,B,I,b={key:(s=e.key)!==null&&s!==void 0?s:e.name,name:(y=e.name)!==null&&y!==void 0?y:"",title:(r=e.title)!==null&&r!==void 0?r:"",text:e.text,danger:(u=e.danger)!==null&&u!==void 0?u:!1,block:(E=e.block)!==null&&E!==void 0?E:!1,type:(R=e.type)!==null&&R!==void 0?R:"default",target:e.target,size:(P=e.size)!==null&&P!==void 0?P:"default",shape:(M=e.shape)!==null&&M!==void 0?M:"",icon:(h=e.icon)!==null&&h!==void 0?h:"",ghost:(B=e.ghost)!==null&&B!==void 0?B:!1,disabled:(I=e.disabled)!==null&&I!==void 0?I:!1},N=(0,d.useState)(!1),q=(0,w.Z)(N,2),o=q[0],t=q[1];function x(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(z){return z.command==e.name}):null}var A=function(){if(e.onClick!=null)try{t({delay:100});var ie=x();ie!=null&&ie.isalert?Le.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(b.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(b)}}):e.onClick(b)}finally{t(!1)}};function l(){return e.ismenu?(0,n.jsx)(On.Z,{overlay:e.menu,children:(0,n.jsx)(ln.Z,{title:b.title,children:(0,n.jsx)(we.Z,(0,_.Z)((0,_.Z)({},b),{},{onClick:A,loading:o,children:b.text}))})}):(0,n.jsx)(ln.Z,{title:b.title,children:(0,n.jsx)(we.Z,(0,_.Z)((0,_.Z)({},b),{},{onClick:A,loading:o,children:b.text}))})}return l()},Be=Vn,Ot=a(47673),Je=a(4107),At=a(36877),kn=a(96607),Vt=a(77883),Ln=a(70507),kt=a(77576),Wn=a(12028),Lt=a(43358),zn=a(34041),Wt=a(53400),un=a(41505),Pn=a(76010),We=a(96486),Oe=a(86582),zt=a(8963),Nn=a(68297),Pt=a(18106),He=a(58634),Kn=a(30381),on=a.n(Kn),Ae=a(75308);function rn(J,e,s){var y,r,u=(0,Ae.MM)(e,J);if((y=e.comvtp)!==null&&y!==void 0&&y.isvtp){var E=new Map(e.comvtp.items);u=E.get(u)}if((r=e.foreign)!==null&&r!==void 0&&r.isfkey){var R=e.foreign.oneobjectfield,P=e.foreign.onedisplayname;s[R]!=null&&(u=s[R][P])}if(e.type=="boolean"&&(u=u?"\u662F":"\u5426"),e.type=="datetime"){var M;u=u!=""?on()(u).format((M=e.datatimetype)===null||M===void 0?void 0:M.dateformat).toString():""}return u}var Hn=function(e,s,y,r){var u,E=e.attr,R=[];function P(h,B,I){var b=rn(h,B,I);return e.onFieldRender!=null?e.onFieldRender(B,b,I):(0,n.jsx)(n.Fragment,{children:b})}var M=function(B,I){return e.onColumnToEdit?e.onColumnToEdit(B,I):(e.onGetFieldToEdit&&(B=e.onGetFieldToEdit(B,I)),r(I),(0,n.jsx)(Ye,{attr:B,value:y[B.field],onChange:function(N){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(I,B.field,N))){console.log(N);var q=Object.assign({},y);I[B.field]=N,q[B.field]=N,r(q)}},onSearchValueChange:function(N){e.onSearchValueChange&&e.onSearchValueChange(B,I,N)},onSearchBefore:function(N,q){e.onSearchData&&e.onSearchData(N,function(o){q(o.model,o)})},onSearchData:e.onSearchData}))};return E==null||(u=E.fields)===null||u===void 0||u.filter(function(h){return h.visible}).forEach(function(h){var B;R.push({dataIndex:h.field,title:h.title,sorter:(B=h.sorter)!==null&&B!==void 0?B:!0,render:function(b,N){if(N!=null)return s&&N.editable&&(h.isedit==null||h.isedit==!0)?M(h,N):P(b,h,N)}})}),R},Gn=He.Z.TabPane,Jn=function J(e){var s,y,r,u,E,R=(0,d.useState)((s=e.loading)!==null&&s!==void 0?s:!1),P=(0,w.Z)(R,2),M=P[0],h=P[1],B=(0,d.useState)((y=e.data)!==null&&y!==void 0?y:{rows:[],total:0}),I=(0,w.Z)(B,2),b=I[0],N=I[1],q=(0,d.useState)((r=e.rowedit)!==null&&r!==void 0?r:!1),o=(0,w.Z)(q,2),t=o[0],x=o[1],A=(0,d.useState)((u=e.current)!==null&&u!==void 0?u:1),l=(0,w.Z)(A,2),z=l[0],ie=l[1],G=(0,d.useState)(10),fe=(0,w.Z)(G,2),de=fe[0],ve=fe[1],k=(0,d.useState)([]),m=(0,w.Z)(k,2),F=m[0],j=m[1],ae=(0,d.useState)((E=e.selectType)!==null&&E!==void 0?E:"radio"),U=(0,w.Z)(ae,2),ue=U[0],he=U[1],je=(0,d.useState)(),ge=(0,w.Z)(je,2),ye=ge[0],me=ge[1],Y=(0,d.useState)({}),g=(0,w.Z)(Y,2),C=g[0],i=g[1];(0,d.useEffect)(function(){var f;N((f=e.data)!==null&&f!==void 0?f:{rows:[],total:0})},[e.data]),(0,d.useEffect)(function(){var f;x((f=e.rowedit)!==null&&f!==void 0?f:!1)},[e.rowedit]),(0,d.useEffect)(function(){var f;h((f=e.loading)!==null&&f!==void 0?f:!1)},[e.loading]),(0,d.useEffect)(function(){var f;ie((f=e.current)!==null&&f!==void 0?f:1)},[e.current]);var S=function(c,V,T){var te,oe,Ze=function(O){h(!1),N(O)},De=function(O){if(O.column==null)return"";var ee={name:O.field,isdesc:!1};return O.order=="descend"&&(ee.isdesc=!0),ee};h(!0),ie((te=c.current)!==null&&te!==void 0?te:1),ve((oe=c.pageSize)!==null&&oe!==void 0?oe:10);try{var D,v,Z={page:(D=c.current)!==null&&D!==void 0?D:1,size:(v=c.pageSize)!==null&&v!==void 0?v:10,sortList:[]};if(T!=null)if((0,We.isArray)(T))T.forEach(function(H){var O=De(H);O!=""&&H.sortList.push(O)});else{var L=De(T);L!=""&&Z.sortList.push(L)}e.onSearchData!=null&&e.onSearchData(Z,Ze)}finally{h(!1)}},K=function(c,V){var T=F.length<=c.length;if(j(c),e.onSelectRows!=null)if(c.length>0){var te=V[V.length-1];T||(te=null,c.length==1&&(te=b.rows.find(function(oe){return oe.id==c[0]}))),e.onSelectRows(te,c,T)}else e.onSelectRows(null,c,!1)},Q=function(){if(!!e.isselect)return{selectedRowKeys:F,fixed:!0,type:ue,columnTitle:ye,hideSelectAll:!1,columnWidth:"32px",onChange:K}};function ne(f){f=="checkbox"&&(he("radio"),j([]),e.onSelectStateChange&&e.onSelectStateChange(!1),me(p()))}function p(){return(0,n.jsx)(we.Z,{type:"link",onClick:function(){me(null),he("checkbox"),j([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function Ee(f){if(e.isedit){f.editable=!t;var c=(0,Oe.Z)(b.rows);c.forEach(function(V){V.id==f.id?V.editable=!t:V.editable&&(V.editable=!1)}),x(!t)}}function Fe(){var f;if(e.isexpandable&&(e==null||(f=e.attr)===null||f===void 0?void 0:f.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(V,T){var te;if(!!V&&(e==null||(te=e.attr)===null||te===void 0?void 0:te.childmodels)!=null&&e.attr.childmodels.length>0){var oe,Ze=e==null||(oe=e.attr)===null||oe===void 0?void 0:oe.childmodels[0];if(T[Ze.propertyname]||(T[Ze.propertyname]=[]),T[Ze.propertyname].total=T[Ze.propertyname].length,T[Ze.propertyname].total==0){var De={page:1,size:10};be(De,Ze,T)}}},expandedRowRender:Pe}:e.onExpandable(e.attr)}function be(f,c,V){f.childmodel=c,f.parent=V,e.onSearchData!=null&&e.onSearchData(f,function(T){var te=(0,Oe.Z)(b.rows),oe=te.findIndex(function(Ze){return Ze.id==V.id});te[oe][c.propertyname]=T.rows,te[oe][c.propertyname].total1=T.total,N({rows:te,total:b.total})})}var ze=function(c,V){if(e.onExpandedRowTabPane){var T=e.onExpandedRowTabPane(c,V);if(T!=null)return T}return(0,n.jsx)(J,{isselect:!1,isedit:!1,isclosecard:!0,attr:c,data:{rows:V[c.propertyname],total:V[c.propertyname].total1},onSearchData:function(oe){be(oe,c,V)}},"id")},Pe=function(c){var V;if((e==null||(V=e.attr)===null||V===void 0?void 0:V.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(te){var oe=e.attr.childmodels[Number(te)];be({},oe,c)},children:e.attr.childmodels.map(function(T,te){return c[T.propertyname]||(c[T.propertyname]=[]),c[T.propertyname].total=c[T.propertyname].length,(0,n.jsx)(Gn,{tab:T.title,children:ze(T,c)},te)})})};function le(){var f=Hn(e,t,C,i),c="id";return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:c,columns:f,rowSelection:Q(),scroll:{x:f.length*150},dataSource:b.rows,pagination:{current:z,pageSize:de,total:b.total,hideOnSinglePage:!0,showTotal:function(T){return"\u603B ".concat(T," \u884C")}},loading:M,expandable:Fe(),onChange:S,onRow:function(T){return{onClick:function(oe){oe.stopPropagation();try{var Ze,De;if(((Ze=Q())===null||Ze===void 0?void 0:Ze.type)=="radio"&&K([T[c]],[T]),((De=Q())===null||De===void 0?void 0:De.type)=="checkbox"){var D=T[c],v=[];F.includes(D)?v=F.filter(function(Z){return Z!=D}):(v=(0,Oe.Z)(F),v.push(D)),K(v,[T])}}finally{e.onRowClick&&e.onRowClick(oe,T)}},onDoubleClick:function(oe){oe.stopPropagation(),Ee(T),e.onRowDoubleClick&&e.onRowDoubleClick(oe,T)},onMouseEnter:function(oe){e.onRowMouseEnter&&e.onRowMouseEnter(oe,T)},onMouseLeave:function(oe){e.onMouseLeave&&e.onMouseLeave(oe,T)}}}})}function X(){return e.isclosecard?le():(0,n.jsx)(Me.Z,{children:le()})}return X()},Ue=Jn,Un=a(61193),Qn=a.n(Un),Xn=function(e){var s=(0,d.useState)({left:0,top:0,bottom:0,right:0}),y=(0,w.Z)(s,2),r=y[0],u=y[1],E=(0,d.useState)(!0),R=(0,w.Z)(E,2),P=R[0],M=R[1],h=d.createRef(),B=function(q,o){var t,x,A,l=(t=window)===null||t===void 0||(x=t.document)===null||x===void 0?void 0:x.documentElement,z=l.clientWidth,ie=l.clientHeight,G=h==null||(A=h.current)===null||A===void 0?void 0:A.getBoundingClientRect();u({left:-(G==null?void 0:G.left)+(o==null?void 0:o.x),right:z-((G==null?void 0:G.right)-(o==null?void 0:o.x)),top:-(G==null?void 0:G.top)+(o==null?void 0:o.y),bottom:ie-((G==null?void 0:G.bottom)-(o==null?void 0:o.y))})};function I(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){P&&M(!1)},onMouseOut:function(){M(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function b(){return(0,n.jsx)(Le.Z,(0,_.Z)((0,_.Z)({},e),{},{title:I(),modalRender:function(q){return(0,n.jsx)(Qn(),{disabled:P,bounds:r,onStart:function(t,x){return B(t,x)},children:(0,n.jsx)("div",{ref:h,children:q})})}}))}return b()},Qe=Xn,Yn=function(e){var s,y,r=(0,d.useState)([]),u=(0,w.Z)(r,2),E=u[0],R=u[1],P=(0,d.useState)(null),M=(0,w.Z)(P,2),h=M[0],B=M[1],I=(0,d.useState)(!1),b=(0,w.Z)(I,2),N=b[0],q=b[1],o=(0,d.useState)(e.data),t=(0,w.Z)(o,2),x=t[0],A=t[1],l=(0,d.useState)(ue()),z=(0,w.Z)(l,1),ie=z[0],G=(0,d.useState)((s=e.commandShow)!==null&&s!==void 0?s:!0),fe=(0,w.Z)(G,1),de=fe[0],ve=(0,d.useState)((y=e.modelshow)!==null&&y!==void 0?y:!1),k=(0,w.Z)(ve,2),m=k[0],F=k[1];(0,d.useEffect)(function(){A(e.data)},[e.data]),(0,d.useEffect)(function(){var Y;F((Y=e.modelshow)!==null&&Y!==void 0?Y:!1)},[e.modelshow]);var j={page:1,size:10,whereList:[],sortList:[]},ae=function(){var g,C,i=on()().valueOf(),S={id:i,isnew:!0,editable:!0};if((g=e.model)===null||g===void 0||(C=g.fields)===null||C===void 0||C.forEach(function(p){p.field!=null&&p.field!="id"&&(S[p.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(S))){var K=[],Q=1;x!=null&&x.rows!=null&&(K=(0,Oe.Z)(x.rows),K.forEach(function(p){p.editable=!1}),Q=x.total+Q);var ne=[S].concat((0,Oe.Z)(K));q(!0),e.onAdded!=null&&e.onAdded(S),e.onDataChange!=null?e.onDataChange({rows:ne,total:Q},S,"add"):A({rows:ne,total:Q})}},U=function(){if(E.length>0){var g=[],C=[],i=(0,Oe.Z)(x.rows);E.forEach(function(K){if(K!=null){var Q=i.findIndex(function(p){return p.id==K?e.onRemoveRowing!=null&&!e.onRemoveRowing(p)?!1:(p.isnew||g.push(K),!0):!1}),ne=i.splice(Q,1);e.onRemoveed!=null&&e.onRemoveed(ne[0]),C.push(ne[0])}});var S={rows:i,total:x.total-1};e.onDataChange!=null?C.length>0&&e.onDataChange(S,C,"remove"):A(S)}};function ue(){var Y=[];return e.model!=null&&(e.model.isadd&&Y.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&Y.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&(Y=e.onGetCommands(Y)),Y}function he(Y,g){F(Y),e.onModalChange&&e.onModalChange(Y,g)}function je(){var Y;if(!e.closetoolbar)return(0,n.jsx)(sn,{iscircle:e.iscirclebutton,commandShow:de,selectcount:E.length,attrs:ie,isclosecard:!1,onClick:function(C,i){e.onCommandClicking&&e.onCommandClicking(i),C=="add"&&ae(),C=="remove"&&U(),e.onCommandClicked&&e.onCommandClicked(i)},searchShow:e.closesearch?!1:{fields:(Y=e.model)===null||Y===void 0?void 0:Y.fields,onSearch:function(C){j.whereList=[],C!=null&&((0,We.isArray)(C)?j.whereList=C:j.whereList=[C]),j.page=1,j.sortList=[],e.onSearchData!=null&&e.onSearchData(j,function(i){A(i)})},onSearchData:e.onSearchData}})}function ge(){var Y,g,C;return(0,n.jsx)(Ue,{attr:e.model,data:x,isedit:!e.closeedit,rowedit:N,selectType:(Y=e.selectType)!==null&&Y!==void 0?Y:"checkbox",isselect:(g=e.isselect)!==null&&g!==void 0?g:!0,isclosecard:(C=e.closecard)!==null&&C!==void 0?C:!0,onSelectRows:function(S,K){R(K),B(S)},onSearchData:function(S,K){if(S.foreign&&S.field){e.onSearchData&&e.onSearchData(S,K);return}j.page=S.page,j.size=S.size,j.sortList=S.sortList,e.onSearchData!=null&&e.onSearchData(j,function(Q){A(Q)})},onRowDataChangeing:function(S,K,Q){return e.onEditRowing!=null?e.onEditRowing(S,K,Q):(!S.isnew&&e.onDataChange!=null&&e.onDataChange(x,S,"edit"),!0)},onRowDoubleClick:function(S,K){K.editable!=null&&q(K.editable),e.ismodal&&m&&he(!1,K)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(S,K,Q){K.isnew&&(K[Q.rowfield]=Q.row),e.onSearchValueChange&&e.onSearchValueChange(S,K,Q)}})}function ye(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[je(),ge()]}):(0,n.jsxs)(Me.Z,{children:[je(),ge()]})}function me(){if(e.ismodal){var Y;return(0,n.jsx)(Qe,{title:(Y=e.model)===null||Y===void 0?void 0:Y.title,width:600,visible:m,onCancel:function(){he(!1,null)},onOk:function(){he(!1,h)},children:(0,n.jsx)(n.Fragment,{children:ye()})})}else return ye()}return me()},Xe=Yn,$n=un.Z.RangePicker,qn=Je.Z.Search,Ce;(function(J){J.Input="Input",J.TextArea="Input.TextArea",J.InputNumber="InputNumber",J.Switch="Switch",J.DatePicker="DatePicker",J.RangePicker="RangePicker",J.Search="Input.Search",J.Avatar="Avatar",J.Select="Select"})(Ce||(Ce={}));var dn=function(e){var s,y={maxLength:500,size:"middle",placeholder:"",disabled:(s=e.disabled)!==null&&s!==void 0?s:!1,style:{width:"100%"},texttype:Ce.Input};for(var r in y)e.options!=null&&e.options[r]!=null&&(y[r]=e.options[r]);return e.width!=null&&(y.style.width=e.width),y.texttype=_n(e,y),y},_n=function(e,s){var y=e.textType,r=e.attr;if(r!=null){if((r.type=="int"||r.type=="int32"||r.type=="int64"||r.type=="decimal")&&(y=Ce.InputNumber,s.min=r.min,r.precision!=null&&r.precision>0&&(s.precision=r.precision),s.picker=void 0),r.type=="datetime"&&(y=Ce.DatePicker),r.type=="boolean"&&(y=Ce.Switch,e.search)){y=Ce.Select;var u=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];s.options=u}if(r.comvtp!=null&&r.comvtp.isvtp){y=Ce.Select;var E=[];(0,We.isMap)(r.comvtp.items)||(r.comvtp.items=new Map(r.comvtp.items)),r.comvtp.items.forEach(function(R,P){E.push({label:R,value:P})}),s.options=E}r.foreign!=null&&r.foreign.isfkey&&(y=Ce.Search),r.length!=null&&r.length>0&&(s.maxLength=r.length),e.disabled==null&&r.disabled!=null&&(s.disabled=r.disabled),e.search&&(s.disabled=!1)}return y==null&&(y=Ce.Input),y},pn=function(e){var s=(0,d.useState)(function(){return dn(e)}),y=(0,w.Z)(s,2),r=y[0],u=y[1],E=(0,d.useState)({isshow:!1,model:void 0,data:void 0}),R=(0,w.Z)(E,2),P=R[0],M=R[1],h=(0,d.useState)({row:void 0,value:"",text:"",rowfield:""}),B=(0,w.Z)(h,2),I=B[0],b=B[1],N=(0,Pn.Z)(e.defaultValue,{value:x(e.value),onChange:function(m,F){if(console.log(m),e.onChange!=null){var j=A(m);console.log(j),e.onChange(j)}}}),q=(0,w.Z)(N,2),o=q[0],t=q[1];(0,d.useEffect)(function(){if(e.search){var k;I.field!=((k=e.attr)===null||k===void 0?void 0:k.field)&&l(null),u(dn(e))}},[e.attr]),(0,d.useEffect)(function(){var k;if(((k=e.attr)===null||k===void 0?void 0:k.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&I.row==null&&e.value!=null){var m=e.children[e.attr.foreign.oneobjectfield];l(m)}},[e.value]);function x(k){var m=e.attr;return(0,Ae.MM)(m,k)}function A(k){var m=e.attr;switch(r.texttype){case Ce.Select:return(m==null?void 0:m.type)=="string"?k.label:(0,Ae.Nz)(m,k)}return(0,Ae.Nz)(m,k)}function l(k){var m={value:"",text:"",row:void 0,rowfield:"",field:""};if(k){var F,j,ae,U,ue,he,je,ge,ye,me,Y=(F=(j=e.attr)===null||j===void 0||(ae=j.foreign)===null||ae===void 0?void 0:ae.oneobjectfieldkey)!==null&&F!==void 0?F:"",g=(U=(ue=e.attr)===null||ue===void 0||(he=ue.foreign)===null||he===void 0?void 0:he.onedisplayname)!==null&&U!==void 0?U:"";console.log(Y+"---"+g),m.row=k,m.value=k[Y],m.text=k[g],m.rowfield=(je=(ge=e.attr)===null||ge===void 0||(ye=ge.foreign)===null||ye===void 0?void 0:ye.oneobjectfield)!==null&&je!==void 0?je:"",m.field=(me=e.attr)===null||me===void 0?void 0:me.field,console.log(m)}b(m),t(m.value),e.onSearchValueChange&&e.onSearchValueChange(m)}function z(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(qn,(0,_.Z)((0,_.Z)({},r),{},{size:"middle",value:I.text,onSearch:function(m){if(e.onSearchBefore!=null){var F,j={foreign:(F=e.attr)===null||F===void 0?void 0:F.foreign,value:m,field:e.attr};e.onSearchBefore(j,function(ae,U){var ue;(ae.title==null||ae.title=="")&&(ae.title=(ue=e.attr)===null||ue===void 0?void 0:ue.title),M({isshow:!0,model:ae,data:U})})}}})),(0,n.jsx)(Xe,{ismodal:!0,modelshow:P.isshow,model:P.model,data:P.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(m,F){var j=(0,_.Z)({},P);j.isshow=m,console.log(j),M(j),l(F)},onSearchData:function(m,F){var j;m.field=e.attr,m.foreign=(j=e.attr)===null||j===void 0?void 0:j.foreign,e.onSearchData!=null&&e.onSearchData(m,F)}})]})}function ie(){var k=e.attr;return(k==null?void 0:k.type)=="string"&&(r.labelInValue=!0),(0,n.jsx)(zn.Z,(0,_.Z)((0,_.Z)({},r),{},{size:"middle",value:o,onChange:t}))}function G(){return(0,n.jsx)(Wn.Z,{size:"default",checked:o,onChange:t})}function fe(){var k=e.attr,m=void 0,F=void 0;if(console.log(k),k.datatimetype&&(k.datatimetype.istime&&(m={format:k.datatimetype.timeformat}),F=k.datatimetype.dateformat),console.log(m),e.search){var j;return(0,n.jsx)($n,{size:"middle",showTime:m,format:F,style:r.style,value:o,allowEmpty:[!0,!0],picker:(j=e.options)===null||j===void 0?void 0:j.picker,onChange:t})}else return(0,n.jsx)(un.Z,(0,_.Z)((0,_.Z)({},r),{},{format:F,showTime:m,size:"middle",picker:"date",value:o,onChange:t}))}function de(){return(0,n.jsx)(Ln.Z,(0,_.Z)((0,_.Z)({},r),{},{value:o,onChange:t}))}function ve(){switch(r.texttype){case Ce.InputNumber:return de();case Ce.DatePicker:return fe();case Ce.Switch:return G();case Ce.Select:return ie();case Ce.Search:return z()}return(0,n.jsx)(Je.Z,(0,_.Z)((0,_.Z)({},r),{},{size:"middle",value:o,onChange:function(m){t(m.target.value)}}))}return ve()},Ye=pn,et=a(76570),Nt=null,nt=function(e){var s=new Map;s.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),s.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),s.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var y=(0,d.useState)({value:"",attr:{type:"string"}}),r=(0,w.Z)(y,2),u=r[0],E=r[1],R=(0,d.useState)(""),P=(0,w.Z)(R,2),M=P[0],h=P[1],B=(0,d.useState)({type:"string"}),I=(0,w.Z)(B,2),b=I[0],N=I[1],q=(0,d.useState)({name:"*",type:"string",symbol:""}),o=(0,w.Z)(q,2),t=o[0],x=o[1],A=(0,d.useState)({picker:null}),l=(0,w.Z)(A,2),z=l[0],ie=l[1],G=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(m){if(m.issearch){var F,j=(F=m.searchsymbol)!==null&&F!==void 0?F:s.get(m.type);m.type=="datetime"&&(j=s.get(m.type)),m.type=="decimal"&&(j=s.get("int")),m.foreign&&m.foreign.isfkey&&(j=void 0),G.push({label:m.title,value:m.field,children:j})}});function fe(){return(0,n.jsx)(kn.Z,{style:{width:"140px"},options:G,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(F){var j;console.log(F);var ae=F[0],U=(j=e.fields)===null||j===void 0?void 0:j.find(function(he){return he.field==ae});if(x({name:ae,symbol:F[1],type:U==null?void 0:U.type}),t.name!=ae&&(E(Object.assign(u,{value:"",attr:U})),h(""),N(U),(U==null?void 0:U.type)=="datetime")){var ue=(0,_.Z)({},z);ue.picker=F[1],ie(ue)}}})}function de(){return(0,n.jsx)(Ye,{width:"240px",options:z,search:!0,name:t.name,attr:b,value:M,onChange:function(F){console.log(F),h(F),E({value:F,attr:u.attr})},onSearchBefore:function(F,j){e.onSearchData&&e.onSearchData(F,function(ae){j(ae.model,ae)})},onSearchData:e.onSearchData})}function ve(){return(0,n.jsx)(we.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(et.Z,{}),onClick:function(){console.log(u);var F=(0,Ae.Nz)(b,u.value);console.log(F);var j={name:t.name,symbol:t.symbol,value:F};if(j.name=="*"&&j.value=="")e.onSearch();else{if(b.type=="datetime"&&u.value!=""&&(0,We.isArray)(F)){var ae=[];return u.value[0]!=null&&(j.symbol=">=",j.value=u.value[0],ae.push(j)),u.value[1]!=null&&ae.push({name:t.name,symbol:"<=",value:u.value[1]}),e.onSearch(ae)}e.onSearch(j)}}})}function k(){return(0,n.jsxs)(Je.Z.Group,{compact:!0,children:[fe(),de(),ve()]})}return k()},tt=nt,at=function(){function J(){(0,yn.Z)(this,J),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Cn.Z)(J,[{key:"onPrint",value:function(s){}},{key:"onSet",value:function(s){}},{key:"onHelp",value:function(s){}},{key:"onAbout",value:function(s){}}]),J}(),it=function(e){var s=["add","create"],y=["remove","delete"],r=["update","edit"],u=["ImportData","import"],E=["ExportData","export"];function R(){var t,x=[],A=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(l){if(l.issplit&&l.splitname!=null)if(A.has(l.splitname)){var z=A.get(l.splitname);z==null||z.push(l)}else A.set(l.splitname,[l]);else x.push(l)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:x.map(function(l){if(A.has(l.command)){var z,ie=(0,n.jsx)(an.Z,{children:(z=A.get(l.command))===null||z===void 0?void 0:z.map(function(G,fe){return(0,n.jsx)(an.Z.Item,{children:(0,n.jsx)(Be,(0,_.Z)((0,_.Z)({},b(G)),{},{onClick:function(){return I(G.command,G)},toolbar:e}),fe)},fe)})});return(0,n.jsx)(Be,(0,_.Z)((0,_.Z)({},b(l)),{},{icon:(0,n.jsx)(Zn.Z,{}),ismenu:!0,menu:ie,onClick:function(){return I(l.command,l)},toolbar:e}))}else return(0,n.jsx)(Be,(0,_.Z)((0,_.Z)({},b(l)),{},{onClick:function(){return I(l.command,l)},toolbar:e}))})})}function P(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function M(){if(e.helpShow!=null&&e.helpShow!=!1){var t,x,A,l,z,ie,G,fe,de,ve,k=(0,d.useState)({isprint:(t=(x=e.helpShow)===null||x===void 0?void 0:x.isprint)!==null&&t!==void 0?t:!1,isset:(A=(l=e.helpShow)===null||l===void 0?void 0:l.isset)!==null&&A!==void 0?A:!1,ishelp:(z=(ie=e.helpShow)===null||ie===void 0?void 0:ie.ishelp)!==null&&z!==void 0?z:!1,isabout:(G=(fe=e.helpShow)===null||fe===void 0?void 0:fe.isabout)!==null&&G!==void 0?G:!1,wvh:(de=(ve=e.helpShow)===null||ve===void 0?void 0:ve.wvh)!==null&&de!==void 0?de:new at}),m=(0,w.Z)(k,2),F=m[0],j=m[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:h(F)})}}function h(t){var x=[];if(t.isprint){var A;x.push((0,n.jsx)(Be,{title:(A=t.wvh)===null||A===void 0?void 0:A.printText,name:"print",shape:"circle",icon:(0,n.jsx)(jn.Z,{}),onClick:I}))}if(t.isset){var l;x.push((0,n.jsx)(Be,{title:(l=t.wvh)===null||l===void 0?void 0:l.setText,name:"set",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:I}))}if(t.ishelp){var z;x.push((0,n.jsx)(Be,{title:(z=t.wvh)===null||z===void 0?void 0:z.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:I}))}if(t.isabout){var ie;x.push((0,n.jsx)(Be,{title:(ie=t.wvh)===null||ie===void 0?void 0:ie.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:I}))}return x.length>0&&x.unshift((0,n.jsx)(tn.Z,{type:"vertical"})),x.map(function(G){return G})}function B(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(tt,(0,_.Z)({},e.searchShow))}var I=function(x,A){e.onClick!=null&&e.onClick(x,A)};function b(t){var x,A={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return A.disabled=(x=P(t))!==null&&x!==void 0?x:!1,A=N(A),e.iscircle&&(A.shape="circle",A.title=A.text,A.text=""),A}function N(t){return s.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Fn.Z,{component:Dn.Z})),y.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Tn.Z,{})),r.includes(t.name)&&(t.icon=(0,n.jsx)(Rn.Z,{})),u.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),E.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(In.Z,{})),t}var q=function(x){return x.length==3?(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:10,children:(0,n.jsx)(se.Z,{justify:"start",children:x[0]})}),(0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)(se.Z,{justify:"end",children:x[1]})}),(0,n.jsx)(re.Z,{span:6,children:(0,n.jsx)(se.Z,{justify:"end",children:x[2]})})]}):x.length==2?(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(se.Z,{justify:"start",children:x[0]})}),(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(se.Z,{justify:"end",children:x[1]})})]}):x.length==1?(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(se.Z,{justify:"start",children:x[0]})})}):(0,n.jsx)(n.Fragment,{})};function o(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(re.Z,{children:B()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(re.Z,{children:R()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(re.Z,{children:M()})),e.isclosecard?q(t):(0,n.jsx)(Me.Z,{children:q(t)})}return o()},sn=it,Kt=a(9715),$e=a(22712),lt=He.Z.TabPane,ut=function(e){var s,y=$e.Z.useForm(),r=(0,w.Z)(y,1),u=r[0],E=(0,d.useState)(e.title),R=(0,w.Z)(E,2),P=R[0],M=R[1],h=(0,d.useState)((s=e.isshow)!==null&&s!==void 0?s:!1),B=(0,w.Z)(h,2),I=B[0],b=B[1],N=(0,d.useState)(j(e.attr)),q=(0,w.Z)(N,2),o=q[0],t=q[1],x=(0,d.useState)(function(){return U(e.values)}),A=(0,w.Z)(x,2),l=A[0],z=A[1],ie=(0,d.useState)(!1),G=(0,w.Z)(ie,2),fe=G[0],de=G[1],ve=(0,d.useState)(!1),k=(0,w.Z)(ve,2),m=k[0],F=k[1];(0,d.useEffect)(function(){console.log(e.values),e.values!=null?z(U(e.values)):ue()},[e.values]),(0,d.useEffect)(function(){t(j(e.attr))},[e.attr]);function j(g){var C,i;return{items:g==null||(C=g.fields)===null||C===void 0?void 0:C.filter(function(S){return S.visible&&S.isedit}),models:g==null||(i=g.childmodels)===null||i===void 0?void 0:i.filter(function(S){return S.propertyname==null&&(S.propertyname=S.name),S.visible})}}function ae(){var g,C=[];return(g=o.items)===null||g===void 0||g.forEach(function(i){var S=he(e.attr,i);e.onInitTextBox!=null&&e.onInitTextBox(i,txtprops),C.push((0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)($e.Z.Item,(0,_.Z)((0,_.Z)({},S),{},{children:(0,n.jsx)(Ye,{attr:i,onSearchBefore:function(Q,ne){e.onSearchData!=null&&e.onSearchData(Q,function(p){ne(p.model,p)})},onSearchData:function(Q,ne){e.onSearchData&&e.onSearchData(Q,ne)},children:l})}),i.field)}))}),e.onInitFormed!=null&&(u.setFieldDisabled=function(i,S){var K;(K=o.items)===null||K===void 0||K.forEach(function(Q){var ne;((ne=Q.field)===null||ne===void 0?void 0:ne.toLocaleLowerCase())==i.toLocaleLowerCase()&&(Q.disabled=S)}),t(o)},u.setTitle=function(i){M(i)},u.show=function(){b(!0)},u.hide=function(){b(!1)},u.setValues=function(i){z(U(i))},u.clear=function(){ue()},u.setHideSearch=function(i){F(i)},u.setHideToolbar=function(i){de(i)},e.onInitFormed(u)),C}function U(g){var C;return g==null&&(g={}),u.setFieldsValue(g),o.models!=null&&((C=o.models)===null||C===void 0?void 0:C.length)>0&&(console.log(o),o.models.forEach(function(i){g[i.propertyname]?g[i.propertyname].total=g[i.propertyname].length:(g[i.propertyname]=[],g[i.propertyname].total=0),i.removeRows=[]})),g}function ue(){var g;u.resetFields();var C={};(g=o.models)===null||g===void 0||g.forEach(function(i){C[i.propertyname]||(C[i.propertyname]=[],C[i.propertyname].total=0)}),z(C)}function he(g,C){var i={};i.name=C.field,i.label=C.title;var S=je(C);return C.disabled||(i.rules=S),e.onInitItem!=null&&e.onInitItem(C,i),i}function je(g){var C,i=[];if(g.required&&i.push({required:g.required}),(C=g.length)!==null&&C!==void 0?C:0>0){var S;i.push({max:(S=g.length)!==null&&S!==void 0?S:500,type:(0,Ae.mc)(g.type)})}return e.onFieldRules!=null&&(i=e.onFieldRules(g,i)),i}var ge=function(C){var i,S=Object.assign({},l);for(var K in C)S[K]=C[K];return o.models!=null&&((i=o.models)===null||i===void 0?void 0:i.length)>0&&o.models.forEach(function(Q){var ne;S[Q.propertyname]!=null&&S[Q.propertyname].forEach(function(p){p.isnew?(p.id=null,p.modelState=1):p.modelState=2}),(ne=Q.removeRows)===null||ne===void 0||ne.forEach(function(p){p.modelState=3,S[Q.propertyname].push(p)})}),S};function ye(){return(0,n.jsx)($e.Z,{labelAlign:"left",form:u,onFinish:function(C){var i=ge(C);console.log(i),u.onFinish!=null&&u.onFinish(i),e.onFinish!=null&&e.onFinish(i)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(se.Z,{gutter:24,children:ae()})})}function me(){var g;if(o.models!=null&&((g=o.models)===null||g===void 0?void 0:g.length)>0){var C;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(C=o.models)===null||C===void 0?void 0:C.map(function(i,S){var K;return(0,n.jsx)(lt,{tab:i.title,children:(0,n.jsx)(Xe,{model:i,data:{rows:l[i.propertyname],total:(K=l[i.propertyname])===null||K===void 0?void 0:K.total},iscirclebutton:!0,closetoolbar:fe,closesearch:m,closecard:!0,onSearchData:function(ne){e.onSearchData!=null&&(ne.parent=l,ne.childmodel=i,e.onSearchData(ne,function(p){var Ee=Object.assign({},l);Ee[i.propertyname]=p.rows,Ee[i.propertyname].total=p.total,z(Ee)}))},onDataChange:function(ne,p,Ee){console.log(ne,p);var Fe=Object.assign({},l);Fe[i.propertyname]=ne.rows,Fe[i.propertyname].total=ne.total,console.log(Fe),Ee=="remove"&&p.forEach(function(be){be&&!be.isnew&&i.removeRows.push(be)}),z(Fe)}})},S)})})}return(0,n.jsx)(n.Fragment,{})}function Y(){return e.ismodal?(0,n.jsxs)(Qe,{title:P,width:1100,visible:I,onCancel:function(){return b(!1)},onOk:function(){u.submit()},children:[(0,n.jsx)(Me.Z,{children:ye()}),me()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Me.Z,{title:P,children:ye()}),me()]})}return Y()},fn=ut,cn=a(38535),ot=a(73218),Ht=a(34669),rt=a(82833),Gt=a(17462),qe=a(76772),_e=a(3182),vn=a(91220),dt=a(94043),Ve=a.n(dt),st=a(43347),Jt=a(35556),hn=a(97880),ft=hn.Z.Step,ct=function(e){var s,y,r=(0,d.useState)((s=e.currentStep)!==null&&s!==void 0?s:0),u=(0,w.Z)(r,2),E=u[0],R=u[1],P=(0,d.useState)((y=e.isShow)!==null&&y!==void 0?y:!1),M=(0,w.Z)(P,2),h=M[0],B=M[1];(0,d.useEffect)(function(){var o;B((o=e.isShow)!==null&&o!==void 0?o:!1)},[e.isShow]),(0,d.useEffect)(function(){var o;if(R((o=e.currentStep)!==null&&o!==void 0?o:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function I(o){return e.onCurrentStepComponent?e.onCurrentStepComponent(o):(0,n.jsx)(fn,{attr:e.attr,ismodal:!1})}function b(){var o;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(hn.Z,{current:E,onChange:function(x){R(x),e.onChange&&e.onChange(x)},children:(o=e.stepItem)===null||o===void 0?void 0:o.map(function(t){return(0,n.jsx)(ft,(0,_.Z)({},t))})}),(0,n.jsx)(tn.Z,{}),I(E)]})}function N(o){B(o),e.onShowChange&&e.onShowChange(o)}function q(){if(e.isModal){var o={onOk:function(){N(!1)},onCancel:function(){N(!1)}};return e.closeOk&&(o.footer=!1),(0,n.jsx)(Qe,(0,_.Z)((0,_.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:h},o),{},{children:b()}))}return e.isCard?(0,n.jsx)(Me.Z,{title:e.title,bordered:!1,children:b()}):b()}return q()},vt=ct,pe=a(54701),ht=a(58602),mn=a(32059);function gn(J,e,s){var y=J.map(function(M,h){return Object.assign({},{key:M.key,title:M.title,position:String.fromCharCode(65+h)+1})}).reduce(function(M,h){return Object.assign({},M,(0,mn.Z)({},h.position,{key:h.key,v:h.title}))},{}),r=e.map(function(M,h){return J.map(function(B,I){return Object.assign({},{content:M[B.key],position:String.fromCharCode(65+I)+(h+2)})})}).reduce(function(M,h){return M.concat(h)}).reduce(function(M,h){return Object.assign({},M,(0,mn.Z)({},h.position,{v:h.content}))},{}),u=Object.assign({},y,r),E=Object.keys(u),R="".concat(E[0],":").concat(E[E.length-1]),P={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},u,{"!ref":R,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};pe.NC(P,s)}function mt(J,e,s,y,r){return en.apply(this,arguments)}function en(){return en=(0,_e.Z)(Ve().mark(function J(e,s,y,r,u){var E,R;return Ve().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:s>0&&(E=[],e.fields.forEach(function(h){h.visible&&E.push({title:h.title,key:h.field,item:h})}),R=Object.assign({},y),R.page=1,R.size=s,R.size>0&&r(R).then(function(h){if(h!=null&&h.success&&h.data&&h.data.rows){var B=h.data.rows;for(var I in B)for(var b in E){var N=B[I][E[b].key],q=rn(N,E[b].item,B[I]);B[I][E[b].key]=q!=null?q:""}gn(E,B,u)}}));case 1:case"end":return M.stop()}},J)})),en.apply(this,arguments)}var gt=function(e){var s,y=(0,d.useState)(0),r=(0,w.Z)(y,2),u=r[0],E=r[1],R=(0,d.useState)((s=e.isShow)!==null&&s!==void 0?s:!1),P=(0,w.Z)(R,2),M=P[0],h=P[1],B=(0,d.useState)(0),I=(0,w.Z)(B,2),b=I[0],N=I[1],q=(0,d.useState)({model:void 0,data:{rows:[],total:0}}),o=(0,w.Z)(q,2),t=o[0],x=o[1],A=(0,d.useState)(K(e.attr)),l=(0,w.Z)(A,2),z=l[0],ie=l[1],G=(0,d.useState)({message:"",description:"",type:"success",count:0}),fe=(0,w.Z)(G,2),de=fe[0],ve=fe[1],k=(0,d.useState)(null),m=(0,w.Z)(k,2),F=m[0],j=m[1],ae=(0,d.useState)({model:null,rows:[],total:0}),U=(0,w.Z)(ae,2),ue=U[0],he=U[1],je=(0,d.useState)(!0),ge=(0,w.Z)(je,2),ye=ge[0],me=ge[1],Y=(0,d.useState)(void 0),g=(0,w.Z)(Y,2),C=g[0],i=g[1];function S(){E(0),N(0),x({model:void 0,data:{rows:[],total:0}}),ve({message:"",description:"",type:"success",count:0}),j(null),he({model:null,rows:[],total:0}),me(!0),i(void 0)}function K(D){var v;return(v=D.fields)===null||v===void 0?void 0:v.filter(function(Z){return Z.visible&&!Z.disabled})}(0,d.useEffect)(function(){h(e.isShow)},[e.isShow]),(0,d.useEffect)(function(){ie(K(e.attr))},[e.attr]);var Q=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(Z){setTimeout(function(){Z(!0)},v)})};function ne(){var D={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},v={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},Z={title:"\u5BFC\u5165\u6570\u636E"},L=[D,v,Z];return L}function p(D){var v={fields:[]};if(D.length>0)for(var Z in D[0]){var L;(L=v.fields)===null||L===void 0||L.push({field:Z,title:Z,type:"string",visible:!0,sorter:!1})}return v}function Ee(D){var v=D.rowcount,Z=D.data;if(v>0){N(v);for(var L=p(Z),H=[],O=0;O<6;O++)H.push(Z[O]);x({model:L,data:{rows:H,total:5}})}}function Fe(){var D,v,Z=new Map,L=new Map;(D=t.model)===null||D===void 0||(v=D.fields)===null||v===void 0||v.forEach(function(ee,W){Z.set(W,ee.title)});var H=[];z.forEach(function(ee,W){var ce,Se;L.set(W,ee.title);var $=ee.foreign&&ee.foreign.isfkey?"Name":"",xe=(ce=t.model)===null||ce===void 0||(Se=ce.fields)===null||Se===void 0?void 0:Se.find(function(Ge){return Ge.field==ee.field||Ge.field==ee.title}),Te=void 0;if(xe==null||xe==null){var Ie;W<((Ie=t.model)===null||Ie===void 0?void 0:Ie.fields.length)&&(Te=W),H.push({id:W,source:Te,target:W,defaultValue:"",foreignMap:$})}else{var Re=(0,vn.Z)(Z.entries()),ke;try{for(Re.s();!(ke=Re.n()).done;){var Ne=ke.value;if(xe.title==Ne[1]||xe.field==Ne[1]){Te=Ne[0];break}}}catch(Ge){Re.e(Ge)}finally{Re.f()}H.push({id:W,source:Te,target:W,defaultValue:"",foreignMap:$})}});var O=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:Z},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:L},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];he({model:{fields:O,isadd:!1,isedit:!0,isremove:!1},rows:H,total:H.length})}function be(D){var v={};for(var Z in ue.rows){var L,H,O=ue.rows[Z],ee=(L=t.model)===null||L===void 0?void 0:L.fields[O.source];if(!((ee==null||ee==null)&&O.defaultValue=="")){var W=z[O.target];if(!(W==null||W==null)){if(O.defaultValue!=null&&O.defaultValue!=""){var ce;v[W.field]=O.defaultValue,(ce=W.foreign)!==null&&ce!==void 0&&ce.isfkey&&(v[W.field]=O[W.field]);continue}var Se=ee.field,$=D[Se];if(W.required&&($==null||$==null||$=="")){V(v,"\u5BFC\u5165\u6570\u636E".concat(ee.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(W.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!($==null||$==null||$=="")){if(W!=null&&W.comvtp&&W.comvtp.isvtp){var xe=(0,vn.Z)(W.comvtp.items.entries()),Te;try{for(xe.s();!(Te=xe.n()).done;){var Ie=Te.value;if($==Ie[1]){$=Ie[0];break}}}catch(ke){xe.e(ke)}finally{xe.f()}}if((H=W.foreign)!==null&&H!==void 0&&H.isfkey&&C!=null&&C.has(W.field)){var Re=C.get(W.field);$=Re[$]}v[W.field]=$}}}}return v}function ze(D){var v=new Map;return ue.rows.forEach(function(Z){var L,H=(L=t.model)===null||L===void 0?void 0:L.fields[Z.source];if(H){var O,ee=z[Z.target],W=Z.foreignMap==""?"Name":Z.foreignMap;if((O=ee.foreign)!==null&&O!==void 0&&O.isfkey&&Z.defaultValue==""){v.has(ee.field)||v.set(ee.field,new Map);var ce=v.get(ee.field);for(var Se in D){var $=D[Se],xe=$[H.field];xe!=null&&xe!=""&&!ce.has(xe)&&(ce==null||ce.set(xe,W))}}}}),v}function Pe(D){var v=ze(D);if(v.size==0){me(!1),ve({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var Z="";v.forEach(function(L,H){var O=z.find(function($){return $.field==H}),ee=z.find(function($){return $.type=="string"}).searchsymbol.find(function($){return $.label=="\u7B49\u4E8E"}).value,W=[],ce="";L.forEach(function($,xe){ce=$.toLowerCase(),W.push({name:$,symbol:ee,value:xe,relation:"||"})});var Se={field:O,foreign:O.foreign,whereList:W};e.onSearchData&&(Q(200),e.onSearchData(Se,function($){if($&&$.rows.length>0)if($.rows.length==L.size){console.log(L);for(var xe in $.rows){var Te=$.rows[xe][ce];L.has(Te)&&(L[Te]=$.rows[xe].id)}i(v),me(!1),console.log(de.description),ve({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(O==null?void 0:O.title,"\u6570\u636E").concat($.total,`\u9879\u3002
`),type:"info",count:0})}else L.forEach(function(Ie,Re){var ke=$.rows.find(function(Ne){return Ne[ce]==Re});Z+="".concat(O==null?void 0:O.title,"\u4E2D\u672A\u627E\u5230").concat(ce,"\u4E3A").concat(Re,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),ke==null&&V($.rows,Z,0)});else Z+="".concat(O==null?void 0:O.title,"\u4E2D\u672A\u627E\u5230").concat(ce,"\u4E3A").concat(W[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),V($.rows,Z,0)}))})}function le(D){if(F==null||F.data==null){Le.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var v=F.data;if(ue.rows.length<=0){Le.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!ye){if(D==v.length){ve({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:D}),me(!0);return}var Z=be(v[D]);Z!=null&&f(Z,function(L,H){X(Z,L,H,D)})}}function X(D,v,Z,L){v?(L++,ve({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(D),type:"success",count:L}),Q(200),le(L)):V(D,Z,L)}function f(D,v){return c.apply(this,arguments)}function c(){return c=(0,_e.Z)(Ve().mark(function D(v,Z){return Ve().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:e.onAdd&&e.onAdd("add",v).then(function(){var O=(0,_e.Z)(Ve().mark(function ee(W){return Ve().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(console.log(W),W.ok!=null&&W.ok==!1&&(me(!0),Z(!1,W.statusText)),!(W!=null&&W.success)){Se.next=8;break}return Se.next=5,Q(200);case 5:Z(!0),Se.next=10;break;case 8:me(!0),Z(!1,W.message);case 10:case"end":return Se.stop()}},ee)}));return function(ee){return O.apply(this,arguments)}}());case 1:case"end":return H.stop()}},D)})),c.apply(this,arguments)}function V(D,v,Z){var L={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(D),description:v,type:"error",count:Z,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(we.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var O=e.form;O.clear(),O.setHideSearch(!0),O.setTitle(e.title),O.show(),O.setValues(D),O.onFinish=function(ee){console.log(ee),O.hide(),f(ee,function(W,ce){X(ee,W,ce,Z)})}}},children:"\u4FEE\u6539"})})};ve(L)}function T(){var D={name:"file",accept:".xlsx, .xls",onChange:function(Z){console.log(Z);var L=new FileReader;L.onload=function(H){try{var O=H.target.result,ee=pe.ij(O,{type:"binary"}),W=[];for(var ce in ee.Sheets)if(ee.Sheets.hasOwnProperty(ce)){W=pe.P6.sheet_to_json(ee.Sheets[ce]);break}var Se={data:W,rowcount:W.length};j(Se),Ee(Se)}catch($){nn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log($)}},L.readAsBinaryString(Z.file.originFileObj)}};return(0,n.jsxs)(Me.Z,{children:[(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(b,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(we.Z,{size:"small",type:"primary",onClick:function(){var Z=[],L={};z.forEach(function(H){Z.push({title:H.title,key:H.field}),L[H.field]=H.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),gn(Z,[L],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsxs)(ht.default,(0,_.Z)((0,_.Z)({},D),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(st.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Ue,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(se.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,push:11,children:(0,n.jsx)(we.Z,{type:"primary",disabled:b<1,onClick:function(){E(u+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function te(){var D={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:ue.model,data:{rows:ue.rows,total:ue.total},onDataChange:function(Z){he((0,_.Z)((0,_.Z)({},ue),{},{rows:Z.rows}))},onGetFieldToEdit:function(Z,L){if(Z.field=="defaultValue"){var H=L.target,O=z[H];return O}return Z},onEditRowing:function(Z,L,H){return H!=null&&(Z.defaultValue=String(H)),!0},onSearchValueChange:function(Z,L,H){H.text!=null&&(L.defaultValue=H.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Xe,(0,_.Z)({},D))})}),(0,n.jsxs)(se.Z,{gutter:[16,16],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(we.Z,{type:"primary",onClick:function(){E(u+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(we.Z,{onClick:function(){E(u-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function oe(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(b,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(de.count,"\u884C"),type:"info"})})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(rt.Z,{percent:parseInt((de.count/b*100).toString()),status:"active"})})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(qe.Z,(0,_.Z)({},de))})}),(0,n.jsxs)(se.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(we.Z,{type:"primary",disabled:ye,onClick:function(){le(de.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(we.Z,{onClick:function(){E(u-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function Ze(D){h(D),e.onShowChange&&e.onShowChange(D),D||S()}function De(){return(0,n.jsx)(vt,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:M,stepItem:ne(),currentStep:u,onChange:function(v){if(v==1&&Fe(),v==2&&F&&F.data){var Z=F.data;Pe(Z)}E(v)},onCurrentStepComponent:function(v){return v==0?T():v==1?te():v==2?oe():(0,n.jsx)(n.Fragment,{})},onShowChange:function(v){Ze(v)}})}return De()},St=gt,xt=function(e){var s=(0,d.useState)(!1),y=(0,w.Z)(s,2),r=y[0],u=y[1],E=(0,d.useState)(null),R=(0,w.Z)(E,2),P=R[0],M=R[1],h=(0,d.useState)(0),B=(0,w.Z)(h,2),I=B[0],b=B[1],N=(0,d.useState)([]),q=(0,w.Z)(N,2),o=q[0],t=q[1],x=(0,d.useState)(void 0),A=(0,w.Z)(x,2),l=A[0],z=A[1],ie=(0,d.useState)({rows:[],total:0}),G=(0,w.Z)(ie,2),fe=G[0],de=G[1],ve=(0,d.useState)(!1),k=(0,w.Z)(ve,2),m=k[0],F=k[1],j=(0,d.useState)(null),ae=(0,w.Z)(j,2),U=ae[0],ue=ae[1],he=(0,d.useState)({page:1,size:10,whereList:[],sortList:[]}),je=(0,w.Z)(he,2),ge=je[0],ye=je[1],me=(0,d.useState)(1),Y=(0,w.Z)(me,2),g=Y[0],C=Y[1];if((0,d.useEffect)(function(){z(void 0),M(null),b(0),t([]),de({rows:[],total:0}),i()},[e.controller]),l==null)return(0,n.jsx)(n.Fragment,{});function i(){if(console.log("waypage.init"),console.log(e),!e.init){var le,X=(le=e.namespace)!==null&&le!==void 0?le:e.controller;console.log(X+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(f){f!=null&&(f.success?(z(f.data),f.data.autoload&&(u(!0),S({},function(c){de(c)}))):ne(f.message.message))})}function S(le,X){if(le.foreign==null&&le.childmodel==null&&I>0){b(0);var f=fe.rows.find(function(c){return c.id==o[0]});f!=null&&(t(o),b(o.length),M(f))}e.search(le).then(function(c){c!=null&&(u(!1),c!=null&&c.success?(c.data.rows==null&&(c.data.rows=[]),X?X(c.data):de(c.data)):ne(c.message.message))})}var K=function(X){var f=null;X.isselectrow&&(f=P),X.selectmultiple&&(f=o),Q(X,f)},Q=function(X,f){e.execute(X.command,f).then(function(c){console.log(c),c!=null&&c.success?(nn.default.success(X.name+"\u5B8C\u6210"),(l==null?void 0:l.viewtype)!="form"&&(U&&U.hide(),tempSearchItem!=null&&tempCallback!=null?(console.log("tempSearchItem"),S(tempSearchItem,tempCallback)):(console.log("2"),S(ge,function(V){de(V)})))):ne(c.message.message)})};function ne(le){Le.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(ot.Z,{}),content:(0,n.jsx)("div",{children:le})})}function p(le,X){U!=null&&U.clear(),U.setHideSearch(!0),U.setTitle((l==null?void 0:l.title)+"-"+le.name),U.show(),X&&(U.setValues(X),U.setHideSearch(!1)),U.onFinish=function(f){console.log(f),Q(le,f)}}function Ee(le){var X,f=le?{fields:l==null||(X=l.fields)===null||X===void 0?void 0:X.filter(function(c){var V;return(V=c.issearch)!==null&&V!==void 0?V:!0}),onSearch:function(V){u(!0);var T={page:1,whereList:[]};V!=null&&((0,We.isArray)(V)?T.whereList=V:T.whereList=[V]),ye(T),C(1),S(T,function(te){de(te)})},onSearchData:S}:!1;return(0,n.jsx)(sn,{attrs:l==null?void 0:l.commands,isselectrow:!0,selectcount:I,commandShow:!0,isshow:!le,onClick:function(V,T){if(console.log(V),V=="ImportData"||V=="importdata"){F(!0);return}if(V=="ExportData"||V=="exportdata"){mt(l,fe.total,ge,e.search,e.title+".xlsx");return}if(V=="add"){if((l==null?void 0:l.viewtype)=="form"){U.onFinish=function(te){console.log(te),Q(T,te)},U.submit();return}p(T);return}if(V=="edit"){p(T,P);return}K(T)},searchShow:f})}function Fe(){return(0,n.jsx)(Ue,{attr:l,data:fe,isselect:!0,isexpandable:!0,loading:r,current:g,onSelectRows:function(X,f){console.log(X),console.log(f),t(f),b(f.length),M(X)},onSearchData:function(X,f){if(X.parent&&X.childmodel){S(X,function(c){f(c)});return}u(!0),C(X.page),X.whereList=ge.whereList,ye(X),S(X,function(c){de(c)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(X,f){var c,V=l==null||(c=l.commands)===null||c===void 0?void 0:c.find(function(T){return T.command=="edit"&&T.visible});V!=null&&p(V,f)}})}function be(le){return(0,n.jsx)(fn,{attr:l,title:e.title,ismodal:le,onInitFormed:function(f){ue(f)},onSearchData:S})}function ze(){return(l==null?void 0:l.viewtype)=="form"?Pe():(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ee(!0)})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Fe()})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:be(!0)})}),(0,n.jsx)(St,{title:e.title,isShow:m,attr:l,onAdd:e.execute,form:U,onShowChange:function(X){F(X),X||S(ge)},onSearchData:S})]})}function Pe(){return(0,n.jsxs)(cn.Oc,{title:e.title,children:[(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ee(!1)})}),(0,n.jsx)(se.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:be(!1)})})]})}return ze()};function yt(J,e){var s=e.controller;e.namespace!=null&&(s=e.namespace);var y=function(R){return{type:s+"/init",payload:R}},r=function(R){return{type:s+"/search",payload:R}},u=function(R){return{type:s+"/execute",payload:R}};return{dispatch:J,init:function(){return J(y({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(R){var P=e.namespace+"/"+e.service+"/"+e.controller;return J(r({c:P,item:R,s:e.service}))},execute:function(R,P){var M=e.namespace+"/"+e.service+"/"+e.controller;return J(u({c:M,command:R,item:P,s:e.service}))}}}var Ct=(0,xn.$j)(function(){},yt)(xt)},20067:function(){}}]);
