(self["webpackChunkant_design_pro"]=self["webpackChunkant_design_pro"]||[]).push([[519],{66721:function(e,n,t){"use strict";t.d(n,{Z:function(){return Je}});t(13062);var o=t(71230),i=(t(89032),t(15746)),l=(t(71194),t(29759)),r=(t(34792),t(48086)),a=t(2824),s=t(67294),u=t(28216),d=(t(58024),t(91894)),c=(t(48736),t(27049)),v=(t(49111),t(19650)),f=(t(30887),t(18515)),h=t(11849),p=t(69610),m=t(54941),g=t(57254),x=t(7945),w=t(24616),Z=t(63270),y=t(3050),S=t(16165),j=t(49101),b=t(73171),C=t(8212),k=t(65233),E=t(20924),D=t(25592),R=(t(59250),t(13013)),T=(t(22385),t(94199)),F=(t(57663),t(71577)),M=t(57119),I=t(85893),L=function(e){var n,t,o,i,r,u,d,c,v,f,p,m={key:null!==(n=e.key)&&void 0!==n?n:e.name,name:null!==(t=e.name)&&void 0!==t?t:"",title:null!==(o=e.title)&&void 0!==o?o:"",text:e.text,danger:null!==(i=e.danger)&&void 0!==i&&i,block:null!==(r=e.block)&&void 0!==r&&r,type:null!==(u=e.type)&&void 0!==u?u:"default",target:e.target,size:null!==(d=e.size)&&void 0!==d?d:"default",shape:null!==(c=e.shape)&&void 0!==c?c:"",icon:null!==(v=e.icon)&&void 0!==v?v:"",ghost:null!==(f=e.ghost)&&void 0!==f&&f,disabled:null!==(p=e.disabled)&&void 0!==p&&p},g=(0,s.useState)(!1),x=(0,a.Z)(g,2),w=x[0],Z=x[1];function y(){return void 0!=e.toolbar&&void 0!=e.name&&void 0!=e.toolbar.attrs&&e.toolbar.attrs.length>0?e.toolbar.attrs.find((function(n){return n.command==e.name})):null}var S=function(){if(void 0!=e.onClick)try{Z({delay:100});var n=y();null!=n&&n.isalert?l.Z.confirm({title:"\u60a8\u786e\u8ba4\u8981\u8fdb\u884c".concat(m.text,"\u5417?"),icon:(0,I.jsx)(M.Z,{}),onOk:function(){e.onClick(m)}}):e.onClick(m)}finally{Z(!1)}};function j(){return e.ismenu?(0,I.jsx)(R.Z,{overlay:e.menu,children:(0,I.jsx)(T.Z,{title:m.title,children:(0,I.jsx)(F.Z,(0,h.Z)((0,h.Z)({},m),{},{onClick:S,loading:w,children:m.text}))})}):(0,I.jsx)(T.Z,{title:m.title,children:(0,I.jsx)(F.Z,(0,h.Z)((0,h.Z)({},m),{},{onClick:S,loading:w,children:m.text}))})}return j()},O=L,z=(t(47673),t(55019)),V=(t(36877),t(18480)),A=(t(77883),t(49747)),P=(t(77576),t(12028)),N=(t(43358),t(34041)),B=(t(53400),t(45433)),G=t(76010),H=t(96486),_=t(86582),q=(t(95936),t(43)),K=(t(18106),t(63885)),J=t(30381),W=t.n(J),$=t(75308);function Q(e,n,t){var o,i,l=(0,$.MM)(n,e);if(null!==(o=n.comvtp)&&void 0!==o&&o.isvtp&&"string"!=n.type){var r=new Map(n.comvtp.items);l=r.get(l)}if(null!==(i=n.foreign)&&void 0!==i&&i.isfkey){var a=n.foreign.oneobjectfield,s=n.foreign.onedisplayname;void 0!=t[a]&&(l=t[a][s])}if("boolean"==n.type&&(l=l?"\u662f":"\u5426"),"datetime"==n.type){var u,d;if(""==l||null==l)return l;var c,v,f=null===(u=n.datatimetype)||void 0===u?void 0:u.dateformat;if(null!==(d=n.datatimetype)&&void 0!==d&&d.istime)f=(null===(c=n.datatimetype)||void 0===c?void 0:c.dateformat)+" "+(null===(v=n.datatimetype)||void 0===v?void 0:v.timeformat);l=W()(l).format(f)}return l}var U,X=function(e,n){var t,o,i,l=e.attr,r=null!==(t=null===l||void 0===l||null===(o=l.fields)||void 0===o||null===(i=o.find((function(e){return e.field==n})))||void 0===i?void 0:i.porpfield)&&void 0!==t?t:n;return r},Y=function(e,n,t,o){var i,l=e.attr,r=[];function a(n,t,o){var i=Q(n,t,o);return void 0!=e.onFieldRender?e.onFieldRender(t,i,o):(0,I.jsx)(T.Z,{title:i,children:i})}var s=function(n,i){return e.onColumnToEdit?e.onColumnToEdit(n,i):(e.onGetFieldToEdit&&(n=e.onGetFieldToEdit(n,i)),o(i),(0,I.jsx)(he,{attr:n,value:t[n.field],onChange:function(l){if(void 0==e.onRowDataChangeing||e.onRowDataChangeing(i,n.field,l)){console.log(l);var r=Object.assign({},t);i[n.field]=l,r[n.field]=l,o(r)}},onSearchValueChange:function(t){e.onSearchValueChange&&e.onSearchValueChange(n,i,t)},onSearchBefore:function(n,t){e.onSearchData&&e.onSearchData(n,(function(e){t(e.model,e)}))},onSearchData:e.onSearchData}))};return null===l||void 0===l||null===(i=l.fields)||void 0===i||i.filter((function(e){return e.visible})).forEach((function(e){var t;r.push({dataIndex:e.field,title:e.title,sorter:null===(t=e.sorter)||void 0===t||t,ellipsis:!0,render:function(t,o){if(void 0!=o)return n&&o.editable&&(void 0==e.isedit||1==e.isedit)?s(e,o):a(t,e,o)}})})),r},ee=K.Z.TabPane,ne=function e(n){var t,o,i,l,r,u=(0,s.useState)(null!==(t=n.loading)&&void 0!==t&&t),c=(0,a.Z)(u,2),v=c[0],f=c[1],h=(0,s.useState)(null!==(o=n.data)&&void 0!==o?o:{rows:[],total:0}),p=(0,a.Z)(h,2),m=p[0],g=p[1],x=(0,s.useState)(null!==(i=n.rowedit)&&void 0!==i&&i),w=(0,a.Z)(x,2),Z=w[0],y=w[1],S=(0,s.useState)(null!==(l=n.current)&&void 0!==l?l:1),j=(0,a.Z)(S,2),b=j[0],C=j[1],k=(0,s.useState)(10),E=(0,a.Z)(k,2),D=E[0],R=E[1],T=(0,s.useState)([]),F=(0,a.Z)(T,2),M=F[0],L=F[1],O=(0,s.useState)(null!==(r=n.selectType)&&void 0!==r?r:"radio"),z=(0,a.Z)(O,2),V=z[0],A=(z[1],(0,s.useState)()),P=(0,a.Z)(A,2),N=P[0],B=(P[1],(0,s.useState)({})),G=(0,a.Z)(B,2),J=G[0],W=G[1];(0,s.useEffect)((function(){var e;g(null!==(e=n.data)&&void 0!==e?e:{rows:[],total:0})}),[n.data]),(0,s.useEffect)((function(){var e;y(null!==(e=n.rowedit)&&void 0!==e&&e)}),[n.rowedit]),(0,s.useEffect)((function(){var e;f(null!==(e=n.loading)&&void 0!==e&&e)}),[n.loading]),(0,s.useEffect)((function(){var e;C(null!==(e=n.current)&&void 0!==e?e:1)}),[n.current]);var $=function(e,t,o){var i,l,r=function(e){f(!1),g(e)},a=function(e){if(void 0==e.column)return"";var t={name:X(n,e.field),isdesc:!1};return"descend"==e.order&&(t.isdesc=!0),t};f(!0),C(null!==(i=e.current)&&void 0!==i?i:1),R(null!==(l=e.pageSize)&&void 0!==l?l:10);try{var s,u,d={page:null!==(s=e.current)&&void 0!==s?s:1,size:null!==(u=e.pageSize)&&void 0!==u?u:10,sortList:[]};if(void 0!=o)if((0,H.isArray)(o))o.forEach((function(e){var n=a(e);""!=n&&e.sortList.push(n)}));else{var c=a(o);""!=c&&d.sortList.push(c)}void 0!=n.onSearchData&&n.onSearchData(d,r)}finally{f(!1)}},Q=function(e,t){var o=M.length<=e.length;if(L(e),void 0!=n.onSelectRows)if(e.length>0){var i=t[t.length-1];o||(i=null,1==e.length&&(i=m.rows.find((function(n){return n.id==e[0]})))),n.onSelectRows(i,e,o)}else n.onSelectRows(null,e,!1)},U=function(){if(n.isselect)return{selectedRowKeys:M,fixed:!0,type:V,columnTitle:N,hideSelectAll:!1,columnWidth:"32px",onChange:Q}};function ne(e){if(n.isedit){e.editable=!Z;var t=(0,_.Z)(m.rows);t.forEach((function(n){n.id==e.id?n.editable=!Z:n.editable&&(n.editable=!1)})),y(!Z)}}function te(){var e;if(n.isexpandable&&void 0!=(null===n||void 0===n||null===(e=n.attr)||void 0===e?void 0:e.childmodels)&&n.attr.childmodels.length>0)return void 0==n.onExpandable?{onExpand:function(e,t){var o;if(e&&(re(t,"id"),void 0!=(null===n||void 0===n||null===(o=n.attr)||void 0===o?void 0:o.childmodels)&&n.attr.childmodels.length>0)){var i,l=null===n||void 0===n||null===(i=n.attr)||void 0===i?void 0:i.childmodels[0];if(t[l.propertyname]||(t[l.propertyname]=[]),t[l.propertyname].total=t[l.propertyname].length,0==t[l.propertyname].total){var r={page:1,size:10};oe(r,l,t)}}},expandedRowRender:le}:n.onExpandable(n.attr)}function oe(e,t,o){e.childmodel=t,e.parent=o,void 0!=n.onSearchData&&n.onSearchData(e,(function(e){var n=(0,_.Z)(m.rows),i=n.findIndex((function(e){return e.id==o.id}));n[i][t.propertyname]=e.rows,n[i][t.propertyname].total1=e.total,g({rows:n,total:m.total})}))}var ie=function(t,o){if(n.onExpandedRowTabPane){var i=n.onExpandedRowTabPane(t,o);if(void 0!=i)return i}return(0,I.jsx)(e,{isselect:!1,isedit:!1,isclosecard:!0,attr:t,data:{rows:o[t.propertyname],total:o[t.propertyname].total1},onSearchData:function(e){oe(e,t,o)}},"id")},le=function(e){var t;if(void 0!=(null===n||void 0===n||null===(t=n.attr)||void 0===t?void 0:t.childmodels)&&n.attr.childmodels.length>0)return(0,I.jsx)(K.Z,{defaultActiveKey:"0",onChange:function(t){var o=n.attr.childmodels[Number(t)];oe({},o,e)},children:n.attr.childmodels.map((function(n,t){return e[n.propertyname]||(e[n.propertyname]=[]),e[n.propertyname].total=e[n.propertyname].length,(0,I.jsx)(ee,{tab:n.title,children:ie(n,e)},t)}))})},re=function(e,n){try{var t,o;if("radio"==(null===(t=U())||void 0===t?void 0:t.type)&&Q([e[n]],[e]),"checkbox"==(null===(o=U())||void 0===o?void 0:o.type)){var i=e[n],l=[];M.includes(i)?l=M.filter((function(e){return e!=i})):(l=(0,_.Z)(M),l.push(i)),Q(l,[e])}}catch(r){console.log(r)}};function ae(){var e=Y(n,Z,J,W),t="id";return(0,I.jsx)(q.Z,{bordered:!0,rowKey:t,columns:e,rowSelection:U(),scroll:{x:150*e.length},dataSource:m.rows,pagination:{current:b,pageSize:D,total:m.total,hideOnSinglePage:!0,showTotal:function(e){return"\u603b ".concat(e," \u884c")}},loading:v,expandable:te(),onChange:$,onRow:function(e){return{onClick:function(o){o.stopPropagation();try{var i,l;if("radio"==(null===(i=U())||void 0===i?void 0:i.type)&&Q([e[t]],[e]),"checkbox"==(null===(l=U())||void 0===l?void 0:l.type)){var r=e[t],a=[];M.includes(r)?a=M.filter((function(e){return e!=r})):(a=(0,_.Z)(M),a.push(r)),Q(a,[e])}}finally{n.onRowClick&&n.onRowClick(o,e)}},onDoubleClick:function(t){t.stopPropagation(),ne(e),n.onRowDoubleClick&&n.onRowDoubleClick(t,e)},onMouseEnter:function(t){n.onRowMouseEnter&&n.onRowMouseEnter(t,e)},onMouseLeave:function(t){n.onMouseLeave&&n.onMouseLeave(t,e)}}}})}function se(){return n.isclosecard?ae():(0,I.jsx)(d.Z,{children:ae()})}return se()},te=ne,oe=t(61193),ie=t.n(oe),le=function(e){var n=(0,s.useState)({left:0,top:0,bottom:0,right:0}),t=(0,a.Z)(n,2),o=t[0],i=t[1],r=(0,s.useState)(!0),u=(0,a.Z)(r,2),d=u[0],c=u[1],v=s.createRef(),f=function(e,n){var t,o,l,r=null===(t=window)||void 0===t||null===(o=t.document)||void 0===o?void 0:o.documentElement,a=r.clientWidth,s=r.clientHeight,u=null===v||void 0===v||null===(l=v.current)||void 0===l?void 0:l.getBoundingClientRect();i({left:-(null===u||void 0===u?void 0:u.left)+(null===n||void 0===n?void 0:n.x),right:a-((null===u||void 0===u?void 0:u.right)-(null===n||void 0===n?void 0:n.x)),top:-(null===u||void 0===u?void 0:u.top)+(null===n||void 0===n?void 0:n.y),bottom:s-((null===u||void 0===u?void 0:u.bottom)-(null===n||void 0===n?void 0:n.y))})};function p(){return(0,I.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){d&&c(!1)},onMouseOut:function(){c(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function m(){return(0,I.jsx)(l.Z,(0,h.Z)((0,h.Z)({},e),{},{title:p(),modalRender:function(e){return(0,I.jsx)(ie(),{disabled:d,bounds:o,onStart:function(e,n){return f(e,n)},children:(0,I.jsx)("div",{ref:v,children:e})})}}))}return m()},re=le,ae=function(e){var n,t,o=(0,s.useState)([]),i=(0,a.Z)(o,2),l=i[0],r=i[1],u=(0,s.useState)(null),c=(0,a.Z)(u,2),v=c[0],f=c[1],h=(0,s.useState)(!1),p=(0,a.Z)(h,2),m=p[0],g=p[1],x=(0,s.useState)(e.data),w=(0,a.Z)(x,2),Z=w[0],y=w[1],S=(0,s.useState)(z()),j=(0,a.Z)(S,1),b=j[0],C=(0,s.useState)(null===(n=e.commandShow)||void 0===n||n),k=(0,a.Z)(C,1),E=k[0],D=(0,s.useState)(null!==(t=e.modelshow)&&void 0!==t&&t),R=(0,a.Z)(D,2),T=R[0],F=R[1];(0,s.useEffect)((function(){y(e.data)}),[e.data]),(0,s.useEffect)((function(){var n;F(null!==(n=e.modelshow)&&void 0!==n&&n)}),[e.modelshow]);var M={page:1,size:10,whereList:[],sortList:[]},L=function(){var n,t,o=W()().valueOf().toString(),i={id:o,isnew:!0,editable:!0};if(null===(n=e.model)||void 0===n||null===(t=n.fields)||void 0===t||t.forEach((function(e){void 0!=e.field&&"id"!=e.field&&(i[e.field]=null)})),void 0==e.onAddRowing||e.onAddRowing(i)){var l=[],r=1;void 0!=Z&&void 0!=Z.rows&&(l=(0,_.Z)(Z.rows),l.forEach((function(e){e.editable=!1})),r=Z.total+r);var a=[i].concat((0,_.Z)(l));g(!0),void 0!=e.onAdded&&e.onAdded(i),void 0!=e.onDataChange?e.onDataChange({rows:a,total:r},i,"add"):y({rows:a,total:r})}},O=function(){if(l.length>0){var n=[],t=[],o=(0,_.Z)(Z.rows);l.forEach((function(i){if(void 0!=i){var l=o.findIndex((function(t){return t.id==i&&(!(void 0!=e.onRemoveRowing&&!e.onRemoveRowing(t))&&(t.isnew||n.push(i),!0))})),r=o.splice(l,1);void 0!=e.onRemoveed&&e.onRemoveed(r[0]),t.push(r[0])}}));var i={rows:o,total:Z.total-1};void 0!=e.onDataChange?t.length>0&&e.onDataChange(i,t,"remove"):y(i)}};function z(){var n=[];return void 0!=e.model&&(e.model.isadd&&n.push({command:"add",name:"\u65b0\u589e"}),e.model.isremove&&n.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),void 0!=e.onGetCommands&&(n=e.onGetCommands(n)),n}function V(n,t){F(n),e.onModalChange&&e.onModalChange(n,t)}function A(){var n;if(!e.closetoolbar)return(0,I.jsx)(Ze,{iscircle:e.iscirclebutton,commandShow:E,selectcount:l.length,attrs:b,isclosecard:!1,onClick:function(n,t){e.onCommandClicking&&e.onCommandClicking(t),"add"==n&&L(),"remove"==n&&O(),e.onCommandClicked&&e.onCommandClicked(t)},searchShow:!e.closesearch&&{fields:null===(n=e.model)||void 0===n?void 0:n.fields,onSearch:function(n){M.whereList=[],void 0!=n&&((0,H.isArray)(n)?M.whereList=n:M.whereList=[n]),M.page=1,M.sortList=[],void 0!=e.onSearchData&&e.onSearchData(M,(function(e){y(e)}))},onSearchData:e.onSearchData}})}function P(){var n,t,o;return(0,I.jsx)(te,{attr:e.model,data:Z,isedit:!e.closeedit,rowedit:m,selectType:null!==(n=e.selectType)&&void 0!==n?n:"checkbox",isselect:null===(t=e.isselect)||void 0===t||t,isclosecard:null===(o=e.closecard)||void 0===o||o,onSelectRows:function(e,n){console.log(e),console.log(n),r(n),f(e)},onSearchData:function(n,t){n.foreign&&n.field?e.onSearchData&&e.onSearchData(n,t):(M.page=n.page,M.size=n.size,M.sortList=n.sortList,void 0!=e.onSearchData&&e.onSearchData(M,(function(e){y(e)})))},onRowDataChangeing:function(n,t,o){return void 0!=e.onEditRowing?e.onEditRowing(n,t,o):(n.isnew||void 0==e.onDataChange||e.onDataChange(Z,n,"edit"),!0)},onRowDoubleClick:function(n,t){void 0!=t.editable&&g(t.editable),e.ismodal&&T&&V(!1,t)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(n,t,o){t.isnew&&(t[o.rowfield]=o.row),e.onSearchValueChange&&e.onSearchValueChange(n,t,o)}})}function N(){return e.closecard?(0,I.jsxs)(I.Fragment,{children:[A(),P()]}):(0,I.jsxs)(d.Z,{children:[A(),P()]})}function B(){var n;return e.ismodal?(0,I.jsx)(re,{title:null===(n=e.model)||void 0===n?void 0:n.title,width:600,visible:T,onCancel:function(){V(!1,null)},onOk:function(){V(!1,v)},children:(0,I.jsx)(I.Fragment,{children:N()})}):N()}return B()},se=ae,ue=B.Z.RangePicker,de=z.Z.Search;(function(e){e["Input"]="Input",e["TextArea"]="Input.TextArea",e["InputNumber"]="InputNumber",e["Switch"]="Switch",e["DatePicker"]="DatePicker",e["RangePicker"]="RangePicker",e["Search"]="Input.Search",e["Avatar"]="Avatar",e["Select"]="Select"})(U||(U={}));var ce=function(e){var n,t={maxLength:500,size:"middle",placeholder:"",disabled:null!==(n=e.disabled)&&void 0!==n&&n,style:{width:"100%"},texttype:U.Input};for(var o in t)void 0!=e.options&&void 0!=e.options[o]&&(t[o]=e.options[o]);return void 0!=e.width&&(t.style.width=e.width),t.texttype=ve(e,t),t},ve=function(e,n){var t=e.textType,o=e.attr;if(void 0!=o){if("int"!=o.type&&"int32"!=o.type&&"int64"!=o.type&&"decimal"!=o.type||(t=U.InputNumber,n.min=o.min,void 0!=o.precision&&o.precision>0&&(n.precision=o.precision),n.picker=void 0),"datetime"==o.type&&(t=U.DatePicker),"boolean"==o.type&&(t=U.Switch,e.search)){t=U.Select;var i=[{label:"\u662f",value:!0},{label:"\u5426",value:!1}];n.options=i}if(void 0!=o.comvtp&&o.comvtp.isvtp){t=U.Select;var l=[];(0,H.isMap)(o.comvtp.items)||(o.comvtp.items=new Map(o.comvtp.items)),o.comvtp.items.forEach((function(e,n){l.push({label:e,value:n})})),n.options=l}void 0!=o.foreign&&o.foreign.isfkey&&(t=U.Search),void 0!=o.length&&o.length>0&&(n.maxLength=o.length),void 0==e.disabled&&void 0!=o.disabled&&(n.disabled=o.disabled),e.search&&(n.disabled=!1)}return void 0==t&&(t=U.Input),t},fe=function(e){var n=(0,s.useState)((function(){return ce(e)})),t=(0,a.Z)(n,2),o=t[0],i=t[1],l=(0,s.useState)({isshow:!1,model:void 0,data:void 0}),r=(0,a.Z)(l,2),u=r[0],d=r[1],c=(0,s.useState)({row:void 0,value:"",text:"",rowfield:""}),v=(0,a.Z)(c,2),f=v[0],p=v[1],m=(0,G.Z)(e.defaultValue,{value:Z(e.value),onChange:function(n,t){if(console.log(n),void 0!=e.onChange){var o=y(n);console.log(o),e.onChange(o)}}}),g=(0,a.Z)(m,2),x=g[0],w=g[1];function Z(n){var t=e.attr;return(0,$.MM)(t,n)}function y(n){var t=e.attr;switch(o.texttype){case U.Select:return"string"==(null===t||void 0===t?void 0:t.type)?n.label:(0,$.Nz)(t,n)}return(0,$.Nz)(t,n)}function S(n){var t={value:"",text:"",row:void 0,rowfield:"",field:""};if(n){var o,i,l,r,a,s,u,d,c,v,f=null!==(o=null===(i=e.attr)||void 0===i||null===(l=i.foreign)||void 0===l?void 0:l.oneobjectfieldkey)&&void 0!==o?o:"",h=null!==(r=null===(a=e.attr)||void 0===a||null===(s=a.foreign)||void 0===s?void 0:s.onedisplayname)&&void 0!==r?r:"";console.log(f+"---"+h),t.row=n,t.value=n[f],t.text=n[h],t.rowfield=null!==(u=null===(d=e.attr)||void 0===d||null===(c=d.foreign)||void 0===c?void 0:c.oneobjectfield)&&void 0!==u?u:"",t.field=null===(v=e.attr)||void 0===v?void 0:v.field,console.log(t)}p(t),w(t.value),e.onSearchValueChange&&e.onSearchValueChange(t)}function j(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(de,(0,h.Z)((0,h.Z)({},o),{},{size:"middle",value:f.text,onSearch:function(n){if(void 0!=e.onSearchBefore){var t,o={foreign:null===(t=e.attr)||void 0===t?void 0:t.foreign,value:n,field:e.attr};e.onSearchBefore(o,(function(n,t){var o;void 0!=n.title&&""!=n.title||(n.title=null===(o=e.attr)||void 0===o?void 0:o.title),d({isshow:!0,model:n,data:t})}))}}})),(0,I.jsx)(se,{ismodal:!0,modelshow:u.isshow,model:u.model,data:u.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(e,n){var t=(0,h.Z)({},u);t.isshow=e,console.log(t),d(t),S(n)},onSearchData:function(n,t){var o;n.field=e.attr,n.foreign=null===(o=e.attr)||void 0===o?void 0:o.foreign,void 0!=e.onSearchData&&e.onSearchData(n,t)}})]})}function b(){var n=e.attr;return"string"==(null===n||void 0===n?void 0:n.type)&&(o.labelInValue=!0),(0,I.jsx)(N.Z,(0,h.Z)((0,h.Z)({},o),{},{size:"middle",value:x,onChange:w}))}function C(){return(0,I.jsx)(P.Z,{size:"default",checked:x,onChange:w})}function k(){var n,t=e.attr,i=void 0,l=void 0;return console.log(t),t&&t.datatimetype&&(t.datatimetype.istime&&(i={format:t.datatimetype.timeformat}),l=t.datatimetype.dateformat,t.datatimetype.istime&&(l=l+" "+t.datatimetype.timeformat)),e.search?(0,I.jsx)(ue,{size:"middle",showTime:i,format:l,style:o.style,value:x,allowEmpty:[!0,!0],picker:null===(n=e.options)||void 0===n?void 0:n.picker,onChange:w}):(0,I.jsx)(B.Z,(0,h.Z)((0,h.Z)({},o),{},{format:l,showTime:i,size:"middle",picker:"date",value:x,onChange:w}))}function E(){return(0,I.jsx)(A.Z,(0,h.Z)((0,h.Z)({},o),{},{value:x,onChange:w}))}function D(){switch(o.texttype){case U.InputNumber:return E();case U.DatePicker:return k();case U.Switch:return C();case U.Select:return b();case U.Search:return j()}return(0,I.jsx)(z.Z,(0,h.Z)((0,h.Z)({},o),{},{size:"middle",value:x,onChange:function(e){w(e.target.value)}}))}return(0,s.useEffect)((function(){var n;e.search&&(f.field!=(null===(n=e.attr)||void 0===n?void 0:n.field)&&S(null),i(ce(e)))}),[e.attr]),(0,s.useEffect)((function(){var n;if(void 0!=(null===(n=e.attr)||void 0===n?void 0:n.foreign)&&e.attr.foreign.isfkey&&void 0!=e.children&&!e.search&&void 0==f.row&&void 0!=e.value){var t=e.children[e.attr.foreign.oneobjectfield];S(t)}}),[e.value]),D()},he=fe,pe=t(76570),me=function(e){var n=new Map;n.set("string",[{label:"\u7b49\u4e8e",value:"="},{label:"\u5305\u542b",value:"like"},{label:"\u4e3a\u7a7a",value:"isnull"},{label:"\u4e0d\u4e3a\u7a7a",value:"isnotnull"},{label:"\u5de6\u5339\u914d",value:"left"},{label:"\u53f3\u5339\u914d",value:"right"}]),n.set("int",[{label:"\u7b49\u4e8e",value:"="},{label:"\u5927\u4e8e",value:">"},{label:"\u5c0f\u4e8e",value:"<"}]),n.set("datetime",[{label:"\u8303\u56f4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5b63",value:"quarter"},{label:"\u5e74",value:"year"}]);var t=(0,s.useState)({value:"",attr:{type:"string"}}),o=(0,a.Z)(t,2),i=o[0],l=o[1],r=(0,s.useState)(""),u=(0,a.Z)(r,2),d=u[0],c=u[1],v=(0,s.useState)({type:"string"}),f=(0,a.Z)(v,2),p=f[0],m=f[1],g=(0,s.useState)({name:"*",type:"string",symbol:""}),x=(0,a.Z)(g,2),w=x[0],Z=x[1],y=(0,s.useState)({picker:null}),S=(0,a.Z)(y,2),j=S[0],b=S[1],C=[{label:"\u5168\u90e8",value:"*"}];function k(){return(0,I.jsx)(V.Z,{style:{width:"140px"},options:C,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(n){var t;console.log(n);var o=n[0],r=null===(t=e.fields)||void 0===t?void 0:t.find((function(e){return e.field==o}));if(r&&r.porpfield&&(o=r.porpfield),Z({name:o,symbol:n[1],type:null===r||void 0===r?void 0:r.type}),w.name!=o&&(l(Object.assign(i,{value:"",attr:r})),c(""),m(r),"datetime"==(null===r||void 0===r?void 0:r.type))){var a=(0,h.Z)({},j);a.picker=n[1],b(a)}}})}function E(){return(0,I.jsx)(he,{width:"240px",options:j,search:!0,name:w.name,attr:p,value:d,onChange:function(e){console.log(e),c(e),l({value:e,attr:i.attr})},onSearchBefore:function(n,t){e.onSearchData&&e.onSearchData(n,(function(e){t(e.model,e)}))},onSearchData:e.onSearchData})}function D(){return(0,I.jsx)(F.Z,{style:{width:"70px"},type:"primary",icon:(0,I.jsx)(pe.Z,{}),onClick:function(){console.log(i);var n=(0,$.Nz)(p,i.value);console.log(n);var t={name:w.name,symbol:w.symbol,value:n};if("*"==t.name&&""==t.value)e.onSearch();else{if("datetime"==p.type&&""!=i.value&&(0,H.isArray)(n)){var o=[];return null!=i.value[0]&&(t.symbol=">=",t.value=i.value[0],o.push(t)),null!=i.value[1]&&o.push({name:w.name,symbol:"<=",value:i.value[1]}),e.onSearch(o)}e.onSearch(t)}}})}function R(){return(0,I.jsxs)(z.Z.Group,{compact:!0,children:[k(),E(),D()]})}return void 0!=e.fields&&e.fields.forEach((function(e){if(e.issearch){var t,o=null!==(t=e.searchsymbol)&&void 0!==t?t:n.get(e.type);"datetime"==e.type&&(o=n.get(e.type)),"decimal"==e.type&&(o=n.get("int")),e.foreign&&e.foreign.isfkey&&(o=void 0),C.push({label:e.title,value:e.field,children:o})}})),R()},ge=me,xe=function(){function e(){(0,p.Z)(this,e),this.printText="\u6253\u5370",this.setText="\u8bbe\u7f6e",this.helpText="\u5e2e\u52a9",this.aboutText="\u5173\u4e8e"}return(0,m.Z)(e,[{key:"onPrint",value:function(e){}},{key:"onSet",value:function(e){}},{key:"onHelp",value:function(e){}},{key:"onAbout",value:function(e){}}]),e}(),we=function(e){var n=["add","create"],t=["remove","delete"],l=["update","edit"],r=["ImportData","import"],u=["ExportData","export"];function p(){var n,t=[],o=new Map;return null===(n=e.attrs)||void 0===n||n.forEach((function(e){if(e.issplit&&void 0!=e.splitname)if(o.has(e.splitname)){var n=o.get(e.splitname);null===n||void 0===n||n.push(e)}else o.set(e.splitname,[e]);else t.push(e)})),(0,I.jsx)(v.Z,{wrap:!0,children:t.map((function(n){if(o.has(n.command)){var t,i=(0,I.jsx)(f.Z,{children:null===(t=o.get(n.command))||void 0===t?void 0:t.map((function(n,t){return(0,I.jsx)(f.Z.Item,{children:(0,I.jsx)(O,(0,h.Z)((0,h.Z)({},L(n)),{},{onClick:function(){return M(n.command,n)},toolbar:e}),t)},t)}))});return(0,I.jsx)(O,(0,h.Z)((0,h.Z)({},L(n)),{},{icon:(0,I.jsx)(g.Z,{}),ismenu:!0,menu:i,onClick:function(){return M(n.command,n)},toolbar:e}))}return(0,I.jsx)(O,(0,h.Z)((0,h.Z)({},L(n)),{},{onClick:function(){return M(n.command,n)},toolbar:e}))}))})}function m(n){return!!e.isselectrow&&(void 0!=e.onCommandDisabled?e.onCommandDisabled(n):(1!=e.selectcount||!n.isselectrow)&&(!(void 0!=e.selectcount&&e.selectcount>1&&n.isselectrow&&n.selectmultiple)&&n.isselectrow))}function R(){if(void 0!=e.helpShow&&0!=e.helpShow){var n,t,o,i,l,r,u,d,c,f,h=(0,s.useState)({isprint:null!==(n=null===(t=e.helpShow)||void 0===t?void 0:t.isprint)&&void 0!==n&&n,isset:null!==(o=null===(i=e.helpShow)||void 0===i?void 0:i.isset)&&void 0!==o&&o,ishelp:null!==(l=null===(r=e.helpShow)||void 0===r?void 0:r.ishelp)&&void 0!==l&&l,isabout:null!==(u=null===(d=e.helpShow)||void 0===d?void 0:d.isabout)&&void 0!==u&&u,wvh:null!==(c=null===(f=e.helpShow)||void 0===f?void 0:f.wvh)&&void 0!==c?c:new xe}),p=(0,a.Z)(h,2),m=p[0];p[1];return(0,I.jsx)(v.Z,{wrap:!0,children:T(m)})}}function T(e){var n,t,o,i,l=[];e.isprint&&l.push((0,I.jsx)(O,{title:null===(n=e.wvh)||void 0===n?void 0:n.printText,name:"print",shape:"circle",icon:(0,I.jsx)(x.Z,{}),onClick:M}));e.isset&&l.push((0,I.jsx)(O,{title:null===(t=e.wvh)||void 0===t?void 0:t.setText,name:"set",shape:"circle",icon:(0,I.jsx)(w.Z,{}),onClick:M}));e.ishelp&&l.push((0,I.jsx)(O,{title:null===(o=e.wvh)||void 0===o?void 0:o.helpText,name:"help",shape:"circle",icon:(0,I.jsx)(Z.Z,{}),onClick:M}));e.isabout&&l.push((0,I.jsx)(O,{title:null===(i=e.wvh)||void 0===i?void 0:i.aboutText,name:"about",shape:"circle",icon:(0,I.jsx)(y.Z,{}),onClick:M}));return l.length>0&&l.unshift((0,I.jsx)(c.Z,{type:"vertical"})),l.map((function(e){return e}))}function F(){if(void 0!=e.searchShow&&0!=e.searchShow)return(0,I.jsx)(ge,(0,h.Z)({},e.searchShow))}var M=function(n,t){void 0!=e.onClick&&e.onClick(n,t)};function L(n){var t,o={name:n.command,title:n.title,text:n.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return o.disabled=null!==(t=m(n))&&void 0!==t&&t,o=z(o),e.iscircle&&(o.shape="circle",o.title=o.text,o.text=""),o}function z(e){return n.includes(e.name)&&(e.type="primary",e.icon=(0,I.jsx)(S.Z,{component:j.Z})),t.includes(e.name)&&(e.type="danger",e.icon=(0,I.jsx)(b.Z,{})),l.includes(e.name)&&(e.icon=(0,I.jsx)(C.Z,{})),r.includes(e.name)&&(e.icon=(0,I.jsx)(k.Z,{})),u.includes(e.name)&&(e.icon=(0,I.jsx)(E.Z,{})),""==e.icon&&(e.icon=(0,I.jsx)(D.Z,{})),e}var V=function(e){return 3==e.length?(0,I.jsxs)(o.Z,{gutter:[8,8],children:[(0,I.jsx)(i.Z,{span:10,children:(0,I.jsx)(o.Z,{justify:"start",children:e[0]})}),(0,I.jsx)(i.Z,{span:8,children:(0,I.jsx)(o.Z,{justify:"end",children:e[1]})}),(0,I.jsx)(i.Z,{span:6,children:(0,I.jsx)(o.Z,{justify:"end",children:e[2]})})]}):2==e.length?(0,I.jsxs)(o.Z,{gutter:[8,8],children:[(0,I.jsx)(i.Z,{span:12,children:(0,I.jsx)(o.Z,{justify:"start",children:e[0]})}),(0,I.jsx)(i.Z,{span:12,children:(0,I.jsx)(o.Z,{justify:"end",children:e[1]})})]}):1==e.length?(0,I.jsx)(o.Z,{gutter:[8,8],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsx)(o.Z,{justify:"start",children:e[0]})})}):(0,I.jsx)(I.Fragment,{})};function A(){var n=[];return void 0!=e.searchShow&&0!=e.searchShow&&n.push((0,I.jsx)(i.Z,{children:F()})),void 0!=e.commandShow&&0!=e.commandShow&&n.push((0,I.jsx)(i.Z,{children:p()})),void 0!=e.helpShow&&0!=e.helpShow&&n.push((0,I.jsx)(i.Z,{children:R()})),e.isclosecard?V(n):(0,I.jsx)(d.Z,{children:V(n)})}return A()},Ze=we,ye=(t(9715),t(55843)),Se=K.Z.TabPane,je=function(e){var n,t=ye.Z.useForm(),l=(0,a.Z)(t,1),r=l[0],u=(0,s.useState)(e.title),c=(0,a.Z)(u,2),v=c[0],f=c[1],p=(0,s.useState)(null!==(n=e.isshow)&&void 0!==n&&n),m=(0,a.Z)(p,2),g=m[0],x=m[1],w=(0,s.useState)(z(e.attr)),Z=(0,a.Z)(w,2),y=Z[0],S=Z[1],j=(0,s.useState)((function(){return A(e.values)})),b=(0,a.Z)(j,2),C=b[0],k=b[1],E=(0,s.useState)(!1),D=(0,a.Z)(E,2),R=D[0],T=D[1],F=(0,s.useState)(!1),M=(0,a.Z)(F,2),L=M[0],O=M[1];function z(e){var n,t;return{items:null===e||void 0===e||null===(n=e.fields)||void 0===n?void 0:n.filter((function(e){return e.visible&&e.isedit})),models:null===e||void 0===e||null===(t=e.childmodels)||void 0===t?void 0:t.filter((function(e){return void 0==e.propertyname&&(e.propertyname=e.name),e.visible}))}}function V(){var n,t=[];return null===(n=y.items)||void 0===n||n.forEach((function(n){var o=N(e.attr,n);void 0!=e.onInitTextBox&&e.onInitTextBox(n,txtprops),t.push((0,I.jsx)(i.Z,{span:8,children:(0,I.jsx)(ye.Z.Item,(0,h.Z)((0,h.Z)({},o),{},{children:(0,I.jsx)(he,{attr:n,onSearchBefore:function(n,t){void 0!=e.onSearchData&&e.onSearchData(n,(function(e){t(e.model,e)}))},onSearchData:function(n,t){e.onSearchData&&e.onSearchData(n,t)},children:C})}),n.field)}))})),void 0!=e.onInitFormed&&(r.setFieldDisabled=function(e,n){var t;null===(t=y.items)||void 0===t||t.forEach((function(t){var o;(null===(o=t.field)||void 0===o?void 0:o.toLocaleLowerCase())==e.toLocaleLowerCase()&&(t.disabled=n)})),S(y)},r.setTitle=function(e){f(e)},r.show=function(){x(!0)},r.hide=function(){x(!1)},r.setValues=function(e){k(A(e))},r.clear=function(){P()},r.setHideSearch=function(e){O(e)},r.setHideToolbar=function(e){T(e)},e.onInitFormed(r)),t}function A(e){var n;return void 0==e&&(e={}),r.setFieldsValue(e),void 0!=y.models&&(null===(n=y.models)||void 0===n?void 0:n.length)>0&&(console.log(y),y.models.forEach((function(n){e[n.propertyname]?e[n.propertyname].total=e[n.propertyname].length:(e[n.propertyname]=[],e[n.propertyname].total=0),n.removeRows=[]}))),e}function P(){var e;r.resetFields();var n={};null===(e=y.models)||void 0===e||e.forEach((function(e){n[e.propertyname]||(n[e.propertyname]=[],n[e.propertyname].total=0)})),k(n)}function N(n,t){var o={};o.name=t.field,o.label=t.title;var i=B(t);return t.disabled||(o.rules=i),void 0!=e.onInitItem&&e.onInitItem(t,o),o}function B(n){var t,o,i=[];(n.required&&i.push({required:n.required}),null!==(t=n.length)&&void 0!==t&&t)&&i.push({max:null!==(o=n.length)&&void 0!==o?o:500,type:(0,$.mc)(n.type)});return void 0!=e.onFieldRules&&(i=e.onFieldRules(n,i)),i}(0,s.useEffect)((function(){console.log(e.values),void 0!=e.values?k(A(e.values)):P()}),[e.values]),(0,s.useEffect)((function(){S(z(e.attr))}),[e.attr]);var G=function(e){var n,t=Object.assign({},C);for(var o in e)t[o]=e[o];return void 0!=y.models&&(null===(n=y.models)||void 0===n?void 0:n.length)>0&&y.models.forEach((function(e){var n;void 0!=t[e.propertyname]&&t[e.propertyname].forEach((function(e){e.isnew?e.modelState=1:e.modelState=2})),null===(n=e.removeRows)||void 0===n||n.forEach((function(n){n.modelState=3,t[e.propertyname].push(n)}))})),console.log(t),t};function H(){return(0,I.jsx)(ye.Z,{labelAlign:"left",form:r,onFinish:function(n){var t=G(n);void 0!=r.onFinish&&r.onFinish(t),void 0!=e.onFinish&&e.onFinish(t)},scrollToFirstError:!0,initialValues:e.values,children:(0,I.jsx)(o.Z,{gutter:24,children:V()})})}function _(){var n,t;return void 0!=y.models&&(null===(n=y.models)||void 0===n?void 0:n.length)>0?(0,I.jsx)(K.Z,{defaultActiveKey:"0",children:null===(t=y.models)||void 0===t?void 0:t.map((function(n,t){var o;return(0,I.jsx)(Se,{tab:n.title,children:(0,I.jsx)(se,{model:n,data:{rows:C[n.propertyname],total:null===(o=C[n.propertyname])||void 0===o?void 0:o.total},iscirclebutton:!0,closetoolbar:R,closesearch:L,closecard:!0,onSearchData:function(t){void 0!=e.onSearchData&&(t.parent=C,t.childmodel=n,e.onSearchData(t,(function(e){var t=Object.assign({},C);t[n.propertyname]=e.rows,t[n.propertyname].total=e.total,k(t)})))},onDataChange:function(e,t,o){console.log(e,t);var i=Object.assign({},C);i[n.propertyname]=e.rows,i[n.propertyname].total=e.total,console.log(i),"remove"==o&&t.forEach((function(e){e&&!e.isnew&&n.removeRows.push(e)})),k(i)}})},t)}))}):(0,I.jsx)(I.Fragment,{})}function q(){return e.ismodal?(0,I.jsxs)(re,{title:v,width:1100,visible:g,onCancel:function(){return x(!1)},onOk:function(){r.submit()},children:[(0,I.jsx)(d.Z,{children:H()}),_()]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(d.Z,{title:v,children:H()}),_()]})}return q()},be=je,Ce=t(35193),ke=t(73218),Ee=t(39428),De=(t(34669),t(82833)),Re=(t(17462),t(76772)),Te=t(3182),Fe=t(91220),Me=t(43347),Ie=(t(35556),t(75899)),Le=Ie.Z.Step,Oe=function(e){var n,t,o=(0,s.useState)(null!==(n=e.currentStep)&&void 0!==n?n:0),i=(0,a.Z)(o,2),l=i[0],r=i[1],u=(0,s.useState)(null!==(t=e.isShow)&&void 0!==t&&t),v=(0,a.Z)(u,2),f=v[0],p=v[1];function m(n){return e.onCurrentStepComponent?e.onCurrentStepComponent(n):(0,I.jsx)(be,{attr:e.attr,ismodal:!1})}function g(){var n;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Ie.Z,{current:l,onChange:function(n){r(n),e.onChange&&e.onChange(n)},children:null===(n=e.stepItem)||void 0===n?void 0:n.map((function(e){return(0,I.jsx)(Le,(0,h.Z)({},e))}))}),(0,I.jsx)(c.Z,{}),m(l)]})}function x(n){p(n),e.onShowChange&&e.onShowChange(n)}function w(){if(e.isModal){var n={onOk:function(){x(!1)},onCancel:function(){x(!1)}};return e.closeOk&&(n.footer=!1),(0,I.jsx)(re,(0,h.Z)((0,h.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:f},n),{},{children:g()}))}return e.isCard?(0,I.jsx)(d.Z,{title:e.title,bordered:!1,children:g()}):g()}return(0,s.useEffect)((function(){var n;p(null!==(n=e.isShow)&&void 0!==n&&n)}),[e.isShow]),(0,s.useEffect)((function(){var n,t;(r(null!==(n=e.currentStep)&&void 0!==n?n:0),e.onChange)&&e.onChange(null!==(t=e.currentStep)&&void 0!==t?t:0)}),[e,e.currentStep]),w()},ze=Oe,Ve=t(54701),Ae=t(58602),Pe=t(32059);function Ne(e,n,t){var o=e.map((function(e,n){return Object.assign({},{key:e.key,title:e.title,position:String.fromCharCode(65+n)+1})})).reduce((function(e,n){return Object.assign({},e,(0,Pe.Z)({},n.position,{key:n.key,v:n.title}))}),{}),i=n.map((function(n,t){return e.map((function(e,o){return Object.assign({},{content:n[e.key],position:String.fromCharCode(65+o)+(t+2)})}))})).reduce((function(e,n){return e.concat(n)})).reduce((function(e,n){return Object.assign({},e,(0,Pe.Z)({},n.position,{v:n.content}))}),{}),l=Object.assign({},o,i),r=Object.keys(l),a="".concat(r[0],":").concat(r[r.length-1]),s={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},l,{"!ref":a,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};Ve.NC(s,t)}function Be(e,n,t,o,i){return Ge.apply(this,arguments)}function Ge(){return Ge=(0,Te.Z)((0,Ee.Z)().mark((function e(n,t,o,i,l){var r,a;return(0,Ee.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t>0&&(r=[],n.fields.forEach((function(e){e.visible&&r.push({title:e.title,key:e.field,item:e})})),a=Object.assign({},o),a.page=1,a.size=t,a.size>0&&i(a).then((function(e){if(void 0!=e&&e.success&&e.data&&e.data.rows){var n=e.data.rows;for(var t in n)for(var o in r){var i=n[t][r[o].key],a=Q(i,r[o].item,n[t]);n[t][r[o].key]=null!==a&&void 0!==a?a:""}Ne(r,n,l)}})));case 1:case"end":return e.stop()}}),e)}))),Ge.apply(this,arguments)}var He=function(e){var n,t=(0,s.useState)(0),u=(0,a.Z)(t,2),c=u[0],f=u[1],p=(0,s.useState)(null!==(n=e.isShow)&&void 0!==n&&n),m=(0,a.Z)(p,2),g=m[0],x=m[1],w=(0,s.useState)(0),Z=(0,a.Z)(w,2),y=Z[0],S=Z[1],j=(0,s.useState)({model:void 0,data:{rows:[],total:0}}),b=(0,a.Z)(j,2),C=b[0],k=b[1],E=(0,s.useState)(ee(e.attr)),D=(0,a.Z)(E,2),R=D[0],T=D[1],M=(0,s.useState)({message:"",description:"",type:"success",count:0}),L=(0,a.Z)(M,2),O=L[0],z=L[1],V=(0,s.useState)(null),A=(0,a.Z)(V,2),P=A[0],N=A[1],B=(0,s.useState)({model:null,rows:[],total:0}),G=(0,a.Z)(B,2),H=G[0],_=G[1],q=(0,s.useState)(!0),K=(0,a.Z)(q,2),J=K[0],W=K[1],$=(0,s.useState)(void 0),Q=(0,a.Z)($,2),U=Q[0],X=Q[1];function Y(){f(0),S(0),k({model:void 0,data:{rows:[],total:0}}),z({message:"",description:"",type:"success",count:0}),N(null),_({model:null,rows:[],total:0}),W(!0),X(void 0)}function ee(e){var n;return null===(n=e.fields)||void 0===n?void 0:n.filter((function(e){return e.visible&&!e.disabled}))}(0,s.useEffect)((function(){x(e.isShow)}),[e.isShow]),(0,s.useEffect)((function(){T(ee(e.attr))}),[e.attr]);var ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return new Promise((function(n){setTimeout((function(){n(!0)}),e)}))};function oe(){var e={title:"\u4e0a\u4f20\u5bfc\u5165\u6587\u4ef6"},n={title:"\u8bbe\u7f6e\u5bfc\u5165\u6620\u5c04"},t={title:"\u5bfc\u5165\u6570\u636e"},o=[e,n,t];return o}function ie(e){var n={fields:[]};if(e.length>0)for(var t in e[0]){var o;null===(o=n.fields)||void 0===o||o.push({field:t,title:t,type:"string",visible:!0,sorter:!1})}return n}function le(e){var n=e.rowcount,t=e.data;if(n>0){S(n);for(var o=ie(t),i=[],l=0;l<6;l++)i.push(t[l]);k({model:o,data:{rows:i,total:5}})}}function re(){var e,n,t=new Map,o=new Map;null===(e=C.model)||void 0===e||null===(n=e.fields)||void 0===n||n.forEach((function(e,n){t.set(n,e.title)}));var i=[];R.forEach((function(e,n){var l,r;o.set(n,e.title);var a=e.foreign&&e.foreign.isfkey?"Name":"",s=null===(l=C.model)||void 0===l||null===(r=l.fields)||void 0===r?void 0:r.find((function(n){return n.field==e.field||n.field==e.title})),u=void 0;if(void 0==s||null==s){var d;n<(null===(d=C.model)||void 0===d?void 0:d.fields.length)&&(u=n),i.push({id:n,source:u,target:n,defaultValue:"",foreignMap:a})}else{var c,v=(0,Fe.Z)(t.entries());try{for(v.s();!(c=v.n()).done;){var f=c.value;if(s.title==f[1]||s.field==f[1]){u=f[0];break}}}catch(h){v.e(h)}finally{v.f()}i.push({id:n,source:u,target:n,defaultValue:"",foreignMap:a})}}));var l=[{field:"source",title:"\u6765\u6e90\u5217\u540d",type:"string",comvtp:{isvtp:!0,items:t},visible:!0,sorter:!1},{field:"target",title:"\u76ee\u6807\u5217\u540d",type:"string",comvtp:{isvtp:!0,items:o},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ed8\u8ba4\u503c",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5c04",type:"string",visible:!0,sorter:!1}];_({model:{fields:l,isadd:!1,isedit:!0,isremove:!1},rows:i,total:i.length})}function ae(e){var n={};for(var t in H.rows){var o,i,l=H.rows[t],r=null===(o=C.model)||void 0===o?void 0:o.fields[l.source];if(void 0!=r&&null!=r||""!=l.defaultValue){var a=R[l.target];if(void 0!=a&&null!=a)if(null==l.defaultValue||""==l.defaultValue){var s=r.field,u=e[s];if(a.required&&(void 0==u||null==u||""==u))return void pe(n,"\u5bfc\u5165\u6570\u636e".concat(r.field,"\u4e3a\u7a7a\u503c\uff0c\u6620\u5c04\u9879").concat(a.title,"\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u8bf7\u4fee\u6539Excel\u540e\u91cd\u8bd5\uff01"),0);if(void 0!=u&&null!=u&&""!=u){if(null!==a&&void 0!==a&&a.comvtp&&a.comvtp.isvtp){var d,c=(0,Fe.Z)(a.comvtp.items.entries());try{for(c.s();!(d=c.n()).done;){var v=d.value;if(u==v[1]){u=v[0];break}}}catch(p){c.e(p)}finally{c.f()}}if(null!==(i=a.foreign)&&void 0!==i&&i.isfkey&&void 0!=U&&U.has(a.field)){var f=U.get(a.field);u=f[u]}n[a.field]=u}}else{var h;n[a.field]=l.defaultValue,null!==(h=a.foreign)&&void 0!==h&&h.isfkey&&(n[a.field]=l[a.field])}}}return n}function ue(e){var n=new Map;return H.rows.forEach((function(t){var o,i=null===(o=C.model)||void 0===o?void 0:o.fields[t.source];if(i){var l,r=R[t.target],a=""==t.foreignMap?"Name":t.foreignMap;if(null!==(l=r.foreign)&&void 0!==l&&l.isfkey&&""==t.defaultValue){n.has(r.field)||n.set(r.field,new Map);var s=n.get(r.field);for(var u in e){var d=e[u],c=d[i.field];null==c||""==c||s.has(c)||null===s||void 0===s||s.set(c,a)}}}})),n}function de(n){var t=ue(n);if(0==t.size)return W(!1),void z({message:"\u8bf7\u70b9\u51fb\u5f00\u59cb\u5bfc\u5165",description:"\u5bfc\u5165\u6570\u636e\u51c6\u5907\u5b8c\u6210......",type:"info",count:0});var o="";t.forEach((function(n,i){var l=R.find((function(e){return e.field==i})),r=R.find((function(e){return"string"==e.type})).searchsymbol.find((function(e){return"\u7b49\u4e8e"==e.label})).value,a=[],s="";n.forEach((function(e,n){s=e.toLowerCase(),a.push({name:e,symbol:r,value:n,relation:"||"})}));var u={field:l,foreign:l.foreign,whereList:a};e.onSearchData&&(ne(200),e.onSearchData(u,(function(e){if(e&&e.rows.length>0)if(e.rows.length==n.size){for(var i in console.log(n),e.rows){var r=e.rows[i][s];n.has(r)&&(n[r]=e.rows[i].id)}X(t),W(!1),console.log(O.description),z({message:"\u8bf7\u70b9\u51fb\u5f00\u59cb\u5bfc\u5165",description:"\u5bfc\u5165\u6570\u636e\u51c6\u5907\u5b8c\u6210,\u5df2\u6620\u5c04".concat(null===l||void 0===l?void 0:l.title,"\u6570\u636e").concat(e.total,"\u9879\u3002\n"),type:"info",count:0})}else n.forEach((function(n,t){var i=e.rows.find((function(e){return e[s]==t}));o+="".concat(null===l||void 0===l?void 0:l.title,"\u4e2d\u672a\u627e\u5230").concat(s,"\u4e3a").concat(t,"\u7684\u6570\u636e\uff0c\u8bf7\u4fee\u6539Excel\u540e\u91cd\u8bd5!\n"),null==i&&pe(e.rows,o,0)}));else o+="".concat(null===l||void 0===l?void 0:l.title,"\u4e2d\u672a\u627e\u5230").concat(s,"\u4e3a").concat(a[0].value,"\u7684\u6570\u636e\uff0c\u8bf7\u4fee\u6539Excel\u540e\u91cd\u8bd5!\n"),pe(e.rows,o,0)})))}))}function ce(e){if(null!=P&&void 0!=P.data){var n=P.data;if(H.rows.length<=0)l.Z.error({content:(0,I.jsx)("div",{children:"Excel\u4e8e\u6570\u636e\u6620\u5c04\u5173\u7cfb\u672a\u8bbe\u7f6e\u4e0d\u80fd\u5bfc\u5165\uff01"})});else if(!J){if(e==n.length)return z({message:"\u5bfc\u5165\u6570\u636e\u5b8c\u6210",description:"",type:"success",count:e}),void W(!0);var t=ae(n[e]);null!=t&&fe(t,(function(n,o){ve(t,n,o,e)}))}}else l.Z.error({content:(0,I.jsx)("div",{children:"\u5bfc\u5165\u6570\u636e\u672a\u4e0a\u4f20\uff0c\u4e0d\u80fd\u5bfc\u5165\uff01"})})}function ve(e,n,t,o){n?(o++,z({message:"\u5bfc\u5165\u6210\u529f",description:JSON.stringify(e),type:"success",count:o}),ne(200),ce(o)):pe(e,t,o)}function fe(e,n){return he.apply(this,arguments)}function he(){return he=(0,Te.Z)((0,Ee.Z)().mark((function n(t,o){return(0,Ee.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.onAdd&&e.onAdd("add",t).then(function(){var e=(0,Te.Z)((0,Ee.Z)().mark((function e(n){return(0,Ee.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(n),void 0!=n.ok&&0==n.ok&&(W(!0),o(!1,n.statusText)),void 0==n||!n.success){e.next=8;break}return e.next=5,ne(200);case 5:o(!0),e.next=10;break;case 8:W(!0),o(!1,n.message);case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 1:case"end":return n.stop()}}),n)}))),he.apply(this,arguments)}function pe(n,t,o){var i={message:"\u5bfc\u5165\u51fa\u9519:"+JSON.stringify(n),description:t,type:"error",count:o,action:(0,I.jsx)(v.Z,{children:(0,I.jsx)(F.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var t=e.form;t.clear(),t.setHideSearch(!0),t.setTitle(e.title),t.show(),t.setValues(n),t.onFinish=function(e){console.log(e),t.hide(),fe(e,(function(n,t){ve(e,n,t,o)}))}}},children:"\u4fee\u6539"})})};z(i)}function me(){var n={name:"file",accept:".xlsx, .xls",onChange:function(e){console.log(e);var n=new FileReader;n.onload=function(e){try{var n=e.target.result,t=Ve.ij(n,{type:"binary"}),o=[];for(var i in t.Sheets)if(t.Sheets.hasOwnProperty(i)){o=Ve.P6.sheet_to_json(t.Sheets[i]);break}var l={data:o,rowcount:o.length};N(l),le(l)}catch(a){r.default.error("\u53d1\u751f\u9519\u8bef\uff01"),console.log(a)}},n.readAsBinaryString(e.file.originFileObj)}};return(0,I.jsxs)(d.Z,{children:[(0,I.jsx)(o.Z,{gutter:[8,8],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsx)(Re.Z,{showIcon:!0,message:"\u4e0a\u4f20\u6587\u4ef6\u4e2d\u7684\u6570\u636e\u4e3a".concat(y,"\u884c"),type:"info",action:(0,I.jsx)(v.Z,{children:(0,I.jsx)(F.Z,{size:"small",type:"primary",onClick:function(){var n=[],t={};R.forEach((function(e){n.push({title:e.title,key:e.field}),t[e.field]=e.type+"(\u6570\u636e\u7c7b\u578b\u63d0\u793a\uff0c\u5f55\u5165\u6570\u636e\u65f6\u8bf7\u5220\u9664)"})),Ne(n,[t],e.title+"\u5bfc\u5165\u6a21\u677f.xlsx")},children:"\u4e0b\u8f7d\u5bfc\u5165\u6a21\u677f"})})})})}),(0,I.jsx)(o.Z,{gutter:[8,8],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsxs)(Ae.Z,(0,h.Z)((0,h.Z)({},n),{},{children:[(0,I.jsx)("p",{className:"ant-upload-drag-icon",children:(0,I.jsx)(Me.Z,{})}),(0,I.jsx)("p",{className:"ant-upload-text",children:"\u70b9\u51fb\u6216\u62d6\u62fd\u6587\u4ef6\u4e0a\u4f20"})]}))})}),(0,I.jsx)(o.Z,{gutter:[8,8],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsx)(te,{isclosecard:!0,attr:C.model,data:C.data})})}),(0,I.jsx)(o.Z,{gutter:[8,8],children:(0,I.jsx)(i.Z,{span:24,push:11,children:(0,I.jsx)(F.Z,{type:"primary",disabled:y<1,onClick:function(){f(c+1)},children:"\u4e0b\u4e00\u6b65"})})})]})}function ge(){var n={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:H.model,data:{rows:H.rows,total:H.total},onDataChange:function(e){_((0,h.Z)((0,h.Z)({},H),{},{rows:e.rows}))},onGetFieldToEdit:function(e,n){if("defaultValue"==e.field){var t=n.target,o=R[t];return o}return e},onEditRowing:function(e,n,t){return void 0!=t&&(e.defaultValue=String(t)),!0},onSearchValueChange:function(e,n,t){void 0!=t.text&&(n.defaultValue=t.text)},onSearchData:e.onSearchData};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsx)(se,(0,h.Z)({},n))})}),(0,I.jsxs)(o.Z,{gutter:[16,16],children:[(0,I.jsx)(i.Z,{span:12,push:10,children:(0,I.jsx)(F.Z,{type:"primary",onClick:function(){f(c+1)},children:"\u4e0b\u4e00\u6b65"})}),(0,I.jsx)(i.Z,{span:12,push:1,children:(0,I.jsx)(F.Z,{onClick:function(){f(c-1)},children:"\u4e0a\u4e00\u6b65"})})]})]})}function xe(){return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsx)(Re.Z,{message:"\u6570\u636e\u5bfc\u5165\uff0c\u603b\u9700\u8981\u5bfc\u5165".concat(y,"\u884c\uff0c\u5df2\u5bfc\u5165").concat(O.count,"\u884c"),type:"info"})})}),(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsx)(De.Z,{percent:parseInt((O.count/y*100).toString()),status:"active"})})}),(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:(0,I.jsx)(Re.Z,(0,h.Z)({},O))})}),(0,I.jsxs)(o.Z,{gutter:[8,8],children:[(0,I.jsx)(i.Z,{span:12,push:10,children:(0,I.jsx)(F.Z,{type:"primary",disabled:J,onClick:function(){ce(O.count)},children:"\u5f00\u59cb\u5bfc\u5165"})}),(0,I.jsx)(i.Z,{span:12,push:1,children:(0,I.jsx)(F.Z,{onClick:function(){f(c-1)},children:"\u4e0a\u4e00\u6b65"})})]})]})}function we(n){x(n),e.onShowChange&&e.onShowChange(n),n||Y()}function Ze(){return(0,I.jsx)(ze,{title:"\u5bfc\u5165".concat(e.title,"\u6570\u636e"),closeOk:!0,isModal:!0,isShow:g,stepItem:oe(),currentStep:c,onChange:function(e){if(1==e&&re(),2==e&&P&&P.data){var n=P.data;de(n)}f(e)},onCurrentStepComponent:function(e){return 0==e?me():1==e?ge():2==e?xe():(0,I.jsx)(I.Fragment,{})},onShowChange:function(e){we(e)}})}return Ze()},_e=He,qe=function(e){var n=(0,s.useState)(!1),t=(0,a.Z)(n,2),u=t[0],d=t[1],c=(0,s.useState)(null),v=(0,a.Z)(c,2),f=v[0],h=v[1],p=(0,s.useState)(0),m=(0,a.Z)(p,2),g=m[0],x=m[1],w=(0,s.useState)([]),Z=(0,a.Z)(w,2),y=Z[0],S=Z[1],j=(0,s.useState)(void 0),b=(0,a.Z)(j,2),C=b[0],k=b[1],E=(0,s.useState)({rows:[],total:0}),D=(0,a.Z)(E,2),R=D[0],T=D[1],F=(0,s.useState)(!1),M=(0,a.Z)(F,2),L=M[0],O=M[1],z=(0,s.useState)(null),V=(0,a.Z)(z,2),A=V[0],P=V[1],N=(0,s.useState)({page:1,size:10,whereList:[],sortList:[]}),B=(0,a.Z)(N,2),G=B[0],_=B[1],q=(0,s.useState)(1),K=(0,a.Z)(q,2),J=K[0],W=K[1];if((0,s.useEffect)((function(){k(void 0),h(null),_({page:1,size:10,whereList:[],sortList:[]}),x(0),S([]),T({rows:[],total:0}),$()}),[e.controller]),void 0==C)return(0,I.jsx)(I.Fragment,{});function $(){if(console.log("waypage.init"),console.log(e),e.init)e.init().then((function(e){void 0!=e&&(e.success?(k(e.data),e.data.autoload&&Q({},(function(e){T(e)}))):ee(e.message))}));else{var n,t=null!==(n=e.namespace)&&void 0!==n?n:e.controller;console.log(t+"model \u672a\u521b\u5efa\u6216init\u65b9\u6cd5\u672a\u5b9e\u73b0\uff0c\u4e0d\u80fd\u521d\u59cb\u5316page.")}}function Q(n,t){x(0),d(!0),e.search(n).then((function(e){if(null!=e)if(d(!1),void 0!=e&&e.success){if(void 0==e.data&&(e.data={rows:[],total:0}),null==e.data.rows&&(e.data.rows=[]),void 0==n.foreign&&void 0==n.childmodel&&y.length>0){var o=e.data.rows.find((function(e){return e["id"]==y[0]}));void 0!=o?(S(y),x(y.length),h(o)):(S([]),x(0),h(null))}t?t(e.data):T(e.data)}else ee(e.message)}),(function(e){console.log(e),d(!1)}))}var U=function(e){var n=null;e.isselectrow&&(n=f),e.selectmultiple&&(n=y),X(e,n)},X=function(n,t){d(!0),e.execute(n.command,t).then((function(e){console.log(e),void 0!=e&&e.success?(d(!1),r.default.success(n.name+"\u5b8c\u6210"),"form"!=(null===C||void 0===C?void 0:C.viewtype)&&(A&&A.hide(),Q(G,(function(e){T(e)})))):(d(!1),ee(e.message))}),(function(e){console.log(e),d(!1)}))};function Y(e){return"object"===typeof e&&null!==e}function ee(e){var n;console.log(e);var t=null===e||void 0===e||null===(n=e.data)||void 0===n?void 0:n.errorMessage;void 0==t&&(Y(e)&&e.message&&(t=e.message),e.response&&e.response.errorMessage&&(t=e.response.errorMessage),e.response&&e.response.message&&(t=e.response.message)),l.Z.error({visible:!0,title:"\u51fa\u9519\u4e86",icon:(0,I.jsx)(ke.Z,{}),content:(0,I.jsx)("div",{children:t})})}function ne(e,n){null!=A&&A.clear(),A.setHideSearch(!0),A.setTitle((null===C||void 0===C?void 0:C.title)+"-"+e.name),A.show(),n&&(A.setValues(n),A.setHideSearch(!1)),A.onFinish=function(n){console.log(n),X(e,n)}}function oe(n){var t;console.log("renderToolbar - model:",C),console.log("renderToolbar - data:",R),console.log("renderToolbar - selectCount:",g),console.log("renderToolbar - values:",f);var o=!!n&&{fields:null===C||void 0===C||null===(t=C.fields)||void 0===t?void 0:t.filter((function(e){var n;return null===(n=e.issearch)||void 0===n||n})),onSearch:function(e){d(!0);var n={page:1,whereList:[]};void 0!=e&&((0,H.isArray)(e)?n.whereList=e:n.whereList=[e]),_(n),W(1),Q(n,(function(e){T(e)}))},onSearchData:Q};try{return(0,I.jsx)(Ze,{attrs:null===C||void 0===C?void 0:C.commands,isselectrow:!0,selectcount:g,commandShow:!0,isshow:!n,onClick:function(n,t){if(console.log(n),"ImportData"!=n&&"importdata"!=n){if("ExportData"!=n&&"exportdata"!=n)return"add"==n?"form"==(null===C||void 0===C?void 0:C.viewtype)?(A.onFinish=function(e){console.log(e),X(t,e)},void A.submit()):void ne(t):void("edit"!=n?U(t):ne(t,f));Be(C,R.total,G,e.search,e.title+".xlsx")}else O(!0)},searchShow:o})}catch(i){return console.error("renderToolbar error:",i),(0,I.jsx)("div",{children:"\u5de5\u5177\u680f\u6e32\u67d3\u9519\u8bef"})}}function ie(){return(0,I.jsx)(te,{attr:C,data:R,isselect:!0,isexpandable:!0,loading:u,current:J,onSelectRows:function(e,n){console.log(e),console.log(n),S(n),x(n.length),h(e)},onSearchData:function(e,n){e.parent&&e.childmodel?Q(e,(function(e){n(e)})):(d(!0),W(e.page),e.whereList=G.whereList,_(e),Q(e,(function(e){T(e)})))},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(e,n){var t,o=null===C||void 0===C||null===(t=C.commands)||void 0===t?void 0:t.find((function(e){return"edit"==e.command&&e.visible}));void 0!=o&&ne(o,n)}})}function le(n){return(0,I.jsx)(be,{attr:C,title:e.title,ismodal:n,onInitFormed:function(e){P(e)},onSearchData:Q})}function re(){return"form"==(null===C||void 0===C?void 0:C.viewtype)?ae():(0,I.jsxs)(Ce.Oc,{title:e.title,children:[(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:oe(!0)})}),(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:ie()})}),(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:le(!0)})}),(0,I.jsx)(_e,{title:e.title,isShow:L,attr:C,onAdd:e.execute,form:A,onShowChange:function(e){O(e),e||Q(G)},onSearchData:Q})]})}function ae(){return(0,I.jsxs)(Ce.Oc,{title:e.title,children:[(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:oe(!1)})}),(0,I.jsx)(o.Z,{gutter:[16,16],children:(0,I.jsx)(i.Z,{span:24,children:le(!1)})})]})}return re()};function Ke(e,n){var t=n.controller;void 0!=n.namespace&&(t=n.namespace);var o=function(e){return{type:t+"/init",payload:e}},i=function(e){return{type:t+"/search",payload:e}},l=function(e){return{type:t+"/execute",payload:e}};return{dispatch:e,init:function(){return e(o({c:n.namespace+"/"+n.service+"/"+n.controller,s:n.service}))},search:function(t){var o=n.namespace+"/"+n.service+"/"+n.controller;return e(i({c:o,item:t,s:n.service}))},execute:function(t,o){var i=n.namespace+"/"+n.service+"/"+n.controller;return e(l({c:i,command:t,item:o,s:n.service}))}}}var Je=(0,u.$j)((function(){}),Ke)(qe)},20067:function(){}}]);