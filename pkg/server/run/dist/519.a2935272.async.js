(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[519],{66721:function(Zt,xn,l){"use strict";l.d(xn,{Z:function(){return Ct}});var jt=l(13062),ce=l(71230),Et=l(89032),re=l(15746),bt=l(71194),We=l(48889),wt=l(34792),tn=l(48086),F=l(2824),f=l(67294),yn=l(28216),Ft=l(58024),Me=l(39144),Dt=l(48736),an=l(27049),Tt=l(49111),Ke=l(19650),Rt=l(30887),ln=l(54689),ee=l(11849),Cn=l(69610),Zn=l(54941),jn=l(57254),En=l(7945),bn=l(24616),wn=l(63270),Fn=l(3050),Dn=l(16165),Tn=l(49101),Rn=l(73171),Mn=l(8212),Bn=l(65233),In=l(20924),On=l(25592),Mt=l(59250),Vn=l(13013),Bt=l(22385),Je=l(94199),It=l(57663),be=l(71577),An=l(57119),n=l(85893),kn=function(e){var v,E,o,a,b,M,W,B,c,D,R,h={key:(v=e.key)!==null&&v!==void 0?v:e.name,name:(E=e.name)!==null&&E!==void 0?E:"",title:(o=e.title)!==null&&o!==void 0?o:"",text:e.text,danger:(a=e.danger)!==null&&a!==void 0?a:!1,block:(b=e.block)!==null&&b!==void 0?b:!1,type:(M=e.type)!==null&&M!==void 0?M:"default",target:e.target,size:(W=e.size)!==null&&W!==void 0?W:"default",shape:(B=e.shape)!==null&&B!==void 0?B:"",icon:(c=e.icon)!==null&&c!==void 0?c:"",ghost:(D=e.ghost)!==null&&D!==void 0?D:!1,disabled:(R=e.disabled)!==null&&R!==void 0?R:!1},z=(0,f.useState)(!1),_=(0,F.Z)(z,2),u=_[0],t=_[1];function j(){return e.toolbar!=null&&e.name!=null&&e.toolbar.attrs!=null&&e.toolbar.attrs.length>0?e.toolbar.attrs.find(function(k){return k.command==e.name}):null}var I=function(){if(e.onClick!=null)try{t({delay:100});var oe=j();oe!=null&&oe.isalert?We.Z.confirm({title:"\u60A8\u786E\u8BA4\u8981\u8FDB\u884C".concat(h.text,"\u5417?"),icon:(0,n.jsx)(An.Z,{}),onOk:function(){e.onClick(h)}}):e.onClick(h)}finally{t(!1)}};function r(){return e.ismenu?(0,n.jsx)(Vn.Z,{overlay:e.menu,children:(0,n.jsx)(Je.Z,{title:h.title,children:(0,n.jsx)(be.Z,(0,ee.Z)((0,ee.Z)({},h),{},{onClick:I,loading:u,children:h.text}))})}):(0,n.jsx)(Je.Z,{title:h.title,children:(0,n.jsx)(be.Z,(0,ee.Z)((0,ee.Z)({},h),{},{onClick:I,loading:u,children:h.text}))})}return r()},Be=kn,Ot=l(47673),Ue=l(4107),Vt=l(36877),Ln=l(96607),At=l(77883),Wn=l(70507),kt=l(77576),zn=l(12028),Lt=l(43358),Pn=l(34041),Wt=l(53400),un=l(41505),on=l(76010),ze=l(96486),Ie=l(86582),zt=l(8963),Nn=l(68297),Pt=l(18106),He=l(58634),Kn=l(30381),rn=l.n(Kn),Re=l(75308);function dn(U,e,v){var E,o,a=(0,Re.MM)(e,U);if((E=e.comvtp)!==null&&E!==void 0&&E.isvtp){var b=new Map(e.comvtp.items);a=b.get(a)}if((o=e.foreign)!==null&&o!==void 0&&o.isfkey){var M=e.foreign.oneobjectfield,W=e.foreign.onedisplayname;v[M]!=null&&(a=v[M][W])}if(e.type=="boolean"&&(a=a?"\u662F":"\u5426"),e.type=="datetime"){var B,c;if(a==""||a==null)return a;var D=(B=e.datatimetype)===null||B===void 0?void 0:B.dateformat;if((c=e.datatimetype)!==null&&c!==void 0&&c.istime){var R,h;D=((R=e.datatimetype)===null||R===void 0?void 0:R.dateformat)+" "+((h=e.datatimetype)===null||h===void 0?void 0:h.timeformat)}a=rn()(a).format(D)}return a}var Hn=function(e,v,E,o){var a,b=e.attr,M=[];function W(c,D,R){var h=dn(c,D,R);return e.onFieldRender!=null?e.onFieldRender(D,h,R):D.type=="string"?(0,n.jsx)(Je.Z,{placement:"topLeft",title:h,children:h}):(0,n.jsx)(n.Fragment,{children:h})}var B=function(D,R){return e.onColumnToEdit?e.onColumnToEdit(D,R):(e.onGetFieldToEdit&&(D=e.onGetFieldToEdit(D,R)),o(R),(0,n.jsx)($e,{attr:D,value:E[D.field],onChange:function(z){if(!(e.onRowDataChangeing!=null&&!e.onRowDataChangeing(R,D.field,z))){console.log(z);var _=Object.assign({},E);R[D.field]=z,_[D.field]=z,o(_)}},onSearchValueChange:function(z){e.onSearchValueChange&&e.onSearchValueChange(D,R,z)},onSearchBefore:function(z,_){e.onSearchData&&e.onSearchData(z,function(u){_(u.model,u)})},onSearchData:e.onSearchData}))};return b==null||(a=b.fields)===null||a===void 0||a.filter(function(c){return c.visible}).forEach(function(c){var D;M.push({dataIndex:c.field,title:c.title,sorter:(D=c.sorter)!==null&&D!==void 0?D:!0,ellipsis:{showTitle:!1},render:function(h,z){if(z!=null)return v&&z.editable&&(c.isedit==null||c.isedit==!0)?B(c,z):W(h,c,z)}})}),M},Gn=He.Z.TabPane,Jn=function U(e){var v,E,o,a,b,M=(0,f.useState)((v=e.loading)!==null&&v!==void 0?v:!1),W=(0,F.Z)(M,2),B=W[0],c=W[1],D=(0,f.useState)((E=e.data)!==null&&E!==void 0?E:{rows:[],total:0}),R=(0,F.Z)(D,2),h=R[0],z=R[1],_=(0,f.useState)((o=e.rowedit)!==null&&o!==void 0?o:!1),u=(0,F.Z)(_,2),t=u[0],j=u[1],I=(0,f.useState)((a=e.current)!==null&&a!==void 0?a:1),r=(0,F.Z)(I,2),k=r[0],oe=r[1],H=(0,f.useState)(10),ve=(0,F.Z)(H,2),de=ve[0],he=ve[1],Ze=(0,f.useState)([]),le=(0,F.Z)(Ze,2),P=le[0],Q=le[1],w=(0,f.useState)((b=e.selectType)!==null&&b!==void 0?b:"radio"),d=(0,F.Z)(w,2),Y=d[0],ne=d[1],Se=(0,f.useState)(),ge=(0,F.Z)(Se,2),me=ge[0],xe=ge[1],$=(0,f.useState)({}),m=(0,F.Z)($,2),x=m[0],i=m[1];(0,f.useEffect)(function(){var y;z((y=e.data)!==null&&y!==void 0?y:{rows:[],total:0})},[e.data]),(0,f.useEffect)(function(){var y;j((y=e.rowedit)!==null&&y!==void 0?y:!1)},[e.rowedit]),(0,f.useEffect)(function(){var y;c((y=e.loading)!==null&&y!==void 0?y:!1)},[e.loading]),(0,f.useEffect)(function(){var y;oe((y=e.current)!==null&&y!==void 0?y:1)},[e.current]);var g=function(Z,O,N){var p,fe,S=function(T){c(!1),z(T)},s=function(T){if(T.column==null)return"";var se={name:T.field,isdesc:!1};return T.order=="descend"&&(se.isdesc=!0),se};c(!0),oe((p=Z.current)!==null&&p!==void 0?p:1),he((fe=Z.pageSize)!==null&&fe!==void 0?fe:10);try{var C,V,X={page:(C=Z.current)!==null&&C!==void 0?C:1,size:(V=Z.pageSize)!==null&&V!==void 0?V:10,sortList:[]};if(N!=null)if((0,ze.isArray)(N))N.forEach(function(ae){var T=s(ae);T!=""&&ae.sortList.push(T)});else{var L=s(N);L!=""&&X.sortList.push(L)}e.onSearchData!=null&&e.onSearchData(X,S)}finally{c(!1)}},A=function(Z,O){var N=P.length<=Z.length;if(Q(Z),e.onSelectRows!=null)if(Z.length>0){var p=O[O.length-1];N||(p=null,Z.length==1&&(p=h.rows.find(function(fe){return fe.id==Z[0]}))),e.onSelectRows(p,Z,N)}else e.onSelectRows(null,Z,!1)},G=function(){if(!!e.isselect)return{selectedRowKeys:P,fixed:!0,type:Y,columnTitle:me,hideSelectAll:!1,columnWidth:"32px",onChange:A}};function ue(y){y=="checkbox"&&(ne("radio"),setSelecteds([]),e.onSelectStateChange&&e.onSelectStateChange(!1),xe(ie()))}function ie(){return(0,n.jsx)(be.Z,{type:"link",onClick:function(){xe(null),ne("checkbox"),setSelecteds([]),e.onSelectStateChange&&e.onSelectStateChange(!0)},children:"\u591A\u9009"})}function Ee(y){if(e.isedit){y.editable=!t;var Z=(0,Ie.Z)(h.rows);Z.forEach(function(O){O.id==y.id?O.editable=!t:O.editable&&(O.editable=!1)}),j(!t)}}function we(){var y;if(e.isexpandable&&(e==null||(y=e.attr)===null||y===void 0?void 0:y.childmodels)!=null&&e.attr.childmodels.length>0)return e.onExpandable==null?{onExpand:function(O,N){var p;if(!!O&&(ke(N,te),(e==null||(p=e.attr)===null||p===void 0?void 0:p.childmodels)!=null&&e.attr.childmodels.length>0)){var fe,S=e==null||(fe=e.attr)===null||fe===void 0?void 0:fe.childmodels[0];if(N[S.propertyname]||(N[S.propertyname]=[]),N[S.propertyname].total=N[S.propertyname].length,N[S.propertyname].total==0){var s={page:1,size:10};Fe(s,S,N)}}},expandedRowRender:Pe}:e.onExpandable(e.attr)}function Fe(y,Z,O){y.childmodel=Z,y.parent=O,e.onSearchData!=null&&e.onSearchData(y,function(N){var p=(0,Ie.Z)(h.rows),fe=p.findIndex(function(S){return S.id==O.id});p[fe][Z.propertyname]=N.rows,p[fe][Z.propertyname].total1=N.total,z({rows:p,total:h.total})})}var Ae=function(Z,O){if(e.onExpandedRowTabPane){var N=e.onExpandedRowTabPane(Z,O);if(N!=null)return N}return(0,n.jsx)(U,{isselect:!1,isedit:!1,isclosecard:!0,attr:Z,data:{rows:O[Z.propertyname],total:O[Z.propertyname].total1},onSearchData:function(fe){Fe(fe,Z,O)}},"id")},Pe=function(Z){var O;if((e==null||(O=e.attr)===null||O===void 0?void 0:O.childmodels)!=null&&e.attr.childmodels.length>0)return(0,n.jsx)(He.Z,{defaultActiveKey:"0",onChange:function(p){var fe=e.attr.childmodels[Number(p)];Fe({},fe,Z)},children:e.attr.childmodels.map(function(N,p){return Z[N.propertyname]||(Z[N.propertyname]=[]),Z[N.propertyname].total=Z[N.propertyname].length,(0,n.jsx)(Gn,{tab:N.title,children:Ae(N,Z)},p)})})},ke=function(Z,O){try{var N,p;if(((N=G())===null||N===void 0?void 0:N.type)=="radio"&&A([Z[O]],[Z]),((p=G())===null||p===void 0?void 0:p.type)=="checkbox"){var fe=Z[O],S=[];P.includes(fe)?S=P.filter(function(s){return s!=fe}):(S=(0,Ie.Z)(P),S.push(fe)),A(S,[Z])}}catch(s){console.log(s)}},te="id";function J(){var y=Hn(e,t,x,i);return(0,n.jsx)(Nn.Z,{bordered:!0,rowKey:te,columns:y,rowSelection:G(),scroll:{x:y.length*150},dataSource:h.rows,pagination:{current:k,pageSize:de,total:h.total,hideOnSinglePage:!0,showTotal:function(O){return"\u603B ".concat(O," \u884C")}},loading:B,expandable:we(),onChange:g,onRow:function(O){return{onClick:function(p){p.stopPropagation();try{var fe,S;if(((fe=G())===null||fe===void 0?void 0:fe.type)=="radio"&&A([O[te]],[O]),((S=G())===null||S===void 0?void 0:S.type)=="checkbox"){var s=O[te],C=[];P.includes(s)?C=P.filter(function(V){return V!=s}):(C=(0,Ie.Z)(P),C.push(s)),A(C,[O])}}finally{e.onRowClick&&e.onRowClick(p,O)}},onDoubleClick:function(p){p.stopPropagation(),Ee(O),e.onRowDoubleClick&&e.onRowDoubleClick(p,O)},onMouseEnter:function(p){e.onRowMouseEnter&&e.onRowMouseEnter(p,O)},onMouseLeave:function(p){e.onMouseLeave&&e.onMouseLeave(p,O)}}}})}function K(){return e.isclosecard?J():(0,n.jsx)(Me.Z,{children:J()})}return K()},Qe=Jn,Un=l(61193),Qn=l.n(Un),Xn=function(e){var v=(0,f.useState)({left:0,top:0,bottom:0,right:0}),E=(0,F.Z)(v,2),o=E[0],a=E[1],b=(0,f.useState)(!0),M=(0,F.Z)(b,2),W=M[0],B=M[1],c=f.createRef(),D=function(_,u){var t,j,I,r=(t=window)===null||t===void 0||(j=t.document)===null||j===void 0?void 0:j.documentElement,k=r.clientWidth,oe=r.clientHeight,H=c==null||(I=c.current)===null||I===void 0?void 0:I.getBoundingClientRect();a({left:-(H==null?void 0:H.left)+(u==null?void 0:u.x),right:k-((H==null?void 0:H.right)-(u==null?void 0:u.x)),top:-(H==null?void 0:H.top)+(u==null?void 0:u.y),bottom:oe-((H==null?void 0:H.bottom)-(u==null?void 0:u.y))})};function R(){return(0,n.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:function(){W&&B(!1)},onMouseOut:function(){B(!0)},onFocus:function(){},onBlur:function(){},children:e.title})}function h(){return(0,n.jsx)(We.Z,(0,ee.Z)((0,ee.Z)({},e),{},{title:R(),modalRender:function(_){return(0,n.jsx)(Qn(),{disabled:W,bounds:o,onStart:function(t,j){return D(t,j)},children:(0,n.jsx)("div",{ref:c,children:_})})}}))}return h()},Xe=Xn,Yn=function(e){var v,E,o=(0,f.useState)([]),a=(0,F.Z)(o,2),b=a[0],M=a[1],W=(0,f.useState)(null),B=(0,F.Z)(W,2),c=B[0],D=B[1],R=(0,f.useState)(!1),h=(0,F.Z)(R,2),z=h[0],_=h[1],u=(0,f.useState)(e.data),t=(0,F.Z)(u,2),j=t[0],I=t[1],r=(0,f.useState)(Y()),k=(0,F.Z)(r,1),oe=k[0],H=(0,f.useState)((v=e.commandShow)!==null&&v!==void 0?v:!0),ve=(0,F.Z)(H,1),de=ve[0],he=(0,f.useState)((E=e.modelshow)!==null&&E!==void 0?E:!1),Ze=(0,F.Z)(he,2),le=Ze[0],P=Ze[1];(0,f.useEffect)(function(){I(e.data)},[e.data]),(0,f.useEffect)(function(){var $;P(($=e.modelshow)!==null&&$!==void 0?$:!1)},[e.modelshow]);var Q={page:1,size:10,whereList:[],sortList:[]},w=function(){var m,x,i=rn()().valueOf().toString(),g={id:i,isnew:!0,editable:!0};if((m=e.model)===null||m===void 0||(x=m.fields)===null||x===void 0||x.forEach(function(ie){ie.field!=null&&ie.field!="id"&&(g[ie.field]=null)}),!(e.onAddRowing!=null&&!e.onAddRowing(g))){var A=[],G=1;j!=null&&j.rows!=null&&(A=(0,Ie.Z)(j.rows),A.forEach(function(ie){ie.editable=!1}),G=j.total+G);var ue=[g].concat((0,Ie.Z)(A));_(!0),e.onAdded!=null&&e.onAdded(g),e.onDataChange!=null?e.onDataChange({rows:ue,total:G},g,"add"):I({rows:ue,total:G})}},d=function(){if(b.length>0){var m=[],x=[],i=(0,Ie.Z)(j.rows);b.forEach(function(A){if(A!=null){var G=i.findIndex(function(ie){return ie.id==A?e.onRemoveRowing!=null&&!e.onRemoveRowing(ie)?!1:(ie.isnew||m.push(A),!0):!1}),ue=i.splice(G,1);e.onRemoveed!=null&&e.onRemoveed(ue[0]),x.push(ue[0])}});var g={rows:i,total:j.total-1};e.onDataChange!=null?x.length>0&&e.onDataChange(g,x,"remove"):I(g)}};function Y(){var $=[];return e.model!=null&&(e.model.isadd&&$.push({command:"add",name:"\u65B0\u589E"}),e.model.isremove&&$.push({command:"remove",name:"\u5220\u9664",isselectrow:!0,selectmultiple:!0})),e.onGetCommands!=null&&($=e.onGetCommands($)),$}function ne($,m){P($),e.onModalChange&&e.onModalChange($,m)}function Se(){var $;if(!e.closetoolbar)return(0,n.jsx)(fn,{iscircle:e.iscirclebutton,commandShow:de,selectcount:b.length,attrs:oe,isclosecard:!1,onClick:function(x,i){e.onCommandClicking&&e.onCommandClicking(i),x=="add"&&w(),x=="remove"&&d(),e.onCommandClicked&&e.onCommandClicked(i)},searchShow:e.closesearch?!1:{fields:($=e.model)===null||$===void 0?void 0:$.fields,onSearch:function(x){Q.whereList=[],x!=null&&((0,ze.isArray)(x)?Q.whereList=x:Q.whereList=[x]),Q.page=1,Q.sortList=[],e.onSearchData!=null&&e.onSearchData(Q,function(i){I(i)})},onSearchData:e.onSearchData}})}function ge(){var $,m,x;return(0,n.jsx)(Qe,{attr:e.model,data:j,isedit:!e.closeedit,rowedit:z,selectType:($=e.selectType)!==null&&$!==void 0?$:"checkbox",isselect:(m=e.isselect)!==null&&m!==void 0?m:!0,isclosecard:(x=e.closecard)!==null&&x!==void 0?x:!0,onSelectRows:function(g,A){console.log(g),console.log(A),M(A),D(g)},onSearchData:function(g,A){if(g.foreign&&g.field){e.onSearchData&&e.onSearchData(g,A);return}Q.page=g.page,Q.size=g.size,Q.sortList=g.sortList,e.onSearchData!=null&&e.onSearchData(Q,function(G){I(G)})},onRowDataChangeing:function(g,A,G){return e.onEditRowing!=null?e.onEditRowing(g,A,G):(!g.isnew&&e.onDataChange!=null&&e.onDataChange(j,g,"edit"),!0)},onRowDoubleClick:function(g,A){A.editable!=null&&_(A.editable),e.ismodal&&le&&ne(!1,A)},onGetFieldToEdit:e.onGetFieldToEdit,onColumnToEdit:e.onColumnToEdit,onSearchValueChange:function(g,A,G){A.isnew&&(A[G.rowfield]=G.row),e.onSearchValueChange&&e.onSearchValueChange(g,A,G)}})}function me(){return e.closecard?(0,n.jsxs)(n.Fragment,{children:[Se(),ge()]}):(0,n.jsxs)(Me.Z,{children:[Se(),ge()]})}function xe(){if(e.ismodal){var $;return(0,n.jsx)(Xe,{title:($=e.model)===null||$===void 0?void 0:$.title,width:600,visible:le,onCancel:function(){ne(!1,null)},onOk:function(){ne(!1,c)},children:(0,n.jsx)(n.Fragment,{children:me()})})}else return me()}return xe()},Ye=Yn,$n=un.Z.RangePicker,qn=Ue.Z.Search,je;(function(U){U.Input="Input",U.TextArea="Input.TextArea",U.InputNumber="InputNumber",U.Switch="Switch",U.DatePicker="DatePicker",U.RangePicker="RangePicker",U.Search="Input.Search",U.Avatar="Avatar",U.Select="Select"})(je||(je={}));var sn=function(e){var v,E={maxLength:500,size:"middle",placeholder:"",disabled:(v=e.disabled)!==null&&v!==void 0?v:!1,style:{width:"100%"},texttype:je.Input};for(var o in E)e.options!=null&&e.options[o]!=null&&(E[o]=e.options[o]);return e.width!=null&&(E.style.width=e.width),E.texttype=_n(e,E),E},_n=function(e,v){var E=e.textType,o=e.attr;if(o!=null){if((o.type=="int"||o.type=="int32"||o.type=="int64"||o.type=="decimal")&&(E=je.InputNumber,v.min=o.min,o.precision!=null&&o.precision>0&&(v.precision=o.precision),v.picker=void 0),o.type=="datetime"&&(E=je.DatePicker),o.type=="boolean"&&(E=je.Switch,e.search)){E=je.Select;var a=[{label:"\u662F",value:!0},{label:"\u5426",value:!1}];v.options=a}if(o.comvtp!=null&&o.comvtp.isvtp){E=je.Select;var b=[];(0,ze.isMap)(o.comvtp.items)||(o.comvtp.items=new Map(o.comvtp.items)),o.comvtp.items.forEach(function(M,W){b.push({label:M,value:W})}),v.options=b}o.foreign!=null&&o.foreign.isfkey&&(E=je.Search),o.length!=null&&o.length>0&&(v.maxLength=o.length),e.disabled==null&&o.disabled!=null&&(v.disabled=o.disabled),e.search&&(v.disabled=!1)}return E==null&&(E=je.Input),E},pn=function(e){var v=(0,f.useState)(function(){return sn(e)}),E=(0,F.Z)(v,2),o=E[0],a=E[1],b=(0,f.useState)({isshow:!1,model:void 0,data:void 0}),M=(0,F.Z)(b,2),W=M[0],B=M[1],c=(0,f.useState)({row:void 0,value:"",text:"",rowfield:""}),D=(0,F.Z)(c,2),R=D[0],h=D[1],z=(0,on.Z)(e.defaultValue,{value:oe(e.value),onChange:function(d,Y){if(console.log(d),e.onChange!=null){var ne=H(d);e.onChange(ne)}}}),_=(0,F.Z)(z,2),u=_[0],t=_[1],j=(0,on.Z)([],{value:e.value,onChange:function(d,Y){e.onChange!=null&&e.onChange(d)}}),I=(0,F.Z)(j,2),r=I[0],k=I[1];(0,f.useEffect)(function(){if(e.search){var w;R.field!=((w=e.attr)===null||w===void 0?void 0:w.field)&&ve(null),a(sn(e))}},[e.attr]),(0,f.useEffect)(function(){var w;if(((w=e.attr)===null||w===void 0?void 0:w.foreign)!=null&&e.attr.foreign.isfkey&&e.children!=null&&!e.search&&R.row==null&&e.value!=null){var d=e.children[e.attr.foreign.oneobjectfield];ve(d)}},[e.value]);function oe(w){var d=e.attr;return(0,Re.MM)(d,w)}function H(w){var d=e.attr;switch(o.texttype){case je.Select:return(d==null?void 0:d.type)=="string"?w.label:(0,Re.Nz)(d,w)}return(0,Re.Nz)(d,w)}function ve(w){var d={value:"",text:"",row:void 0,rowfield:"",field:""};if(w){var Y,ne,Se,ge,me,xe,$,m,x,i,g=(Y=(ne=e.attr)===null||ne===void 0||(Se=ne.foreign)===null||Se===void 0?void 0:Se.oneobjectfieldkey)!==null&&Y!==void 0?Y:"",A=(ge=(me=e.attr)===null||me===void 0||(xe=me.foreign)===null||xe===void 0?void 0:xe.onedisplayname)!==null&&ge!==void 0?ge:"";console.log(g+"---"+A),d.row=w,d.value=w[g],d.text=w[A],d.rowfield=($=(m=e.attr)===null||m===void 0||(x=m.foreign)===null||x===void 0?void 0:x.oneobjectfield)!==null&&$!==void 0?$:"",d.field=(i=e.attr)===null||i===void 0?void 0:i.field,console.log(d)}h(d),t(d.value),e.onSearchValueChange&&e.onSearchValueChange(d)}function de(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(qn,(0,ee.Z)((0,ee.Z)({},o),{},{size:"middle",value:R.text,onSearch:function(d){if(e.onSearchBefore!=null){var Y,ne={foreign:(Y=e.attr)===null||Y===void 0?void 0:Y.foreign,value:d,field:e.attr};e.onSearchBefore(ne,function(Se,ge){var me;(Se.title==null||Se.title=="")&&(Se.title=(me=e.attr)===null||me===void 0?void 0:me.title),B({isshow:!0,model:Se,data:ge})})}}})),(0,n.jsx)(Ye,{ismodal:!0,modelshow:W.isshow,model:W.model,data:W.data,closeedit:!0,commandShow:!1,selectType:"radio",closecard:!0,onModalChange:function(d,Y){var ne=(0,ee.Z)({},W);ne.isshow=d,console.log(ne),B(ne),ve(Y)},onSearchData:function(d,Y){var ne;d.field=e.attr,d.foreign=(ne=e.attr)===null||ne===void 0?void 0:ne.foreign,e.onSearchData!=null&&e.onSearchData(d,Y)}})]})}function he(){var w=e.attr;return(w==null?void 0:w.type)=="string"&&(o.labelInValue=!0),(0,n.jsx)(Pn.Z,(0,ee.Z)((0,ee.Z)({},o),{},{size:"middle",value:u,onChange:t}))}function Ze(){return(0,n.jsx)(zn.Z,{size:"default",checked:u,onChange:t})}function le(){var w=e.attr,d=void 0,Y=void 0;if(console.log(w),w&&w.datatimetype&&(w.datatimetype.istime&&(d={format:w.datatimetype.timeformat}),Y=w.datatimetype.dateformat,w.datatimetype.istime&&(Y=Y+" "+w.datatimetype.timeformat)),e.search){var ne;return(0,n.jsx)($n,{size:"middle",showTime:d,format:Y,style:o.style,value:r,allowEmpty:[!0,!0],picker:(ne=e.options)===null||ne===void 0?void 0:ne.picker,onChange:k})}else return(0,n.jsx)(un.Z,(0,ee.Z)((0,ee.Z)({},o),{},{format:Y,showTime:d,size:"middle",picker:"date",value:u,onChange:t}))}function P(){return(0,n.jsx)(Wn.Z,(0,ee.Z)((0,ee.Z)({},o),{},{value:u,onChange:t}))}function Q(){switch(o.texttype){case je.InputNumber:return P();case je.DatePicker:return le();case je.Switch:return Ze();case je.Select:return he();case je.Search:return de()}return(0,n.jsx)(Ue.Z,(0,ee.Z)((0,ee.Z)({},o),{},{size:"middle",value:u,onChange:function(d){t(d.target.value)}}))}return Q()},$e=pn,et=l(76570),Nt=null,nt=function(e){var v=new Map;v.set("string",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5305\u542B",value:"like"},{label:"\u4E3A\u7A7A",value:"isnull"},{label:"\u4E0D\u4E3A\u7A7A",value:"isnotnull"},{label:"\u5DE6\u5339\u914D",value:"left"},{label:"\u53F3\u5339\u914D",value:"right"}]),v.set("int",[{label:"\u7B49\u4E8E",value:"="},{label:"\u5927\u4E8E",value:">"},{label:"\u5C0F\u4E8E",value:"<"}]),v.set("datetime",[{label:"\u8303\u56F4",value:"date"},{label:"\u5468",value:"week"},{label:"\u6708",value:"month"},{label:"\u5B63",value:"quarter"},{label:"\u5E74",value:"year"}]);var E=(0,f.useState)({value:"",attr:{type:"string"}}),o=(0,F.Z)(E,2),a=o[0],b=o[1],M=(0,f.useState)(""),W=(0,F.Z)(M,2),B=W[0],c=W[1],D=(0,f.useState)({type:"string"}),R=(0,F.Z)(D,2),h=R[0],z=R[1],_=(0,f.useState)({name:"*",type:"string",symbol:""}),u=(0,F.Z)(_,2),t=u[0],j=u[1],I=(0,f.useState)({picker:null}),r=(0,F.Z)(I,2),k=r[0],oe=r[1],H=[{label:"\u5168\u90E8",value:"*"}];e.fields!=null&&e.fields.forEach(function(le){if(le.issearch){var P,Q=(P=le.searchsymbol)!==null&&P!==void 0?P:v.get(le.type);le.type=="datetime"&&(Q=v.get(le.type)),le.type=="decimal"&&(Q=v.get("int")),le.foreign&&le.foreign.isfkey&&(Q=void 0),H.push({label:le.title,value:le.field,children:Q})}});function ve(){return(0,n.jsx)(Ln.Z,{style:{width:"140px"},options:H,allowClear:!1,defaultValue:["*"],expandTrigger:"hover",onChange:function(P){var Q,w=P[0],d=(Q=e.fields)===null||Q===void 0?void 0:Q.find(function(ne){return ne.field==w});if(j({name:w,symbol:P[1],type:d==null?void 0:d.type}),(t.name!=w||(d==null?void 0:d.type)=="datetime")&&(b(Object.assign(a,{value:"",attr:d})),c(""),z(d),(d==null?void 0:d.type)=="datetime")){var Y=(0,ee.Z)({},k);Y.picker=P[1],oe(Y)}}})}function de(){return(0,n.jsx)($e,{width:"240px",options:k,search:!0,name:t.name,attr:h,value:B,onChange:function(P){c(P),b({value:P,attr:a.attr})},onSearchBefore:function(P,Q){console.log(P),e.onSearchData&&e.onSearchData(P,function(w){Q(w.model,w)})},onSearchData:e.onSearchData})}function he(){return(0,n.jsx)(be.Z,{style:{width:"70px"},type:"primary",icon:(0,n.jsx)(et.Z,{}),onClick:function(){console.log(a);var P=(0,Re.Nz)(h,a.value);console.log(P);var Q={name:t.name,symbol:t.symbol,value:P};if(Q.name=="*"&&Q.value=="")e.onSearch();else{if(h.type=="datetime"&&a.value!=""&&(0,ze.isArray)(P)){var w=[];return a.value[0]!=null&&a.value[0]!=""&&a.value[0]!=null&&a.value[0]!="Invalid date"&&(Q.symbol=">=",Q.value=(0,Re.q3)(h,a.value[0]),w.push(Q)),a.value[1]!=null&&a.value[1]!=""&&a.value[1]!=null&&a.value[1]!="Invalid date"&&w.push({name:t.name,symbol:"<=",value:(0,Re.q3)(h,a.value[1])}),console.log(w),e.onSearch(w)}e.onSearch(Q)}}})}function Ze(){return(0,n.jsxs)(Ue.Z.Group,{compact:!0,children:[ve(),de(),he()]})}return Ze()},tt=nt,at=function(){function U(){(0,Cn.Z)(this,U),this.printText="\u6253\u5370",this.setText="\u8BBE\u7F6E",this.helpText="\u5E2E\u52A9",this.aboutText="\u5173\u4E8E"}return(0,Zn.Z)(U,[{key:"onPrint",value:function(v){}},{key:"onSet",value:function(v){}},{key:"onHelp",value:function(v){}},{key:"onAbout",value:function(v){}}]),U}(),it=function(e){var v=["add","create"],E=["remove","delete"],o=["update","edit"],a=["ImportData","import"],b=["ExportData","export"];function M(){var t,j=[],I=new Map;return(t=e.attrs)===null||t===void 0||t.forEach(function(r){if(r.issplit&&r.splitname!=null)if(I.has(r.splitname)){var k=I.get(r.splitname);k==null||k.push(r)}else I.set(r.splitname,[r]);else j.push(r)}),(0,n.jsx)(Ke.Z,{wrap:!0,children:j.map(function(r){if(I.has(r.command)){var k,oe=(0,n.jsx)(ln.Z,{children:(k=I.get(r.command))===null||k===void 0?void 0:k.map(function(H,ve){return(0,n.jsx)(ln.Z.Item,{children:(0,n.jsx)(Be,(0,ee.Z)((0,ee.Z)({},h(H)),{},{onClick:function(){return R(H.command,H)},toolbar:e}),ve)},ve)})});return(0,n.jsx)(Be,(0,ee.Z)((0,ee.Z)({},h(r)),{},{icon:(0,n.jsx)(jn.Z,{}),ismenu:!0,menu:oe,onClick:function(){return R(r.command,r)},toolbar:e}))}else return(0,n.jsx)(Be,(0,ee.Z)((0,ee.Z)({},h(r)),{},{onClick:function(){return R(r.command,r)},toolbar:e}))})})}function W(t){return e.isselectrow?e.onCommandDisabled!=null?e.onCommandDisabled(t):e.selectcount==1&&t.isselectrow||e.selectcount!=null&&e.selectcount>1&&t.isselectrow&&t.selectmultiple?!1:t.isselectrow:!1}function B(){if(e.helpShow!=null&&e.helpShow!=!1){var t,j,I,r,k,oe,H,ve,de,he,Ze=(0,f.useState)({isprint:(t=(j=e.helpShow)===null||j===void 0?void 0:j.isprint)!==null&&t!==void 0?t:!1,isset:(I=(r=e.helpShow)===null||r===void 0?void 0:r.isset)!==null&&I!==void 0?I:!1,ishelp:(k=(oe=e.helpShow)===null||oe===void 0?void 0:oe.ishelp)!==null&&k!==void 0?k:!1,isabout:(H=(ve=e.helpShow)===null||ve===void 0?void 0:ve.isabout)!==null&&H!==void 0?H:!1,wvh:(de=(he=e.helpShow)===null||he===void 0?void 0:he.wvh)!==null&&de!==void 0?de:new at}),le=(0,F.Z)(Ze,2),P=le[0],Q=le[1];return(0,n.jsx)(Ke.Z,{wrap:!0,children:c(P)})}}function c(t){var j=[];if(t.isprint){var I;j.push((0,n.jsx)(Be,{title:(I=t.wvh)===null||I===void 0?void 0:I.printText,name:"print",shape:"circle",icon:(0,n.jsx)(En.Z,{}),onClick:R}))}if(t.isset){var r;j.push((0,n.jsx)(Be,{title:(r=t.wvh)===null||r===void 0?void 0:r.setText,name:"set",shape:"circle",icon:(0,n.jsx)(bn.Z,{}),onClick:R}))}if(t.ishelp){var k;j.push((0,n.jsx)(Be,{title:(k=t.wvh)===null||k===void 0?void 0:k.helpText,name:"help",shape:"circle",icon:(0,n.jsx)(wn.Z,{}),onClick:R}))}if(t.isabout){var oe;j.push((0,n.jsx)(Be,{title:(oe=t.wvh)===null||oe===void 0?void 0:oe.aboutText,name:"about",shape:"circle",icon:(0,n.jsx)(Fn.Z,{}),onClick:R}))}return j.length>0&&j.unshift((0,n.jsx)(an.Z,{type:"vertical"})),j.map(function(H){return H})}function D(){if(e.searchShow!=null&&e.searchShow!=!1)return(0,n.jsx)(tt,(0,ee.Z)({},e.searchShow))}var R=function(j,I){e.onClick!=null&&e.onClick(j,I)};function h(t){var j,I={name:t.command,title:t.title,text:t.name,danger:!1,block:!1,type:"default",size:"default",shape:"",loading:!1,icon:"",ghost:!1,disabled:!1};return I.disabled=(j=W(t))!==null&&j!==void 0?j:!1,I=z(I),e.iscircle&&(I.shape="circle",I.title=I.text,I.text=""),I}function z(t){return v.includes(t.name)&&(t.type="primary",t.icon=(0,n.jsx)(Dn.Z,{component:Tn.Z})),E.includes(t.name)&&(t.type="danger",t.icon=(0,n.jsx)(Rn.Z,{})),o.includes(t.name)&&(t.icon=(0,n.jsx)(Mn.Z,{})),a.includes(t.name)&&(t.icon=(0,n.jsx)(Bn.Z,{})),b.includes(t.name)&&(t.icon=(0,n.jsx)(In.Z,{})),t.icon==""&&(t.icon=(0,n.jsx)(On.Z,{})),t}var _=function(j){return j.length==3?(0,n.jsxs)(ce.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:10,children:(0,n.jsx)(ce.Z,{justify:"start",children:j[0]})}),(0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)(ce.Z,{justify:"end",children:j[1]})}),(0,n.jsx)(re.Z,{span:6,children:(0,n.jsx)(ce.Z,{justify:"end",children:j[2]})})]}):j.length==2?(0,n.jsxs)(ce.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(ce.Z,{justify:"start",children:j[0]})}),(0,n.jsx)(re.Z,{span:12,children:(0,n.jsx)(ce.Z,{justify:"end",children:j[1]})})]}):j.length==1?(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(ce.Z,{justify:"start",children:j[0]})})}):(0,n.jsx)(n.Fragment,{})};function u(){var t=[];return e.searchShow!=null&&e.searchShow!=!1&&t.push((0,n.jsx)(re.Z,{children:D()})),e.commandShow!=null&&e.commandShow!=!1&&t.push((0,n.jsx)(re.Z,{children:M()})),e.helpShow!=null&&e.helpShow!=!1&&t.push((0,n.jsx)(re.Z,{children:B()})),e.isclosecard?_(t):(0,n.jsx)(Me.Z,{children:_(t)})}return u()},fn=it,Kt=l(9715),qe=l(22712),lt=He.Z.TabPane,ut=function(e){var v,E=qe.Z.useForm(),o=(0,F.Z)(E,1),a=o[0],b=(0,f.useState)(e.title),M=(0,F.Z)(b,2),W=M[0],B=M[1],c=(0,f.useState)((v=e.isshow)!==null&&v!==void 0?v:!1),D=(0,F.Z)(c,2),R=D[0],h=D[1],z=(0,f.useState)(Q(e.attr)),_=(0,F.Z)(z,2),u=_[0],t=_[1],j=(0,f.useState)(function(){return d(e.values)}),I=(0,F.Z)(j,2),r=I[0],k=I[1],oe=(0,f.useState)(!1),H=(0,F.Z)(oe,2),ve=H[0],de=H[1],he=(0,f.useState)(!1),Ze=(0,F.Z)(he,2),le=Ze[0],P=Ze[1];(0,f.useEffect)(function(){console.log(e.values),e.values!=null?k(d(e.values)):Y()},[e.values]),(0,f.useEffect)(function(){t(Q(e.attr))},[e.attr]);function Q(m){var x,i;return{items:m==null||(x=m.fields)===null||x===void 0?void 0:x.filter(function(g){return g.visible&&g.isedit}),models:m==null||(i=m.childmodels)===null||i===void 0?void 0:i.filter(function(g){return g.propertyname==null&&(g.propertyname=g.name),g.visible})}}function w(){var m,x=[];return(m=u.items)===null||m===void 0||m.forEach(function(i){var g=ne(e.attr,i);e.onInitTextBox!=null&&e.onInitTextBox(i,txtprops),x.push((0,n.jsx)(re.Z,{span:8,children:(0,n.jsx)(qe.Z.Item,(0,ee.Z)((0,ee.Z)({},g),{},{children:(0,n.jsx)($e,{attr:i,defaultValue:i.defaultvalue,onSearchBefore:function(G,ue){e.onSearchData!=null&&e.onSearchData(G,function(ie){ue(ie.model,ie)})},onSearchData:function(G,ue){e.onSearchData&&e.onSearchData(G,ue)},children:r})}),i.field)}))}),e.onInitFormed!=null&&(a.setFieldDisabled=function(i,g){var A;(A=u.items)===null||A===void 0||A.forEach(function(G){var ue;((ue=G.field)===null||ue===void 0?void 0:ue.toLocaleLowerCase())==i.toLocaleLowerCase()&&(G.disabled=g)}),t(u)},a.setTitle=function(i){B(i)},a.show=function(){h(!0)},a.hide=function(){h(!1)},a.setValues=function(i){k(d(i))},a.clear=function(){Y()},a.setHideSearch=function(i){P(i)},a.setHideToolbar=function(i){de(i)},e.onInitFormed(a)),x}function d(m){var x;return m==null&&(m={}),a.setFieldsValue(m),u.models!=null&&((x=u.models)===null||x===void 0?void 0:x.length)>0&&(console.log(u),u.models.forEach(function(i){m[i.propertyname]?m[i.propertyname].total=m[i.propertyname].length:(m[i.propertyname]=[],m[i.propertyname].total=0),i.removeRows=[]})),m}function Y(){var m;a.resetFields();var x={};(m=u.models)===null||m===void 0||m.forEach(function(i){x[i.propertyname]||(x[i.propertyname]=[],x[i.propertyname].total=0)}),k(x)}function ne(m,x){var i={};i.name=x.field,i.label=x.title;var g=Se(x);return x.disabled||(i.rules=g),e.onInitItem!=null&&e.onInitItem(x,i),i}function Se(m){var x,i=[];if(m.required&&i.push({required:m.required}),(x=m.length)!==null&&x!==void 0?x:0>0){var g;i.push({max:(g=m.length)!==null&&g!==void 0?g:500,type:(0,Re.mc)(m.type)})}return e.onFieldRules!=null&&(i=e.onFieldRules(m,i)),i}var ge=function(x){var i,g=Object.assign({},r);for(var A in x)g[A]=x[A];return u.models!=null&&((i=u.models)===null||i===void 0?void 0:i.length)>0&&u.models.forEach(function(G){var ue;g[G.propertyname]!=null&&g[G.propertyname].forEach(function(ie){ie.isnew?ie.modelState=1:ie.modelState=2}),(ue=G.removeRows)===null||ue===void 0||ue.forEach(function(ie){ie.modelState=3,g[G.propertyname].push(ie)})}),console.log(g),g};function me(){return(0,n.jsx)(qe.Z,{labelAlign:"left",form:a,onFinish:function(x){var i=ge(x);a.onFinish!=null&&a.onFinish(i),e.onFinish!=null&&e.onFinish(i)},scrollToFirstError:!0,initialValues:e.values,children:(0,n.jsx)(ce.Z,{gutter:24,children:w()})})}function xe(){var m;if(u.models!=null&&((m=u.models)===null||m===void 0?void 0:m.length)>0){var x;return(0,n.jsx)(He.Z,{defaultActiveKey:"0",children:(x=u.models)===null||x===void 0?void 0:x.map(function(i,g){var A;return(0,n.jsx)(lt,{tab:i.title,children:(0,n.jsx)(Ye,{model:i,data:{rows:r[i.propertyname],total:(A=r[i.propertyname])===null||A===void 0?void 0:A.total},iscirclebutton:!0,closetoolbar:ve,closesearch:le,closecard:!0,onSearchData:function(ue){e.onSearchData!=null&&(ue.parent=r,ue.childmodel=i,e.onSearchData(ue,function(ie){var Ee=Object.assign({},r);Ee[i.propertyname]=ie.rows,Ee[i.propertyname].total=ie.total,k(Ee)}))},onDataChange:function(ue,ie,Ee){console.log(ue,ie);var we=Object.assign({},r);we[i.propertyname]=ue.rows,we[i.propertyname].total=ue.total,console.log(we),Ee=="remove"&&ie.forEach(function(Fe){Fe&&!Fe.isnew&&i.removeRows.push(Fe)}),k(we)}})},g)})})}return(0,n.jsx)(n.Fragment,{})}function $(){return e.ismodal?(0,n.jsxs)(Xe,{title:W,width:1100,visible:R,onCancel:function(){return h(!1)},onOk:function(){a.submit()},children:[(0,n.jsx)(Me.Z,{children:me()}),xe()]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Me.Z,{title:W,children:me()}),xe()]})}return $()},cn=ut,vn=l(38535),ot=l(73218),Ht=l(34669),rt=l(82833),Gt=l(17462),_e=l(76772),pe=l(3182),hn=l(91220),dt=l(94043),Ve=l.n(dt),st=l(43347),Jt=l(35556),gn=l(97880),ft=gn.Z.Step,ct=function(e){var v,E,o=(0,f.useState)((v=e.currentStep)!==null&&v!==void 0?v:0),a=(0,F.Z)(o,2),b=a[0],M=a[1],W=(0,f.useState)((E=e.isShow)!==null&&E!==void 0?E:!1),B=(0,F.Z)(W,2),c=B[0],D=B[1];(0,f.useEffect)(function(){var u;D((u=e.isShow)!==null&&u!==void 0?u:!1)},[e.isShow]),(0,f.useEffect)(function(){var u;if(M((u=e.currentStep)!==null&&u!==void 0?u:0),e.onChange){var t;e.onChange((t=e.currentStep)!==null&&t!==void 0?t:0)}},[e,e.currentStep]);function R(u){return e.onCurrentStepComponent?e.onCurrentStepComponent(u):(0,n.jsx)(cn,{attr:e.attr,ismodal:!1})}function h(){var u;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(gn.Z,{current:b,onChange:function(j){M(j),e.onChange&&e.onChange(j)},children:(u=e.stepItem)===null||u===void 0?void 0:u.map(function(t){return(0,n.jsx)(ft,(0,ee.Z)({},t))})}),(0,n.jsx)(an.Z,{}),R(b)]})}function z(u){D(u),e.onShowChange&&e.onShowChange(u)}function _(){if(e.isModal){var u={onOk:function(){z(!1)},onCancel:function(){z(!1)}};return e.closeOk&&(u.footer=!1),(0,n.jsx)(Xe,(0,ee.Z)((0,ee.Z)({maskClosable:!1,destroyOnClose:!0,title:e.title,width:900,visible:c},u),{},{children:h()}))}return e.isCard?(0,n.jsx)(Me.Z,{title:e.title,bordered:!1,children:h()}):h()}return _()},vt=ct,en=l(54701),ht=l(58602),mn=l(32059);function Sn(U,e,v){var E=U.map(function(B,c){return Object.assign({},{key:B.key,title:B.title,position:String.fromCharCode(65+c)+1})}).reduce(function(B,c){return Object.assign({},B,(0,mn.Z)({},c.position,{key:c.key,v:c.title}))},{}),o=e.map(function(B,c){return U.map(function(D,R){return Object.assign({},{content:B[D.key],position:String.fromCharCode(65+R)+(c+2)})})}).reduce(function(B,c){return B.concat(c)}).reduce(function(B,c){return Object.assign({},B,(0,mn.Z)({},c.position,{v:c.content}))},{}),a=Object.assign({},E,o),b=Object.keys(a),M="".concat(b[0],":").concat(b[b.length-1]),W={SheetNames:["mySheet"],Sheets:{mySheet:Object.assign({},a,{"!ref":M,"!cols":[{wpx:45},{wpx:100},{wpx:200},{wpx:80},{wpx:150},{wpx:100},{wpx:300},{wpx:300}]})}};en.NC(W,v)}function gt(U,e,v,E,o){return nn.apply(this,arguments)}function nn(){return nn=(0,pe.Z)(Ve().mark(function U(e,v,E,o,a){var b,M;return Ve().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:v>0&&(b=[],e.fields.forEach(function(c){c.visible&&b.push({title:c.title,key:c.field,item:c})}),M=Object.assign({},E),M.page=1,M.size=v,M.size>0&&o(M).then(function(c){if(c!=null&&c.success&&c.data&&c.data.rows){var D=c.data.rows;for(var R in D)for(var h in b){var z=D[R][b[h].key],_=dn(z,b[h].item,D[R]);D[R][b[h].key]=_!=null?_:""}Sn(b,D,a)}}));case 1:case"end":return B.stop()}},U)})),nn.apply(this,arguments)}var mt=function(e){var v,E=(0,f.useState)(0),o=(0,F.Z)(E,2),a=o[0],b=o[1],M=(0,f.useState)((v=e.isShow)!==null&&v!==void 0?v:!1),W=(0,F.Z)(M,2),B=W[0],c=W[1],D=(0,f.useState)(0),R=(0,F.Z)(D,2),h=R[0],z=R[1],_=(0,f.useState)({model:void 0,data:{rows:[],total:0}}),u=(0,F.Z)(_,2),t=u[0],j=u[1],I=(0,f.useState)(A(e.attr)),r=(0,F.Z)(I,2),k=r[0],oe=r[1],H=(0,f.useState)({message:"",description:"",type:"success",count:0}),ve=(0,F.Z)(H,2),de=ve[0],he=ve[1],Ze=(0,f.useState)(null),le=(0,F.Z)(Ze,2),P=le[0],Q=le[1],w=(0,f.useState)({model:null,rows:[],total:0}),d=(0,F.Z)(w,2),Y=d[0],ne=d[1],Se=(0,f.useState)(!0),ge=(0,F.Z)(Se,2),me=ge[0],xe=ge[1],$=(0,f.useState)(void 0),m=(0,F.Z)($,2),x=m[0],i=m[1];function g(){b(0),z(0),j({model:void 0,data:{rows:[],total:0}}),he({message:"",description:"",type:"success",count:0}),Q(null),ne({model:null,rows:[],total:0}),xe(!0),i(void 0)}function A(S){var s;return(s=S.fields)===null||s===void 0?void 0:s.filter(function(C){return C.visible&&!C.disabled})}(0,f.useEffect)(function(){c(e.isShow)},[e.isShow]),(0,f.useEffect)(function(){oe(A(e.attr))},[e.attr]);var G=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(C){setTimeout(function(){C(!0)},s)})};function ue(){var S={title:"\u4E0A\u4F20\u5BFC\u5165\u6587\u4EF6"},s={title:"\u8BBE\u7F6E\u5BFC\u5165\u6620\u5C04"},C={title:"\u5BFC\u5165\u6570\u636E"},V=[S,s,C];return V}function ie(S){var s={fields:[]};if(S.length>0)for(var C in S[0]){var V;(V=s.fields)===null||V===void 0||V.push({field:C,title:C,type:"string",visible:!0,sorter:!1})}return s}function Ee(S){var s=S.rowcount,C=S.data;if(s>0){z(s);for(var V=ie(C),X=[],L=0;L<6;L++)X.push(C[L]);j({model:V,data:{rows:X,total:5}})}}function we(){var S,s,C=new Map,V=new Map;(S=t.model)===null||S===void 0||(s=S.fields)===null||s===void 0||s.forEach(function(ae,T){C.set(T,ae.title)});var X=[];k.forEach(function(ae,T){var se,ye;V.set(T,ae.title);var q=ae.foreign&&ae.foreign.isfkey?"Name":"",Ce=(se=t.model)===null||se===void 0||(ye=se.fields)===null||ye===void 0?void 0:ye.find(function(Ge){return Ge.field==ae.field||Ge.field==ae.title}),De=void 0;if(Ce==null||Ce==null){var Oe;T<((Oe=t.model)===null||Oe===void 0?void 0:Oe.fields.length)&&(De=T),X.push({id:T,source:De,target:T,defaultValue:"",foreignMap:q})}else{var Te=(0,hn.Z)(C.entries()),Le;try{for(Te.s();!(Le=Te.n()).done;){var Ne=Le.value;if(Ce.title==Ne[1]||Ce.field==Ne[1]){De=Ne[0];break}}}catch(Ge){Te.e(Ge)}finally{Te.f()}X.push({id:T,source:De,target:T,defaultValue:"",foreignMap:q})}});var L=[{field:"source",title:"\u6765\u6E90\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:C},visible:!0,sorter:!1},{field:"target",title:"\u76EE\u6807\u5217\u540D",type:"string",comvtp:{isvtp:!0,items:V},visible:!0,sorter:!1,isedit:!1},{field:"defaultValue",title:"\u9ED8\u8BA4\u503C",type:"string",visible:!0,sorter:!1},{field:"foreignMap",title:"\u5916\u5173\u8054\u6620\u5C04",type:"string",visible:!0,sorter:!1}];ne({model:{fields:L,isadd:!1,isedit:!0,isremove:!1},rows:X,total:X.length})}function Fe(S){var s={};for(var C in Y.rows){var V,X,L=Y.rows[C],ae=(V=t.model)===null||V===void 0?void 0:V.fields[L.source];if(!((ae==null||ae==null)&&L.defaultValue=="")){var T=k[L.target];if(!(T==null||T==null)){if(L.defaultValue!=null&&L.defaultValue!=""){var se;s[T.field]=L.defaultValue,(se=T.foreign)!==null&&se!==void 0&&se.isfkey&&(s[T.field]=L[T.field]);continue}var ye=ae.field,q=S[ye];if(T.required&&(q==null||q==null||q=="")){y(s,"\u5BFC\u5165\u6570\u636E".concat(ae.field,"\u4E3A\u7A7A\u503C\uFF0C\u6620\u5C04\u9879").concat(T.title,"\u4E0D\u80FD\u4E3A\u7A7A\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5\uFF01"),0);return}if(!(q==null||q==null||q=="")){if(T!=null&&T.comvtp&&T.comvtp.isvtp){var Ce=(0,hn.Z)(T.comvtp.items.entries()),De;try{for(Ce.s();!(De=Ce.n()).done;){var Oe=De.value;if(q==Oe[1]){q=Oe[0];break}}}catch(Le){Ce.e(Le)}finally{Ce.f()}}if((X=T.foreign)!==null&&X!==void 0&&X.isfkey&&x!=null&&x.has(T.field)){var Te=x.get(T.field);q=Te[q]}s[T.field]=q}}}}return s}function Ae(S){var s=new Map;return Y.rows.forEach(function(C){var V,X=(V=t.model)===null||V===void 0?void 0:V.fields[C.source];if(X){var L,ae=k[C.target],T=C.foreignMap==""?"Name":C.foreignMap;if((L=ae.foreign)!==null&&L!==void 0&&L.isfkey&&C.defaultValue==""){s.has(ae.field)||s.set(ae.field,new Map);var se=s.get(ae.field);for(var ye in S){var q=S[ye],Ce=q[X.field];Ce!=null&&Ce!=""&&!se.has(Ce)&&(se==null||se.set(Ce,T))}}}}),s}function Pe(S){var s=Ae(S);if(s.size==0){xe(!1),he({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210......",type:"info",count:0});return}var C="";s.forEach(function(V,X){var L=k.find(function(q){return q.field==X}),ae=k.find(function(q){return q.type=="string"}).searchsymbol.find(function(q){return q.label=="\u7B49\u4E8E"}).value,T=[],se="";V.forEach(function(q,Ce){se=q.toLowerCase(),T.push({name:q,symbol:ae,value:Ce,relation:"||"})});var ye={field:L,foreign:L.foreign,whereList:T};e.onSearchData&&(G(200),e.onSearchData(ye,function(q){if(q&&q.rows.length>0)if(q.rows.length==V.size){console.log(V);for(var Ce in q.rows){var De=q.rows[Ce][se];V.has(De)&&(V[De]=q.rows[Ce].id)}i(s),xe(!1),console.log(de.description),he({message:"\u8BF7\u70B9\u51FB\u5F00\u59CB\u5BFC\u5165",description:"\u5BFC\u5165\u6570\u636E\u51C6\u5907\u5B8C\u6210,\u5DF2\u6620\u5C04".concat(L==null?void 0:L.title,"\u6570\u636E").concat(q.total,`\u9879\u3002
`),type:"info",count:0})}else V.forEach(function(Oe,Te){var Le=q.rows.find(function(Ne){return Ne[se]==Te});C+="".concat(L==null?void 0:L.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(Te,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),Le==null&&y(q.rows,C,0)});else C+="".concat(L==null?void 0:L.title,"\u4E2D\u672A\u627E\u5230").concat(se,"\u4E3A").concat(T[0].value,`\u7684\u6570\u636E\uFF0C\u8BF7\u4FEE\u6539Excel\u540E\u91CD\u8BD5!
`),y(q.rows,C,0)}))})}function ke(S){if(P==null||P.data==null){We.Z.error({content:(0,n.jsx)("div",{children:"\u5BFC\u5165\u6570\u636E\u672A\u4E0A\u4F20\uFF0C\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}var s=P.data;if(Y.rows.length<=0){We.Z.error({content:(0,n.jsx)("div",{children:"Excel\u4E8E\u6570\u636E\u6620\u5C04\u5173\u7CFB\u672A\u8BBE\u7F6E\u4E0D\u80FD\u5BFC\u5165\uFF01"})});return}if(!me){if(S==s.length){he({message:"\u5BFC\u5165\u6570\u636E\u5B8C\u6210",description:"",type:"success",count:S}),xe(!0);return}var C=Fe(s[S]);C!=null&&J(C,function(V,X){te(C,V,X,S)})}}function te(S,s,C,V){s?(V++,he({message:"\u5BFC\u5165\u6210\u529F",description:JSON.stringify(S),type:"success",count:V}),G(200),ke(V)):y(S,C,V)}function J(S,s){return K.apply(this,arguments)}function K(){return K=(0,pe.Z)(Ve().mark(function S(s,C){return Ve().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:e.onAdd&&e.onAdd("add",s).then(function(){var L=(0,pe.Z)(Ve().mark(function ae(T){return Ve().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:if(console.log(T),T.ok!=null&&T.ok==!1&&(xe(!0),C(!1,T.statusText)),!(T!=null&&T.success)){ye.next=8;break}return ye.next=5,G(200);case 5:C(!0),ye.next=10;break;case 8:xe(!0),C(!1,T.message);case 10:case"end":return ye.stop()}},ae)}));return function(ae){return L.apply(this,arguments)}}());case 1:case"end":return X.stop()}},S)})),K.apply(this,arguments)}function y(S,s,C){var V={message:"\u5BFC\u5165\u51FA\u9519:"+JSON.stringify(S),description:s,type:"error",count:C,action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"ghost",onClick:function(){if(e.form){var L=e.form;L.clear(),L.setHideSearch(!0),L.setTitle(e.title),L.show(),L.setValues(S),L.onFinish=function(ae){console.log(ae),L.hide(),J(ae,function(T,se){te(ae,T,se,C)})}}},children:"\u4FEE\u6539"})})};he(V)}function Z(){var S={name:"file",accept:".xlsx, .xls",onChange:function(C){console.log(C);var V=new FileReader;V.onload=function(X){try{var L=X.target.result,ae=en.ij(L,{type:"binary"}),T=[];for(var se in ae.Sheets)if(ae.Sheets.hasOwnProperty(se)){T=en.P6.sheet_to_json(ae.Sheets[se]);break}var ye={data:T,rowcount:T.length};Q(ye),Ee(ye)}catch(q){tn.default.error("\u53D1\u751F\u9519\u8BEF\uFF01"),console.log(q)}},V.readAsBinaryString(C.file.originFileObj)}};return(0,n.jsxs)(Me.Z,{children:[(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(_e.Z,{showIcon:!0,message:"\u4E0A\u4F20\u6587\u4EF6\u4E2D\u7684\u6570\u636E\u4E3A".concat(h,"\u884C"),type:"info",action:(0,n.jsx)(Ke.Z,{children:(0,n.jsx)(be.Z,{size:"small",type:"primary",onClick:function(){var C=[],V={};k.forEach(function(X){C.push({title:X.title,key:X.field}),V[X.field]=X.type+"(\u6570\u636E\u7C7B\u578B\u63D0\u793A\uFF0C\u5F55\u5165\u6570\u636E\u65F6\u8BF7\u5220\u9664)"}),Sn(C,[V],e.title+"\u5BFC\u5165\u6A21\u677F.xlsx")},children:"\u4E0B\u8F7D\u5BFC\u5165\u6A21\u677F"})})})})}),(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsxs)(ht.default,(0,ee.Z)((0,ee.Z)({},S),{},{children:[(0,n.jsx)("p",{className:"ant-upload-drag-icon",children:(0,n.jsx)(st.Z,{})}),(0,n.jsx)("p",{className:"ant-upload-text",children:"\u70B9\u51FB\u6216\u62D6\u62FD\u6587\u4EF6\u4E0A\u4F20"})]}))})}),(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Qe,{isclosecard:!0,attr:t.model,data:t.data})})}),(0,n.jsx)(ce.Z,{gutter:[8,8],children:(0,n.jsx)(re.Z,{span:24,push:11,children:(0,n.jsx)(be.Z,{type:"primary",disabled:h<1,onClick:function(){b(a+1)},children:"\u4E0B\u4E00\u6B65"})})})]})}function O(){var S={isselect:!1,closesearch:!0,closetoolbar:!0,closecard:!0,model:Y.model,data:{rows:Y.rows,total:Y.total},onDataChange:function(C){ne((0,ee.Z)((0,ee.Z)({},Y),{},{rows:C.rows}))},onGetFieldToEdit:function(C,V){if(C.field=="defaultValue"){var X=V.target,L=k[X];return L}return C},onEditRowing:function(C,V,X){return X!=null&&(C.defaultValue=String(X)),!0},onSearchValueChange:function(C,V,X){X.text!=null&&(V.defaultValue=X.text)},onSearchData:e.onSearchData};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(Ye,(0,ee.Z)({},S))})}),(0,n.jsxs)(ce.Z,{gutter:[16,16],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",onClick:function(){b(a+1)},children:"\u4E0B\u4E00\u6B65"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){b(a-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function N(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(_e.Z,{message:"\u6570\u636E\u5BFC\u5165\uFF0C\u603B\u9700\u8981\u5BFC\u5165".concat(h,"\u884C\uFF0C\u5DF2\u5BFC\u5165").concat(de.count,"\u884C"),type:"info"})})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(rt.Z,{percent:parseInt((de.count/h*100).toString()),status:"active"})})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:(0,n.jsx)(_e.Z,(0,ee.Z)({},de))})}),(0,n.jsxs)(ce.Z,{gutter:[8,8],children:[(0,n.jsx)(re.Z,{span:12,push:10,children:(0,n.jsx)(be.Z,{type:"primary",disabled:me,onClick:function(){ke(de.count)},children:"\u5F00\u59CB\u5BFC\u5165"})}),(0,n.jsx)(re.Z,{span:12,push:1,children:(0,n.jsx)(be.Z,{onClick:function(){b(a-1)},children:"\u4E0A\u4E00\u6B65"})})]})]})}function p(S){c(S),e.onShowChange&&e.onShowChange(S),S||g()}function fe(){return(0,n.jsx)(vt,{title:"\u5BFC\u5165".concat(e.title,"\u6570\u636E"),closeOk:!0,isModal:!0,isShow:B,stepItem:ue(),currentStep:a,onChange:function(s){if(s==1&&we(),s==2&&P&&P.data){var C=P.data;Pe(C)}b(s)},onCurrentStepComponent:function(s){return s==0?Z():s==1?O():s==2?N():(0,n.jsx)(n.Fragment,{})},onShowChange:function(s){p(s)}})}return fe()},St=mt,xt=function(e){var v=(0,f.useState)(!1),E=(0,F.Z)(v,2),o=E[0],a=E[1],b=(0,f.useState)(null),M=(0,F.Z)(b,2),W=M[0],B=M[1],c=(0,f.useState)(0),D=(0,F.Z)(c,2),R=D[0],h=D[1],z=(0,f.useState)([]),_=(0,F.Z)(z,2),u=_[0],t=_[1],j=(0,f.useState)(void 0),I=(0,F.Z)(j,2),r=I[0],k=I[1],oe=(0,f.useState)({rows:[],total:0}),H=(0,F.Z)(oe,2),ve=H[0],de=H[1],he=(0,f.useState)(!1),Ze=(0,F.Z)(he,2),le=Ze[0],P=Ze[1],Q=(0,f.useState)(null),w=(0,F.Z)(Q,2),d=w[0],Y=w[1],ne=(0,f.useState)({page:1,size:10,whereList:[],sortList:[]}),Se=(0,F.Z)(ne,2),ge=Se[0],me=Se[1],xe=(0,f.useState)(1),$=(0,F.Z)(xe,2),m=$[0],x=$[1];if((0,f.useEffect)(function(){k(void 0),B(null),h(0),t([]),de({rows:[],total:0}),i()},[e.controller]),r==null)return(0,n.jsx)(n.Fragment,{});function i(){if(console.log("waypage.init"),console.log(e),!e.init){var te,J=(te=e.namespace)!==null&&te!==void 0?te:e.controller;console.log(J+"model \u672A\u521B\u5EFA\u6216init\u65B9\u6CD5\u672A\u5B9E\u73B0\uFF0C\u4E0D\u80FD\u521D\u59CB\u5316page.");return}e.init().then(function(K){K!=null&&(K.success?(k(K.data),K.data.autoload&&g({},function(y){de(y)})):ie(K.message))})}function g(te,J){h(0),a(!0),e.search(te).then(function(K){if(K!=null)if(a(!1),K!=null&&K.success){if(K.data.rows==null&&(K.data.rows=[]),te.foreign==null&&te.childmodel==null&&u.length>0){var y=K.data.rows.find(function(Z){return Z.id==u[0]});y!=null?(t(u),h(u.length),B(y)):(t([]),h(0),B(null))}J?J(K.data):de(K.data)}else ie(K.message)},function(K){console.log(K),a(!1)})}var A=function(J){var K=null;J.isselectrow&&(K=W),J.selectmultiple&&(K=u),G(J,K)},G=function(J,K){a(!0),e.execute(J.command,K).then(function(y){console.log(y),y!=null&&y.success?(a(!1),tn.default.success(J.name+"\u5B8C\u6210"),(r==null?void 0:r.viewtype)!="form"&&(d&&d.hide(),g(ge,function(Z){de(Z)}))):(a(!1),ie(y.message))},function(y){console.log(y),a(!1)})};function ue(te){return typeof te=="object"&&te!==null}function ie(te){var J=te;ue(te)&&(J=te.message),We.Z.error({visible:!0,title:"\u51FA\u9519\u4E86",icon:(0,n.jsx)(ot.Z,{}),content:(0,n.jsx)("div",{children:J})})}function Ee(te,J){d!=null&&d.clear(),d.setHideSearch(!0),d.setTitle((r==null?void 0:r.title)+"-"+te.name),d.show(),J&&(d.setValues(J),d.setHideSearch(!1)),d.onFinish=function(K){console.log(K),G(te,K)}}function we(te){var J,K=te?{fields:r==null||(J=r.fields)===null||J===void 0?void 0:J.filter(function(y){var Z;return(Z=y.issearch)!==null&&Z!==void 0?Z:!0}),onSearch:function(Z){a(!0);var O={page:1,whereList:[]};Z!=null&&((0,ze.isArray)(Z)?O.whereList=Z:O.whereList=[Z]),me(O),x(1),g(O,function(N){de(N)})},onSearchData:g}:!1;return(0,n.jsx)(fn,{attrs:r==null?void 0:r.commands,isselectrow:!0,selectcount:R,commandShow:!0,isshow:!te,onClick:function(Z,O){if(console.log(Z),Z=="ImportData"||Z=="importdata"){P(!0);return}if(Z=="ExportData"||Z=="exportdata"){gt(r,ve.total,ge,e.search,e.title+".xlsx");return}if(Z=="add"){if((r==null?void 0:r.viewtype)=="form"){d.onFinish=function(N){console.log(N),G(O,N)},d.submit();return}Ee(O);return}if(Z=="edit"){Ee(O,W);return}A(O)},searchShow:K})}function Fe(){return(0,n.jsx)(Qe,{attr:r,data:ve,isselect:!0,isexpandable:!0,loading:o,current:m,onSelectRows:function(J,K){t(K),h(K.length),B(J)},onSearchData:function(J,K){if(J.parent&&J.childmodel){g(J,function(y){K(y)});return}a(!0),x(J.page),J.whereList=ge.whereList,me(J),g(J,function(y){de(y)})},onExpandedRowTabPane:e.onExpandedRowTabPane,onRowDoubleClick:function(J,K){var y,Z=r==null||(y=r.commands)===null||y===void 0?void 0:y.find(function(O){return O.command=="edit"&&O.visible});Z!=null&&Ee(Z,K)}})}function Ae(te){return(0,n.jsx)(cn,{attr:r,title:e.title,ismodal:te,onInitFormed:function(K){Y(K)},onSearchData:g})}function Pe(){return(r==null?void 0:r.viewtype)=="form"?ke():(0,n.jsxs)(vn.Oc,{title:e.title,children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:we(!0)})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Fe()})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ae(!0)})}),(0,n.jsx)(St,{title:e.title,isShow:le,attr:r,onAdd:e.execute,form:d,onShowChange:function(J){P(J),J||g(ge)},onSearchData:g})]})}function ke(){return(0,n.jsxs)(vn.Oc,{title:e.title,children:[(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:we(!1)})}),(0,n.jsx)(ce.Z,{gutter:[16,16],children:(0,n.jsx)(re.Z,{span:24,children:Ae(!1)})})]})}return Pe()};function yt(U,e){var v=e.controller;e.namespace!=null&&(v=e.namespace);var E=function(M){return{type:v+"/init",payload:M}},o=function(M){return{type:v+"/search",payload:M}},a=function(M){return{type:v+"/execute",payload:M}};return{dispatch:U,init:function(){return U(E({c:e.namespace+"/"+e.service+"/"+e.controller,s:e.service}))},search:function(M){var W=e.namespace+"/"+e.service+"/"+e.controller;return U(o({c:W,item:M,s:e.service}))},execute:function(M,W){var B=e.namespace+"/"+e.service+"/"+e.controller;return U(a({c:B,command:M,item:W,s:e.service}))}}}var Ct=(0,yn.$j)(function(){},yt)(xt)},20067:function(){}}]);
